"use strict";angular.module("abtesting",["ngCookies","ngSanitize","ngAnimate","ngFileUpload","ui.router","ui.bootstrap","ui.bootstrap-slider","daterangepicker","monospaced.qrcode","LocalStorageModule","angular-loading-bar","angularQFileUpload","angular-toArrayFilter","ng-echarts","ngclipboard","xeditable","btford.socket-io","angularTreeview","ct.ui.router.extras","config","colorpicker.module","nzTour"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","localStorageServiceProvider","$tooltipProvider","$cookiesProvider","$qProvider","ENV",function(a,b,c,d,e,f,g,h){g.errorOnUnhandledRejections(!1),b.otherwise(function(a){var b=a.get("$state");b.go("app.main")}),c.html5Mode({enabled:!1,requireBase:!1}).hashPrefix(""),d.setPrefix("ADHOC_").setStorageType("sessionStorage").setNotify(!0,!0),e.options({appendToBody:!0});var i=new Date;i.setDate(i.getDate()+2),f.defaults.expires=i}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"],a.interceptors.push("httpInterceptor")}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1,a.latencyThreshold=500}]).run(["App","$state","$timeout","$rootScope","$anchorScroll","$window","abToast","cfpLoadingBar",function(a,b,c,d,e,f,g,h){function i(d,e,f){if(!e.role||!e.role.noAuth)return a.isLoggedIn()?void(e.role&&e.role.noApp||(a.popup(),a.getAppID()||(d.preventDefault(),c(function(){return b.go("app.appmanage")})),e.role&&e.role.noExp||(a.isCurExpIdExist()||(d.preventDefault(),c(function(){return b.go("app.main")})),a.isExist()||(d.preventDefault(),a.getAppData(function(){c(function(){return b.go(e,f)})}))))):(d.preventDefault(),c(function(){b.go("login",{},{reload:!0})}))}c(function(){h.complete()},3e3),d.online=navigator.onLine,a.checkInternet(),d.$state=b,a.resume(),d.$on("$stateChangeStart",function(b,c,e,f){d.pageTitle=c.data.pageTitle,f&&f.name&&(a.setFromState(f),c.prevStateName=f.name),i(b,c,e)}),d.$on("$viewContentLoaded",function(){jQuery("html, body").animate({scrollTop:0},200)})}]),angular.module("config",[]).constant("ENV",{name:"production API_URL",H5_URL:"https://h5.appadhoc.com",ICS_URL:"https://ics-api.appadhoc.com",EXP_URL:"https://experiment-control.appadhoc.com",AUTH_URL:"https://auth.appadhoc.com",DATA_URL:"https://data.appadhoc.com",DIMENSIONDATA_URL:"https://data-job.appadhoc.com",SUBDIVS_URL:"https://data-offline.appadhoc.com",LPO_URL:"https://lpo.appadhoc.com",DOMAIN_URL:"appadhoc.com"}),angular.module("abtesting").controller("NotifyContentCtrl",["$scope","$uibModalInstance","curMeg","AuthApi","allNotMeg","$sce",function(a,b,c,d,e,f){a.subject=f.trustAsHtml(c.subject),a.megContent=f.trustAsHtml(c.message),a.cancel=function(){d.delNotifyRead(c.id).then(function(){var a=e.indexOf(c);e=e.splice(a,1)}),b.dismiss("cancel")}}]),angular.module("abtesting").controller("AlertCtrl",["$scope","$uibModalInstance","opts",function(a,b,c){a.opts=c,a.type=c.type,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("abtesting").service("alert",["$uibModal",function(a){return{alert:function(b,c){if(!b)throw new Error("opts properties is null");b.model=0;var d=a.open({animation:!0,templateUrl:"app/alert/alert.html",controller:"AlertCtrl",windowClass:"modal-alert",size:"lg",resolve:{opts:function(){return b}}});d.result.then(function(){return"function"==typeof c&&c()},function(){})},confirm:function(b,c,d){b.model=1,b.type="query";var e=a.open({animation:!0,templateUrl:"app/alert/alert.html",controller:"AlertCtrl",windowClass:"modal-alert",size:"lg",resolve:{opts:function(){return b}}});e.result.then(function(){return c()},function(){return"function"==typeof d?d():""})}}}]),angular.module("abtesting").service("AuthApi",["$http","$interpolate","ENV",function(a,b,c){var d=c.AUTH_URL,e="https://auth.appadhoc.com";return{registerUser:function(c){var e=b("{{domain}}/auth/signup")({domain:d});return a.post(e,c)},activeUser:function(c,e){var f=b("{{domain}}/auth/active")({domain:d});return a.get(f,{params:{email:c,code:e}})},reactiveUser:function(c){var e=b("{{domain}}/auth/reactive")({domain:d});return a.get(e,{params:{email:c}})},loginUser:function(c,e){var f=b("{{domain}}/auth/login")({domain:d});return a.get(f,{params:{email:c,password:e}})},forgetPassword:function(c){var e=b("{{domain}}/password/forget")({domain:d});return a.get(e,{params:{email:c}})},resetPassword:function(c,e,f){var g=b("{{domain}}/password/reset")({domain:d});return a.get(g,{params:{email:c,password:e,code:f}})},changePassword:function(c,e){var f=b("{{domain}}/password/change")({domain:d});return a.get(f,{params:{old_password:c,new_password:e}})},changeEmail:function(c,e){var f=b("{{domain}}/email/change")({domain:d});return a.get(f,{params:{old_email:c,new_email:e}})},getUserInfo:function(c){var e=b("{{domain}}/user")({domain:d});return a.get(e,{params:{email:c}})},updateUserInfo:function(c){var e=b("{{domain}}/user")({domain:d});return a.post(e,c)},getAdminInfo:function(c){var e=b("{{domain}}/user/{{user_id}}")({domain:d,user_id:c});return a.get(e)},updateAdminInfo:function(c,e){var f=b("{{domain}}/user/{{user_id}}")({domain:d,user_id:c});return a.post(f,e)},getAllMembers:function(){var c=b("{{domain}}/members")({domain:d});return a.get(c)},addMember:function(c){var e=b("{{domain}}/members")({domain:d});return a.post(e,c)},updateMember:function(c,e){var f=b("{{domain}}/members/{{user_id}}")({domain:d,user_id:c});return a.post(f,e)},getAllusers:function(){var c=b("{{domain}}/users")({domain:d});return a.get(c)},creatApp:function(c){var e=b("{{domain}}/apps")({domain:d});return a.post(e,c)},getAllApp:function(){var c=b("{{domain}}/apps")({domain:d});return a.get(c)},getAllAppById:function(c){var e=b("{{domain}}/apps")({domain:d});return a({method:"get",url:e,params:{user_id:c}})},getAppById:function(c){var e=b("{{domain}}/apps/{{app_id}}")({app_id:c,domain:d});return a.get(e)},updateAppById:function(c,e){var f=b("{{domain}}/apps/{{app_id}}")({app_id:c,domain:d});return a.post(f,e)},delAppById:function(c){var e=b("{{domain}}/apps/{{app_id}}")({app_id:c,domain:d});return a["delete"](e)},addAppAuth:function(c,e,f){var g=b("{{domain}}/apps/{{app_id}}/users")({app_id:c,domain:d});return a.post(g,{parmas:{user_id:e,role:f}})},getAppAuth:function(c){var e=b("{{domain}}/apps/{{app_id}}/users")({app_id:c,domain:d});return a.get(e)},delAppAuth:function(c,e){var f=b("{{domain}}/apps/{{app_id}}/users/{{user_id}}")({app_id:c,user_id:e,omain:d});return a["delete"](f)},sendNotifyUsers:function(c){var e=b("{{domain}}/notify/users")({domain:d});return a.post(e,c)},sendNotifyApp:function(c){var e=b("{{domain}}/notify/apps")({domain:d});return a.post(e,c)},getNotifyRead:function(){var c=b("{{domain}}/notify/read")({domain:d});return a.get(c)},delNotifyRead:function(c){var e=b("{{domain}}/notify/{{notify_id}}")({notify_id:c,domain:d});return a["delete"](e)},getUploadToken:function(){var c=b("{{qiniuDomain}}/qiniu/token")({qiniuDomain:e});return a.get(c)}}}]),angular.module("abtesting").service("DataApi",["$http","$interpolate","ENV",function(a,b,c){var d=c.DATA_URL,e=c.DIMENSIONDATA_URL,f=c.SUBDIVS_URL,g=c.ICS_URL;return{getClientsResultsByHourly:function(c,e,f){var g=b("{{domain}}/apps/{{app_id}}/hourly_clients")({domain:d,app_id:c});return a.get(g,{params:{from_hour:e,to_hour:f}})},getClientsResultsByDaily:function(c,e,f){var g=b("{{domain}}/apps/{{app_id}}/daily_clients")({domain:d,app_id:c});return a.get(g,{params:{from_hour:e,to_hour:f}})},getClientsResults:function(c){var e=b("{{domain}}/apps/{{app_id}}/clients")({domain:d,app_id:c});return a.get(e)},getFabianClientsResults:function(c){var d=b("{{domain}}/apps/{{app_id}}/clients")({domain:f,app_id:c});return a.get(d)},getStatResultsByHourly:function(c,e,f,g){var h=b("{{domain}}/apps/{{app_id}}/hourly_results")({domain:d,app_id:c});return a.get(h,{params:{from_hour:e,to_hour:f,stat_key:g}})},getStatResultsByDaily:function(c,e,f,g){var h=b("{{domain}}/apps/{{app_id}}/daily_results")({domain:d,app_id:c});return a.get(h,{params:{from_hour:e,to_hour:f,stat_key:g}})},getStatResults:function(c,e){var f=b("{{domain}}/apps/{{app_id}}/results")({domain:d,app_id:c});return a.get(f,{params:{stat_key:e}})},getFabianStatResults:function(c,d){var e=b("{{domain}}/apps/{{app_id}}/results")({domain:f,app_id:c});return a.get(e,{params:{stat_key:d}})},getStats:function(c){var e=b("{{domain}}/apps/{{app_id}}/stats")({domain:d,app_id:c});return a.get(e)},updateStats:function(c,e){var f=b("{{domain}}/apps/{{app_id}}/stats")({domain:d,app_id:c});return a.post(f,e)},getAllUv:function(c){var e=b("{{domain}}/apps/{{app_id}}/uv")({domain:d,app_id:c});return a.get(e)},getAllUvByDay:function(c,e,f){var g=b("{{domain}}/apps/{{app_id}}/daily_uv")({domain:d,app_id:c});return a.get(g,{params:{from_hour:e,to_hour:f}})},getAllUvByHour:function(c,e,f){var g=b("{{domain}}/apps/{{app_id}}/hourly_uv")({domain:d,app_id:c});return a.get(g,{params:{from_hour:e,to_hour:f}})},getAllUvByMonth:function(c,e,f){var g=b("{{domain}}/apps/{{app_id}}/monthly_uv")({domain:d,app_id:c});return a.get(g,{params:{from_hour:e,to_hour:f}})},getRetainedData:function(c,d,e){var g=b("{{domain}}/apps/{{app_id}}/retained")({domain:f,app_id:c});return a.get(g,{params:{from_hour:d,to_hour:e}})},getAllDimensions:function(c,d){var e=b("{{domain}}/apps/{{app_id}}/get_dimensions")({domain:f,app_id:c});return a.get(e,{params:{group_id:d}})},getDimensionsByStat:function(c,d,e){var g=b("{{domain}}/apps/{{app_id}}/get_dimensions")({domain:f,app_id:c});return a.get(g,{params:{group_id:d,stat_key:e}})},getDimensionsResults:function(c,d,e,g,h){var i=b("{{domain}}/apps/{{app_id}}/results")({domain:f,app_id:c});return a.get(i,{params:{group_id:d,dimension:e,key:g,value:h}})},getDimensionsDailyResults:function(c,d,e,g,h,i,j){var k=b("{{domain}}/apps/{{app_id}}/daily_results")({domain:f,app_id:c});return a.get(k,{params:{group_id:d,dimension:e,from_hour:i,to_hour:j,key:g,value:h}})},getDimensionsDataBySummary:function(c,d,f,g){var h=b("{{domain}}/apps/{{app_id}}/summaries")({domain:e,app_id:c});return a.get(h,{params:{summary_key:f,summary_value:g,group_id:d}})},getDimensionsDataBySummaryByDay:function(c,d,f,g,h,i){var j=b("{{domain}}/apps/{{app_id}}/daily_summaries")({domain:e,app_id:c});return a.get(j,{params:{group_id:d,from_hour:f,to_hour:g,summary_key:h,summary_value:i}})},getCallerApiCountByDay:function(c,e,f){var g=b("{{domain}}/apps/{{app_id}}/daily_api_count")({domain:d,app_id:c});return a.get(g,{params:{from_hour:e,to_hour:f}})},getImportDataFilePath:function(c,d,e){var f=b("{{domain}}/csv")({domain:g});return a.get(f,{params:{from_date:c,to_date:d,group_id:e}})},getCovariance:function(c){var d=b("{{domain}}/apps/{{app_id}}/covariance")({domain:f,app_id:c});return a.get(d)}}}]),angular.module("abtesting").service("ExpApi",["$http","$interpolate","ENV",function(a,b,c){var d=c.EXP_URL;return{getAllExp:function(c){var e=b("{{domain}}/apps/{{appId}}/experiments")({appId:c,domain:d});return a.get(e)},creatExp:function(c,e){var f=b("{{domain}}/apps/{{appId}}/experiments")({appId:c,domain:d});return a.post(f,e)},updateGroupWithExp:function(c,e){var f=b("{{domain}}/groups/{{group_id}}/update_with_exp")({group_id:c,domain:d});return a.post(f,e)},getExpById:function(c){var e=b("{{domain}}/experiments/{{expId}}")({expId:c,domain:d});return a.get(e)},updateExpById:function(c,e){var f=b("{{domain}}/experiments/{{expId}}")({expId:c,domain:d});return a.post(f,e)},deleteExpById:function(c){var e=b("{{domain}}/experiments/{{expid}}")({expid:c,domain:d});return a["delete"](e)},getGroupLog:function(c,e){var f=b("{{domain}}/groups/{{groupId}}/change_logs")({appId:c,groupId:e,domain:d});return a.get(f)},getSdkConfig:function(c){var e=b("{{domain}}/apps/ADHOC_{{app_id}}/sdk_config")({domain:d,app_id:c});return a.get(e)},setSdkConfig:function(c,e){var f=b("{{domain}}/apps/{{app_id}}/sdk_config")({domain:d,app_id:c});return a.post(f,e)},getAllGroup:function(c){var e=b("{{domain}}/apps/{{appId}}/groups")({appId:c,domain:d});return a.get(e)},insertGroup:function(c,e){var f=b("{{domain}}/apps/{{appId}}/groups")({appId:c,domain:d});return a.post(f,e)},getGroupById:function(c){var e=b("{{domain}}/groups/{{groupId}}")({domain:d,groupId:c});return a.get(e)},updateGroupById:function(c,e){var f=b("{{domain}}/groups/{{groupId}}")({groupId:c,domain:d});return a.post(f,e)},deleteGroupById:function(c){var e=b("{{domain}}/groups/{{groupId}}")({groupId:c,domain:d});return a["delete"](e)},updateExps:function(c){var e=b("{{domain}}/experiments/update")({domain:d});return a.post(e,c)},getFlagsById:function(c){var e=b("{{domain}}/apps/{{appId}}/flags")({appId:c,domain:d});return a.get(e)},createFlag:function(c,e){var f=b("{{domain}}/apps/{{appId}}/flags")({appId:c,domain:d});return a.post(f,e)},updateFlageById:function(c,e,f){var g=b("{{domain}}/apps/{{appId}}/flags/{{flageName}}")({domain:d,flageName:f,appId:c});return a.post(g,e)},getAllAudiencesById:function(c){var e=b("{{domain}}/apps/{{appId}}/audiences")({domain:d,appId:c});return a.get(e)},insertAudiences:function(c,e){var f=b("{{domain}}/apps/{{appId}}/audiences")({domain:d,appId:c});return a.post(f,e)},updateAudiencesById:function(c,e,f){var g=b("{{domain}}/apps/{{appId}}/audiences/{{audienceId}}")({domain:d,appId:c,audienceId:e});return a.post(g,f)},delAudiencesById:function(c,e){var f=b("{{domain}}/apps/{{appId}}/audiences/{{audienceId}}")({domain:d,appId:c,audienceId:e});return a["delete"](f)},forceClients:function(c,e){var f=b("{{domain}}/force_clients")({domain:d});return a.post(f,{client_id:c,qr_code:e})},getGenerateClientId:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},getAllLayers:function(c){var e=b("{{domain}}/apps/{{appId}}/layers")({domain:d,appId:c});return a.get(e)},insertLayer:function(c,e){var f=b("{{domain}}/apps/{{appId}}/layers")({domain:d,appId:c});return a.post(f,e)},getLayer:function(c){var e=b("{{domain}}/layers/{{layer_id}}")({domain:d,layer_id:c});return a.get(e)},updateLayer:function(c,e){var f=b("{{domain}}/layers/{{layerId}}")({domain:d,layer_id:c});return a.post(f,e)}}}]),angular.module("abtesting").service("H5Api",["$http","$interpolate","ENV",function(a,b,c){var d=c.H5_URL,e=c.AUTH_URL;return{verSnapshot:function(c){var e=b("{{domain}}/verSnapshot")({domain:d});return a.get(e,{params:{url:c.url,name:c.name,type:c.type}})},openSdk:function(a){var c={domain:d,url:encodeURIComponent(a.url),authkey:a.authkey,appid:a.appid,groupid:a.groupid,expid:a.expid,appkey:a.appkey},e="{{domain}}/openSDK?url={{url}}&authKey={{authkey}}&appID={{appid}}&curGroupId={{groupid}}&versionId={{expid}}&appKey={{appkey}}";a.mode&&(c.mode=a.mode,e+="&mode={{mode}}");var f=b(e)(c);return f},getUploadToken:function(){var c=b("{{domainQiNiu}}/qiniu/token")({domainQiNiu:e});return a.get(c)},getFilterParmas:function(c){var e=b("{{domain}}/filterUrlParams")({domain:d});return a.post(e,c)}}}]),angular.module("abtesting").service("allExpsData",["App","$rootScope","ExpApi","ExpHelper",function(a,b,c,d){return{get:function(b,d){var e=sessionStorage.getItem("allExpsData")?angular.fromJson(sessionStorage.getItem("allExpsData")):[];return e&&!angular.isNumber(d)&&!angular.isString(d)&&d?(!angular.isArray(d)&&angular.isUndefined(_.find(e,d))?e.push(d):"",angular.isArray(d)?e=d:"",sessionStorage.setItem("allExpsData",angular.toJson(e)),b(e)):c.getAllExp(a.getAppID()).then(function(a){sessionStorage.setItem("allExpsData",angular.toJson(a.data.experiments)),b(a.data.experiments)})},compare:function(a,b,c){var d={};a.indexOf("experiments")>=0&&(this.get(function(a){d.allExpsData=a},b),c(d))}}}]),angular.module("abtesting").service("flags",["App","$rootScope","ExpApi",function(a,b,c){return{get:function(b,d){var e=sessionStorage.getItem("flagsCache")?angular.fromJson(sessionStorage.getItem("flagsCache")):[];return e&&!angular.isNumber(d)&&!angular.isString(d)&&d?(!angular.isArray(d)&&angular.isUndefined(_.find(e,d))?e.push(d):"",angular.isArray(d)?e=d:"",sessionStorage.setItem("flagsCache",angular.toJson(e)),b(e)):c.getFlagsById(a.getAppID()).then(function(a){sessionStorage.setItem("flagsCache",angular.toJson(a.data.flags)),b(a.data.flags)})},compare:function(a,b,c){var d={};a.indexOf("flags")>=0&&(this.get(function(a){d.flags=a},b),c(d))}}}]),angular.module("abtesting").service("allGroupsData",["App","$rootScope","ExpApi","ExpHelper",function(a,b,c,d){return{get:function(b,e){var f=sessionStorage.getItem("allGroupsData")?angular.fromJson(sessionStorage.getItem("allGroupsData")):[];return f&&!angular.isNumber(e)&&!angular.isString(e)&&e?(f=d.replaceOrInsertDataById(f,e),sessionStorage.setItem("allGroupsData",angular.toJson(f)),b(f)):c.getAllGroup(a.getAppID()).then(function(a){a&&(0!==a.data.groups.length&&sessionStorage.setItem("allGroupsData",angular.toJson(a.data.groups)),b(a.data.groups))})},compare:function(a,b,c){var d={};return a.indexOf("/groups")>=0||a.indexOf("update_with_exp")>=0?(this.get(function(a){d.allGroupsData=a},b),c(d)):"error过来看程序"}}}]),angular.module("abtesting").service("allLayersData",["App","$rootScope","ExpApi","ExpHelper",function(a,b,c,d){return{get:function(b,e){var f=sessionStorage.getItem("allLayersData")?angular.fromJson(sessionStorage.getItem("allLayersData")):[];return f&&!angular.isNumber(e)&&!angular.isString(e)&&e?(f=d.replaceOrInsertDataById(f,e),sessionStorage.setItem("allLayersData",angular.toJson(f)),b(f)):c.getAllLayers(a.getAppID()).then(function(a){a&&(0!==a.data.layers.length&&a&&sessionStorage.setItem("allLayersData",angular.toJson(a.data.layers)),b(a.data.layers))})},compare:function(a,b,c){var d={};a.indexOf("/layers")>=0&&(this.get(function(a){d.allLayersData=a},b),c(d))}}}]),angular.module("abtesting").service("stats",["App","$rootScope","DataApi",function(a,b,c){return{get:function(b,d){return c.getStats(a.getAppID()).then(function(a){b(a.data.stats)})},compare:function(a,b,c){var d={};a.indexOf("stats")>=0&&(this.get(function(a){d.stats=a},b),c(d))}}}]),angular.module("abtesting").service("curGroupData",["App","$rootScope","ExpApi","ExpHelper",function(a,b,c,d){return{get:function(b){b(a.getCurGroup())},compare:function(b,c,e){var f={},g=a.getCurGroup();if(b.indexOf("groups")>=0||b.indexOf("update_with_exp")>=0)return c.id==g.id?f.curGroupData=d.replaceOrInsertDataById(g,c):f.curGroupData=c,a.saveCurGroup(f.curGroupData),e(f);if(b.indexOf("/experiments")>=0||b.indexOf("/experiments/")>=0){var h=_.keyBy(a.getCurGroup().experiments,"id"),i=function(a,b,c){var d=[];if(a.id==b.id)return b;var e=a;return _.forEach(e.experiments,function(a){a.id==b.id?d.push(b):d.push(a)}),e.experiments=d,c.hasOwnProperty(b.id)||b.hasOwnProperty("experiments")||e.experiments.push(b),e};return f.curGroupData=i(g,c,h),a.saveCurGroup(f.curGroupData),e(f)}}}}]),angular.module("abtesting").service("AbDispacher",["$timeout","$q","$rootScope","Constant",function(a,b,c,d){var e={refreshActionbarCtrl:function(){c.$broadcast(d.EVENT_REFRESH_ACTIONBAE,1)},refreshSlideMenu:function(){c.$broadcast(d.EVENT_REFRESH_SLIDE_MENU,1)},refreshStatPanel:function(){c.$broadcast(d.EVENT_REFRESH_STAT_PANEL)},refreshFlagPanel:function(){c.$broadcast(d.EVENT_REFRESH_FLAG_PANEL)},refreshManagementCtrl:function(){c.$broadcast(d.EVENT_REFRESH_MANAGEMENT)},refreshCreatCtrl:function(){c.$broadcast(d.EVENT_REFRESH_CREATE)},renderPhoneView:function(a){c.$broadcast(d.EVENT_REDNER_PHONE_VIEW,{curView:a})},editorClose:function(){c.$broadcast(d.EVENT_EDITOR_CLOSE)}};return e}]),angular.module("abtesting").controller("AppCtrl",["$scope","$rootScope","App","curApp","curUser",function(a,b,c,d,e){var f=this;f.curUser=e?e.data:"",f.curApp=d?d.data:"";this.curUser;f.curUser&&c.setCurUser(f.curUser),f.curApp&&c.setApp(f.curApp)}]),angular.module("abtesting").directive("uiCiRange",function(){return{restrict:"E",template:"95%置信区间: -",link:function(a,b,c){function d(a){var d=c.notip?"":"<label>95%置信区间：</label>";a=a?a:{},a.low=a.low?a.low:0,a.high=a.high?a.high:0,a.pvalue=a.pvalue?a.pvalue:0;var e=a.low,f=a.high,g=!1;(e>0&&f>=0||e<0&&f<=0)&&(g=!0),d+='<span class="ab-table-interval">[<span   class="'+(g?e>=0?"ab-table-green":"ab-font-red":"ab-font-gray")+' ">'+(e>0?"+":"")+e.toFixed(1)+'%</span>&nbsp;&nbsp;<span  class="'+(g?f>=0?"ab-table-green":"ab-font-red":"ab-font-gray")+'">'+(f>0?"+":"")+f.toFixed(1)+"%</span>]</span>",b.html(d)}a.$watch(c.range,function(a){d(a)},!0)}}}).directive("uiVariantPercent",[function(){return{restrict:"E",template:"",link:function(a,b,c){function d(a){var c="";a="undefined"==typeof a||isNaN(a)?0:a,a-=0,c='<span class="ab-table-change"><span class="'+(a>0?"ab-table-green":a<0?"ab-font-red":"ab-table-green")+'">'+(a>0?"+":"")+a.toFixed(2)+"%</span></span>",b.html(c)}a.$watch(c.percent,function(a){d(a)},!0)}}}]).directive("tableScroll",[function(){return{restrict:"A",scope:{data:"="},link:function(a,b){function c(a,b){function c(c){var d=Math.floor(a.find("table").width())||Math.floor(a.find("div").width()),e=Math.floor(a.width()),f=a.scrollLeft(),g=d-e,h=c,i=h.wheelDelta?h.wheelDelta>0:h.detail<0;b(i),String(g).indexOf("-")!==-1&&(Number(g),g=-g),i&&0!==f&&(c.returnValue=!1,c.preventDefault&&c.preventDefault())}a&&a.bind("DOMMouseScroll mousewheel onmousewheel",function(a){var b=window.event||a;c(b)})}var d=b,e=0,f=0;a.$watch(b.scrollLeft(),function(){c(d,function(a){var c=$(b),g=!0,h=c.find("thead").find("tr").find("th").eq(0),i=c.find("tbody").find("tr").children()||"",j=0;if(j=h.width()+20,g&&c.scroll(function(){var a=c.scrollLeft();h.css("left",a),i.css("left",a)}),a){f=d.scrollLeft()-j,c.scrollLeft(f);var k=c.scrollLeft();h.css("left",k),i.css("left",k),g=!1}else{e=d.scrollLeft()+j,c.scrollLeft(e);var k=c.scrollLeft();c.scrollLeft(e),h.css("left",k),i.css("left",k),g=!1}})})}}}]).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}).directive("groupClientsSum",function(){return{restrict:"E",template:"",link:function(a,b,c){function d(a){var c="",d=[],e=_.groupBy(a.clientsData,"experiment_id"),f=_.map(a.groupData.experiments,"id");f.push(a.groupData.control.id),_.forEach(f,function(a){return e[a]?void d.push(e[a][0]):0}),c=_.reduce(_.map(d,"client_sum"),function(a,b){return a+b},0),b.html(c)}a.$watch(c.datas,function(a){d(a)},!0)}}}),angular.module("abtesting").filter("highlight",["$sce",function(a){return function(b,c){return $.isNumeric(b)&&(b=b.toString()),c&&(b=b.replace(new RegExp("("+c+")","gi"),"<mark>$1</mark>")),a.trustAsHtml(b)}}]).filter("dayOldToNew",function(){return function(a){var b=Math.ceil((new Date).getTime()/1e3);if(a.start>b)return"";if("Running"==a.status){var c=b-a.start;return Math.ceil(c/86400)}if(a.end>b)return"";var c=a.end-a.start;return Math.ceil(c/86400)}}).filter("ChangeName",function(){return function(a){var b=a||[];if(0!==b.length)for(var c in b)b[c]&&"Clients"==b[c].name&&(b[c].name="UV"),b[c]&&"Event-GET_EXPERIMENT_FLAGS"==b[c].name&&(a[c].name="PV");return b}}).filter("isChangeUrl",function(){return function(a){var b=a,c=_.keys(a);return c.forEach(function(c){return!!c&&void(a[c].hasOwnProperty("after")&&a[c].hasOwnProperty("before")&&a[c].before.hasOwnProperty("annotation")&&a[c].after.hasOwnProperty("annotation")&&a[c].before.annotation.hasOwnProperty("base_url")&&a[c].after.annotation.hasOwnProperty("base_url")&&a[c].before.annotation.base_url!=a[c].after.annotation.base_url&&(b[c].changeUrl={},b[c].changeUrl.expId=c,b[c].changeUrl.changeUrlAfter=a[c].after.annotation.base_url,b[c].changeUrl.changeUrlBefore=a[c].before.annotation.base_url))}),b}}),angular.module("abtesting").factory("httpInterceptor",["$q","$injector",function(a,b){return{request:function(a){var c=b.get("App");return a=c.checkWhiteList(a)},requestError:function(b){return a.reject(b)},response:function(a){if(a.hasOwnProperty("error_code")&&0!=a.error_code)return callback(a.reason_display);if("POST"==a.config.method){var c=b.get("dataManager");c.injectorResponseData(a.config.url,a.data)}return a},responseError:function(c){var d=b.get("alert"),e=b.get("App"),f=b.get("Constant"),g=b.get("$state");return"POST"===c.config.method&&e.getAppID()==f.DEMO_APP_ID&&403==c.status?(d.confirm({content:"Demo仅供浏览，不支持操作。请创建自己的应用进行下一步。点击取消留在页面，点击确定去创建",type:"query"},function(){g.go("app.appmanage")}),a.reject(c)):403==c.status&&"GET"===c.config.method?d.confirm({content:"仅供浏览，不支持操作。请创建自己的应用进行下一步。点击取消留在页面，点击确定去创建",type:"query"},function(){g.go("app.appmanage")}):403==c.status&&"POST"===c.config.method?(d.alert({content:"您没有权限进行此项操作",type:"fail"}),a.reject(c)):(e.isLockError()||(e.openErrorLock(),e.openErrorPage()),a.reject(c))}}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app",{templateUrl:"app/app/app.html",controller:"AppCtrl",resolve:{curApp:["AuthApi","App",function(a,b){var c=b.getAppID();return c?a.getAppById(c):{}}],curUser:["AuthApi","App",function(a,b){return a.getUserInfo()}]}})}]),angular.module("abtesting").service("App",["$timeout","$q","$rootScope","$cookies","$state","Auth","$http","$window","$uibModal","alert","localStorageService","$location","Constant","$injector","ENV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p,q,r,s,t=!1;c.env={};var u={getApp:function(){return p},getAppID:function(){var a="ADHOC_MEMBERSHIP_APPID_KEY";return c.app_id=d.get(a),c.app_id},openPenlStat:function(a){c.$broadcast("panels-stat"+a)},closePenlStat:function(a){c.$broadcast("panels-statClose"+a)},openPenls:function(){c.$broadcast("panels")},closePenls:function(){c.$broadcast("panelsClose")},resume:function(){s=d.get("ADHOC_MEMBERSHIP_AUTH_KEY"),console.log(s),g.defaults.headers.common["Auth-Key"]=s,u.getAppID(),p=k.get("_app"),c.app=p,q=k.get("group"),q&&(c.groupname=q.name),r=k.get("_user")||{}},isExist:function(){return!(!c.app||!c.app.id)},getAppData:function(a){f.getApp(c.app_id,function(b){return"string"==typeof b?void e.go("app.appmanage"):(c.app=b,c.app.type=c.app.typ,void f.getUserInfo(function(b){return u.setCurUser(b),a()}))})},openApp:function(b){return this.setApp(b),b.typ===m.APP_TYPE_LPO?this.golpo(b):void a(function(){e.go("app.main",{},{reload:!0})})},setApp:function(a){c.app=a,p=a,k.set("_app",a);var b=a?a.id:null;d.put("ADHOC_MEMBERSHIP_APPID_KEY",b),c.app_id=b},openGroup:function(a){if(u.setExp(a),u.gettyp(),p.typ===m.APP_TYPE_H5&&a.status===m.EXP_STATUS_DEF&&a.typ===m.EXP_TYPE_URL){var b=[];if(a.experiments.forEach(function(a){_.get(a,"annotation.base_url")||b.push(a)}),_.get(a,"control.annotation.base_url")||b.push(a.control),b.length>0)return e.go("app.createInfo.url.stats")}var c=a.status===m.EXP_STATUS_DEF?u.getCurVersionStateName(p,a):u.getCurDataStateName(p);e.go(c,{})},setExp:function(a){u.saveCurGroup(a)},getCurVersionStateName:function(a,b){return b.typ===m.EXP_TYPE_CODE?"app.data.testdata.version.stats":b.typ===m.EXP_TYPE_BUILD?"app.data.testdata.h5version.autostats":a.typ===m.APP_TYPE_H5&&b.typ===m.EXP_TYPE_URL?"app.data.testdata.urlversion.urlstats":a.typ===m.APP_TYPE_ANDIOD&&b.typ===m.EXP_TYPE_URL?"app.data.testdata.h5version.autostats":void 0},getCurDataStateName:function(a){return a.typ===m.APP_TYPE_ANDIOD||a.typ===m.APP_TYPE_IOS?"app.data.summary.detail.retentionplus":"app.data.summary.detail"},getCurGroup:function(){return q?q:e.go("app.main")},getCurGroupId:function(){var a=this.getCurGroup();return a.id},isCurExpExist:function(){return!!q},isCurExpIdExist:function(){var a=d.get("ADHOC_MEMBERSHIP_GROUPID_KEY");return!!a},setCurUser:function(a){r=a,r.h5builder=1,r.appbuilder=$.inArray("appbuilder",a.features)>=0?1:0,r.audience=$.inArray("audience",a.features)>=0?1:0,r.retention=$.inArray("retention",a.features)>=0?1:0,r.urlsplite=1,r.dimension=$.inArray("dimension",a.features)>=0?1:0,r.importData=$.inArray("importData",a.features)>=0?1:0,r.management=$.inArray("management",a.features)>=0?1:0,r.androidBuilder=$.inArray("new_android_edit",a.features)>=0?1:0,r.iosBuilder=$.inArray("new_ios-edit",a.features)>=0?1:0,r.power=$.inArray("power",a.features)>=0?1:0,r.fabian=$.inArray("fabian",a.features)>=0?1:0,r.lpo=$.inArray("LPO",a.features)>=0,r.expenv=$.inArray("expenv",a.features)>=0,c.env.userInfo=r,k.set("_user",r)},getCurUser:function(){return r},gettyp:function(){return q.typ},saveCurGroup:function(a){q=a,c.groupname=q.name,k.set("group",a),d.put("ADHOC_MEMBERSHIP_GROUPID_KEY",a.id)},getDatePickerConfig:function(a){var b={locale:{format:"MM/DD/YYYY",separator:" - ",applyLabel:"确定",cancelLabel:"取消",fromLabel:"从",toLabel:"到",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1},eventHandlers:{"apply.daterangepicker":function(a,c){b.applyHandler&&"function"==typeof b.applyHandler&&b.applyHandler(a,c)}},ranges:{"最近7天":[moment().subtract(6,"days"),moment()]}};return b},isDev:function(){var a=l.host();return a.indexOf("localhost")>-1},goPrev:function(){history.go(-1)},getSystemStat:function(){return[{name:"UV",statName:"UV",description:"系统预置，进入试验版本的访客数",sysEvent:!0}]},getSystemH5Stat:function(){return[{name:"UV",description:"系统预置，进入试验版本的访客数",sysEvent:!0,status:0},{name:"PV",description:"系统预置，试验页面的展示次数",sysEvent:!0,status:0}]},getAppType:function(){return c.app&&c.app.hasOwnProperty("typ")?c.app.typ:null},getGroupType:function(){return q.typ},checkWhiteList:function(a){return _.indexOf(m.WHITE_LIST,a.url)>-1&&delete a.headers["Auth-Key"],a},checkAppRole:function(){var a="ac66bf61-7608-4a5f-9bc4-9e7cf0f9694f";if(r.hasOwnProperty("owner_id")){if(_.isNull(p)&&a!=r.owner_id)return m.BROWSE_DEMO;if(r.owner_id&&a===p.id)return m.BROWSE_DEMO}return a===p.id&&a!=r.id?m.BROWSE_DEMO:p.auth_id!=r.id?m.ONLY_READ:void 0},isLoggedIn:function(){return s},logout:function(){k.clearAll(),d.remove("ADHOC_MEMBERSHIP_AUTH_KEY"),d.remove("ADHOC_MEMBERSHIP_APPID_KEY"),d.remove("ADHOC_MEMBERSHIP_USER"),r=null,p=null,q=null,s=null},setAuthKey:function(a){s=a.auth_key,g.defaults.headers.common["Auth-Key"]=s},getAuthKey:function(){return s},popup:function(){var a=this.getCurUser(),b=(new Date).getTime();if(a.pay&&0==a.pay.length){var c=moment.range(b,1e3*a.free.end).diff("days")+1,e=moment().toISOString(),f=moment(e).add(5,"d").toISOString(),g=d.get("popup");if(!(c<=0))return _.isUndefined(g)?(j.alert({content:"尊敬的用户,您的免费期还剩"+c+'天，请合理安排试验计划。如需延长使用期请<a target="_blank"  class="ab-link" href="http://www.appadhoc.com/charge.html">点击此处</a>',type:"success"}),d.put("popup","true",{expires:f})):void 0}},openErrorLock:function(){t=!0,setTimeout(function(){t=!1},2e3)},isLockError:function(){return t},openErrorPage:function(){i.open({animation:!1,templateUrl:"app/error/error.html",controller:"ErrorCtrl",windowClass:"modal-error"})},setFromState:function(a){"app.create"===a.name&&(a.name="app.createInfo.lists.expInfo"),k.set("_formState",a)},getFromState:function(){return k.get("_formState")},checkInternet:function(){h.addEventListener("offline",function(){var a=n.get("DataLogic");c.online=!1,a.checkInternetCountDown()},!1),h.addEventListener("online",function(){c.online=navigator.onLine},!1)},golpo:function(a){this.setApp(a),this.golpourl()},golpourl:function(){window.location.href=o.LPO_URL},getGroupIdForCookie:function(){var a="ADHOC_MEMBERSHIP_GROUPID_KEY";return d.get(a)}};return u}]),angular.module("abtesting").controller("AppAudienceCtrl",["$scope","App","Constant","$state","alert","ExpApi","$q",function(a,b,c,d,e,f,g){function h(g,h){i.groups=g.data.groups,i.advanceds=h.data.audiences,i.curUser=b.getCurUser(),i.indexAudienceGroups=_.groupBy(i.groups,"control.audience_id"),a.advanceds=_.filter(i.advanceds,function(a){return a.deleted===c.AUDIENCE_STATUS_DEF&&!_.get(a,"conditions")}),a.indexAudienceGroups=i.indexAudienceGroups,a.hasgroup=a.advanceds&&a.advanceds.length>0,a.power=!(!i.curUser||1!==i.curUser.audience),a.editAudience=function(a){d.go("app.config.appAudienceEdit",{advancedId:a.id})},a.delAudience=function(a){e.confirm({content:"受众一旦弃用将再也不能使用，相关试验会受到影响，确认弃用 "+a.name+"？",
type:"query"},function(e){a.deleted=c.AUDIENCE_STATUS_DELETE,f.updateAudiencesById(b.getAppID(),a.id,a).then(function(){d.reload()})})},a.showStatus=1,a.showFilter=function(b){return b.hasOwnProperty("status")||(b.status=0),b.status<=a.showStatus}}var i=this;g.all([f.getAllGroup(b.getAppID()),f.getAllAudiencesById(b.getAppID())]).then(function(a){h(a[0],a[1])})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.config.appAudience",{url:"/appaudience",templateUrl:"app/appAudience/appAudience.html",controller:"AppAudienceCtrl",role:{noExp:!0},data:{pageTitle:"应用配置"}})}]),angular.module("abtesting").controller("AppAudienceEditCtrl",["$scope","$location","$timeout","$stateParams","$rootScope","advancedAll","ExpHelper","alert","App","ExpApi","$state","groups","Constant","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=this;o.advanceds=f.data.audiences,o.indexAdvanceds=_.keyBy(o.advanceds,"id"),o.advancedsNames=_.map(o.advanceds,"name"),o.audiencedId=d.advancedId,o.curAppType=i.getAppType(),o.actionStatus=!!o.audiencedId,o.groups=l.data.groups,o.valideGroups=g.getValideGroups(o.groups),a.expTotal=o.valideGroups.length,a.expgroups=o.valideGroups,o.summaryMap={OS:{iOS:"iOS",Android:"google_android"},language:{Arabic:"ar",Chinese:"zh",Danish:"da",Dutch:"nl",English:"en",Finnish:"fi",French:"fr",Hindi:"hi",Japanese:"ja",Korean:"ko",Norwegian:"no",Portuguese:"pt",Russian:"ru",Spanish:"es",Swedish:"sv"},device_type:{"手机":"mobile","平板":"tablet","智能电视":"smarttv","可穿戴设备":"wearable","嵌入式设备":"embedded"},region_province:{"全球":"000000000000000000000000","大中华":"000000000000000000000001","亚洲其他":"000000000000000000000002","大洋洲":"000000000000000000000003","欧洲":"000000000000000000000004","北美洲":"000000000000000000000005","南美洲":"000000000000000000000006","非洲":"000000000000000000000007","中国大陆":"000000000000000000000008","香港":"000000000000000000000009","澳门":"000000000000000000000010","台湾":"000000000000000000000011","北京市":"000000000000000000000012","天津市":"000000000000000000000013","河北省":"000000000000000000000014","山西省":"000000000000000000000015","内蒙古":"000000000000000000000016","辽宁省":"000000000000000000000017","吉林省":"000000000000000000000018","黑龙江省":"000000000000000000000019","上海市":"000000000000000000000020","江苏省":"000000000000000000000021","浙江省":"000000000000000000000022","安徽省":"000000000000000000000023","福建省":"000000000000000000000024","江西省":"000000000000000000000025","山东省":"000000000000000000000026","河南省":"000000000000000000000027","湖北省":"000000000000000000000028","湖南省":"000000000000000000000029","广东省":"000000000000000000000030","广西":"000000000000000000000031","海南省":"000000000000000000000032","重庆市":"000000000000000000000033","四川省":"000000000000000000000034","贵州省":"000000000000000000000035","云南省":"000000000000000000000036","西藏":"000000000000000000000037","陕西省":"000000000000000000000038","甘肃省":"000000000000000000000039","青海省":"000000000000000000000040","宁夏":"000000000000000000000041","新疆":"000000000000000000000042"},region_city:{"石家庄市":"000000000000000000000043","唐山市":"000000000000000000000044","邯郸市":"000000000000000000000045","保定市":"000000000000000000000046","沧州市":"000000000000000000000047","太原市":"000000000000000000000049","大同市":"000000000000000000000050","晋中市":"000000000000000000000051","呼和浩特市":"000000000000000000000053","包头市":"000000000000000000000054","沈阳市":"000000000000000000000056","大连市":"000000000000000000000057","鞍山市":"000000000000000000000058","抚顺市":"000000000000000000000059","锦州市":"000000000000000000000060","长春市":"000000000000000000000062","吉林市":"000000000000000000000063","哈尔滨市":"000000000000000000000065","齐齐哈尔市":"000000000000000000000066","大庆市":"000000000000000000000067","南京市":"000000000000000000000069","无锡市":"000000000000000000000070","徐州市":"000000000000000000000071","常州市":"000000000000000000000072","苏州市":"000000000000000000000073","南通市":"000000000000000000000074","盐城市":"000000000000000000000075","扬州市":"000000000000000000000076","泰州市":"000000000000000000000077","杭州市":"000000000000000000000079","宁波市":"000000000000000000000080","温州市":"000000000000000000000081","嘉兴市":"000000000000000000000082","绍兴市":"000000000000000000000083","金华市":"000000000000000000000084","台州市":"000000000000000000000085","合肥市":"000000000000000000000087","芜湖市":"000000000000000000000088","淮南市":"000000000000000000000089","福州市":"000000000000000000000091","厦门市":"000000000000000000000092","泉州市":"000000000000000000000093","漳州市":"000000000000000000000094","南昌市":"000000000000000000000096","九江市":"000000000000000000000097","赣州市":"000000000000000000000098","济南市":"000000000000000000000100","青岛市":"000000000000000000000101","淄博市":"000000000000000000000102","烟台市":"000000000000000000000103","潍坊市":"000000000000000000000104","济宁市":"000000000000000000000105","临沂市":"000000000000000000000106","郑州市":"000000000000000000000108","洛阳市":"000000000000000000000109","安阳市":"000000000000000000000110","新乡市":"000000000000000000000111","南阳市":"000000000000000000000112","周口市":"000000000000000000000113","武汉市":"000000000000000000000115","宜昌市":"000000000000000000000116","襄樊市":"000000000000000000000117","长沙市":"000000000000000000000119","衡阳市":"000000000000000000000120","岳阳市":"000000000000000000000121","常德市":"000000000000000000000122","广州市":"000000000000000000000124","韶关市":"000000000000000000000125","深圳市":"000000000000000000000126","珠海市":"000000000000000000000127","汕头市":"000000000000000000000128","佛山市":"000000000000000000000129","江门市":"000000000000000000000130","湛江市":"000000000000000000000131","茂名市":"000000000000000000000132","肇庆市":"000000000000000000000133","惠州市":"000000000000000000000134","东莞市":"000000000000000000000135","中山市":"000000000000000000000136","揭阳市":"000000000000000000000137","南宁市":"000000000000000000000139","柳州市":"000000000000000000000140","桂林市":"000000000000000000000141","海口市":"000000000000000000000143","成都市":"000000000000000000000145","绵阳市":"000000000000000000000146","贵阳市":"000000000000000000000148","遵义市":"000000000000000000000149","昆明市":"000000000000000000000151","拉萨市":"000000000000000000000153","西安市":"000000000000000000000155","宝鸡市":"000000000000000000000156","咸阳市":"000000000000000000000157","兰州市":"000000000000000000000159","西宁市":"000000000000000000000161","银川市":"000000000000000000000163","乌鲁木齐市":"000000000000000000000165"}},o.summaryMapRevolve={};for(var p in o.summaryMap){var q=o.summaryMap[p];o.summaryMapRevolve[p]={};for(var r in q){var s=q[r];o.summaryMapRevolve[p][s]=r}}o.summaryMaps=o.summaryMapRevolve;var t=0;a.appTypeFilter=function(a){return o.curAppType===m.APP_TYPE_DEF||o.curAppType===m.APP_TYPE_H5||(o.curAppType===a.appType||a.appType===t)},a.conditions=[{name:"OS",type:"string",options:["iOS","Android","Windows Phone","BlackBerry","Mac OS","Windows","Linux"],key:"OS",appType:t},{name:"自定义标签",type:"number",input:!0,custom:!0,key:"custom",appType:t},{name:"iOS 版本",type:"number",options:["10.3","10.2","10.1","10.0","9.3","9.2","9.1","9.0","8.4","8.3","8.2","8.1","8.0","7.1","7.0"],key:"os_version",appType:m.APP_TYPE_IOS},{name:"Android 版本",type:"number",options:["7.0","6.0","5.1","5.0","4.4","4.3","4.2","4.1","4.0","3.2","3.1","3.0","2.3","2.2"],key:"os_version",appType:m.APP_TYPE_ANDIOD},{name:"浏览器",type:"string",options:["Chrome","Firefox","Safari","Opera","IE","Edge"],key:"browser",appType:m.APP_TYPE_H5},{name:"Chrome 浏览器版本",type:"number",options:["50","49","48","47","46","45","44","43","42","41","40","39","38","37","36","35","34","33","32","31","30","29","28","27","26","25","24"],key:"browser_version",appType:m.APP_TYPE_H5},{name:"Firefox 浏览器版本",type:"number",options:["45","44","43","42","41","40","39","38","37","36","35","34","33","32","31","30","29","28","27","26","25","24"],key:"browser_version",appType:m.APP_TYPE_H5},{name:"Safari 浏览器版本",type:"number",options:["9","8","7","6","5"],key:"browser_version"},{name:"Opera 浏览器版本",type:"number",options:["33","32","31","30","29","28","27","26","25","24","23","22","21","20"],key:"browser_version",appType:m.APP_TYPE_H5},{name:"Internet Explorer 浏览器版本",type:"number",options:["11","10","9","8"],key:"browser_version"},{name:"Microsoft Edge 浏览器版本",type:"number",options:["25","23","20","19","16","15","13"],key:"browser_version",appType:m.APP_TYPE_H5},{name:"Referrer URL",input:!0,key:"referrer",appType:m.APP_TYPE_H5},{name:"系统语言",type:"string",options:["Chinese","Arabic","Danish","Dutch","English","Finnish","French","Hindi","Japanese","Korean","Norwegian","Portuguese","Russian","Spanish","Swedish"],key:"language",appType:t},{name:"设备类型",type:"string",options:["PC","Mac","手机","平板","智能电视","可穿戴设备","嵌入式设备"],key:"device_type",appType:t},{name:"设备型号",type:"string",input:!0,key:"device_model",appType:t},{name:"屏幕宽度",type:"number",input:!0,key:"display_width",appType:t},{name:"屏幕高度",type:"number",input:!0,key:"display_height",appType:t},{name:"应用版本",type:"number",input:!0,key:"app_version",appType:t}],a.ops=[{label:"不是",type:"string|number",val:"not_equal"},{label:"是",type:"string|number",val:"equal"},{label:"大于",type:"number",val:"bigger"},{label:"小于",type:"number",val:"smaller"}];var u=_.keyBy(a.conditions,"name"),v=_.keyBy(a.ops,"val"),w=function(a){return _.indexOf(o.advancedsNames,a)>=0},x=function(a){var b=a.new_conditions,c=[],d=[];for(var e in b){var f=b[e];if("op"!==f.typ||"left_bracket"!==f.name)if("op"!==f.typ||"right_bracket"!==f.name)c.push(f);else{for(var g=c.length/4,h=0;h<g;h++){var i={},j=c.pop();i.val=j.name,i.op=v[c.pop().name];var k=c.pop();i.type=u[k.description],i.type||(i.type={key:""}),"OS"===i.type.key&&(i.val=o.summaryMaps.OS[i.val]?o.summaryMaps.OS[i.val]:j.name),"language"===i.type.key&&(i.val=o.summaryMaps.language[i.val]?o.summaryMaps.language[i.val]:j.name),"device_type"===i.type.key&&(i.val=o.summaryMaps.device_type[i.val]?o.summaryMaps.device_type[i.val]:j.name),"region_province"===i.type.key&&(i.val=o.summaryMaps.region_province[i.val]?o.summaryMaps.region_province[i.val]:j.val),"region_city"===i.type.key&&(i.val=o.summaryMaps.region_city[i.val]?o.summaryMaps.region_city[i.val]:j.val),"custom"==k.from&&(i.typename=k.name,i.type={custom:!0,input:!0}),i.logic=c.pop().name,d[d.length-1].conditions.push(i)}c=[],d[d.length-1].conditions.reverse()}else{var l=c.length>0?c.pop():{name:"or"};c=[],d.push({logic:l.name,conditions:[]}),c.push({type:"op",name:"or"})}}return d};o.actionStatus?(o.curAudience=o.indexAdvanceds[o.audiencedId],a.conditionlist=x(o.curAudience)):(o.curAudience={name:"",description:"",conditions:[]},a.conditionlist=[{logic:"or",conditions:[{logic:"or",type:a.conditions[0],op:a.ops[1],val:a.conditions[0].options[0]}]}]),c(function(){a.curAudience=o.curAudience}),a.$watchCollection("conditionlist",function(){C()}),a.addCondition=function(b){return z()?h.alert({content:"受众条件不能超过16个",type:"fail"}):(b.conditions||(b.conditions=[]),b.conditions.push({logic:"and",type:a.conditions[0],op:a.ops[1],val:a.conditions[0].options[0]}),void C())},a.addBrackets=function(b){return z()?h.alert({content:"受众条件不能超过16个",type:"fail"}):void a.conditionlist.push({logic:"or",conditions:[{logic:"or",type:a.conditions[0],op:a.ops[1],val:a.conditions[0].options[0]}]})},a.save=function(){var b=D(a.conditionlist),c=E(b),d=c;if(y()){if(!A())return h.alert({content:"受众条件或值不能为空",type:"fail"});a.curAudience.conditions="",a.curAudience.description||(a.curAudience.description=""),a.curAudience.new_conditions=d,o.actionStatus?j.updateAudiencesById(i.getAppID(),a.curAudience.id,a.curAudience).then(function(){h.alert({content:"更新成功",type:"success"}),k.go("app.config.appAudience")}):j.insertAudiences(i.getAppID(),a.curAudience).then(function(){h.alert({content:"创建成功",type:"success"}),k.go("app.config.appAudience")})}};var y=function(){var b=/^[\u4e00-\u9fa5A-Za-z][\u4e00-\u9fa5a-zA-Z0-9_]*$/;return a.curAudience.name?!o.actionStatus&&w(a.curAudience.name)?(h.alert({content:"分组名称已经存在，请重新命名。",type:"fail"}),!1):!!b.test(a.curAudience.name)||(h.alert({content:"受众分组名称命名必须符合变量名法则（英文字母开始，可包含下划线和数字）",type:"fail"}),!1):(h.alert({content:"请填写分组名称!",type:"fail"}),!1)},z=function(){var b=0;return _.forEach(a.conditionlist,function(a){b+=a.conditions?a.conditions.length:0}),b>=16},A=function(){for(var b=0;b<a.conditionlist.length;b++)for(var c=a.conditionlist[b],d=0;d<c.conditions.length;d++){var e=c.conditions[d];if((e.type.hasOwnProperty("custom")&&e.type.custom||e.type.hasOwnProperty("input")&&e.type.input)&&("undefined"==typeof e.val||null===e.val))return!1;if(e.type.hasOwnProperty("custom")&&e.type.custom&&!e.typename)return!1}return!0},B=function(a){for(var b={or:"||",and:"&&",equal:"=",not_equal:"!=",bigger:">",smaller:"<"},c="",d=0;d<a.length;d++){c+=0===d?"(":b[a[d].op]+" (";for(var e=0;e<a[d].params.length;e++){var f=a[d].params[e];c+=0===e?f.type+" "+b[f.op]+" "+f.val:" "+b[f.logic]+" "+f.type+" "+b[f.op]+" "+f.val}c+=")"}return c},C=function(){var b=D(a.conditionlist);a.conditionstr=B(b)},D=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e={op:d.logic,params:[]},f=0;f<(d.conditions?d.conditions:[]).length;f++){var g=d.conditions[f],h={};h.logic=g.logic,h.op=g.op.val,h.type=g.type.custom?g.typename:g.type.key,h.custom=g.type.custom,h.val=g.val,"OS"===h.type&&(h.val=o.summaryMap.OS[h.val]?o.summaryMap.OS[h.val]:g.val),"language"===h.type&&(h.val=o.summaryMap.language[h.val]?o.summaryMap.language[h.val]:g.val),"device_type"===h.type&&(h.val=o.summaryMap.device_type[h.val]?o.summaryMap.device_type[h.val]:g.val),"region_province"===h.type&&(h.val=o.summaryMap.region_province[h.val]?o.summaryMap.region_province[h.val]:g.val),"region_city"===h.type&&(h.val=o.summaryMap.region_city[h.val]?o.summaryMap.region_city[h.val]:g.val),h.description=g.type.name,e.params.push(h)}b.push(e)}return b},E=function(a){for(var b=[],c=0;c<a.length;c++){0!==c&&b.push({typ:"op",name:a[c].op}),b.push({typ:"op",name:"left_bracket"});for(var d=0;d<a[c].params.length;d++){var e=a[c].params[d];0!==d&&b.push({typ:"op",name:e.logic}),b.push({typ:"param",name:e.type,from:e.custom?"custom":"summary",description:e.description}),b.push({typ:"op",name:e.op}),b.push({typ:"param",name:e.val})}b.push({typ:"op",name:"right_bracket"})}return b};a.conditionChange=function(a){a.type.options&&!a.type.input&&(a.val=a.type.options[0]),C()},a.conditionDataChanage=function(){C()},a.resetItem=function(b,c){c.conditions.splice(b,1);var d=a.conditionlist.indexOf(c);0===c.conditions.length&&a.conditionlist.splice(d,1),C()},a.submitFig=!1,a.checkName=function(){if(y()){var a=n.document.getElementById("description");a.focus()}}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.config.appAudienceEdit",{url:"/app-audience-edit/:advancedId",templateUrl:"app/appAudienceEdit/appAudienceEdit.html",controller:"AppAudienceEditCtrl",role:{noExp:!0},data:{pageTitle:"应用配置"},resolve:{advancedAll:["App","ExpApi",function(a,b){return b.getAllAudiencesById(a.getAppID())}],groups:["App","ExpApi",function(a,b){return b.getAllGroup(a.getAppID())}]}})}]),angular.module("abtesting").controller("AppConfigCtrl",["$scope","$uibModal","ExpApi","abToast","App","$timeout","$q",function(a,b,c,d,e,f,g){function h(g,h){i.curApp=g,i.sdkConfig=h.data,a.curApp=i.curApp,a.sdkConfig=i.sdkConfig,a.formTest={apitime:"",trackertime:""},a.formTest.apitime=i.sdkConfig.getflag_interval,a.formTest.trackertime=i.sdkConfig.track_interval,a.copySDKTip="",""==a.sdkConfig.app_lowest_version&&(a.sdkConfig.app_lowest_version="全部"),a.openSdkConfig=function(b){a.editFig=!a.editFig,delete b.apitime.$error.max,a.formTest.lowest_version=""==a.sdkConfig.app_lowest_version?"全部":a.sdkConfig.app_lowest_version},a.verifyPwd=function(){var f=b.open({animation:!0,templateUrl:"components/checkPwdModel/checkPwdModel.html",controller:"CheckPwdModelCtrl",windowClass:"modal-alert",size:"lg",resolve:{exp:{},content:function(){return"更改配置后，将对集成sdk的所有的用户生效，请输入密码以确认操作"}}});f.result.then(function(){var b={getflag_interval:a.formTest.apitime,app_lowest_version:"全部"==a.formTest.lowest_version?"":a.formTest.lowest_version};c.setSdkConfig(e.getAppID(),b).then(function(b){a.editFig=!1,a.sdkConfig={},a.sdkConfig=b.data,a.sdkConfig.app_lowest_version=""==b.data.app_lowest_version?"全部":b.data.app_lowest_version,d.success({msg:"sdkconfig修改成功",icon:!0,time:3e3,top:0})})})},a.onCopySuccess=function(){a.copied=!0},a.cc=!1,a.$watch("copied",function(){f(function(){a.copied=!1},2e3)}),a.copySDKTFlg=!1,a.copy=function(){var b=document.getElementById("copy-appconfig");b.select(),document.execCommand("copy"),a.copySDKTFlg=!0},a.$watch("copySDKTFlg",function(){f(function(){a.copySDKTFlg=!1},3e3)})}var i=this;g.all([e.getApp(),c.getSdkConfig(e.getAppID())]).then(function(a){h(a[0],a[1])},function(){})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.config.appConfig",{url:"/appconfig",templateUrl:"app/appConfig/appConfig.html",controller:"AppConfigCtrl",role:{noExp:!0},data:{pageTitle:"应用配置"}})}]),angular.module("abtesting").controller("AppFlagsCtrl",["$scope","ExpHelper","ExpApi","App","$q",function(a,b,c,d,e){function f(e){g.flags=e.data.flags,a.flags=b.getCodeFlags(g.flags),a.focusTr=function(a){a.$show()},a.cleanForm=function(a,b){a.stopPropagation(),b.$cancel()},a.saveFlag=function(a,b){b.description=a.description,c.updateFlageById(d.getAppID(),b,b.name).then(function(a){})}}var g=this;e.all([c.getFlagsById(d.getAppID())]).then(function(a){f(a[0])},function(){})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.config.appFlags",{url:"/appflags",templateUrl:"app/appFlags/appFlags.html",controller:"AppFlagsCtrl",role:{noExp:!0},data:{pageTitle:"应用配置"}})}]),angular.module("abtesting").controller("AppForgotPassCtrl",["$scope","Auth","alert",function(a,b,c){function d(){return a.user.email?void(a.subDisabled=!0):void(a.subDisabled=!1)}a.subDisabled=!1,a.user={email:""},a.formTest={},a.email={tip:"",pattern:"您的联络邮箱输入错误，请重新输入",required:"请您输入联络邮箱"},a.change=function(b,c){for(var e in c.$error)if(1==c.$error[e])return a[b].tip=a[b][e],a.user[b]="",void d();a[b].tip="",a.user[b]=c.$viewValue,d()},a.forgotFn=function(){b.requestResetPassword(a.formTest.forgetPassword,function(a){return 20004==a.error_code?c.alert({content:'此账户还未激活,<a href="https://www.appadhoc.com/abtesting/#/register" >点此激活</a>',type:"fail"}):void("string"==typeof a?c.alert({content:a,type:"fail"}):a&&c.alert({content:"已经发送找回密码链接到您的邮箱，请查收。"}))})}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("appForgotPass",{url:"/begin_password_reset",templateUrl:"app/appForgotPass/appForgotPass.html",controller:"AppForgotPassCtrl",role:{noAuth:!0},data:{pageTitle:"找回密码 A/BTesting"}})}]),angular.module("abtesting").controller("AppStatsCtrl",["$scope","App","ExpHelper","DataApi","$q",function(a,b,c,d,e){function f(e){g.stats=e.data.stats,g.sysStats=b.getSystemStat(),g.curAllVailde=c.getVaildeStats(g.stats),g.curAppStats=c.getStat(g.curAllVailde),g.curAppComStats=c.getComStat(g.curAllVailde),g.indexAppStats=_.keyBy(g.curAppStats,"name"),g.indexAppComStats=_.keyBy(g.curAppComStats,"name"),a.curAppStats=_.filter(g.curAppStats,function(a){return a.name&&_.indexOf(a.name,"-")===-1}),a.curAppComStats=g.curAppComStats,a.focusTr=function(a){a.$show()},a.cleanForm=function(a,b){a.stopPropagation(),b.$cancel()},a.saveStat=function(a,c){c.description=a.description,d.updateStats(b.getAppID(),c).then(function(){})}}var g=this;e.all([d.getStats(b.getAppID())]).then(function(a){f(a[0])},function(){})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.config.appStats",{url:"/appstats",templateUrl:"app/appStats/appStats.html",controller:"AppStatsCtrl",role:{noExp:!0},data:{pageTitle:"应用配置"}})}]),angular.module("abtesting").controller("AppcreateCtrl",["$scope","$timeout","$rootScope","Auth","$state","App","alert","Constant",function(a,b,c,d,e,f,g,h){a.formTest={logo:"",url:"",description:""},a.isLpoRole=f.getCurUser().lpo,a.$watch("copied",function(){b(function(){a.copied=!1},2e3)}),a.onCopySuccess=function(){a.copied=!0},a.sub=function(){var b=f.getCurUser();return b.role===h.ROLE_COLLABORATOR?g.alert({content:"您没有权限进行此项操作",type:"fail"}):(a.formTest.typ=_.toNumber(a.formTest.typ),void d.addApp(a.formTest,function(b){"string"==typeof b?g.alert({content:b,type:"fail"}):(a.curAppObj=b,a.succesPanel=!0,f.setApp(b))}))},a.toCreate=function(){return a.curAppObj.typ===h.APP_TYPE_LPO?void f.golpo(a.curAppObj):void e.go("app.create")}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.appcreate",{url:"/appcreate",templateUrl:"app/appcreate/appcreate.html",controller:"AppcreateCtrl",role:{noApp:!0},data:{pageTitle:"版本管理 A/BTesting"}})}]),angular.module("abtesting").controller("AppinfoCtrl",["$scope","$state","$rootScope","Auth","Constant","App","curApp",function(a,b,c,d,e,f,g){a.subData={url:""},a.curApp=g.data,a.update=function(){d.updateApp(a.curApp,function(a){"string"==typeof a&&alert.alert({content:a,type:"fail"}),c.app=a})},a.back=f.goPrev}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.appinfo",{url:"/appinfo",templateUrl:"app/appinfo/appinfo.html",controller:"AppinfoCtrl",role:{noExp:!0},data:{pageTitle:"应用信息 A/BTesting"},resolve:{curApp:["AuthApi","App",function(a,b){return a.getAppById(b.getAppID())}]}})}]),angular.module("abtesting").controller("AppmanageCtrl",["$scope","App","AuthApi","$state","$timeout","Constant","alert","AuthHelper","ExpApi",function(a,b,c,d,e,f,g,h,i){function j(j){k.apps=j?j.data.apps:"";for(var l in k.apps){var m=k.apps[l];m.app_key="LT_"+m.app_key.substr(m.app_key.indexOf("_")+1,m.app_key.length)}k.curUser=b.getCurUser(),k.apps=_.filter(k.apps,function(a){return 10!=a.typ}),k.myApps=h.getCurUserApps(k.apps,k.curUser.id),k.colapps=_.difference(k.apps,k.myApps),a.myApps=k.myApps,a.userInfoData=b.getCurUser(),a.colapps=_.filter(k.colapps,function(a){return!a.name.startsWith("ABDemo_")});var n=function(b,d){var e=!1;i.getAllGroup(b.id).then(function(d){return _.forEach(d.data.groups,function(a){a.status===f.EXP_STATUS_RUN&&(e=!0)}),0!=e?g.alert({content:"应用下包含运行中的试验，请停止全部试验后再删除。",type:"fail"}):void g.confirm({content:"确认要删除"+b.name+"应用吗？删除后将无法再看到应用内的任何数据。",type:"query"},function(){c.delAppById(b.id).then(function(c){a.myApps=_.pullAllBy(a.myApps,[{id:b.id}],"id")})})})};a.openApp=function(a){b.openApp(a)},a.create=function(){d.go("app.appcreate")},a.getApp=function(a){b.setApp(a),e(function(){d.go("app.appinfo")})},a.delAppBymyapps=function(b){n(b,a.myApps)},a.delAppBycolapps=function(b){n(b,a.colapps)}}var k=this;a.isLoading=!1,c.getAllApp().then(function(b){j(b),a.isLoading=!0},function(){a.isLoading=!0})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.appmanage",{url:"/appmanage",templateUrl:"app/appmanage/appmanage.html",controller:"AppmanageCtrl",role:{noApp:!0,noExp:!0},data:{pageTitle:"应用列表 A/BTesting"}})}]),angular.module("abtesting").factory("Auth",["$cookies","$http","$location","$rootScope","$timeout","alert","ENV",function(a,b,c,d,e,f,g){var h=null,i=null,j=g.AUTH_URL;return a.get("ADHOC_MEMBERSHIP_USER")&&a.get("ADHOC_MEMBERSHIP_AUTH_KEY")&&(h={email:a.get("ADHOC_MEMBERSHIP_USER"),auth_key:a.get("ADHOC_MEMBERSHIP_AUTH_KEY"),id:a.get("ADHOC_MEMBERSHIP_USER_ID")},d.currentUser=h,i=h.auth_key,d.auth_key=i),{setUser:function(c){h=c,c?(i=c.auth_key,d.currentUser=h,d.auth_key=i,a.put("ADHOC_MEMBERSHIP_AUTH_KEY",c.auth_key),a.put("ADHOC_MEMBERSHIP_USER",c.email),a.put("ADHOC_MEMBERSHIP_USER_ID",c.id),b.defaults.headers.common["Auth-Key"]=i):(i=null,d.currentUser=null,d.auth_key=null)},getUser:function(){return h},isLoggedIn:function(){return null!=this.getUser()},clearUser:function(){this.setUser(null),a.remove("ADHOC_MEMBERSHIP_AUTH_KEY"),a.remove("ADHOC_MEMBERSHIP_APPID_KEY"),a.remove("ADHOC_MEMBERSHIP_USER")},getAuth_key:function(){return d.auth_key?d.auth_key:a.get("ADHOC_MEMBERSHIP_AUTH_KEY")},getApp_id:function(){return d.app.id},register:function(a,c,d,e){b({url:j+"/auth/signup",method:"POST",data:{email:c,password:d,invite_code:a,features:["h5builder_v2"]}}).then(function(a){e(a)})},activate:function(a,c,d){b({url:j+"/auth/active",method:"GET",params:{code:a,email:c}}).then(function(a){d(a)})},tryLogin:function(a,d){var e=this;b({url:j+"/auth/login",method:"GET",params:a}).then(function(b){if(b){if(b.hasOwnProperty("error_code"))return 20010==b.error_code?void f.confirm({content:'您的帐号还没有激活，点击"确定"将重新发送激活链接到您的邮箱，请勿关闭页面。',type:"fail"},function(){e.sendActivationEmail(a.email,function(a){f.alert({content:"已经重新发送激活链接到您的邮箱，请查收。",type:"success"})})}):(e.setUser(null),c.path("/login"),d(b.reason_display));e.setUser({email:a.email,auth_key:b.data.auth_key}),d(b.data)}})},checkPassword:function(a,c){b({url:j+"/auth/login",method:"GET",params:{email:h.email,password:a}}).then(function(a){c(a)})},getUserInfo:function(c){b({url:j+"/user",method:"GET",headers:{"Auth-Key":i},params:{}}).then(function(b){d.currentUser.id=b.data.id,a.ADHOC_MEMBERSHIP_USER_ID=b.data.id,c(b.data)})},getAllApp:function(a){return i?void b.get(j+"/apps",{headers:{"Auth-Key":i}}).then(function(b){a(b.data.apps)}):void a(null)},getApp:function(a,c){return a||(a=this.getApp_id()),a&&i?void b.get(j+"/apps/"+a,{headers:{"Auth-Key":i}}).then(function(a){c(a.data)}):void c(null)},updateApp:function(a,c){b({url:j+"/apps/"+this.getApp_id(),method:"POST",headers:{"Auth-Key":i,"Content-Type":"application/json"},data:a}).then(function(a){c(a.data)})},addApp:function(a,c){b({url:j+"/apps",method:"POST",headers:{"Auth-Key":i},data:a}).then(function(a){c(a.data)})},deleteApp:function(a,c){return a?void b({url:j+"/apps/"+a,method:"DELETE",headers:{"Auth-Key":i}}).then(function(a){c(a.data)}):void c(null)},requestResetPassword:function(a,c){b({url:j+"/password/forget",method:"GET",params:{email:a}}).then(function(a){c(a.data)})},resetPassword:function(a,c,d,e){b({url:j+"/password/reset",method:"GET",params:{code:a,email:c,password:d}}).then(function(a){e(a)})},changePassword:function(a,c,d){b({url:j+"/password/change",method:"GET",headers:{"Auth-Key":i},params:{new_password:a,old_password:c}}).then(function(a){d(a)})},sendActivationEmail:function(a,c){b({url:j+"/auth/reactive",method:"GET",params:{email:a}}).then(function(a){c(a)})},getAppNotifications:function(a){b({url:j+"/notify/read",method:"GET",headers:{"Auth-Key":i}}).then(function(b){a(b)})},deleteNotification:function(a,c){b({url:j+"/notify/"+a,method:"DELETE",headers:{"Auth-Key":i}}).then(function(a){c(a)})},sendNotification:function(a,c){b({url:j+"/notify/users",method:"POST",headers:{"Auth-Key":i},data:a}).then(function(a){})},authorizeRole:function(a,c,d){var e=this.getApp_id();b({url:j+"/user",method:"GET",headers:{"Auth-Key":i},params:{email:a}}).then(function(a){var f=a.id;b({url:j+"/apps/"+e+"/users",method:"POST",headers:{"Auth-Key":i},data:{user_id:f,role:c}}).then(function(a){d(a)})})},removeAuthorizedRole:function(a,c){var d=this.getApp_id();b({url:j+"/user",method:"GET",headers:{"Auth-Key":i},params:{email:a}}).then(function(a){var e=a.id;b({url:j+"/apps/"+d+"/users/"+e,method:"DELETE",headers:{"Auth-Key":i}}).then(function(a){c(a)})})},getAuthorizationOfApp:function(a){var c=this.getApp_id();b({url:j+"/apps/"+c+"/users",method:"GET",headers:{"Auth-Key":i}}).then(function(b){a(b.users)})}}}]),angular.module("abtesting").controller("ChangeEmailCtrl",["$rootScope","$scope","$state","$stateParams","Auth","AuthApi","alert","Constant","App",function(a,b,c,d,e,f,g,h,i){b.subDisabled=!1,b.formTest={},b.emailRegexp=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,b.curUser=i.getCurUser(),b.checkRepeatEmail=function(a){var c=b.formTest.email==b.formTest.emailTwo;a.emailTwo.$setValidity("repact",c)},b.sub=function(){f.changeEmail(b.curUser.email,b.formTest.email).then(function(a){20001==a.error_code?g.alert({content:a.reason_display,type:"fail"}):g.alert({content:"修改成功"},function(){e.clearUser(),c.go("login")})})}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.changeEmail",{url:"/changeEmail",templateUrl:"app/changeEmail/changeEmail.html",controller:"ChangeEmailCtrl",role:{noApp:!0},data:{pageTitle:"修改邮箱 A/BTesting"}})}]),angular.module("abtesting").controller("ChangePassCtrl",["$rootScope","$scope","$state","$stateParams","Auth","alert","Constant","App","appsData","AuthHelper","DataApi","$q","abToast","DataHelper",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.bSub=!0,b.subDisabled=!1,b.formTest={},b.acTest=!1,b.nuTest=!1,b.enTest=!1,b.curUser=h.getCurUser(),self.apps=j.getCurUserApps(i.data.apps,b.curUser.id),self.allAppsId=_.map(self.apps,"id"),self.roles=[{name:"创建者",key:g.ROLE_OWNER},{name:"编辑者",key:g.ROLE_ADMIN},{name:"普通用户",key:g.ROLE_COLLABORATOR}],b.roles=_.keyBy(self.roles,"key"),b.oldPwd={tip:"",pattern:"您的密码输入错误，请重新输入",required:"请您输入密码"},b.pwd={tip:"",pattern:"您的密码输入错误，请重新输入",required:"请您输入密码"},b.pwdTwo={tip:"",pattern:"您输入的密码不一致，请重新输入",required:"请您输入相同密码确认"},b.changePass=function(a){var c=/.{8,}/,d=/[\d\W]/,e=/[a-zA-Z]/;return a?(b.acTest=c.test(a),b.nuTest=d.test(a),void(b.enTest=e.test(a))):(b.acTest=!1,b.nuTest=!1,void(b.enTest=!1))},b.sub=function(){e.changePassword(b.formTest.password,b.formTest.oldPassword,function(a){20001==a.error_code?f.alert({content:a.reason_display,type:"fail"}):(b.formTest.password="",b.formTest.passwordTwo="",b.formTest.userPassword="",f.alert({content:"修改成功"},function(){e.clearUser(),c.go("login")}))})},b.back=h.goPrev,self.getCurUserStatus=function(){var a=(new Date).getTime();return 1e3*b.curUser.free.end>a&&1e3*b.curUser.free.begin<a?(b.curUserStatus="免费试用",b.endDate=moment(1e3*b.curUser.free.end).format("YYYY-MM-DD")):(b.curUser.pay.forEach(function(a){if(n.isNewDateInTheTime(a))return b.curUserStatus="付费用户",b.apiMax=a.num,b.endDate=moment(1e3*n.getLastTimeoFNewDateInContinuousDate(b.curUser.pay).end).format("YYYY-MM-DD")}),b.endDate?void 0:b.curUserStatus="账户已失效")},self.getCurUserStatus(),self.getCurHistory=function(){var a=moment().subtract(1,"months").toObject();b.curHistory={history:a.years+"年"+(a.months+1)+"月",format:moment().subtract(1,"months").format("YYYY-MM")}},self.getCurHistory(),self.selectHistory=function(a){var b={},c=moment(a).daysInMonth();return b.startDate=moment(a+"-01").toISOString(),b.endDate=moment(a+"-"+c).toISOString(),b},self.getEarliestTime=function(){if(0!=self.apps.length)for(var a,b=((new Date).getTime(),_.orderBy(self.apps,"created_at")),c=0;c<b.length;c++)if(0!=b[c].created_at)return a=b[c].created_at},self.getHistoryMoreYear=function(a,b){var c={historyList:[],surplusMonths:b};if("object"!=typeof a){var d=_.toNumber(a)+1;c.years=d}else{var d=a.years+1;c.years=d,c.historyList=a.historyList}for(var e=0,f=1;f<=12;f++){e++;var g={};if(g.history=d+"年"+f+"月",f<10?g.format=d+"-0"+f:g.format=d+"-"+f,e>b)return c;c.historyList.push(g),c.surplusMonths=b-e}if(e<b)return self.getHistoryMoreYear(c,c.surplusMonths)},self.getHistoryList=function(){var a=(new Date).getTime(),c=self.getEarliestTime(),d=n.timeRangeDiffMonths(1e3*c,a),e=moment(1e3*c).toObject();b.historyList=[];for(var f=0,g=e.months+1;g<=12;g++){f++;var h={};if(h.history=e.years+"年"+g+"月",g<10?h.format=e.years+"-0"+g:h.format=e.years+"-"+g,f>=d)return b.historyList.push(h),_.reverse(b.historyList);b.historyList.push(h)}if(f<d){var i=d-f,j=self.getHistoryMoreYear(e.years,i);b.historyList=_.reverse(_.concat(b.historyList,j.historyList))}},self.getHistoryList(),b.searchHistoryConsumption=function(a){m.info({msg:"正在查询中...",icon:!0,time:3e3,top:0}),b.curHistory=a.history;var c=self.selectHistory(a.format),d=[],e=[];_.forEach(self.allAppsId,function(a){var b=k.getCallerApiCountByDay(a,c.startDate,c.endDate),f=k.getAllUvByMonth(a,c.startDate,c.endDate);e.push(f),d.push(b)}),l.all(d).then(function(a){var c=0,d=function(a){return c+=a};_.map(_.map(_.flatten(_.map(a,"data.daily_api_count")),"api_count"),d),b.allDailyApiCount=c,m.removeAll()}),l.all(e).then(function(a){var c=0,d=function(a){return c+=a};_.map(_.map(_.flatten(_.map(a,"data.monthly_uv")),"client_sum"),d),b.allUV=c})},b.searchHistoryConsumption(b.curHistory)}]),angular.module("abtesting").config(["$stateProvider",function(a){
a.state("app.changePass",{url:"/changePass",templateUrl:"app/changePass/changePass.html",controller:"ChangePassCtrl",role:{noApp:!0},data:{pageTitle:"修改密码 A/BTesting"},resolve:{appsData:["App","AuthApi",function(a,b){return b.getAllApp()}]}})}]),angular.module("abtesting").controller("ConfigCtrl",["$scope","$state","$rootScope",function(a,b,c){}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.config",{url:"/config",templateUrl:"app/config/config.html",controller:"ConfigCtrl",role:{noExp:!0},data:{pageTitle:"应用配置"}})}]),angular.module("abtesting").service("Constant",["$rootScope",function(a){return a.Constant={SYSTEM_STATS_VAILDE:"系统自动生成",SYSTEM_STATS_VAILDE1:"系统自动",SYSTEM_STATS_PV:"Event-GET_EXPERIMENT_FLAGS",SYSTEM_STATS_UV:"Clients",SYSTEM_STATS_VISIT:"Event-session",SYSTEM_STATS_VISIT_DESCRIPTION:"访客从进入应用到离开应用记为1次访问，离开后超过30分钟再次访问记为下次",SYSTEM_STATS_DURATION:"Event-duration",SYSTEM_STATS_DURATION_DESCRIPTION:"从进入应用到离开应用的时间是一次访问的时长",SYSTEM_STATS_BOUNCE:"Event-bounce",SYSTEM_STATS_CRASH:"Event-crash",SYSTEM_STATS_CRASH_DESCRIPTION:"应用崩溃和未捕获异常数据的次数",EXP_STATUS_DEF:"NotStart",EXP_STATUS_RUN:"Running",EXP_STATUS_STOP:"Stopped",EXP_STATUS_PUBLISH:"Published",EXP_STATUS_DELETE:"Delete",EXP_TYPE_CODE:"Code",EXP_TYPE_BUILD:"Build",EXP_TYPE_URL:"Url",EXP_FLAGS_DELETE:5,DEMO_APP_ID:"ac66bf61-7608-4a5f-9bc4-9e7cf0f9694f",APP_TYPE_H5:5,APP_TYPE_ANDIOD:6,APP_TYPE_IOS:7,APP_TYPE_DEF:0,APP_TYPE_LPO:12,APP_STATUS_DEL:5,STAT_STATUS_DEF:0,STAT_STATUS_DELETE:5,AUDIENCE_STATUS_DEF:!1,AUDIENCE_STATUS_DELETE:!0,BY_DAY:1,BY_HOUR:0,BROWSE_DEMO:0,EDIT_DEMO:1,ONLY_READ:2,STATUS_MEAN:0,STATUS_TOTAL:1,STATUS_CONVERT:2,STATUS_CONVERTRATE:3,COMSTATFORMULARY_MATCH_REGEXP:/([^-+*\/\d\/\s()\[\]{}@$#%&、~!]([\w\d]*))/g,COMSTATFORMULARY__SEARCH_REGEXP:/[^\w \d\+\-\*\/\(\)\.]/,COVARIATE_STAT_FIND_UV_AS_DEN:/(^[a-zA-Z][\w\d]*(?=UV$))|(^[a-zA-Z][\w\d]*(?=UV[+,-]))/,WHITE_LIST:["https://auth.appadhoc.com/qiniu/token"],QINIU_IMGH5_TMPL:"https://o6p8nieie.qnssl.com/web-{{expid}}-{{url}}.png",EVENT_REFRESH_ACTIONBAE:"refreshActionbar",EVENT_REFRESH_SLIDE_MENU:"refreshSlideMenu",EVENT_REFRESH_STAT_PANEL:"refreshStatPanel",EVENT_REFRESH_FLAG_PANEL:"refreshFlagPanel",EVENT_REFRESH_MANAGEMENT:"refreshManagement",EVENT_REFRESH_CREATE:"refreshCreate",EVENT_REDNER_PHONE_VIEW:"renderPhoneView",EVENT_EDITOR_CLOSE:"editorClose",ADCANCED_ALL:"全部受众",LAYER_BTN_DEF_ID:"defualt",LAYER_BTN_NEW_ID:"new",ROLE_OWNER:"Owner",ROLE_ADMIN:"Admin",ROLE_COLLABORATOR:"Collaborator",DEMO_APP_ID:"ac66bf61-7608-4a5f-9bc4-9e7cf0f9694f"}}]),angular.module("abtesting").controller("CreateCtrl",["$scope","$timeout","$state","ExpApi","App","Constant","$stateParams","ExpLogic","ExpHelper","H5Api","$window","$rootScope","abToast","$uibModal","alert","dataManager",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this;p.register(["allGroupsData"],function(a){q.groups=a.allGroupsData,q.refreshData()}),p.changeState(function(a){var b=_.keys(a);b.forEach(function(b){switch(b){case"allGroupsData":q.groups=a.allGroupsData}}),q.refreshData()}),a.envs=[{id:0,iname:"全部",ua:"",isDefualt:!0},{id:1,iname:"支付宝",ua:"AlipayClient"},{id:2,iname:"微信",ua:"MicroMessenger"},{id:3,iname:"IOS",ua:"iphone|ipod|ipad"},{id:4,iname:"Android",ua:"android"}],a.selectEnvs={select:a.envs[0]},q.curApp=e.getApp(),a.type=-1,q.refreshData=function(){q.groupNames=_.keyBy(q.groups,"name")},q.getH5FlagTmpl=function(b){var c={mode:b.mode,regexp:b.regexp,url:b.url,data:{changes:[],stats:[]}};return a.selectEnvs.select.ua&&(c.ua=a.selectEnvs.select.ua),a.h5FlagTmplKeywords&&(c.keywords=a.h5FlagTmplKeywords),c},q.newTab="",q.getFlagJSON=function(a){var b={};return _.each(a,function(a){var c=q.getH5FlagTmpl(a);b[a.url]=c}),angular.toJson(b)},q.snapshot=function(){for(var b=0;b<q.curExps.length;b++)for(var c=q.curExps[b],d=0;d<a.urls.length;d++){var e=a.urls[d];j.verSnapshot({url:e.url,name:c.id,type:"web"})}},q.curUser=e.getCurUser(),a.isExpEnv=q.curUser.expenv,a.group={},a.code=e.getAppType()===f.APP_TYPE_H5,a.h5=e.getAppType()===f.APP_TYPE_H5,a.android=e.getAppType()===f.APP_TYPE_ANDIOD,a.androidRole=1===q.curUser.androidBuilder,a.ios=e.getAppType()===f.APP_TYPE_IOS,a.iosRole=1===q.curUser.iosBuilder,a.h5Role=1===q.curUser.h5builder,a.urlSpliteRole=e.getAppType()===f.APP_TYPE_H5&&1===q.curUser.urlsplite,a.ptmindRole=1===q.curUser.ptmind,a.DEFAULT_MODE=1,a.REGEXP_MODE=2,a.submitPadding=!1,q.urls=angular.fromJson(_.get(q.curControl,"annotation.urls"))||[],a.urls=q.urls,a.mode=a.REGEXP_MODE,a.addPage=function(){var b={mode:"",url:"",regexp:""};a.urls.push(b)},a.initURLObj=function(a){console.log("init url"),a.mode||(a.mode="equal")},a.urls.length||(a.addPage(),console.log("add")),a.select=function(b){(a.androidRole||b!==f.EXP_TYPE_BUILD||q.curApp.typ!==f.APP_TYPE_ANDIOD)&&(a.iosRole||b!==f.EXP_TYPE_BUILD||q.curApp.typ!==f.APP_TYPE_IOS)&&(a.type=a.on=b)},a.select(f.EXP_TYPE_BUILD),q.creatLayerFig=!1,q.curApp=e.getApp(),a.layerRole=!0,q.addH5BuildFlags=function(b){var f=a.urls[0].url;f=i.autoComplateURL(f),a.urls[0].url=f;var g=q.getFlagJSON(a.urls),h="_"+encodeURIComponent(f)+"_",j=a.getFlagTmpl(h),k={};d.createFlag(e.getAppID(),j,h).then(function(b){_.each(q.curExps,function(b){k[b.id]={},k[b.id].flags={},k[b.id].flags[h]=g,k[b.id].annotation={},k[b.id].annotation.urls=angular.toJson(a.urls),k[b.id].annotation.keywords=angular.toJson(a.h5FlagTmplKeywords),a.selectEnvs.select.ua&&(k[b.id].annotation.ua=angular.toJson(a.selectEnvs.select))});_.keyBy(q.curExps,"id");d.updateGroupWithExp(a.group.id,{experiments_updater:k}).then(function(b){return q.snapshot(),a.submitPadding=!1,c.go("app.createInfo.lists.expInfo")})})},q.checkURLExistParams=function(a){return a&&a.indexOf("?")>-1},a.promptCount=0,q.promptURLExistParams=function(b){j.getFilterParmas({url:b}).then(function(b){b.data.success?(b.data.result&&b.data.result.length>0&&(a.h5FlagTmplKeywords=b.data.result),a.filterParamsSuccess=!0):a.filterParamsFail=!0})},q.addAndroidFlag=function(b){var c="__autoexperiment__",f=a.getFlagTmpl(c);d.createFlag(e.getAppID(),f,c).then(function(){_.each(q.curExps,function(a){a.flags={},a.flags[c]="{}"});var e=_.keyBy(q.curExps,"id");d.updateGroupWithExp(a.group.id,{experiments_updater:e}).then(function(){return b()})})},a.changeLayer=function(b){q.layersCount=b.count,q.curLayer=b,a.curLayer=q.curLayer,b.layerId!==f.LAYER_BTN_DEF_ID&&b.layerId!==f.LAYER_BTN_NEW_ID&&(q.postLayerId=b.layerId)},q.nextStepPage=function(){return a.type===f.EXP_TYPE_CODE?c.go("app.createInfo.expversion.expInfo"):a.type===f.EXP_TYPE_URL?c.go("app.createInfo.url.stats"):(a.type===f.EXP_TYPE_BUILD&&e.getAppType()===f.APP_TYPE_ANDIOD&&q.addAndroidFlag(function(){return c.go("mobileeditor",{})}),a.type===f.EXP_TYPE_BUILD&&e.getAppType()===f.APP_TYPE_IOS&&q.addAndroidFlag(function(){return c.go("iosMobileEditor",{})}),a.type===f.EXP_TYPE_BUILD&&e.getAppType()===f.APP_TYPE_H5?q.addH5BuildFlags():void 0)},a.nextStep=function(b){if(q.groupNames[a.group.name]?b.name.$setValidity("exist",!1):b.name.$setValidity("exist",!0),a.type===-1)return m.warning({msg:"请选择试验类型"});if(b.$valid){if(q.curApp.typ===f.APP_TYPE_H5&&a.type===f.EXP_TYPE_BUILD)var c=window.open("about:blank","_blank");a.submitPadding=!0;var g={name:a.group.name,description:a.group.description,typ:a.type};if(q.curLayer.layerId===f.LAYER_BTN_NEW_ID)return a.clicked=!0,d.insertLayer(e.getAppID(),{name:"layer"+(q.layersCount+1),app_id:e.getAppID(),status:0,typ:0,description:""}).then(function(b){$.extend(!0,{},g);g.layer_id=b.data.id,h.createGroup(g,function(b){a.group=b.data,e.setExp(b.data),q.curExps=i.getValideExpsByGroup(a.group),q.nextStepPage(),q.curApp.typ===f.APP_TYPE_H5&&a.type===f.EXP_TYPE_BUILD&&a.editURL(q.urls[0],c)})});q.postLayerId&&(g.layer_id=q.postLayerId),a.clicked=!0,h.createGroup(g,function(b){a.group=b.data,e.setExp(b.data),q.curExps=i.getValideExpsByGroup(a.group),q.nextStepPage(),q.curApp.typ===f.APP_TYPE_H5&&a.type===f.EXP_TYPE_BUILD&&a.editURL(q.urls[0],c)})}},a.copy=function(){var b=document.getElementById("copy-url-sdk");b.select(),document.execCommand("copy"),a.copytextTip="复制成功"},q.updateH5Data=function(){var b=a.group,c={group_updater:{}};c.group_updater[b.id]={id:b.id},d.updateGroupWithExp(a.group.id,c)},a.$watch("copytextTip",function(){b(function(){a.copytextTip=""},6e3)}),a.editURL=function(b,c){var d=j.openSdk({url:b.url,authkey:e.getAuthKey(),appid:e.getAppID(),groupid:e.getCurGroupId(),expid:a.group.control.id,appkey:q.curApp.app_key});i.bindWindowClosed(c,function(){q.updateH5Data()}),c.location.href=d},a.getFlagTmpl=function(a){return{name:a,description:"Version of test pages in H5",typ:"String",default_value:"{}"}},a.changeURL=function(b){b&&q.checkURLExistParams(b)&&(a.isExistParams=!0)},a.autoFilterParams=function(a){q.promptURLExistParams(a)}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.create",{url:"/create",templateUrl:"app/create/create.html",controller:"CreateCtrl",params:{groupType:null},role:{noExp:!0},data:{pageTitle:"创建试验 A/BTesting"}})}]),angular.module("abtesting").controller("CreateInfoCtrl",["$scope","curGroup","layers","$state","toScroll","ExpApi","App","Constant","ExpLogic",function(a,b,c,d,e,f,g,h,i){var j=this;j.curGroup=b.data,j.layers=c.data.layers,j.indexLayers=_.keyBy(j.layers,"id"),a.curGroup=j.curGroup,a.curLayerName=j.curGroup.layer_id?j.indexLayers[j.curGroup.layer_id].name:"默认层",a.curStateName=d.current.name,a.goStep=function(b){return 1===b?e.goAnchor("createinfo"):"app.createInfo.expversion.expInfo"===a.curStateName&&2===b?e.goAnchor("expversion"):"app.createInfo.lists.expInfo"===a.curStateName&&2===b?e.goAnchor("h5lists"):"app.createInfo.url.stats"===a.curStateName&&2===b?e.goAnchor("urllists"):"app.createInfo.expversion.expInfo"!==a.curStateName&&"app.createInfo.lists.expInfo"!==a.curStateName&&"app.createInf.url.stats"!==a.curStateName||3!==b?void 0:e.goAnchor("expinfo")},j.updateH5Data=function(){i.updatePageCacheData(j.curGroup)},a.$on("$locationChangeSuccess",function(a){j.updateH5Data()}),a.saveTestURL=function(){var b={description:a.curGroup.description};f.updateGroupById(a.curGroup.id,b).then(function(a){})}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.createInfo",{url:"/createInfo",templateUrl:"app/createInfo/createInfo.html",controller:"CreateInfoCtrl",role:{noExp:!0},data:{pageTitle:"创建试验 A/BTesting"},resolve:{curGroup:["ExpApi","App",function(a,b){return a.getGroupById(b.getCurGroupId())}],layers:["ExpApi","App",function(a,b){return a.getAllLayers(b.getAppID())}]}})}]),angular.module("abtesting").controller("DataCtrl",["$scope",function(a){a.scroll=0}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.data",{url:"/data",templateUrl:"app/data/data.html",controller:"DataCtrl"})}]),function(){function a(){"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return d!==-1&&d===b}),Number.prototype.toMyPrecision=function(a){var b=this.valueOf(),c=parseInt(b);return b==c?this.toString():b>10?this.toFixed(a-1):this.toPrecision(a)}}a()}(),angular.module("abtesting").service("dataManager",["$q","$rootScope","$injector",function(a,b,c){var d=[],e=[];return{register:function(a,b){if(a){var d=[],f={};e.push(a),a.forEach(function(e){var g={},h=e,i=c.get(h);i&&i.get(function(c){g[e]=c,f[e]=c,d.push(g),d.length==a.length&&b(f)})})}},changeState:function(a){d.push(a)},injectorResponseData:function(a,b){var f=_.uniq(_.flattenDepth(e,1));d.forEach(function(d){f.forEach(function(e){var f=c.get(e);f.compare(a,b,d)})})}}}]),angular.module("abtesting").controller("DetailCtrl",["$scope","$stateParams","App","$q","$state","$timeout","Constant","ExpHelper","DataHelper","DataApi","ExpApi","$uibModal","alert",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(e,f,k,m,n){o.curGroup=e.data,o.stats=k.data.stats,o.clientsResults=m.data.clients,o.statResults=n.data.results,o.curUser=c.getCurUser(),o.curControl=o.curGroup.control,o.curExps=h.getValideExpsByGroup(o.curGroup),o.curStats=i.getNonFormulaStats(_.uniqWith(h.getCurStatsByGroup(o.stats,o.curGroup),_.isEqual)),o.appDefStats=h.getAppDefStatsByGroup(o.curGroup,o.stats)?h.getAppDefStatsByGroup(o.curGroup,o.stats):[],o.curStats=_.concat(o.curStats,o.appDefStats),o.curVaildeExp=h.getValideExpsByGroup(o.curGroup),o.curExpsId=_.map(o.curVaildeExp,"id"),a.powerRole=!(!o.curUser||1!==o.curUser.power),o.indexCurVaildeExp=_.keyBy(o.curVaildeExp,"id"),o.indexClientsResults=_.keyBy(o.clientsResults,"experiment_id"),o.indexFabinClientsResults=angular.copy(o.indexClientsResults),o.vaildeClientsResultsId=_.keysIn(o.indexClientsResults),o.indexStatResults=_.groupBy(o.statResults,"stat_key"),o.indexFabinStatResults=angular.copy(o.indexStatResults),o.indexOriginStatResults=angular.copy(o.indexStatResults),o.indexPVResults=_.keyBy(o.indexStatResults[g.SYSTEM_STATS_PV],"experiment_id"),o.indexFabinPVResults=angular.copy(o.indexPVResults),o.customizer=function(a,b){return _.isUndefined(a)?b:a},o.defaults=_.partialRight(_.assignWith,o.customizer()),o.makeIndexClientsResultCompareData=function(){_.forEach(o.indexClientsResults,function(a){a.client_sum=0})},a.group=o.curGroup,a.exps=o.curExps,a.curStats=_.orderBy(o.curStats,"name"),a.curStat=b.statName?b.statName:0!=o.curStats.length?a.curStats[0]:"",a.curDimensionsTypes=[{name:"全部",key:"all"},{name:"用户自定义",key:"custom"},{name:"系统自带",key:"summary"}],a.curDimensionsType=a.curDimensionsTypes[0],a.lookDimensionsFig=!1,a.allDimensionsDataFig=!1,o.initDimensions=function(b){o.allDimensions=b.data,o.curDimensionsSumarry=o.allDimensions.summary,o.curDimensionsCustom=o.allDimensions.custom,o.dimensionFig=!0,o.customKeys=i.changeDimensionsKeysChinese(i.getDimensionsKeys(o.curDimensionsCustom,"custom")),o.summaryKeys=i.changeDimensionsKeysChinese(i.getDimensionsKeys(o.curDimensionsSumarry,"summary")),a.dimensionRole=!(!o.curUser||1!==o.curUser.dimension)},o.queryDimensionsStat=function(b){a.lookDimensionsFig=!1,a.allDimensionsDataFig=!1,a.curDimensionsType=a.curDimensionsTypes[0],1===c.getCurUser().dimension&&b?j.getDimensionsByStat(c.getAppID(),c.getCurGroupId(),b).then(function(a){o.initDimensions(a)}):o.initDimensions({data:{custom:[],summary:[]}})},o.queryDimensionsStat(a.curStat.name),a.indexFabinClientsResults=o.indexFabinClientsResults,a.curAppType=c.getAppType(),a.varianceClients="均值",a.convertStat="总值",o.groupStartTime=a.group.control.start_date,o.groupStartDate=moment.unix(o.groupStartTime);var p=i.defaultSelectedEndDate(o.curGroup),q=moment(p).subtract(6,"days");a.datePicker={},a.datePicker.date={startDate:q,endDate:p};var r=c.getDatePickerConfig();r.ranges["开始至今"]=[o.groupStartDate,moment()],a.datePickerConfig=r,o.getDatePickerEndDate=function(){var b=moment.range(a.datePicker.date.endDate,moment()).diff("days");return 0==b?moment():a.datePicker.date.endDate},a.curStatResult=[],o.timeCompareDataByDay=i.getTimeCompareDataByDay(moment(a.datePicker.date.startDate).subtract(1,"days"),o.getDatePickerEndDate()),o.timeCompareDataByHour=i.getTimeCompareDataByHour(moment(a.datePicker.date.startDate),o.getDatePickerEndDate()),o.timeReversByDay=o.timeCompareDataByDay.dataCompleteUtc,o.timeReversByHour=o.timeCompareDataByHour.dataCompleteUtc,_.reverse(o.timeReversByDay),_.reverse(o.timeReversByHour),o.orderTimeGetDataHandleTemlateFun=function(b,d,e){a.curStatResult=[],o.sumCurStatObject={},o.clientSumObject={},o.pvSumObject={},a.curStatObject={},a.trendmapData.xAxis.data=[],a.trendmapData.series=[],o.dimensionFig?(o.sourceDataByDay=b.data.daily_results?b.data.daily_results:b.data.hourly_results,o.indexStatResults=[],o.indexStatResults=_.groupBy(e.data.results,"stat_key"),a.indexClientsResults={},o.indexClientsResults={},o.indexClientsResults=_.keyBy(d.data.clients,"experiment_id"),a.indexClientsResults=o.indexClientsResults,o.indexPVResults=_.keyBy(o.indexStatResults[g.SYSTEM_STATS_PV],"experiment_id")):(o.sourceDataByDay=b.data.daily_results,o.indexStatResults=_.groupBy(d.data.results,"stat_key"),o.indexSummariesClientsResults=_.keyBy(d.data.results,"experiment_id"),o.makeIndexClientsResultCompareData(),a.indexClientsResults={},a.indexClientsResults=o.defaults(o.indexClientsResults,o.indexSummariesClientsResults),o.indexPVResults=_.keyBy(o.indexStatResults[g.SYSTEM_STATS_PV],"experiment_id")),o.indexSourceData=_.groupBy(o.sourceDataByDay,"experiment_id"),o.indexSourceDataByStatKey=_.groupBy(o.sourceDataByDay,"stat_key"),a.chartPeriodStatus===g.BY_DAY?o.timeRevers=o.timeReversByDay:o.timeRevers=o.timeReversByHour,_.forEach(o.curExpsId,function(b){o.compareDataByDay={},o.lineSeriesObject={name:"",type:"line",created_at:"",smooth:!0,data:[]},o.compareSumDataByDay=a.chartPeriodStatus===g.BY_DAY?_.zipObject(o.timeCompareDataByDay.dataCompleteUtc,o.timeCompareDataByDay.dataCompleteNullData):_.zipObject(o.timeCompareDataByHour.dataCompleteUtc,o.timeCompareDataByHour.dataCompleteNullData),o.compareMeanDataByDay=a.chartPeriodStatus===g.BY_DAY?_.zipObject(o.timeCompareDataByDay.dataCompleteUtc,o.timeCompareDataByDay.dataCompleteNullData):_.zipObject(o.timeCompareDataByHour.dataCompleteUtc,o.timeCompareDataByHour.dataCompleteNullData),o.compareUvDataByDay=a.chartPeriodStatus===g.BY_DAY?_.zipObject(o.timeCompareDataByDay.dataCompleteUtc,o.timeCompareDataByDay.dataCompleteNullData):_.zipObject(o.timeCompareDataByHour.dataCompleteUtc,o.timeCompareDataByHour.dataCompleteNullData),o.compareUv_meanDataByDay=a.chartPeriodStatus===g.BY_DAY?_.zipObject(o.timeCompareDataByDay.dataCompleteUtc,o.timeCompareDataByDay.dataCompleteNullData):_.zipObject(o.timeCompareDataByHour.dataCompleteUtc,o.timeCompareDataByHour.dataCompleteNullData),o.curLineSeriesObjectAllData=o.indexSourceData[b],o.indexCurLineSeriesObjectData=_.groupBy(o.curLineSeriesObjectAllData,"stat_key"),o.curLineSeriesObjectData=o.indexCurLineSeriesObjectData[a.curStat.name],a.curStatResult=o.curLineSeriesObjectData,o.tabSum=function(){var d;d=o.indexStatResults?o.indexStatResults:"",1==c.getCurUser().fabian&&"all"==a.curDimensionsType.key&&(d=o.indexFabinStatResults);var e=_.find(d[a.curStat.name],function(a){return a.experiment_id==b});if(a.statUnit==g.STATUS_CONVERTRATE||a.statUnit==g.STATUS_CONVERT){if(o.sumCurStatObject[b]={},e)if(e.hasOwnProperty("client_sum")&&"all"!=a.curDimensionsType.key){o.sumCurStatObject[b].client_sum=e.client_sum;var f=_.find(d[g.SYSTEM_STATS_PV],function(a){return a.experiment_id=b});o.sumCurStatObject[b].PV=f?f.sum:0}else o.sumCurStatObject[b].client_sum=o.indexFabinClientsResults[b].client_sum,o.sumCurStatObject[b].PV=o.indexFabinPVResults[b]?o.indexFabinPVResults[b].sum:0;else o.sumCurStatObject[b].client_sum=0,o.sumCurStatObject[b].PV=0;var h=_.find(d[a.curStat.name],function(a){return a.experiment_id==b});o.sumCurStatObject[b].mean=h?100*h.uv_mean+"%":"0% ",o.sumCurStatObject[b].sum=_.find(d[a.curStat.name],function(a){return a.experiment_id==b})?_.find(d[a.curStat.name],function(a){return a.experiment_id==b}).uv:0}if(a.statUnit==g.STATUS_MEAN||a.statUnit==g.STATUS_TOTAL){if(o.sumCurStatObject[b]={},e)if(e.hasOwnProperty("client_sum")&&"all"!=a.curDimensionsType.key){o.sumCurStatObject[b].client_sum=e.client_sum;var i=_.find(d[g.SYSTEM_STATS_PV],function(a){return a.experiment_id=b});o.sumCurStatObject[b].PV=i?i:0}else o.sumCurStatObject[b].client_sum=o.indexFabinClientsResults[b].client_sum,o.sumCurStatObject[b].PV=o.indexFabinPVResults[b]?o.indexFabinPVResults[b].sum:0;else o.sumCurStatObject[b].client_sum=0,o.sumCurStatObject[b].PV=0;o.sumCurStatObject[b].mean=_.find(d[a.curStat.name],function(a){return a.experiment_id==b})?_.find(d[a.curStat.name],function(a){return a.experiment_id==b}).mean.toMyPrecision(3):0,o.sumCurStatObject[b].sum=_.find(d[a.curStat.name],function(a){return a.experiment_id==b})?_.find(d[a.curStat.name],function(a){return a.experiment_id==b}).sum:0}var j=_.keyBy(d[g.SYSTEM_STATS_PV],"experiment_id");o.pvSumObject=j},o.tabSum(),a.curStatObject=o.sumCurStatObject,a.clientSumObject=o.clientSumObject,a.pvSumObject=o.pvSumObject,o.dimensionFig?o.lineSeriesObjectHour=_.map(o.curLineSeriesObjectData,"hour"):o.lineSeriesObjectHour=_.map(o.curLineSeriesObjectData,"date"),o.lineSeriesObjectMean=_.map(o.curLineSeriesObjectData,"mean"),o.lineSeriesObjectSum=_.map(o.curLineSeriesObjectData,"sum"),o.lineSeriesObjectUv=_.map(o.curLineSeriesObjectData,"uv"),o.lineSeriesObjectUv_mean=_.map(o.curLineSeriesObjectData,"uv_mean"),o.sameDataSum=_.zipObject(o.lineSeriesObjectHour,o.lineSeriesObjectSum),o.sameDataMean=_.zipObject(o.lineSeriesObjectHour,o.lineSeriesObjectMean),o.sameDataUv=_.zipObject(o.lineSeriesObjectHour,o.lineSeriesObjectUv),o.sameDataUv_mean=_.zipObject(o.lineSeriesObjectHour,o.lineSeriesObjectUv_mean),o.defaults(o.compareSumDataByDay,o.sameDataSum),o.defaults(o.compareUv_meanDataByDay,o.sameDataUv_mean),o.defaults(o.compareUvDataByDay,o.sameDataUv),o.defaults(o.compareMeanDataByDay,o.sameDataMean),o.indexCurVaildeExp[b]&&(o.lineSeriesObject.created_at=o.indexCurVaildeExp[b].created_at),o.indexCurVaildeExp[b].isControl&&(o.lineSeriesObject.name="原始版本"),o.indexCurVaildeExp[b].isControl||(o.lineSeriesObject.name=o.indexCurVaildeExp[b].name),a.statUnit==g.STATUS_CONVERTRATE&&(o.lineSeriesObject.data=[],_.forEachRight(o.timeRevers,function(a){var b=o.compareUv_meanDataByDay[a].toMyPrecision(3);o.lineSeriesObject.data.push(b)})),a.statUnit==g.STATUS_CONVERT&&(o.lineSeriesObject.data=[],_.forEachRight(o.timeRevers,function(a){var b=o.compareUvDataByDay[a].toMyPrecision(3);o.lineSeriesObject.data.push(b)})),a.statUnit==g.STATUS_TOTAL&&(o.lineSeriesObject.data=[],_.forEachRight(o.timeRevers,function(a){o.lineSeriesObject.data.push(o.compareSumDataByDay[a].toMyPrecision(3))})),a.statUnit==g.STATUS_MEAN&&(o.lineSeriesObject.data=[],_.forEachRight(o.timeRevers,function(a){var b=o.compareMeanDataByDay[a].toMyPrecision(3);o.lineSeriesObject.data.push(b)})),a.trendmapData.series.push(o.lineSeriesObject),a.trendmapData.series=_.orderBy(a.trendmapData.series,"created_at")}),a.trendmapData.xAxis.data=a.chartPeriodStatus===g.BY_DAY?o.timeCompareDataByDay.dataCompleteTime:o.timeCompareDataByHour.dataCompleteTime,o.expConfidence()},o.byDay=function(b){a.disabledDimension=!1,a.statUnit!=g.STATUS_CONVERTRATE&&a.statUnit!=g.STATUS_CONVERT||(a.disabledDimension=!0,o.dimensionFig=!0,a.curDimensionsType=a.curDimensionsTypes[0],a.lookDimensions=""),"all"===a.curDimensionsType.key?j.getStatResultsByDaily(c.getAppID(),a.datePicker.date.startDate.hour(0).minute(0).toISOString(),o.getDatePickerEndDate().toISOString(),b.name).then(function(b){j.getStatResults(c.getAppID()).then(function(d){j.getClientsResults(c.getAppID()).then(function(c){o.orderTimeGetDataHandleTemlateFun(b,c,d),a.lookDimensions=""})})}):a.getDimensionsData()},a.curStat&&o.byDay(a.curStat),o.byHour=function(b){a.lookDimensions="",a.curDimensionsType=a.curDimensionsTypes[0],a.disabledDimension=!0,j.getStatResultsByHourly(c.getAppID(),a.datePicker.date.startDate.toISOString(),o.getDatePickerEndDate().toISOString(),b.name).then(function(b){j.getStatResults(c.getAppID()).then(function(d){j.getClientsResults(c.getAppID()).then(function(c){o.orderTimeGetDataHandleTemlateFun(b,c,d),a.allDimensionsDataFig=!1})})})},a.getCurDimensionsKeys=function(b){return a.curDimensionsType=b,"all"==b.key?(a.lookDimensions="查看",a.curDimensionsKeys=[]):"custom"==b.key?(a.curDimensionsKeys=o.customKeys,a.curDimensionsKey=a.curDimensionsKeys[0],a.curDimensionsKey?a.getCurDimensionsValues(a.curDimensionsKey):""):"summary"==b.key?(a.curDimensionsKeys=o.summaryKeys,a.curDimensionsKey=a.curDimensionsKeys[0],a.curDimensionsKey?a.getCurDimensionsValues(a.curDimensionsKey):""):void 0},a.getCurDimensionsValues=function(b){var c=_.concat(o.curDimensionsSumarry,o.curDimensionsCustom);a.curDimensionsKey=b,a.lookDimensions="查看",o.curDimensionsValues=_.pull(_.keysIn(_.groupBy(c,b.key)),"undefined"),a.curDimensionsValues=[],_.forEach(o.curDimensionsValues,function(b){""==b&&(b="其他"),a.curDimensionsValues.push(decodeURIComponent(b))}),"os_version"==a.curDimensionsKey.key||"app_version"==a.curDimensionsKey.key?a.curDimensionsValues.sort(function(a,b){for(var c,d,e,f=a.split("."),g=b.split("."),h=Math.max(f.length,g.length),i=0;i<h;i++)if(d=~~f[i],e=~~g[i],c=d>e?1:d<e?-1:0,0!==c)return c;return c}):a.curDimensionsValues.sort(function(a,b){return a.localeCompare(b)}),a.curDimensionsValue=a.curDimensionsValues[0]},a.selectDimension=function(b){a.curDimensionsValue=b,a.lookDimensions="查看"},a.getDimensionsData=function(){if("all"===a.curDimensionsType.key){if(o.dimensionFig=!0,a.chartPeriodStatus===g.BY_DAY)return o.byDay(a.curStat);if(a.chartPeriodStatus===g.BY_HOUR)return o.byHour(a.curStat)}o.dimensionFig=!1;var b=a.curDimensionsValue,e="custom"!=a.curDimensionsType.key?a.curDimensionsKey.key:a.curDimensionsKey.name;"其他"==b&&(b="");var f=[];f.push(j.getDimensionsResults(c.getAppID(),o.curGroup.id,a.curDimensionsType.key,e,b)),f.push(j.getDimensionsDailyResults(c.getAppID(),o.curGroup.id,a.curDimensionsType.key,e,b,a.datePicker.date.startDate.hour(0).minute(0).second(0).millisecond(0).toISOString(),o.getDatePickerEndDate().toISOString())),d.all(f).then(function(b){var c,d;_.filter(b,function(a){_.hasIn(a.data,"daily_results")&&(c=a),_.hasIn(a.data,"results")&&(d=a)}),o.orderTimeGetDataHandleTemlateFun(c,d),a.lookDimensions=""})},a.getPVResult=function(a){if(a)return o.indexPVResults[a.id]},a.getStatResult=function(b,c){if(b){var d,e=angular.isObject(c)?c.name:c;d="all"!=a.curDimensionsType.key?o.indexStatResults[e]:o.indexFabinStatResults[e];var f=_.keyBy(d,"experiment_id");return f[b.id]}},a.getOutputVar=function(b){if(b){var c,d=b.stat_key;b.experiment_id;c=o.indexFabinStatResults[d],"all"!=a.curDimensionsType.key&&(c=o.indexStatResults[d]);var e=_.keyBy(c,"experiment_id"),f=e[o.curControl.id];if(f){var h={sum:b.sum,uv:b.uv};return a.statUnit==g.STATUS_CONVERTRATE||a.statUnit==g.STATUS_CONVERT?h.variance=100*(b.uv_mean/f.uv_mean-1):h.variance=100*(b.mean/f.mean-1)}}},a.getOutputCi=function(b){if(b){var c,d=b.stat_key,e=b.experiment_id;c=o.indexFabinStatResults[d],"all"!=a.curDimensionsType.key&&(c=o.indexStatResults[d]);var f=_.keyBy(c,"experiment_id"),g=f[o.curControl.id],h=.05,j=o.curExps.length-1>10?10:o.curExps.length-1,k=i.getMiniKOfZBK(o.curControl);if(g&&!g.formula)return o.indexClientsResults[o.curControl.id]&&o.indexClientsResults[e]?o.indexClientsResults[o.curControl.id].client_sum<30||o.indexClientsResults[e].client_sum<30?null:a.statUnit==a.Constant.STATUS_CONVERTRATE||a.statUnit==a.Constant.STATUS_CONVERT?i.getOutputCi(b,g,o.indexFabinClientsResults[o.curControl.id].client_sum,o.indexFabinClientsResults[e].client_sum,h,j,k,i.getDistinct):i.getOutputCi(b,g,o.indexFabinClientsResults[o.curControl.id].client_sum,o.indexFabinClientsResults[e].client_sum,h,j,k):null}},a.changeStat=function(b){a.curStat=b,a.stat=b.name,a.chartPeriodStatus==g.BY_DAY&&o.byDay(b),a.chartPeriodStatus==g.BY_HOUR&&o.byHour(b),o.expConfidence(),o.queryDimensionsStat(b.name)},r.applyHandler=function(b,c){a.chartPeriodStatus==g.BY_HOUR&&(o.dimensionFig=!0,o.byHour(a.curStat)),a.chartPeriodStatus==g.BY_DAY&&o.byDay(a.curStat),o.timeCompareDataByDay=i.getTimeCompareDataByDay(moment(a.datePicker.date.startDate).subtract(1,"days"),o.getDatePickerEndDate()),o.timeCompareDataByHour=i.getTimeCompareDataByHour(moment(a.datePicker.date.startDate),o.getDatePickerEndDate()),o.timeReversByDay=o.timeCompareDataByDay.dataCompleteUtc,o.timeReversByHour=o.timeCompareDataByHour.dataCompleteUtc,_.reverse(o.timeReversByDay),_.reverse(o.timeReversByHour),a.dataSeries={}},a.$watch("curDimensionsKey",function(b,c){b!==c&&(b&&"all"!==b.key?a.allDimensionsDataFig=!0:a.allDimensionsDataFig=!1)}),a.$watch("statUnit",function(b,c){if(b!==c){if(b===g.STATUS_CONVERTRATE||b===g.STATUS_CONVERT){if(a.varianceClients="转化率",a.convertStat="转化人数",a.chartPeriodStatus===g.BY_DAY)return o.byDay(a.curStat);if(a.chartPeriodStatus===g.BY_HOUR)return o.byHour(a.curStat)}if(b===g.STATUS_MEAN||b===g.STATUS_TOTAL){if(a.convertStat="总值",a.varianceClients="均值",a.chartPeriodStatus===g.BY_DAY)return o.byDay(a.curStat);if(a.chartPeriodStatus===g.BY_HOUR)return o.byHour(a.curStat)}}}),a.$watch("chartPeriodStatus",function(b,c){if(b!==c)return b==g.BY_DAY?o.byDay(a.curStat):b==g.BY_HOUR?(o.dimensionFig=!0,o.byHour(a.curStat)):void 0}),a.control_name="CONTROL",a.stat=a.statsArray;var k=[];a.stats={},a.linedataNullTime=[],a.linedataNullDataArray=[],a.linedataNullData={data:[],name:""},a.statsArray=[],a.distriPlodata={},a.comStatsObj={},a.disLabelArray=[],a.statUnit=g.STATUS_MEAN,a.showVariance=!1,a.chartPeriodStatus=g.BY_DAY,a.groupname=a.group.name,a.control_name=a.group.control.name,a.curExps=[a.group.control].concat(a.group.experiments),o.expConfidence=function(){_.forEach(o.curExps,function(b){b.storeExpConfidence={};var c=a.getStatResult(b,a.curStat);b.storeExpConfidence.variant=a.getOutputVar(c),b.storeExpConfidence.cirang=a.getOutputCi(c)})},o.expConfidence(),a.goStatePower=function(b,c){if("all"==a.curDimensionsType.key){l.open({animation:!0,templateUrl:"app/power/power.html",controller:"PowerCtrl",size:"power-modal",resolve:{curGroup:["ExpApi","App",function(a,b){return a.getGroupById(b.getCurGroupId())}],allGroup:["ExpApi","App",function(a,b){return a.getAllGroup(b.getAppID())}],stats:["DataApi","App",function(a,b){return a.getStats(b.getAppID())}],clientsResults:["DataApi","App",function(a,b){return 1!=b.getCurUser().fabian?a.getClientsResults(b.getAppID()):a.getFabianClientsResults(b.getAppID())}],statResults:["DataApi","App",function(a,b){return 1!=b.getCurUser().fabian?a.getStatResults(b.getAppID()):a.getFabianStatResults(b.getAppID())}],contextData:{statName:b.name,expId:c.id,type:a.statUnit,newFormula:!0}}})}}}var o=this;a.trendmapConfig={dataLoaded:!0},a.trendmapData={grid:{show:!1,left:"80px",right:"3%",top:"35px",bottom:"35px",borderColor:"#eeeeee"},tooltip:{trigger:"axis"},yAxis:{type:"value",axisLine:{show:!1},axisLabel:{formatter:function(a,b){var c;return a>9999&&(a=a/1e4+"w"),c=a}},axisTick:{show:!1},splitLine:{lineStyle:{width:1,color:"#eeeeee",type:"solid"}}},xAxis:{splitLine:{show:!1},type:"category",boundaryGap:!1,data:[],axisLine:{lineStyle:{color:"#eeeeee"}},axisTick:{lineStyle:{color:"#eeeeee"}}},series:[]},d.all([k.getGroupById(c.getCurGroupId()),k.getAllGroup(c.getAppID()),j.getStats(c.getAppID()),1!=c.getCurUser().fabian?j.getClientsResults(c.getAppID()):j.getFabianClientsResults(c.getAppID()),1!=c.getCurUser().fabian?j.getStatResults(c.getAppID()):j.getFabianStatResults(c.getAppID())]).then(function(a){n(a[0],a[1],a[2],a[3],a[4])},function(a){$sate.go("error")})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.data.summary.detail",{url:"/detail",templateUrl:"app/detail/detail.html",controller:"DetailCtrl",data:{pageTitle:"试验数据 A/BTesting"}})}]),angular.module("abtesting").controller("DevTestCtrl",["$scope","App","ExpHelper","Constant","$filter","ExpApi","$interpolate","alert","$q","DataApi","DataHelper",function(a,b,c,d,e,f,g,h,i,j,k){function l(e,l,n,o,p){m.getPageData=function(a){var c=j.getClientsResults(b.getAppID()),d=j.getStatResults(b.getAppID());i.all([c,d]).then(function(b){return a(b[0],b[1])})},m.makeDataIndex=function(){m.indexClientsResults=_.keyBy(m.clientsResults,"experiment_id"),m.indexStatResults=_.groupBy(m.statResults,"stat_key"),m.indexPVResults=_.keyBy(m.indexStatResults[d.SYSTEM_STATS_PV],"experiment_id")},m.curGroup=e.data,m.stats=l.data.stats,m.clientsResults=o.data.clients,m.statResults=p.data.results,m.flags=n.data.flags,m.urls=angular.fromJson(_.get(m.curGroup,"control.annotation.urls")),m.urls&&m.urls.length>0&&(m.selectURL=m.urls[0]),m.indexClientsResults=_.keyBy(m.clientsResults,"experiment_id"),m.indexStatResults=_.groupBy(m.statResults,"stat_key"),m.indexPVResults=_.keyBy(m.indexStatResults[d.SYSTEM_STATS_PV],"experiment_id"),
m.indexFlags=_.keyBy(c.getVaildeFlags(m.flags),"name"),m.curExps=c.getValideExpsByGroup(m.curGroup),m.curExps=_.sortBy(m.curExps,"created_at"),m.curAllStats=c.getCurStatsByGroup(m.stats,m.curGroup),m.curStats=c.getStat(m.curAllStats),m.curControl=m.curGroup.control,m.getDefStats=function(){var a=c.getEventStatsByGroup(m.curGroup,m.stats);return a=k.sysStatsChangeNameToChineses(a)},m.appDefStats=m.getDefStats(),a.curAppType=b.getAppType(),a.curGroup=m.curGroup,a.curExpsNav=_.sortBy(m.curExps,"created_at"),a.curStats=m.curStats,a.sysStats=a.curAppType===d.APP_TYPE_H5?b.getSystemH5Stat():b.getSystemStat(),a.sysStats=_.concat(a.sysStats,m.appDefStats),a.curFlags=m.indexFlags,a.isShowImg=a.curGroup.typ===d.EXP_TYPE_BUILD||a.curGroup.typ===d.EXP_TYPE_URL,m.getExpPreviewImg=function(){var b;return a.curAppType===d.APP_TYPE_H5&&m.curGroup.typ===d.EXP_TYPE_BUILD&&(b=_.get(m.selectURL,"url"))?g(d.QINIU_IMGH5_TMPL)({expid:a.selectExp.id,url:encodeURIComponent(encodeURIComponent(m.selectURL.url))})+"?"+(new Date).getTime():a.curAppType===d.APP_TYPE_H5&&m.curGroup.typ===d.EXP_TYPE_URL&&(b=_.get(a.selectExp,"annotation.base_url"))?g(d.QINIU_IMGH5_TMPL)({expid:a.selectExp.id,url:encodeURIComponent(encodeURIComponent(b))})+"?"+(new Date).getTime():a.curAppType!==d.APP_TYPE_ANDIOD&&a.curAppType!==d.APP_TYPE_IOS||m.curGroup.typ!==d.EXP_TYPE_BUILD?void 0:_.get(a.selectExp,"annotation.snapshot")},m.getDevExpId=function(a){return"debug-"+a},a.$watch("abTabNow",function(b){"undefined"!=typeof b&&(a.selectExp=m.curExps[b],a.selectExp&&(a.selectExp.previewImg=m.getExpPreviewImg()),m.initDataTable())}),m.dataTable={},a.getClientsResult=function(){if(a.selectExp)return m.indexClientsResults[m.getDevExpId(a.selectExp.id)]},a.getPVStatResult=function(){if(a.selectExp)return m.indexPVResults[m.getDevExpId(a.selectExp.id)]},a.getStatResult=function(b){if(a.selectExp&&b){var c=m.indexStatResults[b],d=_.keyBy(c,"experiment_id");return d[m.getDevExpId(a.selectExp.id)]}},m.initDataTable=function(){m.dataTable.UV=a.getClientsResult(),m.dataTable.PV=a.getPVStatResult(),_.forEach(m.appDefStats,function(b){m.dataTable[b.name]=a.getStatResult(b.name)}),_.forEach(m.curStats,function(b){m.dataTable[b.name]=a.getStatResult(b.name)}),a.dataTable=m.dataTable},a.devVersion=function(){var b=window.open("about:blank","_blank"),c=f.getGenerateClientId(),d=_.get(a.selectExp,"qr_code"),e=m.selectURL;if(e){var g=a.addParamsToURL(e.url,{adhoc_force_client_id:c}),h="https://h5.appadhoc.com/redirectURL?url="+encodeURIComponent(g);f.forceClients(c,d).then(function(){b.location.href=h})}},a.devUrlVersion=function(){var b=window.open("about:blank","_blank"),c=f.getGenerateClientId(),d=_.get(a.selectExp,"qr_code"),e=_.get(m.curControl,"annotation.base_url"),g=a.addParamsToURL(e,{adhoc_force_client_id:c}),h="https://h5.appadhoc.com/redirectURL?url="+encodeURIComponent(g);f.forceClients(c,d).then(function(){b.location.href=h})},a.devCodeVersion=function(){var b=window.open("about:blank","_blank"),c=f.getGenerateClientId(),d=_.get(a.selectExp,"qr_code"),e=_.get(a.curGroup,"annotation.base_url"),g=a.addParamsToURL(e,{adhoc_force_client_id:c}),h="https://h5.appadhoc.com/redirectURL?url="+encodeURIComponent(g);f.forceClients(c,d).then(function(){b.location.href=h})},a.makeWeixinDevCode=function(){var b=f.getGenerateClientId(),c=_.get(a.selectExp,"qr_code");f.forceClients(b,c).then(function(){var c=a.selectExp.isControl?"原始版本":a.selectExp.name;h.alert({content:"您当前版本["+c+"]的小程序集成测试ClientID 为<br><br>"+b,type:"success"})})},a.checkTestURL=function(a){if(!a)return"版本测试地址不能为空"},a.saveTestURL=function(){var b=_.get(a.curGroup,"annotation.base_url"),c={annotation:{base_url:b}};f.updateGroupById(a.curGroup.id,c).then(function(a){})},a.refreshData=function(){m.getPageData(function(a,b){m.clientsResults=a.data.clients,m.statResults=b.data.results,m.makeDataIndex(),m.initDataTable()})}}var m=this;a.addParamsToURL=function(a,b){function c(a){var b="";b+="?";var c=0;for(var d in a)c++,b+=d,b+="=",b+=a[d],b+="&";return b}function d(a){return a.indexOf("#")===-1&&"&"==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),a}var e=a.indexOf("://")>-1?a:"http://"+a,f="";if(e.indexOf("?")>-1){f=e.substr(0,e.indexOf("?")),f+=c(b);var g=e.substr(e.indexOf("?")+1,e.length);f+=g}else if(a.indexOf("#")>-1){f=e.substr(0,e.indexOf("#")),f+=c(b);var h=e.substr(e.indexOf("#"),e.length);f=d(f),f+=h}else f=a+c(b);return f=d(f)},a.isLoading=!1,i.all([f.getGroupById(b.getCurGroupId()),j.getStats(b.getAppID()),f.getFlagsById(b.getAppID()),j.getClientsResults(b.getAppID()),j.getStatResults(b.getAppID())]).then(function(b){l(b[0],b[1],b[2],b[3],b[4]),a.isLoading=!0},function(){a.isLoading=!0})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.data.devtest",{url:"/devtest",templateUrl:"app/devtest/devtest.html",controller:"DevTestCtrl",data:{pageTitle:"集成调试 A/BTesting"}})}]),angular.module("abtesting").service("abEchartstTheme",function(){return{color:["#61a7db","#58c584","#ffa5aa","#58c0c5","#b1a7f2","#fdcc81","#add376","#db99dd","#ffdb43","#61a7db","#58c584","#ffa5aa","#58c0c5","#b1a7f2","#fdcc81"],tooltip:{backgroundColor:"rgba(255,255,255,0.85)",borderColor:"#d2d2d2",borderWidth:"1",textStyle:{color:"#313131",fontSize:"12"},axisPointer:{lineStyle:{color:"#d2d2d2",type:"dashed"}}},yAxis:{axisLabel:{formatter:function(a,b){var c;return a>9999&&(a=a/1e4+"w"),c=a}}},xAxis:{nameTextStyle:{color:"#333"}}}}),angular.module("ng-echarts",[]).directive("ngEcharts",["abEchartstTheme",function(a){return{controller:["$scope","$element",function(b,c){echarts.registerTheme("abtheme",a),b.chart=echarts.init(c[0],"abtheme"),this.getChart=function(){return b.chart},this.showLoading=function(a){var c=a||{text:"数据加载中",effect:"bubble",textStyle:{fontSize:20}};b.chart.showLoading(c)},this.hideLoading=function(){b.chart.hideLoading()}}],link:function(a,b,c,d){function e(){g.clear(),a.config&&a.config.dataLoaded===!1&&d.showLoading(a.config.loadingOption),a.config&&a.config.dataLoaded&&(g.setOption(a.option,!0),g.resize(),d.hideLoading())}function f(){angular.isArray(a.config.event)&&angular.forEach(a.config.event,function(a,b){for(var c in a)g.on(c,a[c])})}var g=a.chart;g.clear(),a.config.event&&f(),a.$watch(function(){return a.config},function(a){a&&e()},!0),a.$watch(function(){return a.option},function(a){a&&e()},!0)},scope:{option:"=ecOption",config:"=ecConfig"},restrict:"EA"}}]),angular.module("abtesting").controller("ErrorCtrl",["$scope","$state","$uibModalInstance",function(a,b,c){a.refresh=function(){c.close(),b.reload()}}]),angular.module("abtesting").config(["$stateProvider",function(a){}]),angular.module("abtesting").controller("ExpsCtrl",["$scope","$timeout","$filter","App","alert","ExpHelper","ExpApi","$uibModal","AbDispacher","Constant","dataManager","DataApi","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(i){function l(d){var e=h.open({templateUrl:"app/selectlayer/selectlayer.html",controller:"SelectLayerCtrl",resolve:{modelGroup:function(){return d},allGroup:function(){return o.groups},curPageGroup:function(){return a.datas}}});e.result.then(function(){b(function(){a.curTabIndex=0,a.filteredData=c("filter")(a.datas,a.expsFilter),a.totalItems=a.datas.length,a.select(1),a.currentPage=1},1e3)})}o.clients=i.data.clients,k.register(["allGroupsData","allLayersData"],function(a){o.groups=a.allGroupsData,o.allLayersData=a.allLayersData,o.refreshData()}),k.changeState(function(b){var c=_.keys(b);c.forEach(function(a){switch(a){case"allGroupsData":o.groups=b.allGroupsData;break;case"allLayersData":o.allLayersData=b.allLayersData}}),a.select(a.currentPage),o.refreshData()}),o.sumGroupTraffic=function(){_.forEach(a.currentPageStores,function(a){var b=0;b+=a.control.traffic,b+=_.sum(_.map(a.experiments,"traffic")),a.traffic=b})},o.refreshData=function(){o.valideGroups=f.getValideGroups(o.groups),o.indexClients=_.keyBy(this.clients,"experiment_id"),a.clients=o.clients,o.allLayersData?o.allLayersData.unshift({name:"默认层",id:"default"}):"",_.forEach(o.groups,function(a){a.layer_id||(a.layer_id="default")}),o.indexAllLayer=_.keyBy(o.allLayersData,"id"),a.indexAllLayer=o.indexAllLayer,a.expTotal=o.valideGroups.length,a.expgroups=o.valideGroups,a.allLayers=o.allLayersData,a.filterChanged()},o.expStatusDic={0:-1,1:j.EXP_STATUS_DEF,2:j.EXP_STATUS_RUN,3:j.EXP_STATUS_PUBLISH,4:j.EXP_STATUS_STOP},a.curTabIndex=0,a.$watch("curTabIndex",function(b){a.radioModel=o.expStatusDic[b]}),a.getClients=function(a){var b=f.getValideExpIdsByGroup(a);return _.reduce(b,function(a,b){return a+=o.indexClients[b]?o.indexClients[b].client_sum:0},0)},a.showStatus=1;var m=new Date;a.showGroups={group:1},a.lastWeek=m.getTime()-6048e5,a.numPerPageOpts=[3,5,10,50],a.numPerPage=a.numPerPageOpts[2],a.radioModel=-1,a.filteredData=[],a.expsFilter=function(b,c,d){for(var e in b)return a.radioModel===-1?b:a.radioModel===j.EXP_STATUS_RUN?2===b.status||b.status===j.EXP_STATUS_RUN:b.status===a.radioModel},o.query=function(b){a.filteredData=c("filter")(a.datas,b),a.select(1),a.currentPage=1,a.filteredData?a.totalItems=a.filteredData.length:a.totalItems=0,a.maxSize=10,a.bigTotalItems=175,a.bigCurrentPage=1},a.$watch("radioModel",function(){o.query(a.expsFilter)}),a.onFilterChange=function(){a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){a.select(1),a.currentPage=1},a.search=function(){a.filteredData=c("filter")(a.datas,a.searchKeywords),a.onFilterChange()},a.select=function(b){var c=(b-1)*a.numPerPage,d=c+a.numPerPage;a.filteredData?a.currentPageStores=a.filteredData.slice(c,d):a.currentPageStores=[],o.sumGroupTraffic()},a.numPerPage=a.numPerPageOpts[2],a.setPage=function(b){a.currentPage=b},a.checkModel={all:!1,def:!0,run:!1,publish:!1,stop:!1},a.filterChanged=function(){var b=o.valideGroups;a.datas=c("orderBy")(b,["-control.created_at","-traffic"]),a.searchKeywords="",a.filteredData=[],a.row="",a.currentPage=1,a.currentPageStores=[],a.totalItems=a.datas.length,a.search(),a.select(1)},a.openGroup=function(a){d.openGroup(a)},a.deltExp=function(b){e.confirm({type:"fail",content:"确定删除试验 "+b.name+" ？该试验及数据将不再显示。"},function(){g.deleteGroupById(b.id).then(function(){o.groups=_.pullAllBy(o.groups,[b],"id"),a.select(a.currentPage),o.refreshData()})})},a.statsFilter=function(a){return!!a&&a.indexOf("Event")===-1},a.stopBubble=function(a){a.stopPropagation()},a.clone=function(a){l(a)},a.statsFilter=function(a){return!_.startsWith(a,"Event-")},a.searchKey="",o.searchFilter=function(b){return b.name.indexOf(a.searchKey)>-1},a.search=function(){a.curTabIndex=0,o.query(o.searchFilter)},a.$watch("searchKey",function(){a.search()})}var o=this,p=d.getApp();p.typ===j.APP_TYPE_LPO&&d.golpourl(),a.isLoading=!1,m.all([l.getClientsResults(d.getAppID())]).then(function(b){n(b[0]),a.isLoading=!0},function(){a.isLoading=!0})}]),angular.module("abtesting").filter("Status",[function(){return function(a,b,c,d,e,f){var g=0;for(var h in a)a[h].status==b&&g++,a[h].status==c&&g++,a[h].status==d&&g++,a[h].status==e&&g++,a[h].status==f&&g++;return g>=10&&(g=10),g}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.main",{url:"/",templateUrl:"app/exps/exps.html",controller:"ExpsCtrl",role:{noExp:!0},data:{pageTitle:"试验列表  A/BTesting"}})}]),angular.module("abtesting").controller("ExpInfoCtrl",["$uibModal","$scope","AbDispacher","$state","$location","Constant","alert","App","ExpApi","DataApi","DataHelper","$q","ExpHelper","$stateParams","H5Api","dataManager","toScroll","ExpLogic",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=this;p.register(["stats","curGroupData","allGroupsData"],function(a){s.curGroup=angular.copy(a.curGroupData),s.groups=angular.copy(a.curGroupData),s.stats=angular.copy(a.stats),s.refreshData()}),p.changeState(function(a){var b=_.keys(a);b.forEach(function(b){switch(b){case"curGroupData":s.groups=angular.copy(a.curGroupData),s.curGroup=angular.copy(a.curGroupData),j.getStats(h.getAppID()).then(function(a){s.stats=a.data.stats,s.refreshData()})}})}),s.refreshData=function(){s.groups=m.getValideGroups(s.groups),s.group=s.curGroup,s.curApp=h.getApp(),s.curControl=s.group?s.group.control:"",s.curExps=s.group?m.getValideExpsByGroup(s.group):"",s.urls=angular.fromJson(_.get(s.curControl,"annotation.urls"))||[],s.curGroupAllStats=m.getCurStatsByGroup(s.stats,s.group),s.curGroupStats=m.getStat(s.curGroupAllStats),s.curGroupComStats=m.getComStat(s.curGroupAllStats),s.indexStats=_.keyBy(s.stats,"name"),s.indexCurGroupAllStats=_.keyBy(s.curGroupAllStats,"name"),s.indexCurGroupStats=_.keyBy(s.curGroupStats,"name"),s.indexCurGroupComStats=_.keyBy(s.curGroupComStats,"name"),s.stateReferrer=n.referrer,b.group=s.group,s.group&&(b.isShowUrlSpliteExp=s.group.typ===f.EXP_TYPE_URL,b.isShowBuilderExp=s.curApp.typ===f.APP_TYPE_H5&&s.group.typ===f.EXP_TYPE_BUILD,b.isShowAndriodBuilderExp=s.curApp.typ===f.APP_TYPE_ANDIOD&&s.group.typ===f.EXP_TYPE_BUILD&&s.curControl.status===f.EXP_STATUS_DEF||s.curApp.typ===f.APP_TYPE_ANDIOD&&s.group.typ===f.EXP_TYPE_BUILD&&s.curControl.status===f.EXP_STATUS_RUN,b.isShowIosBuilderExp=s.curApp.typ===f.APP_TYPE_IOS&&s.group.typ===f.EXP_TYPE_BUILD&&s.curControl.status===f.EXP_STATUS_DEF||s.curApp.typ===f.APP_TYPE_IOS&&s.group.typ===f.EXP_TYPE_BUILD&&s.curControl.status===f.EXP_STATUS_RUN),b.urls=s.urls[0],b.curGroupStats=s.curGroupStats,b.curGroupComStats=s.curGroupComStats,s.getSystemStat()},b.curAppType=h.getAppType(),b.comlisting=!0,b.showComHelpMsg=!0,s.getSystemStat=function(){return b.curAppType===f.APP_TYPE_H5?b.sysStats=h.getSystemH5Stat():(b.sysStats=h.getSystemStat(),s.curControl&&s.curControl.stats.forEach(function(a){if(a===f.SYSTEM_STATS_VISIT||a===f.SYSTEM_STATS_CRASH||a===f.SYSTEM_STATS_DURATION){var c=k.sysStatsChangeNameToChineses(s.indexStats[a]);c&&(c.sysEvent=!0),b.sysStats.push(c)}}),b.sysStats)},b.h5Editor=function(){d.go("app.createInfo.lists")},b.adding=function(){h.openPenlStat("s")},b.goEditor=function(){d.go("h5editor")},b.updateStatus=function(a,b){5==b?g.confirm({content:"确认删除优化指标 "+a.name+"？",type:"fail"},function(){3!=a.status&&(a.status=b,j.updateStats(h.getAppID(),a))}):(a.status=b,j.updateStats(h.getAppID(),a))},b.ss="ss",b.s="s",b.addingComStat=function(){h.openPenlStat("ss")},s.removeAndroidBuilderStateInFlags=function(a,b){var c=angular.fromJson(a.flags.__autoexperiment__),d=[];if(c.stats)return c.stats.forEach(function(a){a.stat_key!=b&&d.push(a)}),c.stats=d,angular.toJson(c)},b.deleteComStat=function(a,c){a.stopPropagation(),g.confirm({content:"确认删除复合指标 "+c.name+"？",type:"fail"},function(){var a=s.curControl.stats.indexOf(c.name);b.curGroupComStats.indexOf(c);s.curControl.stats.splice(a,1);var d={experiments_updater:{}};_.forEach(s.curExps,function(a){d.experiments_updater[a.id]={stats:s.curControl.stats}}),i.updateGroupWithExp(s.curGroup.id,d).then(function(a){})})},s.curSelectStats=[],b.selectStatHandler=function(a){if(s.curControl.stats.indexOf(a.name)>=0)return g.alert({content:"试验已关注指标:"+a.statName,type:"fail"});if(a.name!==f.SYSTEM_STATS_VISIT&&a.name!==f.SYSTEM_STATS_CRASH&&a.name!==f.SYSTEM_STATS_DURATION||b.sysStats.push(a),s.indexCurGroupStats[a.name])return g.alert({content:"试验已关注指标:"+a.name,type:"fail"});s.stats.push(a);var d=s.curControl.stats;d.push(a.name);var e={experiments_updater:{}};_.forEach(s.curExps,function(a){d=_.uniqWith(d,_.isEqual),e.experiments_updater[a.id]={stats:d}}),i.updateGroupWithExp(s.curGroup.id,e).then(function(a){s.refreshData(),c.refreshStatPanel()})},b.selectComStatHandler=function(a){if(s.indexCurGroupComStats[a.name])return g.alert({content:"试验已关注复合指标:"+a.name,type:"fail"});var c=a.formula.match(f.COMSTATFORMULARY_MATCH_REGEXP),d=[],e=[];s.stats.push(a),_.forEach(c,function(a){"PV"!==a&&"UV"!==a&&s.curControl.stats.indexOf(a)<0&&s.indexStats[a]&&(d.push(a),e.push(s.indexStats[a]))}),s.indexCurGroupComStats[a.name]=a;var h={experiments_updater:{}};_.forEach(s.curExps,function(b){b.stats.push(a.name),b.stats=b.stats.concat(d),b.stats=_.uniqWith(_.pull(b.stats,"UV","PV"),_.isEqual),h.experiments_updater[b.id]={stats:b.stats}}),i.updateGroupWithExp(s.curGroup.id,h).then(function(c){s.indexCurGroupAllStats.hasOwnProperty(a.name)||b.curGroupComStats.push(a)})},b.nextStep=function(){var a=h.getCurVersionStateName(s.curApp,s.group);if(s.group.typ===f.EXP_TYPE_URL){var c=[],e=0;if(s.group.experiments.forEach(function(a){_.get(a,"annotation.base_url")||a.status==f.EXP_STATUS_DELETE||c.push(a),a.status!=f.EXP_STATUS_DELETE&&(e+=1)}),!s.group.control.hasOwnProperty("annotation")||0==e||0!=c.length)return void g.alert({content:"至少有两个版本",type:"fail"},function(){q.goAnchor("urllists")})}s.groups.length<2?b.openModel(function(){s.curApp.typ===f.APP_TYPE_DEF?d.go(a):d.go("app.data.devtest")}):s.curApp.typ===f.APP_TYPE_DEF?d.go(a):d.go("app.data.devtest")},b.openModel=function(c){var d=a.open({animation:!0,templateUrl:"components/firstModel/firstModal.html",controller:"FirstModalCtrl",windowClass:"modal-guide",size:"lg",resolve:{items:function(){return b.items}}});d.result.then(function(){return c()})},b.prev=function(){history.go(-1)},b.removeStatHandler=function(a,c){if(a.stopPropagation(),c){var d=c.hasOwnProperty("statName")?c.statName:c.name,e="";if(_.forEach(b.curGroupComStats,function(a){var b=a.formula.match(f.COMSTATFORMULARY_MATCH_REGEXP);b.indexOf(d)>-1&&(e+=a.name+"、")}),e=e.substr(0,e.lastIndexOf("、")))return g.alert({content:"要移除优化指标："+d+"<br>复合指标:"+e+"中，引用该优化指标，删除后将影响复合指标的数值",type:"fail"});if(c.isAutoSate){if(b.isShowBuilderExp)return b.addBuilderState();if(b.isShowUrlSpliteExp)return b.removeURLSpiteState()}g.confirm({content:"确定要移除优化指标："+d,type:"fail"},function(){var a=_.indexOf(s.curControl.stats,c.name);s.curControl.stats.splice(a,1);var d={experiments_updater:{}};if(s.curControl.typ===f.EXP_TYPE_BUILD&&h.getAppType()===f.APP_TYPE_ANDIOD||s.curControl.typ===f.EXP_TYPE_BUILD&&h.getAppType()===f.APP_TYPE_IOS){if(h.getAppType()===f.APP_TYPE_IOS&&c.isAutoSate)return b.addIosBuilderState();if(h.getAppType()===f.APP_TYPE_ANDIOD&&c.isAutoSate)return b.addAndroidBuilderState();_.forEach(s.curExps,function(a){d.experiments_updater[a.id]={stats:s.curControl.stats}}),i.updateGroupWithExp(s.curGroup.id,d)}else _.forEach(s.curExps,function(a){d.experiments_updater[a.id]={stats:s.curControl.stats}}),i.updateGroupWithExp(s.curGroup.id,d).then(function(a){})})}},b.focusTr=function(a,b){a.$show()},b.cleanStatForm=function(a,b,c){a.stopPropagation(),b.$cancel()},b.saveStat=function(a,b){b.description=a.description,j.updateStats(h.getAppID(),b).then(function(){})},b.saveComStat=function(a,b){b.description=a.description,b.formula=a.formula,j.updateStats(h.getAppID(),b).then(function(){})},s.updateH5Data=function(){r.updatePageCacheData(s.curGroup,function(){})},b.addAutoState=function(){var b=a.open({templateUrl:"app/modalAddAutoState/modalAddAutoState.html",size:"addautostate",controller:"ModalAddAutoStateCtrl",resolve:{curGroup:function(){return i.getGroupById(h.getCurGroupId())}}});b.result.then(function(){s.updateH5Data()})},b.addBuilderState=function(){if(h.getAppType()==f.APP_TYPE_H5){var a=window.open("about:blank","_blank"),b=o.openSdk({url:s.urls[0].url,authkey:h.getAuthKey(),appid:h.getAppID(),groupid:h.getCurGroupId(),expid:s.curControl.id,appkey:s.curApp.app_key});m.bindWindowClosed(a,function(){s.updateH5Data()}),a.location.href=b}},b.addIosBuilderState=function(){d.go("iosMobileEditor")},b.addAndroidBuilderState=function(){d.go("mobileeditor")},b.removeURLSpiteState=function(){var a=window.open("about:blank","_blank"),b=o.openSdk({authkey:h.getAuthKey(),url:_.get(s.curControl,"annotation.base_url"),appid:h.getAppID(),groupid:h.getCurGroupId(),expid:s.curControl.id,appkey:s.curApp.app_key,mode:"urlsplite"});m.bindWindowClosed(a,function(){s.updateH5Data()}),a.location.href=b},b.isAutoState=function(a){if(!s.curControl)return!1;if(!s.curControl.hasOwnProperty("flags"))return!1;for(var b in s.curControl.flags){var c=s.curControl.flags[b];if(!c)return!1;var d=angular.fromJson(c);if("__autoexperiment__"==b&&d.hasOwnProperty("stats")){var e=d.stats,f=_.groupBy(e,"stat_key");return!!f.hasOwnProperty(a.name)}if("__autoexperiment__"!=b&&_.isObject(d)){var g=_.values(d)[0],h=g.data.stats,i=_.groupBy(h,"statName");return!!i.hasOwnProperty(a.name)}}return!1}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.createInfo.expversion.expInfo",{url:"/expInfo",templateUrl:"app/expstats/expInfo.html",controller:"ExpInfoCtrl",role:{noExp:!0},data:{pageTitle:"创建试验  A/BTesting"}}),a.state("app.createInfo.lists.expInfo",{url:"/expstats",templateUrl:"app/expstats/expInfo.html",controller:"ExpInfoCtrl",role:{noExp:!0},data:{pageTitle:"创建试验  A/BTesting"}}),a.state("app.createInfo.url.stats",{url:"/stats",templateUrl:"app/expstats/expInfo.html",controller:"ExpInfoCtrl",role:{noExp:!0},data:{pageTitle:"创建试验  A/BTesting"}})}]),angular.module("abtesting").controller("ExpversionCtrl",["$scope","$state","$timeout","App","ExpHelper","ExpApi","alert","AbDispacher","Constant","$q","abToast","toScroll","DataHelper","nzTour","dataManager","ExpLogic",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this;o.register(["allGroupsData","curGroupData","flags"],function(a){q.curGroup=a.curGroupData,q.flags=a.flags,q.groups=a.allGroupsData,q.refreshData(),q.firstComer()}),o.changeState(function(a){var b=_.keys(a);b.forEach(function(b){switch(b){case"allGroupsData":q.groups=a.allGroupsData;break;case"flags":q.flags=a.flags;break;case"curGroupData":q.curGroup=a.curGroupData}}),q.refreshData()}),q.refreshData=function(){q.groups=e.getValideGroups(q.groups),q.curFlags=e.getValideFlagByGroup(q.flags,q.curGroup),a.isFristExp=1===q.groups.length,q.curAllExpId=_.map(a.curExps,"id"),q.indexCurExps=_.groupBy(a.curExps,"id"),a.curFlags=q.curFlags,a.curGroup=q.curGroup,a.curControl=q.curGroup?q.curGroup.control:{},a.curExps=e.getValideExpsByGroup(a.curGroup),q.expNames=_.keyBy(a.curExps,"name"),a.vaildeflags=_.flattenDepth(e.getVaildeFlags(q.flags),1),a.add=!0,a.h5=d.getAppType()===i.APP_TYPE_H5,a.android=d.getAppType()===i.APP_TYPE_ANDIOD,a.ios=d.getAppType()===i.APP_TYPE_IOS,q.newExpStats=a.curControl.stats,q.newExpCustorm=a.curControl.custom_conditions,q.newExpSummary=a.curControl.summary_conditions,q.curLayerId=a.curControl.layer_id?a.curControl.layer_id:"",q.getNewExpFlag()},q.getNewExpFlag=function(){if(q.newExpflag={},a.curGroup&&a.curGroup.hasOwnProperty("control"))for(var b in a.curGroup.control.flags)q.newExpflag[b]=a.curGroup.control.flags[b],_.isBoolean(a.curGroup.control.flags[b])&&(q.newExpflag[b]=!a.curGroup.control.flags[b])},q.updateExp=function(a,b){f.updateExpById(a.id,a).then(function(a){return b(a.data)})},q.addExp=function(a,b){f.creatExp(d.getAppID(),a).then(function(a){return b(a.data)})},q.curFlagsByname=_.groupBy(a.flags,"name"),q.updateEveryExp=function(b,c){var d=[];a.curExps.forEach(function(a){a.hasOwnProperty("id")&&d.push(a)}),q.indexCurExps=_.keyBy(d,"id");var e={experiments_updater:{}};_.forEach(q.indexCurExps,function(a){"addFlag"===b&&("String"!==c.typ&&"string"!==c.typ||(a.flags[c.name]=c.default_value?c.default_value:""),"Number"!==c.typ&&"number"!==c.typ&&"Integer"!==c.typ||(a.flags[c.name]=c.default_value?c.default_value:0),"Boolean"!==c.typ&&"boolean"!==c.typ||(a.isControl?a.flags[c.name]=c.default_value:a.flags[c.name]=!c.default_value),e.experiments_updater[a.id]={flags:a.flags}),"delFlag"===b&&(_.unset(a.flags,c),e.experiments_updater[a.id]={flags:a.flags})}),f.updateGroupWithExp(q.curGroup.id,e).then(function(a){h.refreshFlagPanel()})},a.addFlags=function(){q.isRowLock()||d.openPenls()},a.select=function(b){return _.findIndex(a.curFlags,{name:b.name})>=0?g.alert({content:"变量"+b.name+"已经选取",type:"fail"}):(a.curFlags.push(b),q.updateEveryExp("addFlag",b),q.curFlagsByname=_.groupBy(a.curFlags,"name"),void q.startStepThree())},a.delFlag=function(b){g.confirm({content:"确定要删除["+b.name+"]变量吗？"},function(){_.remove(a.curFlags,function(a){return a==b}),q.updateEveryExp("delFlag",b.name)})},a.addExps=function(){if(!q.isRowLock()){d.closePenls();var b=m.getExpDistantDateRange();a.inserted={name:"",description:"",traffic:0,start_date:moment().valueOf(),end_date:b.end.valueOf(),flags:q.newExpflag,summary_conditions:q.newExpSummary,custom_conditions:q.newExpCustorm,group_id:a.curGroup.id,stats:q.newExpStats,typ:q.curGroup.typ},q.curLayerId&&(a.inserted.layer_id=q.curLayerId),a.curExps.push(a.inserted),a.editRowLock=!0}},a.types=[{key:"true",val:!0},{key:"false",val:!1}],a.cleanForm=function(b,c,d){if(a.editRowLock=!1,b.stopPropagation(),c.$cancel(),!d.id){var e=a.curExps.indexOf(d);e>-1&&a.curExps.splice(e,1)}},a.editRowLock=!1,q.isRowLock=function(){return!!a.editRowLock&&(k.warning({msg:"点击行尾确定按钮以保存!"}),!0)},a.focusTr=function(b,c){c.isControl||q.isRowLock()||(a.editRowLock=!0,q.expNames=_.keyBy(a.curExps,"name"),delete q.expNames[c.name],b.$show())},a.removeExp=function(a,b){a.stopPropagation(),g.confirm({content:"确认要删除["+b.name+"]版本?"},function(){f.deleteExpById(b.id).then(function(a){p.updatePageCacheData()})})},a.saveExp=function(b,c){a.editRowLock=!1,c.id?q.updateExp(c,function(b){var d=a.curExps.indexOf(c);a.curExps[d]=b,q.expNames=_.keyBy(a.curExps,"name"),q.curAllExpId=_.map(a.curExps,"id")}):q.addExp(c,function(b){var d=a.curExps.indexOf(c);a.curExps[d]=b,q.expNames=_.keyBy(a.curExps,"name"),q.curAllExpId=_.map(a.curExps,"id");var e={};e.id=b.id,b.hasOwnProperty("layer_id")&&(e.layer_id=b.layer_id),e.status=q.newStatus,q.updateExp(e,function(a){})})},q.checkString=function(a){if(0===a.length)return"不能为空"},q.checkNumber=function(a){if(_.isNaN(_.toNumber(a)))return"输入不是一个数字"},a.checkExpName=function(a){return 0===a.length?"试验名称不能为空":q.expNames[a]?"试验名称不能重复":void 0},a.checkFlags=function(a,b){switch(b){case"String":return q.checkString(a);case"Number":case"Interger":return q.checkNumber(a)}},a.next=function(){l.goAnchor("expinfo")},a.opens=function(){d.openPenls(),a.add=!1,q.startStepThree()};var r={config:{previousText:"上一步",nextText:"下一步",finishText:"完成"},steps:[{target:"#step1",content:"变量用于控制进行对照的元素。"},{target:"#step-1",content:"在每个版本中填写对应的值，比如原始版本True, 试验版本 False。"},{target:"#first-add-flag",content:"点击添加变量"}]};q.firstComer=function(){a.isFristExp&&n.start(r)},q.startStepThree=function(){var b={config:{previousText:"上一步",nextText:"下一步",finishText:"完成"},steps:[{target:"#step-1",content:"点击编辑按钮，填写每个版本对应的变量值。"}]};a.isFristExp&&1===a.curFlags.length&&setTimeout(function(){n.start(b)},1e3)}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.createInfo.expversion",{url:"/expversion",templateUrl:"app/expversion/expversion.html",controller:"ExpversionCtrl",role:{noExp:!0},data:{pageTitle:"创建试验  A/BTesting"}})}]),angular.module("abtesting").controller("ForgotPassCtrl",["$scope","$state","$stateParams","$location","Auth","alert",function(a,b,c,d,e,f){a.bSub=!0,a.subDisabled=!1,a.link=c.link,a.formTest={},a.acTest=!1,a.nuTest=!1,a.enTest=!1,a.changePass=function(b){var c=/.{8,}/,d=/[\d\W]/,e=/[a-zA-Z]/;return b?(a.acTest=c.test(b),a.nuTest=d.test(b),void(a.enTest=e.test(b))):(a.acTest=!1,a.nuTest=!1,void(a.enTest=!1))},a.sub=function(){e.resetPassword(c.code,c.email,a.formTest.password,function(a){return 20006==a.data.error_code?f.alert({content:'您当前的链接已失效，请重新申请<a href="https://www.appadhoc.com/abtesting/#/begin_password_reset">找回密码</a>',type:"fail"}):void b.go("forgotPassSuc")})}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("forgotPass",{url:"/forgot_password?code?email",templateUrl:"app/forgotPass/forgotPass.html",controller:"ForgotPassCtrl",role:{noAuth:!0},data:{pageTitle:"找回密码 A/BTesting"}})}]),angular.module("abtesting").controller("ForgotPassSucCtrl",["$scope","$state","$stateParams",function(a,b,c){""==c[0]}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("forgotPassSuc",{url:"/forgot_pass_suc/:0",templateUrl:"app/forgotPassSuc/forgotPassSuc.html",controller:"ForgotPassSucCtrl",role:{noAuth:!0},data:{pageTitle:"找回密码 A/BTesting"}})}]),angular.module("abtesting").controller("h5Ctrl",function(){}),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.h5",{url:"/h5",templateUrl:"app/h5/h5.html",controller:"h5Ctrl"})}]),angular.module("abtesting").controller("H5listsCtrl",["$scope","$timeout","$interpolate","curGroup","App","$state","ExpApi","Constant","H5Api","ExpHelper","$stateParams","$window","$rootScope","toScroll","dataManager","ExpLogic",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this;q.curApp=e.getApp(),q.curGroup=d.data,o.changeState(function(a){var b=_.keys(a);b.forEach(function(b){switch(b){case"curGroupData":q.curGroup=a.curGroupData}}),q.refreshData()}),q.refreshData=function(){q.curControl=q.curGroup.control,q.exps=j.getValideExpsByGroup(q.curGroup),q.urls=angular.fromJson(_.get(q.curControl,"annotation.urls"))||[],q.expenv=angular.fromJson(_.get(q.curControl,"annotation.ua"))||null,a.curGroup=q.curGroup,a.curApp=q.curApp,a.urls=q.urls,a.expenv=q.expenv,a.curExps=q.exps,a.experiments=q.exps,a.expgroups=[],a.expsObj={},a.variant_experiments=[],a.cur_description=null,q.initExpsImg()},q.initExpsImg=function(){_.forEach(a.experiments,function(b){e.getAppType()==h.APP_TYPE_H5&&a.selectURL?b.preImg=c(h.QINIU_IMGH5_TMPL)({expid:b.id,url:encodeURIComponent(encodeURIComponent(a.selectURL.url))})+"?"+(new Date).getTime():b.preImg=b.annotation?b.annotation.snapshot:"https://o6p8nieie.qnssl.com/web-null-url.png"})},q.refreshData(),a.urls.length>0&&(a.selectURL=a.urls[0]),a.dic={equal:"完全匹配",startsWith:"匹配开头",regex:"模糊匹配"},e.getAppType()===h.APP_TYPE_ANDIOD&&q.curGroup.typ===h.EXP_TYPE_BUILD&&j.bindWindowClosed(q.newTab,function(){g.getGroupById(e.getCurGroupId()).then(function(b){a.experiments=j.getValideExpsByGroup(b.data),q.initExpsImg()})}),a.nextStep=function(){e.getAppType()===h.APP_TYPE_ANDIOD&&q.newTab&&q.newTab.close(),n.goAnchor("expinfo")},a.groupname=e.getCurGroup().name,a.filterDelExp=function(a){return 5!=a.status},q.updateH5Data=function(){p.updatePageCacheData(q.curGroup)},a.selectURLHandler=function(b){a.selectURL=b,q.initExpsImg()},a.toExp=function(b){var c=window.open("about:blank","_blank"),d=g.getGenerateClientId(),e=b.qr_code,f=a.selectURL.url,h=f.indexOf("://")>-1?f:"http://"+f,i="?";h.indexOf("?")>-1&&(i="&");var f=h+i+"adhoc_force_client_id="+d,j="https://h5.appadhoc.com/redirectURL?url="+encodeURIComponent(f);g.forceClients(d,e).then(function(){c.location.href=j})},a.editIosMobile=function(){f.go("iosMobileEditor")},a.editMobile=function(){f.go("mobileeditor")},a.editURL=function(a){var b=l.open("about:blank","_blank"),c=i.openSdk({url:a.url,authkey:e.getAuthKey(),appid:e.getAppID(),groupid:e.getCurGroupId(),expid:q.curControl.id,appkey:q.curApp.app_key});j.bindWindowClosed(b,function(){q.updateH5Data()}),b.location.href=c}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.createInfo.lists",{url:"/lists",templateUrl:"app/h5lists/h5lists.html",controller:"H5listsCtrl",data:{pageTitle:"H5 试验详情"},resolve:{curGroup:["ExpApi","App",function(a,b){return a.getGroupById(b.getCurGroupId())}]}})}]),angular.module("abtesting").controller("H5urlsCtrl",["$scope","$state","$timeout","ExpHelper","curGroup","ExpApi","H5Api","App","Constant",function(a,b,c,d,e,f,g,h,i){var j=this;a.DEFAULT_MODE=1,a.REGEXP_MODE=2,j.curGroup=e.data,j.curApp=h.getApp(),j.curControl=j.curGroup.control,j.curExps=d.getValideExpsByGroup(j.curGroup),j.urls=angular.fromJson(_.get(j.curControl,"annotation.urls"))||[],j.getH5FlagTmpl=function(a){return{mode:a.mode,regexp:a.regexp,url:a.url,data:{changes:[],stats:[]}}},j.getFlagJSON=function(a){var b={};return _.each(a,function(a){var c=j.getH5FlagTmpl(a);b[a.url]=c}),angular.toJson(b)},a.mode=a.REGEXP_MODE,a.urls=j.urls,a.addPage=function(){var b={mode:"",url:"",regexp:""};a.urls.push(b)},a.initURLObj=function(a){a.mode||(a.mode="equal")},j.snapshot=function(){for(var b=0;b<j.curExps.length;b++)for(var c=j.curExps[b],d=0;d<a.urls.length;d++){var e=a.urls[d];g.verSnapshot({url:e.url,name:c.id,type:"web"
})}},a.nextStep=function(c){if(!c.$invalid){var e=window.open("about:blank","_blank"),g=a.urls[0].url;g=d.autoComplateURL(g),a.urls[0].url=g;var k=j.getFlagJSON(a.urls),l="_"+encodeURIComponent(g)+"_",m=a.getFlagTmpl(l);f.createFlag(h.getAppID(),m,l).then(function(c){_.each(j.curExps,function(b){_.set(b,"annotation.urls",angular.toJson(a.urls)),b.flags[l]=k});var d=_.keyBy(j.curExps,"id");f.updateGroupWithExp(j.curGroup.id,{experiments_updater:d}).then(function(c){return j.snapshot(),a.editURL(a.urls[0],e),h.getAppType()===i.APP_TYPE_ANDIOD?b.go("mobileeditor"):b.go("app.h5.lists")})})}},a.urls.length||a.addPage(),a.copy=function(){var b=document.getElementById("copy-url-sdk");b.select(),document.execCommand("copy"),a.copytextTip="复制成功"},a.$watch("copytextTip",function(){c(function(){a.copytextTip=""},6e3)}),a.editURL=function(a,b){var c=g.openSdk({url:a.url,authkey:h.getAuthKey(),appid:h.getAppID(),groupid:h.getCurGroupId(),expid:j.curControl.id,appkey:j.curApp.app_key});b.location.href=c},a.getFlagTmpl=function(a){return{name:a,description:"Version of test pages in H5",typ:"String",default_value:"{}"}}}]),angular.module("abtesting").controller("H5versionCtrl",["$scope","$rootScope","App","$state","ExpApi","H5Api","$interpolate","$window","ExpHelper","Constant","dataManager","curGroup","ExpLogic",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=this;n.curApp=c.getApp(),n.curGroup=l.data,k.changeState(function(a){var b=_.keys(a);b.forEach(function(b){switch(b){case"curGroupData":n.curGroup=a.curGroupData}}),n.refreshData()}),n.addInfomation=function(a){_.forEach(a,function(a){if(a){if(a.isControl)return a.displayName="原始版本",void(a.displayDescription="对照组");a.displayName=a.name,a.displayDescription=a.description}})},n.updateH5Data=function(){m.updatePageCacheData(n.curGroup)},n.initExpsImg=function(){_.forEach(a.curExps,function(b){c.getAppType()==j.APP_TYPE_H5&&a.selectURL?b.preImg=g(j.QINIU_IMGH5_TMPL)({expid:b.id,url:encodeURIComponent(encodeURIComponent(a.selectURL.url))})+"?"+(new Date).getTime():b.preImg=b.annotation?b.annotation.snapshot:"https://o6p8nieie.qnssl.com/web-null-url.png"})},n.refreshData=function(){n.curControl=n.curGroup.control,n.urls=angular.fromJson(_.get(n.curControl,"annotation.urls"))||[],n.expenv=angular.fromJson(_.get(n.curControl,"annotation.ua"))||null,a.urls=n.urls,a.expenv=n.expenv,a.urls.length>0&&(a.selectURL=a.urls[0]),n.curExps=i.getValideExpsByGroup(n.curGroup),n.addInfomation(n.curExps),a.curExps=n.curExps,a.curApp=n.curApp,n.initExpsImg()},n.refreshData(),a.edit=function(){d.go("h5editor")},a.show=function(b){var c=window.open("about:blank","_blank"),d=e.getGenerateClientId(),f=b.qr_code,g=a.selectURL.url;g=a.addParamsToURL(g,{adhoc_force_client_id:d});var h="https://h5.appadhoc.com/redirectURL?url="+encodeURIComponent(g);e.forceClients(d,f).then(function(){c.location.href=h})},a.toExp=function(b){var e=f.openSdk({url:a.group.annotation.base_url,authkey:c.getAuthKey(),appid:c.getAppID(),groupid:c.getCurGroupId(),expid:b.id,appkey:n.curApp.app_key});i.bindWindowClosed(e,function(){d.reload()}),window.location.href=e},a.dic={equal:"完全匹配",startsWith:"匹配开头",regex:"模糊匹配"},a.editURL=function(a){var b=window.open("about:blank","_blank"),d=f.openSdk({url:a.url,authkey:c.getAuthKey(),appid:c.getAppID(),groupid:c.getCurGroupId(),expid:n.curControl.id,appkey:n.curApp.app_key});i.bindWindowClosed(b,function(){n.updateH5Data()}),b.location.href=d},a.selectURLHandler=function(b){a.selectURL=b,n.initExpsImg()},a.editMobile=function(){c.getAppType()===j.APP_TYPE_ANDIOD&&d.go("mobileeditor")},a.editIosMobile=function(){c.getAppType()===j.APP_TYPE_IOS&&d.go("iosMobileEditor")},a.$on("$locationChangeSuccess",function(a){n.updateH5Data()}),a.addParamsToURL=function(a,b){function c(a){var b="";b+="?";var c=0;for(var d in a)c++,b+=d,b+="=",b+=a[d],b+="&";return b}function d(a){return a.indexOf("#")===-1&&"&"==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),a}var e=a.indexOf("://")>-1?a:"http://"+a,f="";if(e.indexOf("?")>-1){f=e.substr(0,e.indexOf("?")),f+=c(b);var g=e.substr(e.indexOf("?")+1,e.length);f+=g}else if(a.indexOf("#")>-1){f=e.substr(0,e.indexOf("#")),f+=c(b);var h=e.substr(e.indexOf("#"),e.length);f=d(f),f+=h}else f=a+c(b);return f=d(f)}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.data.testdata.h5version",{url:"/h5version",templateUrl:"app/h5version/h5version.html",controller:"H5versionCtrl",data:{pageTitle:"版本管理 A/BTesting"},resolve:{curGroup:["ExpApi","App",function(a,b){return a.getGroupById(b.getCurGroupId())}]}})}]),angular.module("abtesting").service("AuthHelper",["Constant",function(a){return{getCurUserApps:function(a,b){return _.filter(a,function(a){return _.get(a,"author_id")===b})}}}]),angular.module("abtesting").service("DataHelper",["DataApi","App","Constant","alert",function(DataApi,App,Constant,alert){return{getClientByData:function(a){return _.map(a,"client_sum")},getClientsResultsByDailyByExpId:function(a,b){return _.filter(a,_.matches({experiment_id:b}))},getCurrentClientsResults:function(a){return _.map(a.data.clients,client_sum)},getVaildeStats:function(a){return _.filter(a,function(a){return a.description!=Constant.SYSTEM_STATS_VAILDE&&a.description!=Constant.SYSTEM_STATS_VAILDE1})},getVaildeStatsNameArray:function(a){return _.map(a,"name")},getVaildeStatsResults:function(a){return _.filter(a,function(a){return!a.stat_key.startsWith(Constant.SYSTEM_STATS_PV)&&!a.stat_key.startsWith(Constant.SYSTEM_STATS_UV)})},getNonFormulaStats:function(a){var b=[];return _.forEach(a,function(a){""==a.formula&&b.push(a)}),b},getStatResultsByStat:function(a,b){return _.filter(a,function(a){return a.stat_key==b})},getStatResultsMeanByStatByExperimentIdArray:function(a,b){var c,d,e=[];return _.forEach(b,function(b){c=_.filter(a,_.matches({experiment_id:b})),e.push(c)}),d=_.flattenDeep(e,1),_.map(d,"mean")},getStatResultsMeanByStatByExpId:function(a,b){var c=_.filter(a,_.matches({experiment_id:b}));return _.map(c,"mean")},getStatResultsByStatDiffExp:function(a,b){return _.forEach(b,function(a){})},getTimeCompareDataByDay:function(a,b){var c=this;c.dataCompleteTime=[],c.dataCompleteUtc=[],c.dataCompleteNullData=[];for(var d,e=a,f=b,g=moment.range(e,f).diff("days"),h=(this.timeRangeDiffHours(e,f),0);h<g;h++){var d=moment(e).add(h,"days").format("MM-DD");c.dataCompleteNullData.push(0),c.dataCompleteUtc.push(moment(e).add(h,"days").format("YYYY-MM-DD")+"T16:00:00.000Z")}for(var h=1;h<=g;h++)d=moment(e).add(h,"days").format("MM-DD"),c.dataCompleteTime.push(d);return{dataCompleteUtc:c.dataCompleteUtc,dataCompleteNullData:c.dataCompleteNullData,dataCompleteTime:c.dataCompleteTime}},getTimeCompareDataByHour:function(a,b){var c=this,d=a,e=b;c.dataCompleteTime=[],c.dataCompleteUtc=[],c.dataCompleteNullData=[];for(var f=moment.range(d,e).diff("days"),g=24*f+moment(e).hour(),h=moment(d).add(1,"days").format("YYYY-MM-DD"),i=-24;i<g-23;i++){var j=moment(h).add(i,"h").toISOString(),k=moment(h).add(i,"hours").format("MM-DD HH:mm");c.dataCompleteUtc.push(j),c.dataCompleteTime.push(k),c.dataCompleteNullData.push(0)}return{dataCompleteUtc:c.dataCompleteUtc,dataCompleteNullData:c.dataCompleteNullData,dataCompleteTime:c.dataCompleteTime}},getCompareTimeByDay:function(a,b){var c=this.getTimeCompareDataByDay(a,b),d=c.dataCompleteUtc;return _.reverse(d),d},getCompareTimeByHour:function(a,b){var c=(this.getTimeCompareDataByHour(a,b),timeCompareDataByDay.dataCompleteUtc);return _.reverse(c),c},checkFormula:function(a,b){var c=_.keyBy(b,"name"),d=a.match(Constant.COMSTATFORMULARY_MATCH_REGEXP),e=a.search(Constant.COMSTATFORMULARY__SEARCH_REGEXP);if(e!=-1)return alert.alert({content:"计算公式语法错误",type:"fail"}),-1;var f={},g=[];return f=c,App.getAppType()===Constant.APP_TYPE_H5&&(f.PV={name:Constant.SYSTEM_STATS_PV,description:"",status:0,formula:""}),f.UV={name:Constant.SYSTEM_STATS_UV,description:"",status:0,formula:""},d?(d.forEach(function(a){f.hasOwnProperty(a)||g.push(a)}),0!=g.length?(alert.alert({content:"计算公式包含未知指标名:"+g,type:"fail"}),-1):void 0):void 0},matchedStatsFromFormula:function(a){var b=a.match(Constant.COMSTATFORMULARY_MATCH_REGEXP),c=null;return b&&(c=[],b.forEach(function(a){a.startsWith("{")&&a.endsWith("}")&&(a=a.substr(1,a.length-2)),c.push(a)})),c},mathEval:function(exp){var reg=/(?:[a-z$_][a-z0-9$_]*)|(?:[;={}\[\]"'!&<>^\\?:])/gi,valid=!0;if(exp=exp.replace(reg,function(a){return Math.hasOwnProperty(a)?"Math."+a:void(valid=!1)}),!valid)return NaN;if(!exp)return NaN;try{return eval(exp)}catch(e){return NaN}},getComputedStatValue:function(a,b,c,d){var e=_.groupBy(a,"stat_key"),f=this.matchedStatsFromFormula(b.formula),g=b.formula;g=g.replace(new RegExp("{","g"),""),g=g.replace(new RegExp("}","g"),"");for(var h in f){var i=_.keyBy(e[f[h]],"experiment_id");if("sum"==d){var j=i[c]?i[c].sum:0;g=g.replace(new RegExp(f[h]),j)}if("mean"==d){var j=i[c]?i[c].mean:0;g=g.replace(new RegExp(f[h]),j)}if("uv_sum"==d){var j=i[c]?i[c].uv:0;g=g.replace(new RegExp(f[h]),j)}if("uv_mean"==d){var j=i[c]?i[c].uv_mean:0;g=g.replace(new RegExp(f[h]),j)}}return this.mathEval(g)},tooltipFormatter:function(a){$.isArray(a)||(a=[a]);var b,c=[],d="";return a.forEach(function(a){b=a.name;var d=isFinite(a.data)?a.data.toMyPrecision(3):"",e=a.seriesName+": "+d+"<br/>";c.push(e)}),c&&a.length==c.length&&c.forEach(function(a){d+=a}),b+"<br/>"+d},getDimensionsKeys:function(a,b){if(a){var c=[],d=[];return _.forEach(a,function(a){c.push(_.keys(a))}),d=_.uniq(_.flatten(c))}},changeDimensionsKeysChinese:function(a){if(a){var b=[],c={display_height:" 屏幕高度",url:"url",os_version:"  操作系统版本",device_model:"设备型号",browser:" 浏览器",display_width:"屏幕宽度",country:"国家",sdk_api_version:"SDKapi版本",device_type:"设备类型",locale:"地区",os_version_name:"操作系统版本名称",browser_version_name:"浏览器版本名称",language:"语言",device_vendor:"设备厂商",sdk_version:"SDK版本",brower_engine:"浏览器内核",browser_engine:"浏览器内核",region_province:"省份",referrer:"referrer URL",OS:"操作系统",browser_version:"浏览器版本",region_city:" 城市",network_state:"网络类型",screen_size:"屏幕密度"},d=function(a,b){var c={};if(a)return c.name=b[a]?decodeURIComponent(b[a]):decodeURIComponent(a),c.key=a,c};return _.forEach(a,function(a){if("all"!==a){var e=d(a,c);b.push(e)}}),b}},phi_cdf:function(a){var b=.254829592,c=-.284496736,d=1.421413741,e=-1.453152027,f=1.061405429,g=.3275911,h=Math.sign(a);a=Math.abs(a)/Math.sqrt(2);var i=1/(1+g*a),j=1-((((f*i+e)*i+d)*i+c)*i+b)*i*Math.pow(Math.E,-a*a);return.5*(1+h*j)},calculate_p_value:function(a,b,c,d,e,f){var g=-Math.abs(b-a)/Math.sqrt(c/e+d/f),h=2*this.phi_cdf(g);return h},calculate_critz:function(a){var b,c=6,d=1e-6,e=-c,f=c,g=0;if(a<0||a>1)return-1;for(;f-e>d;)b=this.phi_cdf(g),b>a?f=g:e=g,g=.5*(f+e);return g},getCb_dunnett:function(a,b){var c=[0,2.107,2.336,2.466,2.55,2.616,2.672,2.71,2.748,2.785,2.814],d=[0,2.678,2.88,3.004,3.08,3.137,3.185,3.224,3.262,3.291,3.32],e=.05==b?c:d,f=e[a];return f},get_zb_k:function(a,b,c,d){return a*Math.pow(c/b,d-.5)},getMiniKOfZBK:function(a){var b=this.timeRangeDiffDays(1e3*a.start_date,moment())+1;return b>14?b=14:b<0?b=0:b},calculate_statistical_power:function(a,b,c,d,e,f,g,h,i,j){var k=this.assistCountUv(a,b,g),l=k.x1,m=k.x2,n=k.v1,o=k.v2,p=1.9599651;if(.05!=f&&f>0&&f<=1&&(p=Math.abs(this.calculate_critz(f/2))),.05==f&&j||.01==f&&j){var q=this.getCb_dunnett(h,f);p=this.get_zb_k(q,14,i,0)}var r=Math.sqrt(n/c+o/d),s=Math.abs(m-l),t=e||.03,u=p*r,v=s-u,w=s/r,x=0,y=0,z=0,A=Math.abs(l*t)/r,B=1;if(.05==f&&j||.01==f&&j){var C=2*this.phi_cdf(-w),D=2*this.phi_cdf(-p);B=D<Number.MIN_VALUE?1:C*f/D,B>1&&(B=1)}else B=2*this.phi_cdf(-w);B>=f?(z=100*t,y=A,x=y):(z=Math.sign(m-l)*v*100/l,y=-p+w,x=Math.sign(m-l)*y);var E=this.phi_cdf(-p+y)+this.phi_cdf(-p-y),F="";E<.5?F="功效不足":E<.8?F="功效一般":E<=1&&(F="功效足够");var G=m-l,H=(G-u)/k.x1*100,I=(G+u)/k.x1*100,J="";J=Math.sign(H)==Math.sign(I)&&Math.min(Math.abs(H),Math.abs(I))>=100*t?"效果显著":Math.max(Math.abs(H),Math.abs(I))<100*t?"效果不显著":"效果不确定",w=(m-l)/r;var K={pvalue:B,mpower:E,ci_value:u,power_desc:F,effect_desc:J,effect_size:z,zvalue:w,z_effect:x,z_alpha:p,z_max:p+w,z_min:-p+w,z_detect:A,ci_low:H,ci_high:I};return K},getOutputCi:function(a,b,c,d,e,f,g,h){if(h)var i=h(a,b);else{var i={};if(i.o={sum:a.sum},i.x1=b.mean,a.hasOwnProperty("x_avg"),0==i.x1||_.isUndefined(i.x1))return null;i.x2=a.mean,i.v1=b.variance?b.variance:0,i.v2=a.variance?a.variance:0}if(!i)return 0;var j=c,k=d,l=1.9599651;if(.05!=e&&e>0&&e<=1&&(l=Math.abs(this.calculate_critz(e/2))),.05==e||.01==e){var m=this.getCb_dunnett(f,e);l=this.get_zb_k(m,14,g,0)}var n=l*Math.sqrt(i.v1/j+i.v2/k),o=i.x2-i.x1;return i.o?{low:(o-n)/i.x1*100,high:(o+n)/i.x1*100,p_value:0}:null},getDistinct:function(a,b){var c={};return c.o=a?{sum:a.uv}:{sum:0},c.x1=b?b.uv_mean:0,0==c.x1||_.isUndefined(c.x1)?null:(c.x2=a.uv_mean,c.v1=c.x1*(1-c.x1),c.v2=c.x2*(1-c.x2),c)},assistCountUv:function(a,b,c){var d={};return c?(d.x1=a.mean?a.mean:0,d.x2=b.mean?b.mean:0,d.v1=a.variance?a.variance:0,d.v2=b.variance?b.variance:0):(d.x1=a.uv_mean?a.uv_mean:0,d.x2=b.uv_mean?b.uv_mean:0,d.v1=d.x1*(1-d.x1),d.v2=d.x2*(1-d.x2)),d},getCompositeStatVariance:function(a){var b=a.x_avg,c=a.y_avg,d=a.x_variance,e=a.y_variance;if(0==b||0==c)return"Invalid Data";var f=a.covariance,g=function(a,b){return a/Math.pow(b,2)},h=g(d,b),i=g(e,c),j=2*f/(b*c);return a.variance=Math.pow(b/c,2)*(i+h-j),a.mean=b/c,a},getOutputVar:function(){},getExpDistantDateRange:function(){var a=moment(),b=a.add(10,"years").hours(0).minutes(0).seconds(0);return{begin:a,end:b}},getValueTypeGridLeft:function(a){var b=0;_.map(_.flatten(_.map(a,"data")),function(a){if(b<a)return b=a});var c=_.toString(b);return 5>c.length&&c.length>3?"60px":c.length>8?"80px":"50px"},defaultSelectedEndDate:function(a){return a.status==Constant.EXP_STATUS_STOP||a.status==Constant.EXP_STATUS_PUBLISH?moment(1e3*a.control.end_date):moment()},isNewDateInTheTime:function(a){var b=Math.floor(Date.now()/1e3);return a.begin<b&&b<a.end+86400},getLastTimeoFNewDateInContinuousDate:function(a){var b,c,d=this;if(a.forEach(function(a){var c=Math.floor(Date.now()/1e3);if(a.begin<c&&c<a.end+86400)return b=a}),b)return a.forEach(function(a){if(1==d.timeRangeDiffDays(1e3*b.end,1e3*a.begin)||0==d.timeRangeDiffDays(1e3*b.end,1e3*a.begin))return b=a}),c=b},timeToObject:function(a){return moment(a).toObject()},timeRangeDiffHours:function(a,b){var c=this.timeToObject(a),d=this.timeToObject(b),e=0,f=0;return d.date-c.date!=0?(f=this.timeRangeDiffDays(a,b)-1,e=24*f+d.hours):d.date-c.date==0?e=d.hours-c.hours:void 0},timeRangeDiffDays:function(a,b,c){var d=this.timeToObject(a),e=this.timeToObject(b),f=0,g=0,h=0,i=0,j=0;if(moment(e).isBefore(d))return-3;if(e.years-d.years>0){if(e.years!=d.years+1){for(var k=d.years+1;k<e.years;k++)i+=moment([k,11,31]).dayOfYear();for(var k=d.months;k<11;k++)h+=moment([d.years,k]).daysInMonth();for(var k=0;k<e.months-1;k++)g+=moment([e.years,k]).daysInMonth();return 11==d.months&&(j=moment([d.years,d.months]).daysInMonth()-d.date),f=g+i+h+e.date+j}for(var k=d.months;k<=11;k++)g+=moment([d.years,k]).daysInMonth();for(var k=0;k<e.months;k++)g+=moment([e.years,k]).daysInMonth();return g-=d.date,f=e.date+g}if(e.years-d.years==0){if(d.months-e.months==0)return f=e.date-d.date;for(var k=d.months;k<e.months;k++)g+=k==d.months?_.toNumber(moment([e.years,k]).daysInMonth())-d.date:_.toNumber(moment([e.years,k]).daysInMonth());return f=g+e.date}},timeRangeDiffMonths:function(a,b){var c=this.timeToObject(a),d=this.timeToObject(b),e=0,f=0;if(d.years-c.years>0){for(var g=c.years+1;g<d.years;g++)f+=12;return f=11-c.months+f,f=d.months+1+f,e=f}if(d.years-c.years==0)return e=d.months-c.months},timeRangeDiffMonths:function(a,b){var c=this.timeToObject(a),d=this.timeToObject(b),e=0,f=0,g=!1;if(moment(c).isBefore(moment(d))&&d.years!=c.years&&d.months!=c.months&&d.date!=c.date){g=!0;var h=c;c=h,d=h}if(d.years-c.years>0){for(var i=c.years;i<d.years;i++)f+=12;return f=11-c.months+f,f=d.months+1+f,e=g?-(d.months+1+f):d.months+1+f}if(d.years-c.years==0)return e=g?-(d.months-c.months):d.months-c.months},timeRangeDiffYears:function(a,b){var c=(this.timeToObject(a),this.timeToObject(b)),d=0;return d=c.years-c.years},normalDistribution:function(a,b,c){return Math.pow(Math.E,Math.pow(a-b,2)/(-2*c))/Math.sqrt(2*Math.PI*c)},compareSdkVersion:function(a,b){if(_.isUndefined(a))return!1;if(_.isUndefined(b))return!0;_.isString(a)||_.isString(a),_.isString(b)||_.isString(b);var c,d=_.toString(a.split("-")[0]).split("."),e=_.toString(b.split("-")[0]).split("."),f=d.length>e.length?d.length:e.length,g=-1;if(e.toString()==d.toString())return!0;for(;++g<f;){if(_.isUndefined(d[g])&&(d[g]=0),_.isUndefined(e[g])&&(e[g]=0),_.toNumber(d[g])>_.toNumber(e[g])){c=!0;break}if(_.toNumber(d[g])<_.toNumber(e[g])){c=!1;break}}return c},sysStatsChangeNameToChineses:function(a){if(a){var b=function(a){return a.name===Constant.SYSTEM_STATS_VISIT&&(a.statName="访问次数"),a.name===Constant.SYSTEM_STATS_CRASH&&(a.statName="崩溃次数"),a.name===Constant.SYSTEM_STATS_DURATION&&(a.statName="访问时长(s)"),a};return angular.isArray(a)?(a.forEach(function(a){a=b(a)}),a):angular.isArray(a)?a:a=b(a)}},testStatsFormualCovariance:function(a){var b=/[0-9a-zA-Z_]*\/{1}[0-9a-zA-Z_]*/;return b.test(a)}}}]),angular.module("abtesting").service("ExpHelper",["Constant","AbDispacher","DataHelper",function(a,b,c){return{getValideGroups:function(b){return _.filter(b,function(b){return b.status!=a.EXP_STATUS_DELETE&&null!=b.control})},getRunGroups:function(b){return _.filter(b,function(b){return b.status==a.EXP_STATUS_RUN})},getStopGroups:function(b){return _.filter(b,function(b){return b.status==a.EXP_STATUS_STOP})},getDefGroups:function(b){return _.filter(b,function(b){return b.status==a.EXP_STATUS_DEF})},getPublishGroups:function(b){return _.filter(b,function(b){return b.status==a.EXP_STATUS_PUBLISH})},getVaildeExps:function(b){return _.filter(b,function(b){return b.status!=a.EXP_STATUS_DELETE})},getValideExpsByGroup:function(b){var c=_.filter(b.experiments,function(b){return b.status!=a.EXP_STATUS_DELETE});return b.control&&(b.control.isControl=!0),_.concat([b.control],c)},getValideExpIdsByGroup:function(a){var b=this.getValideExpsByGroup(a);return _.map(b,"id")},getStatNamesByGroup:function(a){return a&&a.hasOwnProperty("control")?a.control.stats:[]},getCurStatsByGroup:function(b,c){if(b&&0===b.length)return[];var d=this.getStatNamesByGroup(c),e=_.filter(b,function(b){return!b.name.startsWith("Event-")&&b.status!==a.STAT_STATUS_DELETE}),f=_.keyBy(e,"name"),g=[];return _.forEach(d,function(a){f[a]&&g.push(f[a])}),_.uniqWith(g,_.isEqual)},getStat:function(a){return _.uniqWith(_.filter(a,function(a){return _.has(a,"formula")&&!a.formula}),_.isEqual)},getComStat:function(a){return _.filter(a,function(a){return _.has(a,"formula")&&a.formula})},getNoEventStats:function(a){return _.filter(a,function(a){return!a.name.startsWith("Event-")})},getEventStats:function(a){return _.filter(a,function(a){return a.name.startsWith("Event-")})},getEventStatsByGroup:function(a,b){if(a&&b){var c=[],d=this.getEventStats(b),e=_.keyBy(d,"name");return a.control.stats.forEach(function(a){e[a]&&c.push(e[a])}),c}},getAppDefStatsByGroup:function(b,d){if(b&&d){var e=[],f=this.getEventStatsByGroup(b,d);return f.forEach(function(b){b.name!=a.SYSTEM_STATS_VISIT&&b.name!=a.SYSTEM_STATS_CRASH&&b.name!=a.SYSTEM_STATS_DURATION||e.push(b)}),e=c.sysStatsChangeNameToChineses(e)}},getTrafficByGroup:function(a){var b=this.getValideExpsByGroup(a);return _.sum(_.map(b,"traffic"))},getValideTrafficByGroups:function(a){var b=this,c=b.getValideGroups(a),d=100;return _.forEach(c,function(a){d-=b.getTrafficByGroup(a)}),d},getVaildeFlags:function(b){return _.uniqWith(_.filter(b,function(b){return b.status!=a.EXP_FLAGS_DELETE}),_.isEqual)},getCodeFlags:function(a){return _.uniqWith(_.filter(a,function(a){return!_.startsWith(a.name,"_")&&!_.endsWith(a.name,"_")}),_.isEqual)},getVaildeStats:function(b){return _.uniqWith(_.filter(b,function(b){return b.status!=a.STAT_STATUS_DELETE&&!_.startsWith(b.name,"Event-")}),_.isEqual)},getValideFlagByGroup:function(a,b){if(!a)return[];if(!b||!b.control)return[];var c=_.keys(b.control.flags),d=_.keyBy(a,"name"),e=[];return _.forEach(c,function(a){d[a]&&e.push(d[a])}),_.uniqWith(e,_.isEqual)},startNewGroup:function(b){var c=parseInt((new Date).getTime()/1e3);return delete b.id,delete b.control.id,delete b.control.group_id,b.status=a.EXP_STATUS_RUN,b.control.start_date=c,_.forEach(b.experiments,function(a){delete a.id,delete a.group_id,a.start_date=c}),b},getControl:function(a){return _.find(a,{isControl:!0})},bindWindowClosed:function(a,c){var d=window.setInterval(function(){if(a&&a.closed)return window.clearInterval(d),b.editorClose(),c()},500)},autoComplateURL:function(a){var b=a.split("//");return b[1]&&b[1].indexOf("/")===-1&&b[1].indexOf("?")===-1?a+"/":a},getGroupRunDay:function(a){var b=Math.ceil((new Date).getTime()/1e3),c=_.get(a,"control.start_date"),d=c<b?moment.range(c,b).diff("days"):0;return d},replaceOrInsertDataById:function(a,b,c){if(a&&b){var d=angular.copy(a),e=angular.copy(b);if(!angular.isArray(d)&&angular.isObject(d)&&!angular.isArray(e)&&e&&d){if(d.id==e.id)return e;if(angular.isArray(d[c])){var f=_.keyBy(d[c],"id"),g=[];return d[c].forEach(function(a){a.id==e.id?g.push(e):g.push(a)}),f.hasOwnProperty(e.id)&&g.push(e),d[c]=g,d}}if(angular.isArray(d)&&!angular.isArray(e)&&angular.isObject(e)&&d&&e){var g=[],f=_.keyBy(d,"id");return g=f.hasOwnProperty(e.id)?_.pullAllBy(d,[e],"id"):d,g.push(e),g}}}}}]),angular.module("abtesting").controller("IosMobileEditorCtrl",["$scope","$sce","androidSocket","$state","alert","App","abToast","$timeout","curGroup","$stateParams","$qupload","$rootScope","DataHelper","ExpHelper","ExpLogic","ExpApi","DataApi","H5Api","allStatsData","$q","Constant","AbDispacher","curApp",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(b){return clearTimeout(Q),a.app&&a.app.app_key?b(a.app.app_key):void(Q=setTimeout(function(){return x(b)},100))}function y(a){return 1==a.a?"#"+a.r.toString(16)+a.g.toString(16)+a.b.toString(16):"rgba("+Math.floor(a.r)+","+Math.floor(a.g)+","+Math.floor(a.b)+","+new Number(a.a).toFixed(2)+")"}function z(a,b){a.class_name=a.type,a.position=b,a.invicount=0,a.x=a.left,a.y=a.top,a.ios=!0;var c={},d={};for(var e in a.properties){var f=a.properties[e];"size"===f.type&&(c.width=new Number(f.value.width).toFixed(2),c.height=new Number(f.value.height).toFixed(2)),"backgroundColor"==f.type&&f&&(c.bg_color=y(f.value)),"textColor"==f.type&&(c.textColor=y(f.value)),"center"==f.type?(c.centerX=Math.round(10*f.value.x)/10,c.centerY=Math.round(10*f.value.y)/10):"contentEdgeInsets"==e?(c.paddingTop=f.top,c.paddingBottom=f.bottom,c.paddingLeft=f.left,c.paddingRight=f.right):"font"==e?c.textSize=f.size:c[e]=f,d[e]=f}a.hasOwnProperty("org_properties")||(a.org_properties=angular.copy(d)),a.properties=c,a.noEdge=!d.contentEdgeInsets;for(var g=a.children,h=0;h<g.length;h++)z(g[h],h)}function A(b){a.hideOverlay(),b=N.orderByAppJsonChangeNumber(b),N.changeNumber=b.changeNumber?b.changeNumber:0,b.hasOwnProperty("isNewPage")&&b.isNewPage&&(a.curView=null,N.resetForm()),v.renderPhoneView(a.curView),a.treelock=!1,b=angular.fromJson(b),b.viewTree||b.windows&&(b.viewTree=b.windows[0]),z(b.viewTree,0),a.curConnectMobile&&a.curConnectMobile.id==b.socketid&&(a.ios&&(a.phoneImage="data:image/jpeg;base64, "+b.screenShot.screenShot),a.curVersion.shot=a.phoneImage,N.curControl.annotation||X(a.phoneImage,N.curControl.id,function(a){var b="http://7xldge.com2.z0.glb.qiniucdn.com/"+a.key;h(function(){p.updateExpById(N.curControl.id,{annotation:{snapshot:b}}).then(function(a){N.curControl=a.data})})}),a.dpi=b.dpi,a.touchMapJson=b,O.emit("picture_ok",{socketid:a.curConnectMobile.id}),a.setParent(a.touchMapJson),window.touchInfo={w:b.screenWidth,h:b.screenHeight},a.tree=b,a.treedata=[b.viewTree],a.screenWidth=b.screenWidth,a.screenHeight=b.screenHeight,a.hideLanding(),a.hideOverlay())}function B(a){for(var b=a.changes,c=0;b&&c<b.length;c++){for(var d=b[c],e=d.properties,f=[],g=0;e&&g<e.length;g++){var h=e[g];h.s=0,"size"==h.property&&(h.s=.2),"center"==h.property&&(h.s=.3),f.push(h)}f=f.sort(function(a,b){return a.s-b.s}),d.properties=f}return a}function C(b,c,d){var e=b,f=S[e],b=(f.aliases,f.key?f.key:f.aliases);!a.ios&&a.dpi&&f.dp&&(c=parseInt(c/a.dpi+.5)),a.propsOld[b]=a.propsOld[b]?a.propsOld[b]:c,"width"!==b&&"height"!==b||(N.initProps[a.curNode.elemId]=N.initProps[a.curNode.elemId]?N.initProps[a.curNode.elemId]:{},N.initProps[a.curNode.elemId][b]=N.initProps[a.curNode.elemId][b]?N.initProps[a.curNode.elemId][b]:c),"text"==b?d(b,c,f.type):G(function(){d(b,c,f.type)})}function D(a,b,c){N.getChangePropIndex();var d={property:a,value:b};return c&&(d.type=c),d}function E(){return{experiment_version:20,experiment_id:200230,socketid:a.curConnectMobile?a.curConnectMobile.id:null,description:"version#1",changes:[],changeNumber:N.changeNumber?N.changeNumber:0,stats:[]}}function F(b,c,d){if(a.curVersion.exp.id==a.group.control.id)return e.alert({content:"原始版本不可编辑",type:"fail"});a.showLanding(),h(function(){a.$apply()});var f=E(),g=D(b,c,d);if(!N.inputFormat(g))return a.loadingStatus=!1;if("text"!=g.property&&"NaN"===_.toString(g.value))return a.loadingStatus=!1;if(a.ios&&a.curView){a.curNode.persistentSelector=a.curView.persistentSelector;var i=_.keyBy(a.curView.org_properties,"name");if("width"!=b&&"height"!=b||(g=N.handleIosPropsResult(g,i,"size"),b="size"),"tintColor"==b|"backgroundColor"==b||"titleColor"==b||"text_color"==b||"bg_color"==b)if("titleColor"!=b)g.value=N.rgbaToObject(g.value),"text_color"==b&&(b="textColor",g.property="textColor"),"bg_color"==b&&(b="backgroundColor",g.property="backgroundColor");else{var j=g.value;g.value={normal:N.rgbaToObject(j)}}"text_size"==b&&(g=N.handleIosPropsResult(g,i,"font"),b="font"),"centerY"!=b&&"centerX"!=b||(g=N.handleIosPropsResult(g,i,"center"),b="center"),"bg_bitmap"!=b&&"src_bitmap"!=b||("bg_bitmap"==b&&(b="backgroundImage"),"src_bitmap"==b&&(b="image"),g=N.handleIosPropsResult(g,i,b)),"paddingTop"!=b&&"paddingLeft"!=b&&"paddingRight"!=b&&"paddingBottom"!=b||(g=N.handleIosPropsResult(g,i,"contentEdgeInsets"),b="contentEdgeInsets"),"title"==b&&(g=N.handleIosPropsResult(g,i,"title")),g.type=i[b].type}a.curNode.properties=[],a.curNode.properties.push(g),f.changes.push(a.curNode),a.changes||(a.changes=[]);var k=a.hashCode(angular.toJson(a.curNode.position,!1)),l=!1;if(a.changes.forEach(function(b){var c=angular.toJson(b.persistentSelector),d=angular.toJson(a.curNode.persistentSelector);c==d&&b.properties[0].property==a.curNode.properties[0].property&&(b.properties[0].value=a.curNode.properties[0].value,b.properties[0].type=a.curNode.properties[0].type,l=!0)}),!l){var m={position:a.curNode.position,properties:a.curNode.properties,id:k};a.ios&&(m.persistentSelector=a.curNode.persistentSelector),a.changes.push(m)}f.changes=N.mergeSamePositionPros(),f=N.emitIosDataAddChangeNumber(f);var n=B(f),o=angular.toJson(n);O.emit("props",o),a.versions.forEach(function(b){if(b.displayName==a.curVersion.displayName){var c=b.data.stats;b.data={},b.data=f,b.data.stats=c}}),angular.extend(a.propsOld,a.props),a.curView.properties=a.props}function G(a){U&&window.clearTimeout(U),U=window.setTimeout(a,1e3)}function H(){for(var a in T){var b=T[a];b()}}function I(){for(var a in S);}function J(a){var b="";return a.forEach(function(a){var c=a.index;c>=0&&(b+="-"+c)}),b}function K(b,c){a.eventsObj[c]=b,P[b]?P[b].ids.push(c):P[b]={id:b,ids:[c]}}function L(b,c){if(b&&b!=c){if(b.creatFig)return void a.versions.forEach(function(a){a.creatFig=!1});if(a.endEditing(),c.data=a.getVersionData(),a.changes=[],b.data){a.changes=b.data.changes;var d=angular.copy(a.curVersion.data);d.changes=N.mergeSamePositionPros(),d=N.emitIosDataAddChangeNumber(d),O.emit("change-version",{data:d}),a.changes=N.disperseChangeProperties(a.curVersion.data.changes)}}}function M(){try{return window.self!==window.top}catch(a){return!0}}var N=this;N.curGroup=i.data,N.allStats=s.data.stats,N.curStats=m.getVaildeStats(N.allStats),N.curApp=w.data;var O=c.getInstense();N.fromState=f.getFromState(),a.gofromState="app.createInfo.lists.expInfo",N.fromState&&N.fromState.name&&(a.gofromState=N.fromState.name),a.curStats=N.curStats,a.curNoFormulaStats=n.getNoEventStats(m.getNonFormulaStats(a.curStats)),N.curControl=N.curGroup.control,a.group=N.curGroup,a.app=N.curApp,a.ios=!0,a.formTest={},N.copyVersions=[],a.saving=0,a.versions=[],a.curVersion={},a.storeStat={},a.props={},a.propsOld={},N.initProps={},a.curView,a.changes=[],a.curNode={},a.treelock=!0,a.clickCount=0,a.statMap={},a.stats=[],N.storeOldValue={},a.groupName=j.groupname;var P={};a.connectStatus=!0;JSON.stringify({cd:23});a.ios&&a.appjson&&(a.curConnectMobile={}),a.mobileDisconnect=!1,a.waitingConnect=!0,a.loadingStatus=!1,a.connectInfo="请打开安装sdk的应用,连接编辑器",a.layoutOpen=!0,a.styleOpen=!0,a.contentOpen=!0,a.statOpen=!0,a.hideOverlay=function(){a.connectStatus=!1},a.showLanding=function(){a.loadingStatus=!0,h(function(){a.loadingStatus&&g.danger({icon:!0,msg:"操作未成功,请检查手机网络连接状况并重试",top:0,time:3e4})},1e4)},a.hideLanding=function(){a.loadingStatus=!1,g.removeAll()},a.$watch("curConnectMobile",function(b,c){b&&(O.emit("refresh"),g.success({msg:"检测到页面变化，即将刷新",icon:!0,time:3e3,top:0}),h(function(){a.waitingConnect=!0},3e3))}),a.viewTreeStatus=!1,a.toggleViewTree=function(){a.viewTreeStatus=!a.viewTreeStatus},N.storeVersionsChange={},a.mobileClients=[],O.connect(),h(function(){a.waitingConnect=!1},6e4),O.on("refresh-mobile",function(b){var c=b.sockets;if(a.mobileClients=c,a.mobileDisconnect=!1,"disconnect"==b.status&&(a.mobileDisconnect=!0,N.storeAppJsons=[]),0===c.length)return a.connectStatus=!0;if(("mobile_login"==b.status||!a.curConnectMobile)&&c.length>0&&(a.curConnectMobile=a.mobileClients[0],a.curConnectMobile.deviceName=decodeURIComponent(a.curConnectMobile.deviceName)),a.curVersion.data){var d={};d.changes=N.mergeSamePositionPros(a.curVersion.data.changes)?N.mergeSamePositionPros(a.curVersion.data.changes):[],d.changeNumber=N.changeNumber,d=N.emitIosDataAddChangeNumber(d);var e=angular.toJson(d);O.emit("props",e),N.storeVersionsChange[a.curVersion.exp.id]=N.storeVersionsChange[a.curVersion.exp.id]+e}else"web_login"==b.status&&(a.needsProps=!0)}),O.on("web-login-fail",function(){a.isConnect=!0});var Q;O.on("connect",function(){x(function(a){O.emit("web-login",{appkey:a})})}),O.on("get-mobile",function(b){a.mobileClients=b,!a.curConnectMobile&&b.length>0&&(a.curConnectMobile=a.mobileClients[0],a.hideOverlay())}),a.isKick=!1,O.on("mobile-kick",function(){a.isKick=!0,setTimeout(function(){a.isKick=!1},2e3)}),a.isBgColorOpen=!1,a.setParent=function(b){a.loopSetParent(b.viewTree)},a.loopSetParent=function(b){for(var c=b.children,d=0;d<c.length;d++)c[d].parent=b,a.loopSetParent(c[d])};N.storeAppJsons=[],N.orderByAppJsonChangeNumber=function(a){N.storeAppJsons.push(a);var b=_.orderBy(N.storeAppJsons,"snapshotNumber");return b[N.storeAppJsons.length-1]},O.on("picture_",A),window.touchInfo={w:0,h:0},a.calcView=function(b,c){var d=b.ios?b:b.properties,e=null,f=d.width*b.height/(a.screenWidth*a.screenHeight);c.x>=d.x&&c.x<=d.x+d.width&&c.y>=d.y&&c.y<=d.y+d.height&&f<.6&&(e=b);for(var g=b.children,h=0;h<g.length;h++){var i=g[h],j=a.calcView(i,c);j&&(e=j)}return e},a.hoverNode={id:0},a.phoneTouchMove=function(b){if(!b)return a.hoverNode={id:0},void a.$apply();if(a.touchMapJson){var c=a.calcView(a.touchMapJson.viewTree,b);c&&a.hoverNode!=c&&(a.hoverNode=c,a.$apply())}},a.phoneTouchSelect=function(){var b=a.hoverNode;a.selectTouchItem(b),a.selectedChange=null,h(function(){a.$apply()})},a.selectTouchItem=function(b){console.log(b);var c=a.treeScope.componentsTree.currentNode;c&&c.selected&&(c.selected=void 0),a.treeScope.componentsTree.currentNode=b,b.selected="selected",a.highlightElements([]),H();var d=Array(),e=b;for(a.curView=b;e.parent;){var f={view:e.class_name,index:e.position,offset:e.position-e.invicount};e.row&&(f.row=e.row),e.cur_item&&(f.cur_item=e.cur_item),d.push(f),e=e.parent}var g={view:e.class_name,index:e.position,offset:e.position-e.invicount
};e.row&&(g.row=e.row),e.cur_item&&(g.cur_item=e.cur_item),d.push(g),d.push({activity:a.tree.activity}),d=d.reverse(),a.curNode.position=d,a.curNode.elemId=J(d),a.curDomStat=a.eventsObj[a.curNode.elemId],a.dataConvert(a.curView),I()};var R=new Array;a.visibilitys=[{label:"可见",val:0},{label:"不可见",val:4},{label:"隐藏",val:8}],a.textAlignments=[{label:"居左",val:0},{label:"居中",val:1},{label:"居右",val:2},{label:"段尾对齐",val:3},{label:"正常",val:4}],a.selectTreeItem=function(b){R=[],H();var c=a;if(b){a.curView=b.node,R.push({view:b.node.class_name,index:b.node.position,offset:b.node.position-b.node.invicount}),b=b.$parent;for(var d=new Array;b.$id!==c.$id;){var e=b.node;if(e){var f={view:e.class_name,index:e.position,offset:e.position-e.invicount};e.row&&(f.row=e.row),e.cur_item&&(f.cur_item=e.cur_item),d.push(f)}b=b.$parent}R=R.concat(d),R.push({activity:a.tree.activity}),R=R.reverse(),a.curNode.position=R,a.curNode.elemId=J(R),a.curDomStat=a.eventsObj[a.curNode.elemId],a.dataConvert(a.curView),I()}else a.curView=null},a.treeHandler=function(b){var c=angular.element(b.target).scope();return c.node.width<1||c.node.height<1||c.node.class_name.startsWith("_")||c.node.left>360?(g.warning({msg:"当前选中元素不可编辑",icon:!0,time:1e3,top:0}),void(a.curView=null)):(a.selectTreeItem(c),void(a.selectedChange=null))},a.$watch("curView",function(a,b){b&&!a&&N.resetForm()}),a.touchHanlder=function(){a.treeHandler(l.curTouchEvent),a.selectedChange=null},a.highlightChange=function(b){if(a.selectedChange=b,b.position[0].activity==a.tree.activity){for(var c=a.treedata[b.position[1].offset],d=2;d<b.position.length&&c;d++){var e=b.position[d].offset;c=c.children[e]}c&&a.selectTouchItem(c)}},N.checkCurViewToCreateRightCurView=function(a){var b=_.keyBy(a.properties,"name"),c={},d={};b.hasOwnProperty("backgroundImage");for(var e in a.properties)d.hasOwnProperty(a.properties[e].name)?c[e]=d[a.properties[e].name]:c[e]=a.properties[e];return a.org_properties=c,a},a.dataConvert=function(b){if(b){a.curView=N.checkCurViewToCreateRightCurView(b);var c=angular.copy(b.properties)||{};a.props=N.convertIosDataToObject(c),c.hasOwnProperty("text")&&(a.props.text=c.text.value),c.value&&(a.props.width=Math.round(c.size.width),a.props.height=Math.round(c.size.height)),a.props.bg_bitmap="def",a.ios?c.hasOwnProperty("image")&&(a.props.src_bitmap="def"):c.hasOwnProperty("src_bitmap")&&(a.props.src_bitmap="def"),angular.extend(a.propsOld,a.props)}},a.textBtnStatus=!0,a.ChangeText=function(){a.textBtnStatus=!1},N.resetForm=function(){H();for(var b in S)a.props[S[b].key]="";$(".colorpicker").removeClass("colorpicker-visible")},N.disperseChangeProperties=function(a){if(a){var b=[];return a.forEach(function(a){a.properties.forEach(function(c){var d={persistentSelector:a.persistentSelector,position:a.position,properties:[c]};b.push(d)})}),b=_.uniqWith(b,_.isEqual)}},N.mergeSamePositionPros=function(b,c){var d;b||(d=angular.copy(a.changes)),b&&(d=b),d||(d=[]);var e=[],f=[],g=_.values(a.allSelectedStats),h=[];g.forEach(function(a){h.push(a.views)}),f=_.flatten(h),d.forEach(function(a){var b=_.groupBy(a.properties,"property");b.hasOwnProperty("stat_key")||e.push(a)}),e.forEach(function(a){a.positionString=angular.toJson(a.persistentSelector),a.positionStoreString=angular.toJson(a.position)});var i={},j=[];_.groupBy(e,function(a){i[a.positionString]=i[a.positionString]?i[a.positionString]:[],i[a.positionString].push(a.properties[0]),i[a.positionString].unshift({selector:angular.toJson(a.persistentSelector),positionSelect:angular.toJson(a.positionStoreString)})}),f&&(f.forEach(function(a){a.positionString=angular.toJson(a.persistentSelector),a.positionStoreString=angular.toJson(a.position)}),_.groupBy(f,function(a){var b=a.positionString;i[b]=i[b]?i[b]:[],i[b].push({property:"stat_key",type:"event",value:a.stat_key}),i[b].unshift({selector:angular.toJson(a.persistentSelector),positionSelect:angular.toJson(a.positionStoreString)})}));var k=_.keys(i);if(0!=k.length){for(var l in i){var m={},n=_.uniqWith(i[l],_.isEqual);"object"==typeof angular.fromJson(i[l][0].selector)&&(m.persistentSelector=angular.fromJson(i[l][0].selector),m.position=angular.fromJson(angular.fromJson(i[l][0].positionSelect)),n.splice(0,1),m.properties=n,j.push(m))}return j}},N.emitIosDataAddChangeNumber=function(a){return a.hasOwnProperty("changeNumber")?(a.changeNumber=_.toNumber(N.changeNumber)+1,a):(a.changeNumber=0,a)},N.addStatUpdateVersions=function(b){var c=angular.copy(a.curNode);c.stat_key=b,a.curVersion.data.stats=a.curVersion.data.stats?a.curVersion.data.stats:[],a.curVersion.data.stats.push(c),a.versions.forEach(function(b){b.exp.id!=a.curVersion.exp.id&&(b.data.stats=[],b.data.stats=a.curVersion.data.stats)})},N.cleanStatUpdateVersions=function(b){var c=[];b.id?a.curVersion.data.stats.forEach(function(b){b.elemId!=a.curNode.elemId&&c.push(b)}):a.curVersion.data.stats.forEach(function(a){a.stat_key!=b.name&&c.push(a)}),a.curVersion.data.stats=[],a.curVersion.data.stats=c,a.versions.forEach(function(b){b.exp.id!=a.curVersion.exp.id&&(b.data.stats=[],b.data.stats=a.curVersion.data.stats)})},N.inputFormat=function(a){if("text"!=a.property&&(_.isUndefined(a.value)||_.isNull(a.value)||_.isNaN(a.value)))return!1;if("titleColor"==a.property||"tintColor"==a.property||"text_color"==a.property||"backgroundColor"==a.property||"textColor"==a.property||"bg_color"==a.property){if(""==a.value)return!1;var b=N.rgbaToObject(a.value);return!(b.r<0||b.r>255||!b.r)&&(!(b.g<0||b.g>255||!b.g)&&(!(b.b<0||b.b>255||!b.b)&&!(b.a<0||b.a>1||!b.a)))}return!("text_size"==a.property&&_.isUndefined(a.value)||"text_size"==a.property&&_.isNull(a.value)||"text_size"==a.property&&_.isNaN(a.value))},N.rgbaToObject=function(a){for(var b=a,c=b.length-1,d=b.indexOf("(")+1,e=b.slice(d,c),f=_.split(e,",",4),a={},g=0;g<f.length;g++)0==g&&(a.r=f[g]),1==g&&(a.g=f[g]),2==g&&(a.b=f[g]),3==g&&(a.a=f[g]);return a},N.rgbaToString=function(a){if(a)return"rgba("+Math.floor(a.r)+","+Math.floor(a.g)+","+Math.floor(a.b)+","+Number(Number(a.a).toFixed(2))+")"},N.directionDataToString=function(a){return a?a.hasOwnProperty("r")&&a.hasOwnProperty("g")&&a.hasOwnProperty("b")?N.rgbaToString(a):a.hasOwnProperty("uri")?a.uri:a:""},N.convertIosDataToObject=function(a){var b=_.keyBy(a,"name"),c={};for(var d in S){var e=S[d].aliases;if(b[e]&&b.hasOwnProperty(e)){if("object"!=typeof b[e].value&&(c[e]=b[e].value),b[e].hasOwnProperty("value")&&"object"==typeof b[e].value&&"object"!=typeof b[e].value[f]&&S[d].hasOwnProperty("direction")){var f=S[d].direction;c[S[d].key]=b[e].value[f]}if(b[e].hasOwnProperty("value")&&"object"==typeof b[e].value&&"object"==typeof b[e].value[f]&&S[d].hasOwnProperty("direction")){var f=S[d].direction;c[S[d].key]=N.directionDataToString(b[e].value[f])}}if("height"==e&&b.hasOwnProperty("size")||"width"==e&&b.hasOwnProperty("size")){var g=b.size.value[e],h=Number(g).toString().indexOf(".");h>-1&&(g=Number(Number(g).toFixed(2))),c[e]=g}if("font"==e&&b.hasOwnProperty("font")&&(c.text_size=b.font.value.size),("tintColor"==e&&b.hasOwnProperty(e)||"backgroundColor"==e&&b.hasOwnProperty(e)||"textColor"==e&&b.hasOwnProperty(e))&&(c[S[d].key]=N.rgbaToString(b[e].value)),"centerX"==e&&b.hasOwnProperty("center")||"centerY"==e&&b.hasOwnProperty("center")){var g=b.center.value[S[d].storeKey],h=Number(g).toString().indexOf(".");h>-1&&(g=Number(Number(g).toFixed(2))),c[S[d].key]=g}if("padding"==e&&b.hasOwnProperty("contentEdgeInsets")){var f=S[d].direction;c[S[d].key]=b.contentEdgeInsets.value[f]}}return c},N.handleIosPropsResult=function(a,b,c){var d={};if(d.property=c,d.value=b[c].hasOwnProperty("value")?b[c].value:b[c].originalValue,"src_bitmap"==a.property){var e="image";return d.value=b[e].value,d.value.hasOwnProperty("normal")?d.value.normal.uri=a.value:d.value.uri=a.value,d}if("bg_bitmap"==a.property){var e="backgroundImage";return d.value=b[e].value,d.value.normal.uri=a.value,d}return S["props."+a.property].hasOwnProperty("direction")?d.value[S["props."+a.property].direction]=a.value:d.value[S["props."+a.property]]=a.value,d};var S={"props.width":{key:"width",aliases:"width",direction:"width"},"props.height":{key:"height",aliases:"height",direction:"height"},"props.alpha":{key:"alpha",aliases:"alpha"},"props.text":{key:"text",aliases:"text"},"props.src_bitmap":{key:"src_bitmap",aliases:"image",type:"image",direction:"uri"},"props.bg_bitmap":{key:"bg_bitmap",aliases:"image",type:"image"},"props.title":{key:"title",aliases:"title",direction:"normal"},"props.titleColor":{key:"titleColor",aliases:"titleColor",direction:"normal"},"props.tintColor":{key:"tintColor",aliases:"tintColor"}};S["props.centerX"]={key:"centerX",aliases:"centerX",storeKey:"x",direction:"x"},S["props.centerY"]={key:"centerY",aliases:"centerY",storeKey:"y",direction:"y"},S["props.textAlignment"]={key:"textAlignment",aliases:"textAlignment"},S["props.text_size"]={key:"text_size",aliases:"font",direction:"size"},S["props.text_color"]={key:"text_color",aliases:"textColor",type:"color"},S["props.bg_color"]={key:"bg_color",aliases:"backgroundColor",type:"color"},S["props.paddingTop"]={key:"paddingTop",aliases:"padding",direction:"top"},S["props.paddingBottom"]={key:"paddingBottom",aliases:"padding",direction:"bottom"},S["props.paddingLeft"]={key:"paddingLeft",aliases:"padding",direction:"left"},S["props.paddingRight"]={key:"paddingRight",aliases:"padding",direction:"right"};var T=[];N.getChangePropIndex=function(){a.changes&&(N.indexChangesProperty=_.keyBy(a.changes,function(a){return a.properties[0].property}))},a.hashCode=function(a){var b,c,d,e=0;if(0==a.length)return e;for(b=0,d=a.length;b<d;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return e};var U;a.status={isFirstOpen:!0,isFirstDisabled:!1},a.refresh=function(){O.emit("refresh")},a.undoChanges=function(b){e.confirm({content:"确定撤销该修改？",type:"query"},function(){var c=a.changes.indexOf(b);a.changes.splice(c,1);var d=E();d.changes=N.mergeSamePositionPros()?N.mergeSamePositionPros():[],d=N.emitIosDataAddChangeNumber(d),O.emit("del_change",{data:angular.toJson(d)})})},a.setFormScope=function(b){a.formScope=b,a.trackStatBy="add"},a.setTreeScope=function(b){a.treeScope=b},a.showTrackingElement=function(){a.editingStatPanel=!0},a.changeTrackStatType=function(b){a.trackStatBy=b},a.trackStat=function(b){a.stats.push({name:b.name}),"array"==typeof N.curControl.stats&&N.curControl.stats||(N.curControl.stats=[]),a.curNode.persistentSelector=a.curView.persistentSelector,a.curNode.stat_key=b.name,N.curControl.stats=N.curControl.stats.push(b.name),a.allSelectedStats[b.name]=a.allSelectedStats[b.name]?a.allSelectedStats[b.name]:{},a.allSelectedStats[b.name].name=b.name,a.allSelectedStats[b.name].views=a.allSelectedStats[b.name].views?a.allSelectedStats[b.name].views:[],a.allSelectedStats[b.name].views.push(angular.copy(a.curNode)),a.storeStat[a.curNode.elemId]=a.storeStat[a.curNode.elemId]?a.storeStat[a.curNode.elemId]:{},a.storeStat[a.curNode.elemId].stat_key=b.name,a.storeStat[a.curNode.elemId][b.name]={},a.storeStat[a.curNode.elemId][b.name].id=b.name,a.storeStat[a.curNode.elemId][b.name].views=[],a.curNode.stat_key=b.name,a.storeStat[a.curNode.elemId][b.name].views.push(angular.copy(a.curNode)),N.addStatUpdateVersions(b.name),N.saveStats(),a.editingStatPanel=!1},a.addDomIdToStats=function(b){if(a.curNode){K(b,a.curNode.elemId),a.addStat(b);var c=!0;if(a.control.stats.forEach(function(a){a==b&&(c=!1)}),c){a.control.stats.push(b),p.updateExpById(a.control.id,{stats:a.control.stats});var d={elemId:a.curNode.elemId,statName:b};a.events.push(d)}}},a.addStat=function(b,c){if(b){if(_.keyBy(a.curStats,"name")[b]&&""===_.keyBy(a.curStats,"name")[b].formula)return e.alert({content:"指标名称已存在",type:"fail"});if(_.keyBy(a.curStats,"name")[b]&&""!=_.keyBy(a.curStats,"name")[b].formula)return e.alert({content:"已存在同名复合指标",type:"fail"});a.curNode.persistentSelector=a.curView.persistentSelector,a.curNode.stat_key=b,a.allSelectedStats[b]=a.allSelectedStats[b]?a.allSelectedStats[b]:{},a.allSelectedStats[b].name=b,a.allSelectedStats[b].views=a.allSelectedStats[b].views?a.allSelectedStats[b].views:[],a.allSelectedStats[b].views.push(angular.copy(a.curNode)),a.storeStat[a.curNode.elemId]=a.storeStat[a.curNode.elemId]?a.storeStat[a.curNode.elemId]:{},a.storeStat[a.curNode.elemId].stat_key=b,a.storeStat[a.curNode.elemId][b]={},a.storeStat[a.curNode.elemId][b].id=b,a.storeStat[a.curNode.elemId][b].views=[],a.storeStat[a.curNode.elemId][b].views.push(angular.copy(a.curNode)),a.storeStat[a.curNode.elemId][b].views[0].stat_key=b,q.updateStats(f.getAppID(),{app_id:f.getAppID(),name:b,description:c?c:"",formula:"",status:0}).then(function(c){"array"==typeof N.curControl.stats&&N.curControl.stats||(N.curControl.stats=[]),N.curControl.stats.push(b),a.curStats.push(c.data),a.curNoFormulaStats.unshift(c.data),a.formTest.newStatName="",a.formTest.newStatDescription="",N.addStatUpdateVersions(b),N.saveStats()})}},a.highlightElements=function(b){var c=[];b.forEach(function(b){if(b.position[0].activity==a.tree.activity){for(var d=b.position,e=a.treedata[d[1].offset],f=2;f<d.length&&e;f++){var g=d[f].offset;e=e.children[g]}e&&c.push(e)}}),a.highlightedViews=c},a.showChangeElems=function(b){var c=[];c.push(b),a.highlightElements(c)},a.showStatElems=function(b){for(var c in a.allSelectedStats){var d=a.allSelectedStats[c];d!=b&&(d.selected=!1)}b.selected=!b.selected,b.selected?a.highlightElements(b.views):a.highlightElements([])},a.cleanStat=function(b,c){var d=c.id?c.id:c.name,f=_.groupBy(a.storeStat,"stat_key");e.confirm({content:"确定取消跟踪优化指标 "+d+"？相关联的所有组件的点击事件将不再跟踪。",type:"query"},function(){if(N.cleanStatUpdateVersions(c),c.id)if(delete a.storeStat[a.curNode.elemId],1==f[d].length)delete a.allSelectedStats[d];else{var b=[];a.allSelectedStats[d].views.forEach(function(c){c.elemId!=a.curNode.elemId&&b.push(c)}),a.allSelectedStats[d].views=b}c.name&&(delete a.allSelectedStats[d],f[d].forEach(function(b){delete a.storeStat[b[d].views[0].elemId]}));var e=[];a.events.forEach(function(a){a.statName!=d&&e.push(a)}),a.events=e,a.curDomStat==d&&(a.curDomStat=null),a.highlightElements([]),N.saveStats()})},a.cleanElemStat=function(){if(a.curNode){var b=null,c=[];if(a.events.forEach(function(d){d.elemId!=a.curNode.elemId?c.push(d):b=d}),a.events=c,a.curDomStat=null,delete a.eventsObj[a.curNode.elemId],b){var d=a.statMap[b.statName];if(d)if(d.views.length<=1)delete a.statMap[b.statName],a.control.stats.splice(a.control.stats.indexOf(b.statName),1),p.updateExpById(a.control.id,{stats:a.control.stats});else{var e=[];d.views.forEach(function(a){a.elemId!=b.elemId&&e.push(a)}),d.views=e}}}},a.endEditing=function(){a.hoverNode={id:0},a.selectTreeItem(null),a.selectedChange=null,a.highlightElements([]);var b=a.treeScope.componentsTree.currentNode;b&&b.selected&&(b.selected=void 0);for(var c in a.statMap){var d=a.statMap[c];d.selected=!1}},a.isIosHasTheProperty=function(b){if(a.curView){var c=_.keyBy(a.curView.org_properties,"name");return c.hasOwnProperty(b)}},N.handleControlChanges=function(a){var b=[];return a.forEach(function(a){var c=angular.copy(a);c.properties=[];var d=_.keyBy(a.properties,"property");d.hasOwnProperty("stat_key")&&c.properties.push(d.stat_key),b.push(c)}),b},a.showVersion=function(b){a.curVersion=b},a.saveVersions=function(){O.emit("web-logout");var b={experiments_updater:{}};a.curVersion.data.changes=a.changes,a.versions.forEach(function(c){c.data.stats=a.getStatsList();var d=_.uniq(_.concat(_.map(c.data.stats,"stat_key"),N.storeCodeStats));if(c.exp.id==N.curControl.id){var e={};e.changes=N.mergeSamePositionPros([]),e.changeNumber=c.data.changeNumber,e.stats=c.data.stats,e.experiment_id=c.data.experiment_id,e.socketid=c.data.socketid,e.experiment_version=c.data.experiment_version;var f=angular.toJson(e);b.experiments_updater[c.exp.id]={flags:{__autoexperiment__:f},stats:d}}else{if(c.data.changes){var e={};e.changes=N.mergeSamePositionPros(c.data.changes),e.changeNumber=c.data.changeNumber,e.stats=c.data.stats,e.experiment_id=c.data.experiment_id,e.socketid=c.data.socketid,e.experiment_version=c.data.experiment_version;var g=B(e),h=angular.toJson(g)}else{var e={};e.changes=N.mergeSamePositionPros([]),e.changeNumber=c.data.changeNumber,e.stats=c.data.stats,e.experiment_id=c.data.experiment_id,e.socketid=c.data.socketid,e.experiment_version=c.data.experiment_version;var h=angular.toJson(e)}N.storeVersionsChange[c.exp.id]="",b.experiments_updater[c.exp.id]={flags:{__autoexperiment__:h},stats:d}}}),N.copyVersions=[],N.copyVersions=angular.copy(a.versions),p.updateGroupWithExp(N.curGroup.id,b).then(function(a){N.curGroup=a.data,g.success({msg:"所有版本保存成功",icon:!0,time:3e3,top:0})})},N.saveStats=function(){var b=n.getValideExpsByGroup(N.curGroup),c=E(),d={experiments_updater:{}};b.forEach(function(b){var c=b,e=c.flags.__autoexperiment__,f=angular.fromJson(e);_.isNumber(f)&&(f={});var g=_.uniq(_.concat(_.map(a.curVersion.data.stats,"stat_key"),N.storeCodeStats));f.changes=f.hasOwnProperty("changes")?f.changes:[];var h=angular.fromJson(e);h.stats=a.getStatsList(),h.changeNumber=_.isNaN(N.changeNumber)?0:N.changeNumber,h.changes=N.mergeSamePositionPros(f.changes);var i=N.emitIosDataAddChangeNumber(h),j=angular.toJson(i);c.id==N.curControl.id?(N.curControl.stats=g,d.experiments_updater[c.id]={flags:{__autoexperiment__:j},stats:g}):d.experiments_updater[c.id]={flags:{__autoexperiment__:j},stats:g}}),p.updateGroupWithExp(N.curGroup.id,d).then(function(b){var d={};d.stats=a.getStatsList(),d.changeNumber=_.isNaN(N.changeNumber)?0:N.changeNumber,d.experiment_id=a.curVersion.exp.id,d.socketid=c.socketid,d.experiment_version=a.curVersion.exp.description,d.changes=N.mergeSamePositionPros(a.changes);var e=angular.toJson(N.emitIosDataAddChangeNumber(d));O.emit("props",e)})},a.getVersionData=function(){var b=E();return b.changes=a.changes,b},a.getStatsList=function(){var b=[],c=_.map(_.values(a.allSelectedStats),"name"),d=_.values(a.storeStat);if(0!=d.length)for(var e in d)for(var f in d[e])c.indexOf(f)<0||b.push(d[e][f].views[0]);return b},a.startPage=function(){if(a.group=N.curGroup,a.groupEditCode=a.group.id,a.group.control.isControl=!0,a.experiments=[a.group.control],a.experiments=_.concat(a.experiments,a.group.experiments),a.stats=n.getStat(N.allStats),a.group){a.experiments.forEach(function(b){var c=b.flags.__autoexperiment__;N.storeVersionsChange[b.id]=c;var d=E();if(c&&"string"==typeof c&&"{}"!=c){var e=angular.fromJson(c);d.changes=N.disperseChangeProperties(e.changes),d.stats=e.stats,N.changeNumber=e.changeNumber,d.changeNumber=e.changeNumber}N.copyVersions.push({exp:b,data:d});var f={displayName:b.isControl?"原始版本":b.name,exp:b,data:d,created_at:b.created_at};b.name.startsWith("CONTROL-")&&(f.displayName="基准缺省版本",f.bControl=!0,a.control=b),a.versions.push(f),a.versions=_.orderBy(a.versions,"created_at"),a.indexOfVersions=_.keyBy(a.versions,"displayName")}),a.eventsObj={},a.events=[];var b=a.versions.length>1?a.versions[1]:a.versions[0];if(N.storeCodeStats=[],a.allSelectedStats={},b){if(b.data.stats){b.data.stats.forEach(function(b){a.allSelectedStats[b.stat_key]=a.allSelectedStats[b.stat_key]?a.allSelectedStats[b.stat_key]:{},a.allSelectedStats[b.stat_key].name=b.stat_key,a.allSelectedStats[b.stat_key].views=a.allSelectedStats[b.stat_key].views?a.allSelectedStats[b.stat_key].views:[],a.allSelectedStats[b.stat_key].views.push(b),a.storeStat[b.elemId]=a.storeStat[b.elemId]?a.storeStat[b.elemId]:{},a.storeStat[b.elemId].stat_key=b.stat_key,a.storeStat[b.elemId][b.stat_key]={},a.storeStat[b.elemId][b.stat_key].id=b.stat_key,a.storeStat[b.elemId][b.stat_key].views=a.storeStat[b.elemId][b.stat_key].views?a.storeStat[b.elemId][b.stat_key].views:[],a.storeStat[b.elemId][b.stat_key].views.push(b);var c=J(b.position);a.events.push({elemId:c,statName:b.stat_key}),K(b.stat_key,c)});var c=_.map(b.data.stats,"stat_key");N.storeCodeStats=_.pullAll(b.exp.stats,c)}j.expname&&a.versions.forEach(function(a){a.exp.name==j.expname&&(b=a)}),a.showVersion(b),a.changes=a.curVersion.data.changes,a.$watch("curVersion",L)}}},N.getControlFlagsChanges=function(){var a=[];return a=N.mergeSamePositionPros([])},N.addVersionName=function(b){var c=/([0-9]+(?=_))/g,d=_.keys(a.indexOfVersions),e=angular.toJson(d),f=e.match(c),g=[];_.forEach(f,function(a){g.push(_.toNumber(a))});var h=_.max(g),i=a.group.experiments.length;return b=i>h?_.toNumber(i)+1:_.toNumber(h)+1},N.kkdf=!0,a.addVersion=function(){if(N.kkdf){var b=a.group.experiments.length+1,c=m.getExpDistantDateRange(),d={name:"试验版本_"+b+"_"+a.group.name,description:"版本 "+b,group_id:a.group.id,flags:{},stats:0!=N.curControl.stats.length&&_.isArray(N.curControl.stats)?N.curControl.stats:[],start_date:_.toNumber(moment(c.begin).valueOf()),end_date:_.toNumber(moment(c.end).valueOf()),traffic:0,status:N.curGroup.control.status,typ:N.curControl.typ};N.curControl.hasOwnProperty("layer_id")&&(d.layer_id=N.curControl.layer_id),N.kkdf=!1,p.creatExp(f.getAppID(),d).then(function(b){N.kkdf=!0,N.curControl.status==u.EXP_STATUS_RUN?p.updateExpById(b.data.id,{status:u.EXP_STATUS_RUN}).then(function(b){a.group.experiments.push(b.data);var c={displayName:b.data.name,exp:b.data,data:{changes:N.getControlFlagsChanges()},created_at:b.data.created_at,creatFig:!0};a.showVersion(c),a.versions.push(c),a.versions=_.orderBy(a.versions,"created_at"),a.indexOfVersions=_.keyBy(a.versions,"displayName"),O.emit("add_new_version"),a.changes=c.data.changes}):p.updateExpById(b.data.id,{flags:N.curControl.flags?N.curControl.flags:[]}).then(function(b){a.group.experiments.push(b.data);var c={displayName:b.data.name,exp:b.data,data:{changes:N.getControlFlagsChanges()},created_at:b.data.created_at,creatFig:!0};a.showVersion(c),a.versions.push(c),a.versions=_.orderBy(a.versions,"created_at"),a.indexOfVersions=_.keyBy(a.versions,"displayName"),O.emit("add_new_version"),a.changes=c.data.changes})})}},a.deleteVersion=function(){return a.curVersion.exp.id===N.curControl.id?e.alert({content:"原始版本不可被删除",type:"fail"}):void e.confirm({content:"确定删除测试版本 "+a.curVersion.exp.name+"？",type:"query"},function(){o.delExp(a.curVersion.exp,function(b){g.success({msg:"测试版本 "+a.curVersion.exp.name+" 已经被删除！",icon:!0,time:3e3,top:0});var c=a.versions.indexOf(a.curVersion);a.versions.splice(c,1),a.indexOfVersions=_.keyBy(a.versions,"displayName"),a.showVersion(a.versions[a.versions.length-1])})})},a.finishEditing=function(){for(var b in N.storeVersionsChange)""!=N.storeVersionsChange[b];e.confirm({content:"确定退出编辑器？未保存的操作将会丢失。",type:"query"},function(){a.uploadPhoneImage(),O.disconnect(!0),a.backEdit()})};var V={text:"内容",title:"内容",font:"字体大小",titleColor:"字体颜色",textColor:"字体颜色",backgroundColor:"背景颜色",size:"大小",text_gravity:"对齐",textAlignment:"对齐",contentEdgeInsets:"边距",alpha:"透明度",center:"位置",backgroundImage:"背景图片",image:"图片",visibility:"可见性",tintColor:"icon颜色"};a.getLabelFromProperty=function(a){var b=a.properties[0].property,c=V[b];return c||b},a.isHaveIconImage=function(){if(a.curView.properties){var b=_.keyBy(a.curView.org_properties,"name");return""!=b.image.value.normal.uri}},a.getURLFromProperty=function(c){var d=_.keyBy(a.textAlignments,"val"),e=c.properties[0].property;c.properties[0].storeProperty;return"textAlignment"==e?d[c.properties[0].value].label:"size"==e?b.trustAsHtml("宽度:"+c.properties[0].value.width+"<br>高度  :"+c.properties[0].value.height):"font"==e?c.properties[0].value.size:"center"==e?"x位置:"+c.properties[0].value.x+";y位置:"+c.properties[0].value.y:"backgroundColor"==e||"textColor"==e||"tintColor"==e?N.rgbaToString(c.properties[0].value):"image"==e&&c.properties[0].value.hasOwnProperty("uri")?c.properties[0].value.uri:"contentEdgeInsets"==e?b.trustAsHtml("上边距:"+c.properties[0].value.top+"<br>下边距 :"+c.properties[0].value.bottom+"<br>左边距 :"+c.properties[0].value.left+"<br>右边距 :"+c.properties[0].value.right):c&&c.properties[0]&&c.properties[0].hasOwnProperty("value")&&c.properties[0].value.hasOwnProperty("normal")&&"object"!=typeof c.properties[0].value.normal?c.properties[0].value.normal:c&&c.properties[0]&&c.properties[0].hasOwnProperty("value")&&c.properties[0].value.hasOwnProperty("normal")&&"object"==typeof c.properties[0].value.normal?N.directionDataToString(c.properties[0].value.normal):c.properties[0].value},a.indexOfTextAlignments=_.keyBy(a.textAlignments,"val"),a.selectFiles=[];var W=function(b,c){a.selectFiles[b].progress={p:0},r.getUploadToken().then(function(d){var e=d.data;a.selectFiles[b].upload=k.upload({key:e.filename,file:a.selectFiles[b].file,token:e.token}),a.selectFiles[b].upload.then(function(a){c(a)},function(a){},function(c){a.selectFiles[b].progress.p=Math.floor(100*c.loaded/c.totalSize)})})};a.controllChangeEmit=function(a,b){C(a,b,F)},a.selectArrayControllChangeEmit=function(b,c){a.props[b]=c;var d="props."+b;C(d,c,F)},a.$on("colorpicker-closed",function(a,b){if(b.value){var c=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/;c.test(b.value)&&C(b.name,b.value,F)}});var X=function(a,b,c){r.getUploadToken().then(function(d){var e=d.data;k.upload({dataURI:a,fileKey:b,token:e.token}).then(function(a){c(a)},function(){c()})})};a.abort=function(b){a.selectFiles[b].upload.abort(),a.selectFiles.splice(b,1)},a.resetVersion=function(){e.confirm({content:"确定要重置版本【"+a.curVersion.displayName+"】吗?所做的编辑将会丢失",type:"query"},function(){var b=E();a.changes=b.changes,b=N.emitIosDataAddChangeNumber(b),O.emit("del_change",{data:angular.toJson(b)}),N.resetForm(),g.success({msg:"重置成功",icon:!0,time:3e3,top:0})})},a.onFileSelect=function(b){for(var c=a.selectFiles.length,d=0;d<b.length;d++)a.selectFiles[d+c]={file:b[d]},W(d+c,function(b){var c="https://cdn.appadhoc.com/"+b.key;h(function(){a.props.bg_bitmap=c,a.controllChangeEmit("props.bg_bitmap",c)})})},a.onFileSelectFrontImage=function(b){for(var c=a.selectFiles.length,d=0;d<b.length;d++){if(a.selectFiles[d+c]={file:b[d]},a.ios){var e=b[d].name;e.indexOf("@2x.")>0?a.props.imgScale=2:e.indexOf("@3x.")>0&&(a.props.imgScale=3)}W(d+c,function(b){var c="https://cdn.appadhoc.com/"+b.key;h(function(){a.props.src_bitmap=c,a.controllChangeEmit("props.src_bitmap",c)})})}},a.alphaSlider=function(b){a.props.alpha=b,a.controllChangeEmit("props.alpha",b)},a.backEdit=function(){return M()?void window.parent.postMessage("edit-close","*"):void("app.createInfo.lists.expInfo"==N.fromState.name?d.go(a.gofromState):f.goPrev())},a.uploadPhoneImage=function(){g.success({msg:"正在退出请稍后....",icon:!0,time:13e3,top:0});var b=[],c=[],e={experiments_updater:{}};a.versions.forEach(function(a){a.shot&&c.push(a)}),0==c.length&&d.go(a.gofromState),c.forEach(function(a){var d=a;h(function(){X(d.shot,d.exp.id,function(a){var f="http://7xldge.com2.z0.glb.qiniucdn.com/"+a.key;e.experiments_updater[d.exp.id]={annotation:{snapshot:f}},b.push(f),b.length==c.length&&p.updateGroupWithExp(N.curGroup.id,e).then(function(a){O.emit("web-disconnect"),O.disconnect(),O.removeAllListeners(),g.removeAll()})})})})},a.startPage(),a.$on("$destroy",function(){O.emit("web-logout"),O.removeListener(),O.disconnect(!0)}),a.canEditView=function(){if(!a.curView)return 1;var b=a.curView.hasOwnProperty("canEdit");return b?a.curView.canEdit:1},a.canBindView=function(){if(!a.curView)return 1;var b=a.curView.hasOwnProperty("canBind");return b?a.curView.canBind:1},a.$on("colorpicker-closed",function(){a.$apply()})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("iosMobileEditor",{url:"/iosMobileEditor",templateUrl:"app/iosMobileEditor/iosMobileEditor.html",controller:"IosMobileEditorCtrl",data:{pageTitle:"iOS 编辑器 A/B Testing"},role:{noExp:!0},resolve:{curApp:["AuthApi","App",function(a,b){var c=b.getAppID();return a.getAppById(c)}],curGroup:["ExpApi","App",function(a,b){var c=b.getCurGroupId()||b.getGroupIdForCookie();return a.getGroupById(c)}],allStatsData:["DataApi","App",function(a,b){return a.getStats(b.getAppID())}]}})}]),angular.module("abtesting").directive("layer",function(){return{templateUrl:"app/layer/layer.html",restrict:"E",scope:{onSelect:"&onSelect"},controller:["$scope","App","ExpApi","Constant","$q",function(a,b,c,d,e){var f=this;f.layerList=[],f.requestData=function(){e.all([c.getAllLayers(b.getAppID()),c.getAllGroup(b.getAppID())]).then(function(a){f.allLayers=a[0].data.layers,f.allGroups=a[1].data.groups}).then(function(){f.vaildGroups=_.filter(f.allGroups,function(a){return a.status===d.EXP_STATUS_DEF||a.status===d.EXP_STATUS_RUN})}).then(function(){f.indexGroupByLaryerId=_.groupBy(f.vaildGroups,"control.layer_id")}).then(function(){f.initLayerList()}).then(function(){a.curAllLayers=f.layerList,a.selectLayer=f.layerList[0]}).then(function(){var b=a.onSelect();if(b){var c=angular.copy(a.selectLayer);return c.count=f.allLayers.length,b(c)}})},f.addDefLayer=function(){var a={};a.name="默认层",a.layerId=d.LAYER_BTN_DEF_ID,a.groups=f.getDefGroups()||[],a.traffic=f.getDefLayerTraffic(a.groups),f.layerList.push(a)},f.addNewLayer=function(){var a={name:"新建层",traffic:"",groups:[],layerId:d.LAYER_BTN_NEW_ID};f.layerList.push(a)},f.initLayerList=function(){f.addDefLayer(),f.addNewLayer(),_.forEach(f.allLayers,function(a){var b={};b.name=a.name,b.layerId=a.id,b.groups=f.getCurLayerGroup(a)||[],b.traffic=f.getCurLayerTraffic(b.groups),f.layerList.push(b)})},f.getCurLayerTraffic=function(a){var b=f.getGroupTraffic(a);return 100-b},f.getDefLayerTraffic=function(a){var b=f.getGroupTraffic(a);return 100-b},f.getGroupTraffic=function(a){var b=0;return _.forEach(a,function(a){b+=_.get(a,"control.traffic"),b+=_.sumBy(_.get(a,"experiments"),function(a){return a.traffic})}),b},f.getDefGroups=function(){var a=f.indexGroupByLaryerId[void 0];return a},f.getCurLayerGroup=function(a){var b=f.indexGroupByLaryerId[a.id];return b},f.requestData()}],link:function(a){a.changeLayer=function(b){var c=a.onSelect();a.selectLayer=b,b.count=a.curAllLayers.length-2,c&&c(b)}}}}),angular.module("abtesting").service("layer",function(){var a={addNewLayer:function(){}};return a}),angular.module("abtesting").service("DataLogic",["App","Constant","DataHelper","abToast","$rootScope","$state","$interval","$timeout",function(a,b,c,d,e,f,g,h){return{retentionDarwTab:function(a,b,d,e){var f=this,g=a?a.data.retained_results:[];if(f.newDate=moment(),b)return f.indexStatResults=_.groupBy(g,"exp_id"),f.curExpStats=f.indexStatResults[b.id],f.indexStatResultsByHour=[],f.indexSameExpResultsByHour=_.groupBy(f.curExpStats,"date"),f.timeReversByDay=c.getCompareTimeByDay(d,e),f.retainedStats=[],_.forEachRight(f.timeReversByDay,function(a){f.statTime=moment(a).format("YYYY-MM-DD");var b={hour:f.statTime,weekhour:"",newWeekData:"",retainedWeekData:"",newData:"",Retained1:"",Retained2:"",Retained3:"",Retained4:"",Retained5:"",Retained6:"",Retained7:""},c=moment.range(a,f.newDate).diff("days");f.indexSameHourSameExpResultsByStat=_.keyBy(f.indexSameExpResultsByHour[a],"stat_key"),f.indexSameHourSameExpResultsByStat["Clients-New-Weekly"]&&(b.newWeekData=f.indexSameHourSameExpResultsByStat["Clients-New-Weekly"].stat_value,b.weekhour=moment(a).subtract(13,"days").format("YYYY/MM/DD")+"——"+moment(a).subtract(7,"days").format("YYYY/MM/DD")),f.indexSameHourSameExpResultsByStat["Clients-Retained-Weekly"]&&(b.retainedWeekData=f.indexSameHourSameExpResultsByStat["Clients-Retained-Weekly"].stat_value);for(var d=0;d<=7;d++)if(0==c)f.indexSameHourSameExpResultsByStat["Clients-New-Daily"]?b.newData=f.indexSameHourSameExpResultsByStat["Clients-New-Daily"]:b.newData="-";else{b.newData=f.indexSameHourSameExpResultsByStat["Clients-New-Daily"]?f.indexSameHourSameExpResultsByStat["Clients-New-Daily"].stat_value:"-";for(var e=1;e<=c;e++)f.indexSameExpResultsRetainedByStat=_.keyBy(f.indexSameExpResultsByHour[moment(a).add(e,"days").toISOString()],"stat_key"),f.indexSameExpResultsRetainedByStat["Clients-Retained-Daily-"+e]?b["Retained"+e]=f.indexSameExpResultsRetainedByStat["Clients-Retained-Daily-"+e].stat_value:b["Retained"+e]="-",1==e&&(f.indexSameExpResultsRetainedByStat=_.keyBy(f.indexSameExpResultsByHour[moment(a).toISOString()],"stat_key"),f.indexSameExpResultsRetainedByStat["Clients-Retained-Daily"]?b["Retained"+e]=f.indexSameExpResultsRetainedByStat["Clients-Retained-Daily"].stat_value:b["Retained"+e]="-");
}f.retainedStats.push(b)}),_.reverse(f.retainedStats)},checkInternetCountDown:function(){var a,b=10,c="",d=this,f=angular.element(document.querySelector("body")),i=angular.element('<div class="abtoast-container ab-check-internet-con" style="top:'+(angular.isUndefined(top)?48:top)+'px"></div>'),j=angular.element('<p class="abtoast-warning ab-check-internet" style="height: 100%;padding: 15px;" >'+c+"</p>");f.append(i),i.append(j),d.cuntDown=function(){angular.isDefined(a)||(a=g(function(){b--,b<0&&(b=0),0!=b&&$(".ab-check-internet").html("目前网络连接已经断开"+b+"秒后，将会重连"),0==b&&(e.online||$("#ab-check-internet").html("连接失败"),e.online?d.cuntDownSuccess():b=10)},1e3))},d.cancelCuntDown=function(){angular.isDefined(a)&&(g.cancel(a),a=void 0)},d.cuntDownSuccess=function(){d.cancelCuntDown(),$(".ab-check-internet").removeClass("abtoast-warning").addClass("abtoast-success").html("重新连接成功"),h(function(){$(".ab-check-internet-con").remove()},2e3)},d.cuntDown()}}}]),angular.module("abtesting").service("ExpLogic",["App","Constant","DataHelper","ExpApi",function(a,b,c,d){return{createGroup:function(e,f){var g=c.getExpDistantDateRange(),h={name:e.name,app_id:a.getAppID(),description:e.description,typ:e.typ,control:{name:"原始版本",description:"对照组",flags:{},stats:[],traffic:0,typ:e.typ,status:b.EXP_STATUS_DEF,start_date:moment().valueOf(),end_date:g.end.valueOf()},experiments:[{name:"试验版本_1_"+e.name,description:"版本 1",flags:{},stats:[],traffic:0,typ:e.typ,status:b.EXP_STATUS_DEF,start_date:moment().valueOf(),end_date:g.end.valueOf()}]};e.layer_id&&(h.layer_id=e.layer_id,h.control.layer_id=e.layer_id,h.experiments[0].layer_id=e.layer_id),d.insertGroup(a.getAppID(),h).then(function(a){f(a)})},delGroup:function(a,c){({experiments_updater:{},group_updater:{status:b.EXP_STATUS_DELETE}});d.deleteGroupById(a.id).then(function(a){c(a)})},creatExp:function(b,e){var f=c.getExpDistantDateRange(),g={name:b.name,description:b.description,group_id:b.id,flags:b.flags?b.flags:{},stats:b.stats?b.stats:[],start_date:moment().valueOf(),end_date:f.end.valueOf(),traffic:0,status:0};b.layer_id&&(g.layer_id=b.layer_id),d.creatExp(a.getAppID(),g).then(function(a){e&&e(a)})},delExp:function(a,b){var c;a.id&&(c=a.id),a.id||(c=a);var e=this;d.deleteExpById(c).then(function(a){b&&b(a),e.updatePageCacheData()})},updatePageCacheData:function(b,c){b||(b=a.getCurGroup());var e=a.getCurUser();a.getApp().author_id!=e.id&&"Admin"!=e.role&&e.owner_id!=e.id||d.updateGroupWithExp(b.id,{group_updater:{id:b.id}}).then(function(a){c&&c(a)})}}}]),angular.module("abtesting").controller("LoginCtrl",["$rootScope","$scope","$state","Auth","alert","App","$timeout",function(a,b,c,d,e,f,g){b.formTest={},d.clearUser(),a.env={},b.$watch("errorTip",function(){g(function(){b.errorTip=""},5e3)}),b.login=function(a){d.tryLogin({email:b.formTest.name,password:b.formTest.password},function(a){return"20015"==a.error_code?e.alert({content:"您的账号已失效,请与sales@lpotest.com联系激活。",type:"fail"}):"20004"==a.error_code?e.alert({content:"您的账号未激活。",type:"fail"}):"用户名或密码错误"===a.reason_display?b.errorTip="邮箱或密码输入错误，请重新输入":"用户未激活"==a.reason_display?e.alert({content:"账户未激活，请检查激活邮件",type:"fail"}):void d.getUserInfo(function(b){return"string"==typeof b?void e.alert({content:b,type:"fail"},function(){c.go("login")}):(f.setCurUser(b),f.setAuthKey(a),c.go("app.appmanage"),void 0)})},function(a){console.log(a)})}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/login/login.html",controller:"LoginCtrl",role:{noAuth:!0},data:{pageTitle:"登录 A/BTesting"}})}]),angular.module("abtesting").controller("ManagementCtrl",["$scope","Apps","Auth","App","alert","Constant","AuthApi","AuthHelper","$uibModal",function(a,b,c,d,e,f,g,h,i){var j=this;j.apps=b.data.apps,j.curOwner=d.getCurUser(),a.curOwner=j.curOwner,a.apps=j.apps,a.blockedContent={"false":"加入黑名单","true":"取消黑名单"},j.roles=[{name:"编辑者",key:f.ROLE_ADMIN},{name:"普通用户",key:f.ROLE_COLLABORATOR}],a.roles=_.keyBy(j.roles,"key"),a.refresh=function(){j.owner=d.getCurUser(),j.ownerApps=h.getCurUserApps(j.apps,j.owner.id),a.getAllMembers=function(){g.getAllMembers().then(function(b){a.members=b.data.members,_.forEach(a.members,function(a){g.getAllAppById(a.id).then(function(b){a.apps=b.data.apps})})})},a.getAllMembers()},a.refresh(),a.addAndCanelBlacklist=function(b){var c=b.blocked?"取消":"加入",d=b.blocked?"该用户将可以登录和使用平台":"该用户将无法登录和使用平台";e.confirm({content:"确定将该用户"+c+"黑名单?"+d,type:"query"},function(){var c={};c.blocked=!b.blocked,g.updateMember(b.id,c).then(function(c){_.forEach(a.members,function(a){a.id==b.id&&(a.blocked=!b.blocked)})})})},a.invitate=function(a){i.open({templateUrl:"components/invitate/invitate.html",controller:"InvitateCtrl",resolve:{Apps:function(){return j.apps}}})},a.edit=function(a){i.open({templateUrl:"components/editmemberModel/editmember.html",controller:"EditmemberCtrl",resolve:{Apps:function(){return j.apps},userInfo:function(){return a}}})},a.goback=d.goPrev,a.$on(f.EVENT_REFRESH_MANAGEMENT,function(b){a.refresh()})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.management",{url:"/management",templateUrl:"app/management/management.html",controller:"ManagementCtrl",role:{noApp:!0,noExp:!0},data:{pageTitle:"成员管理 A/BTesting"},resolve:{Apps:["AuthApi",function(a){return a.getAllApp()}]}})}]),angular.module("abtesting").factory("androidSocket",["socketFactory","$location","ENV",function(a,b,c){var d=c.H5_URL;return{getInstense:function(){var b=io.connect(d);return a({ioSocket:b})}}}]),angular.module("abtesting").controller("MobileEditorCtrl",["$scope","androidSocket","$state","alert","App","abToast","$timeout","curGroup","$stateParams","$qupload","$rootScope","DataHelper","ExpHelper","ExpLogic","ExpApi","DataApi","H5Api","allStatsData","$q","Constant","AbDispacher","$window","dataManager","curApp",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){function y(b){return clearTimeout(O),a.app.app_key?b(a.app.app_key):void(O=setTimeout(function(){return y(b)},100))}function z(b){u.renderPhoneView(a.curView),a.treelock=!1,b=angular.fromJson(b),b.viewTree||b.windows&&(b.viewTree=b.windows[0]),a.curConnectMobile&&a.curConnectMobile.id==b.socketid&&(a.phoneImage="data:image/jpeg;base64, "+b.screenShot,a.curVersion.shot=a.phoneImage,L.curControl.annotation||W(a.phoneImage,L.curControl.id,function(a){var b="http://7xldge.com2.z0.glb.qiniucdn.com/"+a.key;g(function(){o.updateExpById(L.curControl.id,{annotation:{snapshot:b}}).then(function(a){L.curControl=a.data})})}),a.dpi=b.dpi,a.touchMapJson=b,M.emit("picture_ok",{socketid:a.curConnectMobile.id}),a.ios||(P&&P.activity==b.activity||(a.endEditing(),a.props={}),P=b),a.setParent(a.touchMapJson),window.touchInfo={w:b.screenWidth,h:b.screenHeight},a.tree=b,a.treedata=[b.viewTree],a.screenWidth=b.screenWidth,a.screenHeight=b.screenHeight,a.hideLanding(),a.hideOverlay())}function A(a){if("undefined"==typeof a||0==a)return"";a=_.toNumber(a),a<0&&(a=4294967295+a+1);var b=a.toString(16).substr(-6);return"object]"!=a?L.toRGB(b,"string"):void 0}function B(b,c,d){var e=b;if(!angular.isUndefined(c)){var f=R[e],g=f.hasOwnProperty("aliases")?f.aliases:f.key,b=f.key?f.key:f.aliases;a.propsOld[b]!==c&&(!a.ios&&a.dpi&&f.dp&&l.compareSdkVersion("2.3.2",a.sdkVersion)&&(c=parseInt(c/a.dpi+.5)),a.propsOld[b]=a.propsOld[b]?a.propsOld[b]:c,"width"!==b&&"height"!==b||(L.initProps[a.curNode.elemId]=L.initProps[a.curNode.elemId]?L.initProps[a.curNode.elemId]:{},L.initProps[a.curNode.elemId][b]=L.initProps[a.curNode.elemId][b]?L.initProps[a.curNode.elemId][b]:c),"text"==b?d(g,c,f.type):F(function(){d(g,c,f.type)}))}}function C(a,b,c){L.getChangePropIndex(),"text_size"==a&&"NaN"==_.toString(b)&&(b="NaN");var d={property:a,value:b};return c&&(d.type=c),d}function D(){return{experiment_version:20,experiment_id:200230,socketid:a.curConnectMobile?a.curConnectMobile.id:null,description:"version#1",changes:[]}}function E(b,c,e){if(a.curVersion.exp.id==a.group.control.id)return d.alert({content:"原始版本不可编辑",type:"fail"});a.showLanding(),g(function(){a.$apply()});var f=D(),h=C(b,c,e);if(!L.inputFormat(h))return a.loadingStatus=!1;h=L.handleAndroidPropsResult(h),a.curNode.properties=[],a.curNode.properties.push(h),a.changes||(a.changes=[]);var i=a.hashCode(angular.toJson(a.curNode.position,!1)),j=!1;if(a.changes.forEach(function(c){c.id==i&&c.properties[0].property==a.curNode.properties[0].property&&c.properties[0].type==a.curNode.properties[0].type&&(c.properties[0].value=a.curNode.properties[0].value,"text"===b&&(a.curNode.properties[0].old_value=c.properties[0].old_value),a.curNode.properties[0].type&&(c.properties[0].type=a.curNode.properties[0].type),j=!0)}),!j){"text"===b&&(a.curNode.properties[0].old_value=a.propsOld.text);var k={position:a.curNode.position,properties:a.curNode.properties,id:i};a.changes.push(k)}f.changes.push(a.curNode),f.changes=a.changes;var l=angular.toJson(f);L.storeVersionsChange[a.curVersion.exp.id]=L.storeVersionsChange[a.curVersion.exp.id],a.versions.forEach(function(b){b.displayName==a.curVersion.displayName&&(b.data=f)}),M.emit("props",l),a.curView.properties=a.props}function F(a){T&&window.clearTimeout(T),T=window.setTimeout(a,1e3)}function G(){for(var a in S){var b=S[a];b()}}function H(a){var b="";return a?(a.forEach(function(a){var c=a.hasOwnProperty("row")?a.row:a.index;c>=0&&(b+="-"+c)}),b):b}function I(b,c){a.eventsObj[c]=b,N[b]?N[b].ids.push(c):N[b]={id:b,ids:[c]}}function J(b,c){if(b&&b!=c){if(b.creatFig)return void a.versions.forEach(function(a){a.creatFig=!1});a.endEditing(),c.data=a.getVersionData(),a.changes=[],b.data&&(a.changes=b.data.changes),a.curVersion.data&&(M.emit("change-version",{data:a.curVersion.data}),f.success({msg:"切换版本为【"+a.curVersion.displayName+"】",top:0,icon:!0,time:2e3}))}}function K(){try{return window.self!==window.top}catch(a){return!0}}var L=this;L.curGroup=h.data,L.allStats=r.data.stats,L.curStats=l.getVaildeStats(L.allStats),L.curApp=x.data;var M=b.getInstense();L.fromState=e.getFromState(),console.log(L.fromState,"name"),a.gofromState="app.createInfo.lists.expInfo",L.fromState&&L.fromState.name&&(a.gofromState=L.fromState.name),a.curStats=L.curStats,a.curNoFormulaStats=m.getNoEventStats(l.getNonFormulaStats(a.curStats)),L.curControl=L.curGroup.control,a.group=L.curGroup,a.app=L.curApp,a.formTest={},a.saving=0,a.versions=[],a.curVersion={},a.storeStat={},a.props={},a.propsOld={},L.initProps={},a.curView,a.changes=[],a.curNode={},a.treelock=!0,a.clickCount=0,a.statMap={},a.stats=[],L.storeOldValue={},a.groupName=i.groupname;var N={};a.connectStatus=!0,a.mobileDisconnect=!1,a.waitingConnect=!0,a.ios&&a.appjson&&(a.curConnectMobile={}),a.loadingStatus=!1,a.connectInfo="请打开安装sdk的应用,连接编辑器",a.layoutOpen=!0,a.styleOpen=!0,a.contentOpen=!0,a.statOpen=!0,a.hideOverlay=function(){a.connectStatus=!1},a.showLanding=function(){a.loadingStatus=!0,f.removeAll(),g(function(){a.loadingStatus&&f.danger({icon:!0,msg:"保存中请稍等",top:0,time:3e4})},1e4)},a.hideLanding=function(){a.loadingStatus=!1,f.removeAll()},a.viewTreeStatus=!1,a.toggleViewTree=function(){a.viewTreeStatus=!a.viewTreeStatus},L.storeVersionsChange={},a.mobileClients=[],a.$watch("curConnectMobile",function(b,c){b&&(M.emit("refresh"),f.success({msg:"检测到页面变化，即将刷新",icon:!0,time:3e3,top:0}),g(function(){a.waitingConnect=!0},3e3))}),M.connect(),g(function(){a.waitingConnect=!1},6e4),M.on("refresh-mobile",function(b){var c=b.sockets;if(a.mobileClients=c,a.mobileDisconnect=!1,"disconnect"==b.status&&(a.mobileDisconnect=!0),0===c.length)return a.connectStatus=!0;if(("mobile_login"==b.status||!a.curConnectMobile)&&c.length>0&&(a.curConnectMobile=a.mobileClients[0],a.sdkVersion=c[0].version),a.curVersion.data){var d=angular.toJson(a.curVersion.data);M.emit("props",d),L.storeVersionsChange[a.curVersion.exp.id]=L.storeVersionsChange[a.curVersion.exp.id]+d}else"web_login"==b.status&&(a.needsProps=!0)}),M.on("web-login-fail",function(){a.isConnect=!0});var O;M.on("connect",function(){y(function(a){M.emit("web-login",{appkey:a})})}),M.on("get-mobile",function(b){a.mobileClients=b,!a.curConnectMobile&&b.length>0&&(a.curConnectMobile=a.mobileClients[0],a.hideOverlay())}),a.isKick=!1,M.on("mobile-kick",function(){a.isKick=!0,setTimeout(function(){a.isKick=!1},2e3)}),M.emit("get-mobile"),a.setParent=function(b){a.loopSetParent(b.viewTree)},a.loopSetParent=function(b){for(var c=b.children,d=0;d<c.length;d++)c[d].parent=b,a.loopSetParent(c[d])};var P=null;M.on("picture_",z),window.touchInfo={w:0,h:0},a.calcView=function(b,c){var d=b.ios?b:b.properties,e=null,f=b.properties.width*b.properties.height/(a.screenWidth*a.screenHeight);c.x>=d.x&&c.x<=d.x+d.width&&c.y>=d.y&&c.y<=d.y+d.height&&f<.75&&(e=b);for(var g=b.children,h=0;h<g.length;h++){var i=g[h],j=a.calcView(i,c);j&&(e=j)}return e},a.hoverNode={id:0},a.phoneTouchMove=function(b){if(!b)return a.hoverNode={id:0},void a.$apply();if(a.touchMapJson){var c=a.calcView(a.touchMapJson.viewTree,b);c&&a.hoverNode!=c&&(a.hoverNode=c,a.$apply())}},a.phoneTouchSelect=function(){var b=a.hoverNode;a.selectTouchItem(b),a.selectedChange=null,g(function(){a.$apply()})},a.selectTouchItem=function(b){var c=a.treeScope.componentsTree.currentNode;c&&c.selected&&(c.selected=void 0),a.treeScope.componentsTree.currentNode=b,b.selected="selected",a.highlightElements([]),G();var d=Array(),e=b;for(a.curView=b;e.parent;){var f={view:e.class_name,index:e.position,offset:e.position-e.invicount};e&&e.hasOwnProperty("row")&&(f.row=e.row),e&&e.hasOwnProperty("cur_item")&&(f.cur_item=e.cur_item),d.push(f),e=e.parent}var g={view:e.class_name,index:e.position,offset:e.position-e.invicount};e.row&&(g.row=e.row),e.cur_item&&(g.cur_item=e.cur_item),d.push(g),d.push({activity:a.tree.activity}),d=d.reverse(),a.curNode.position=d,a.curNode.elemId=H(d),a.curDomStat=a.eventsObj[a.curNode.elemId],a.dataConvert(a.curView)};var Q=new Array;a.visibilitys=[{label:"可见",val:0},{label:"不可见",val:4},{label:"隐藏",val:8}],a.gravitys=[{label:"居上",val:8388659},{label:"居中",val:17},{label:"水平居中",val:49},{label:"垂直居中",val:8388627},{label:"居左",val:51},{label:"居右",val:53},{label:"居下",val:8388691}],a.textStyles=[{label:"正常",val:0},{label:"粗体",val:1},{label:"斜体",val:2},{label:"粗斜体",val:3}],a.sizes=[{label:"充满全屏",val:-1},{label:"适应内容",val:-2},{label:"自定义",val:0}],a.ellipsizes=[{label:"无",val:"none"},{label:"省略号在开头",val:"START"},{label:"省略号在中间",val:"MIDDLE"},{label:"省略号在结尾",val:"END"},{label:"跑马灯",val:"MARQUEE"}],a.selectTreeItem=function(b){Q=[],G();var c=a;if(b){a.curView=b.node,Q.push({view:b.node.class_name,index:b.node.position,offset:b.node.position-b.node.invicount}),b=b.$parent;for(var d=new Array;b.$id!==c.$id;){var e=b.node;if(e){var f={view:e.class_name,index:e.position,offset:e.position-e.invicount};e.row&&(f.row=e.row),e.cur_item&&(f.cur_item=e.cur_item),d.push(f)}b=b.$parent}Q=Q.concat(d),Q.push({activity:a.tree.activity}),Q=Q.reverse(),a.curNode.position=Q,a.curNode.elemId=H(Q),a.curDomStat=a.eventsObj[a.curNode.elemId],a.dataConvert(a.curView)}else a.curView=null},a.treeHandler=function(b){var c=angular.element(b.target).scope();return c.node.properties.width<1||c.node.properties.height<1||c.node.properties.x>360?(f.warning({msg:"当前选中元素不可编辑",icon:!0,time:1e3,top:0}),void(a.curView=null)):(a.selectTreeItem(c),void(a.selectedChange=null))},a.$watch("curView",function(b,c){if(c&&!b){G();for(var d in R)a.props[R[d].key]=""}}),a.touchHanlder=function(){a.treeHandler(k.curTouchEvent),a.selectedChange=null},a.highlightChange=function(b){if(a.selectedChange=b,b.position[0].activity==a.tree.activity){for(var c=a.treedata[b.position[1].offset],d=2;d<b.position.length&&c;d++){var e=b.position[d].offset;c=c.children[e]}c&&a.selectTouchItem(c)}},L.toHex=function(a){return"string"==typeof a&&(a=L.rgbaToObject(a)),"#"+(1<<24|parseInt(a.r,10)<<16|parseInt(a.g,10)<<8|parseInt(a.b,10)).toString(16).substr(1)},L.toRGB=function(a,b){var c=_.trim(_.toString(a));0==c.indexOf("#")&&(c=c.slice(1,c.length));var d=c.slice(0,2),e=c.slice(2,4),f=c.slice(4,6),g=parseInt(d,16),h=parseInt(e,16),e=parseInt(f,16);return"string"==b?"rgb("+g+","+h+","+e+")":"object"==b?{r:g,g:h,b:e}:{r:g,g:h,b:e}},L.inputFormat=function(a){if("sizeY"==a.property&&0==a.value||"sizeX"==a.property&&0==a.value)return!1;if("text"!=a.property&&(_.isUndefined(a.value)||_.isNull(a.value)||_.isNaN(a.value)))return!1;if("text_color"==a.property||"backgroundColor"==a.property||"textColor"==a.property||"bg_color"==a.property){var b=L.rgbaToObject(a.value);return!(b.r<0||b.r>255||!b.r)&&(!(b.g<0||b.g>255||!b.g)&&!(b.b<0||b.b>255||!b.b))}return!("text_size"==a.property&&_.isUndefined(a.value)||"text_size"==a.property&&_.isNull(a.value)||"text_size"==a.property&&_.isNaN(a.value))},L.rgbaToObject=function(a){for(var b=a,c=b.length-1,d=b.indexOf("(")+1,e=b.slice(d,c),f=_.split(e,",",4),a={},g=0;g<f.length;g++)0==g&&(a.r=f[g]),1==g&&(a.g=f[g]),2==g&&(a.b=f[g]),3==g&&(a.a=f[g]);return a},L.handleAndroidPropsResult=function(b){var c=b;return"maxlines"==b.property&&(c.value=Math.floor(c.value),a.props.maxlines=c.value),("text_color"==b.property||"color"==b.type&&"background"==b.property)&&(c.value=L.toHex(b.value)),("sizeY"==b.property&&0!=b.value||"sizeX"==b.property&&0!=b.value)&&("sizeY"==b.property?c.property="height":c.property="width"),c},L.booleanToString=function(a){var b={};if("object"==typeof a){for(var c in a)"boolean"==typeof a[c]?b[c]=_.toString(a[c]):b[c]=a[c];return b}},a.isAndroidHasTheProperty=function(b){return!!a.curView&&a.curView.properties.hasOwnProperty(b)},a.dataConvert=function(b){if(b){var c=angular.copy(b.properties)||{};if(a.props=L.booleanToString(c),c.height_mode<0?a.props.sizeY=c.height_mode:a.props.sizeY=0,c.width_mode<0?a.props.sizeX=c.width_mode:a.props.sizeX=0,c.hasOwnProperty("alpha")){var d=Number(c.alpha).toFixed(1);a.props.alpha=Number(d)}c.hasOwnProperty("text")&&(a.props.text=c.text),c.hasOwnProperty("text_color")&&(a.props.text_color=A(c.text_color)),a.props.bg_color=A(c.bg_color),a.props.bg_bitmap="def",a.ios?c.hasOwnProperty("image")&&(a.props.src_bitmap="def"):c.hasOwnProperty("src_bitmap")&&(a.props.src_bitmap="def"),a.propsOld=angular.extend({},a.props)}},a.textBtnStatus=!0,a.ChangeText=function(){a.textBtnStatus=!1};var R={"props.width":{key:"width",aliases:"width",dp:!0},"props.height":{key:"height",aliases:"height",dp:!0},"props.paddingBottom":{key:"paddingBottom",aliases:"paddingBottom",dp:!0},"props.paddingTop":{key:"paddingTop",aliases:"paddingTop",dp:!0},"props.paddingLeft":{key:"paddingLeft",aliases:"paddingLeft",dp:!0},"props.paddingRight":{key:"paddingRight",aliases:"paddingRight",dp:!0},"props.alpha":{aliases:"alpha"},"props.text_gravity":{key:"text_gravity",aliases:"text_gravity"},"props.text_style":{key:"text_style",aliases:"text_style"},"props.text_color":{key:"text_color",aliases:"text_color"},"props.text_size":{key:"text_size",aliases:"text_size",dp:!0},"props.visibility":{aliases:"visibility"},"props.text":{aliases:"text"},"props.text_selectable":{key:"text_selectable",aliases:"text_selectable"},"props.bg_bitmap":{key:"bg_bitmap",aliases:"background",type:"image"},"props.bg_color":{key:"bg_color",aliases:"background",type:"color"},"props.src_bitmap":{key:"src_bitmap",aliases:"image",type:"image"},"props.hint":{key:"hint",aliases:"hint"},"props.translationY":{key:"translationY",aliases:"translationY"},"props.translationX":{key:"translationX",aliases:"translationX"},"props.maxlines":{key:"maxlines",aliases:"maxlines"},"props.sizeY":{key:"sizeY",aliases:"sizeY"},"props.sizeX":{key:"sizeX",aliases:"sizeX"},"props.ellipsize":{key:"ellipsize",aliases:"ellipsize"},"props.scrollBarFadingEnbled":{key:"scrollBarFadingEnbled",aliases:"scrollBarFadingEnbled"}},S=[];L.getChangePropIndex=function(){a.changes&&(L.indexChangesProperty=_.keyBy(a.changes,function(a){return a.properties[0].property}))},a.hashCode=function(a){var b,c,d,e=0;if(0==a.length)return e;for(b=0,d=a.length;b<d;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return e};var T;a.status={isFirstOpen:!0,isFirstDisabled:!1},a.refresh=function(){M.emit("refresh")},a.undoChanges=function(b){d.confirm({content:"确定撤销该修改？",type:"query"},function(){var c=a.changes.indexOf(b);a.changes.splice(c,1);var d=D();d.changes=a.changes,M.emit("del_change",{data:angular.toJson(d)})})},a.setFormScope=function(b){a.formScope=b,a.trackStatBy="add"},a.setTreeScope=function(b){a.treeScope=b},a.showTrackingElement=function(){a.editingStatPanel=!0},a.changeTrackStatType=function(b){a.trackStatBy=b},a.trackStat=function(b){a.stats.push({name:b.name}),"array"==typeof L.curControl.stats&&L.curControl.stats||(L.curControl.stats=[]),L.curControl.stats=L.curControl.stats.push(b.name),a.allSelectedStats[b.name]=a.allSelectedStats[b.name]?a.allSelectedStats[b.name]:{},a.allSelectedStats[b.name].name=b.name,a.allSelectedStats[b.name].views=a.allSelectedStats[b.name].views?a.allSelectedStats[b.name].views:[],a.allSelectedStats[b.name].views.push(angular.copy(a.curNode)),a.storeStat[a.curNode.elemId]=a.storeStat[a.curNode.elemId]?a.storeStat[a.curNode.elemId]:{},a.storeStat[a.curNode.elemId].stat_key=b.name,a.storeStat[a.curNode.elemId][b.name]={},a.storeStat[a.curNode.elemId][b.name].id=b.name,a.storeStat[a.curNode.elemId][b.name].views=[],a.curNode.stat_key=b.name,a.storeStat[a.curNode.elemId][b.name].views.push(angular.copy(a.curNode)),a.saveVersions(),L.saveStats(),a.editingStatPanel=!1},a.addDomIdToStats=function(b){if(a.curNode){I(b,a.curNode.elemId),a.addStat(b);var c=!0;if(a.control.stats.forEach(function(a){a==b&&(c=!1)}),c){a.control.stats.push(b),o.updateExpById(a.control.id,{stats:a.control.stats});var d={elemId:a.curNode.elemId,statName:b};a.events.push(d)}}},a.addStat=function(b,c){if(b){if(_.keyBy(a.curStats,"name")[b]&&""===_.keyBy(a.curStats,"name")[b].formula)return d.alert({content:"指标名称已存在",type:"fail"});if(_.keyBy(a.curStats,"name")[b]&&""!=_.keyBy(a.curStats,"name")[b].formula)return d.alert({content:"已存在同名复合指标",type:"fail"});a.allSelectedStats[b]=a.allSelectedStats[b]?a.allSelectedStats[b]:{},a.allSelectedStats[b].name=b,a.allSelectedStats[b].views=a.allSelectedStats[b].views?a.allSelectedStats[b].views:[],a.allSelectedStats[b].views.push(angular.copy(a.curNode)),a.storeStat[a.curNode.elemId]=a.storeStat[a.curNode.elemId]?a.storeStat[a.curNode.elemId]:{},a.storeStat[a.curNode.elemId].stat_key=b,a.storeStat[a.curNode.elemId][b]={},a.storeStat[a.curNode.elemId][b].id=b,a.storeStat[a.curNode.elemId][b].views=[],a.storeStat[a.curNode.elemId][b].views.push(angular.copy(a.curNode)),a.storeStat[a.curNode.elemId][b].views[0].stat_key=b,p.updateStats(e.getAppID(),{app_id:e.getAppID(),name:b,description:c?c:"",formula:"",status:0}).then(function(c){"array"==typeof L.curControl.stats&&L.curControl.stats||(L.curControl.stats=[]),L.curControl.stats.push(b),a.curStats.push(c.data),a.curNoFormulaStats.unshift(c.data),a.formTest.newStatName="",a.formTest.newStatDescription="",a.saveVersions()})}},a.highlightElements=function(b){var c=[];b.forEach(function(b){if(b.position[0].activity==a.tree.activity){for(var d=b.position,e=a.treedata[d[1].offset],g=2;g<d.length&&e;g++)if(d[g].hasOwnProperty("row")){for(var h,i=0;i<e.children.length;i++){var j=e.children[i];j.row==d[g].row&&(h=j)}if(!h)return void f.warning({icon:!0,msg:"指标绑定的元素不再当前显示的区域内",top:0,time:1e3});e=h}else{var k=d[g].offset;e=e.children[k]}e&&c.push(e)}}),a.highlightedViews=c},a.showChangeElems=function(b){var c=[],d=!1;d||(c.push(b),a.highlightElements(c))},a.showStatElems=function(b){for(var c in a.allSelectedStats){var d=a.allSelectedStats[c];d!=b&&(d.selected=!1)}b.selected=!b.selected,b.selected?a.highlightElements(b.views):a.highlightElements([])},a.cleanStat=function(b,c){var e=c.id?c.id:c.name,f=_.groupBy(a.storeStat,"stat_key");d.confirm({content:"确定取消跟踪优化指标 "+e+"？相关联的所有组件的点击事件将不再跟踪。",type:"query"},function(){if(c.id)if(delete a.storeStat[a.curNode.elemId],1==f[e].length)delete a.allSelectedStats[e];else{var b=[];a.allSelectedStats[e].views.forEach(function(c){c.elemId!=a.curNode.elemId&&b.push(c)}),a.allSelectedStats[e].views=b}c.name&&(delete a.allSelectedStats[e],f[e].forEach(function(b){delete a.storeStat[b[e].views[0].elemId]}));var d=[];a.events.forEach(function(a){a.statName!=e&&d.push(a)}),a.events=d,a.curDomStat==e&&(a.curDomStat=null),a.highlightElements([]),L.saveStats()})},a.cleanElemStat=function(){if(a.curNode){var b=null,c=[];if(a.events.forEach(function(d){d.elemId!=a.curNode.elemId?c.push(d):b=d}),a.events=c,a.curDomStat=null,delete a.eventsObj[a.curNode.elemId],b){var d=a.statMap[b.statName];if(d)if(d.views.length<=1)delete a.statMap[b.statName],a.control.stats.splice(a.control.stats.indexOf(b.statName),1),o.updateExpById(a.control.id,{stats:a.control.stats});else{var e=[];d.views.forEach(function(a){a.elemId!=b.elemId&&e.push(a)}),d.views=e}}}},a.endEditing=function(){a.hoverNode={id:0},a.selectTreeItem(null),a.selectedChange=null,a.highlightElements([]);var b=a.treeScope.componentsTree.currentNode;b&&b.selected&&(b.selected=void 0);for(var c in a.statMap){var d=a.statMap[c];d.selected=!1}},a.showVersion=function(b){a.curVersion=b},L.saveStats=function(){var b={experiments_updater:{}},c=m.getValideExpsByGroup(L.curGroup);c.forEach(function(c){var d=c,e=d.flags.__autoexperiment__,f=angular.fromJson(e);f.stats=a.getStatsList(),_.isNumber(f)&&(f={});var g=_.uniq(_.concat(_.keys(a.allSelectedStats),L.storeCodeStats));f.changes=f.hasOwnProperty("changes")?f.changes:[],b.experiments_updater[d.id]={flags:{__autoexperiment__:angular.toJson(f)},stats:g}}),o.updateGroupWithExp(L.curGroup.id,b).then(function(a){})},a.saveVersions=function(){M.emit("web-logout");a.curVersion.data.changes=a.changes;var b={experiments_updater:{}};a.versions.forEach(function(c){c.data.stats=a.getStatsList();var d=angular.copy(c.data);d.changes=[];var e=angular.toJson(d),f=angular.toJson(c.data);L.storeVersionsChange[c.exp.id]="";var g=_.uniq(_.concat(_.keys(a.allSelectedStats),L.storeCodeStats));c.exp.id==a.group.control.id?b.experiments_updater[c.exp.id]={flags:{__autoexperiment__:e},stats:g}:b.experiments_updater[c.exp.id]={flags:{__autoexperiment__:f},stats:g}}),o.updateGroupWithExp(L.curGroup.id,b).then(function(a){L.curGroup=a.data,f.success({msg:"所有版本保存成功",icon:!0,time:3e3,top:0})})},a.getVersionData=function(){var b=D();return b.changes=a.changes,b},a.getStatsList=function(){var b=[],c=_.map(_.values(a.allSelectedStats),"name"),d=_.values(a.storeStat);if(0!=d.length)for(var e in d)for(var f in d[e])c.indexOf(f)<0||(delete d[e][f].views[0].properties,b.push(d[e][f].views[0]));return b},a.startPage=function(){if(a.group=L.curGroup,a.groupEditCode=a.group.id,a.group.control.isControl=!0,a.experiments=[a.group.control],a.experiments=_.concat(a.experiments,a.group.experiments),a.stats=m.getStat(L.allStats),a.group){a.experiments.forEach(function(b){var c=b.flags.__autoexperiment__;L.storeVersionsChange[b.id]=c;var d=D();c&&"string"==typeof c&&(d=angular.fromJson(c));var e={displayName:b.isControl?"原始版本":b.name,exp:b,data:d,created_at:b.created_at};b.name.startsWith("CONTROL-")&&(e.displayName="基准缺省版本",e.bControl=!0,a.control=b),a.versions.push(e),a.versions=_.orderBy(a.versions,"created_at")}),a.eventsObj={},a.events=[];var b=a.versions.length>1?a.versions[1]:a.versions[0];if(L.storeCodeStats=[],a.allSelectedStats={},b.data.stats){b.data.stats.forEach(function(b){a.allSelectedStats[b.stat_key]=a.allSelectedStats[b.stat_key]?a.allSelectedStats[b.stat_key]:{},a.allSelectedStats[b.stat_key].name=b.stat_key,a.allSelectedStats[b.stat_key].views=a.allSelectedStats[b.stat_key].views?a.allSelectedStats[b.stat_key].views:[],a.allSelectedStats[b.stat_key].views.push(b),a.storeStat[b.elemId]=a.storeStat[b.elemId]?a.storeStat[b.elemId]:{},a.storeStat[b.elemId].stat_key=b.stat_key,a.storeStat[b.elemId][b.stat_key]={},a.storeStat[b.elemId][b.stat_key].id=b.stat_key,a.storeStat[b.elemId][b.stat_key].views=a.storeStat[b.elemId][b.stat_key].views?a.storeStat[b.elemId][b.stat_key].views:[],a.storeStat[b.elemId][b.stat_key].views.push(b);var c=H(b.position);a.events.push({elemId:c,statName:b.stat_key}),I(b.stat_key,c)});var c=_.map(b.data.stats,"stat_key");L.storeCodeStats=_.pullAll(b.exp.stats,c)}if(i.expname&&a.versions.forEach(function(a){a.exp.name==i.expname&&(b=a)}),a.showVersion(b),a.changes=a.curVersion.data.changes,a.needsProps){var d=angular.toJson(a.curVersion.data);M.emit("props",d),a.needsProps=!1}a.$watch("curVersion",J)}},L.addVersionName=function(b){var c=/([0-9]+(?=_))/g,d=_.keys(a.indexOfVersions),e=angular.toJson(d),f=e.match(c),g=[];_.forEach(f,function(a){g.push(_.toNumber(a))});var h=_.max(g),i=a.group.experiments.length;return b=i>h?_.toNumber(i)+1:_.toNumber(h)+1},a.addVersion=function(){var b=a.group.experiments.length+1,c="__autoexperiment__",d=l.getExpDistantDateRange(),f={name:"试验版本_"+b+"_"+a.group.name,description:"版本 "+b,group_id:a.group.id,flags:L.curControl.flags?L.curControl.flags:{},stats:0!=L.curControl.stats.length?L.curControl.stats:[],start_date:_.toNumber(moment(d.begin).valueOf()),end_date:_.toNumber(moment(d.end).valueOf()),traffic:0,status:L.curGroup.control.status,typ:L.curGroup.typ};f.flags[c]=b||"",f.group=a.group,f.typ=L.curControl.typ,L.curControl.hasOwnProperty("layer_id")&&(f.layer_id=L.curControl.layer_id),o.creatExp(e.getAppID(),f).then(function(b){if(L.curControl.status==t.EXP_STATUS_RUN)o.updateExpById(b.data.id,{status:t.EXP_STATUS_RUN}).then(function(b){a.group.experiments.push(b.data);var c={displayName:b.data.name,exp:b.data,data:{},created_at:b.data.created_at,creatFig:!0};a.showVersion(c),a.versions.push(c),a.versions=_.orderBy(a.versions,"created_at");var d=D();d.changes=a.changes,M.emit("add_new_version"),a.changes=[]});else{a.group.experiments.push(b.data);var c={displayName:b.data.name,exp:b.data,data:{},created_at:b.data.created_at,creatFig:!0};a.showVersion(c),a.versions.push(c),a.versions=_.orderBy(a.versions,"created_at");var d=D();d.changes=a.changes,M.emit("add_new_version"),a.changes=[]}})},a.deleteVersion=function(){return a.curVersion.exp.id===L.curControl.id?d.alert({content:"原始版本不可被删除",type:"fail"}):void d.confirm({content:"确定删除测试版本 "+a.curVersion.exp.name+"？",type:"query"},function(){n.delExp(a.curVersion.exp,function(b){f.success({msg:"测试版本 "+a.curVersion.exp.name+" 已经被删除！",icon:!0,time:3e3,top:0});var c=a.versions.indexOf(a.curVersion);a.versions.splice(c,1),a.showVersion(a.versions[a.versions.length-1])})})},a.finishEditing=function(){for(var b in L.storeVersionsChange)""!=L.storeVersionsChange[b];d.confirm({content:"确定退出编辑器？未保存的操作将会丢失。",type:"query"},function(){a.uploadPhoneImage(),M.emit("web-disconnect"),M.disconnect(!0),a.backEdit()})};var U={text:"内容",text_size:"字体大小",text_color:"字体颜色",width:"宽度",height:"高度",text_gravity:"对齐",textAlignment:"对齐",padding:"边距",alpha:"透明度",background:"背景图片",image:"图片",visibility:"可见性",ellipsize:"文字滚动方式",scrollBarFadingEnbled:"滚动条",text_selectable:"文本复制",text_style:"字体设置",hint:"文本提示",paddingTop:"上边距",paddingLeft:"左边距",paddingRight:"右边距",paddingBottom:"下边距",translationX:"X位置",translationY:"Y位置",maxlines:"最大行数"};L.indexOfGravitys=_.keyBy(a.gravitys,"val"),L.indexOfTextStyles=_.keyBy(a.textStyles,"val"),a.indexOfTextStyles=L.indexOfTextStyles,L.indexOfsizes=_.keyBy(a.sizes,"val"),L.indexOfEllipsize=_.keyBy(a.ellipsizes,"val"),L.indexOfVisibiltys=_.keyBy(a.visibilitys,"val"),a.indexOfVisibiltys=L.indexOfVisibiltys,a.indexOfEllipsize=L.indexOfEllipsize,a.indexOfsizes=L.indexOfsizes,a.indexOfGravitys=L.indexOfGravitys,a.getLabelFromProperty=function(a){var b=a.properties[0].property,c=a.properties[0].value,d=a.properties[0].type;if("background"==b&&"color"==d)return"背景颜色";if("height"==b&&c<0||"width"==b&&c<0)return"尺寸";var e=U[b];return e||b},a.getURLFromProperty=function(a){var b=a.properties[0].value,c=a.properties[0].property;if("text_color"==c||"background"==c&&"color"==a.properties[0].type)return L.toRGB(b,"string");if("height"==c&&b<0||"width"==c&&b<0){var d="height"==c?"纵向":"横向";return d+L.indexOfsizes[b].label}for(var e in R)if(R[e].key===c&&R[e].dp)return b+"dp";return"text_gravity"==c?L.indexOfGravitys[b].label:"text_style"==c?L.indexOfTextStyles[b].label:"ellipsize"==c?L.indexOfEllipsize[b].label:"visibility"==c?L.indexOfVisibiltys[b].label:b;
},a.selectFiles=[],L.getSuffix=function(a){return a.indexOf(".")>-1?a.substr(a.indexOf("."),a.length):""};var V=function(b,c){a.selectFiles[b].progress={p:0},q.getUploadToken().then(function(d){var e=d.data,f=L.getSuffix(a.selectFiles[b].file.name);a.selectFiles[b].upload=j.upload({key:e.filename+f,file:a.selectFiles[b].file,token:e.token}),a.selectFiles[b].upload.then(function(a){c(a)},function(a){},function(c){a.selectFiles[b].progress.p=Math.floor(100*c.loaded/c.totalSize)})})},W=function(a,b,c){q.getUploadToken().then(function(d){var e=d.data;j.upload({dataURI:a,fileKey:b,token:e.token}).then(function(a){c(a)},function(){c()})})};a.abort=function(b){a.selectFiles[b].upload.abort(),a.selectFiles.splice(b,1)},a.resetVersion=function(){d.confirm({content:"确定要重置版本【"+a.curVersion.displayName+"】吗?所做的编辑将会丢失",type:"query"},function(){var b=D();a.changes=b.changes,M.emit("change-version",{data:b}),G();for(var c in R)a.props[R[c].key]="";f.success({msg:"重置成功",icon:!0,time:3e3,top:0})})},a.alphaSlider=function(b){a.props.alpha=b,a.controllChangeEmit("props.alpha",b)},a.onFileSelect=function(b){for(var c=a.selectFiles.length,d=0;d<b.length;d++)a.selectFiles[d+c]={file:b[d]},V(d+c,function(b){var c="http://7xldge.com2.z0.glb.qiniucdn.com/"+b.key;g(function(){a.props.bg_bitmap=c,a.controllChangeEmit("props.bg_bitmap",c)})})},a.onFileSelectFrontImage=function(b){for(var c=a.selectFiles.length,d=0;d<b.length;d++){if(a.selectFiles[d+c]={file:b[d]},a.ios){var e=b[d].name;e.indexOf("@2x.")>0?a.props.imgScale=2:e.indexOf("@3x.")>0&&(a.props.imgScale=3)}V(d+c,function(b){var c="http://7xldge.com2.z0.glb.qiniucdn.com/"+b.key;g(function(){a.props.src_bitmap=c,a.controllChangeEmit("props.src_bitmap",c)})})}},a.backEdit=function(){return K()?void window.parent.postMessage("edit-close","*"):void("app.createInfo.lists.expInfo"==L.fromState.name?c.go(a.gofromState):c.go(a.gofromState))},a.uploadPhoneImage=function(){f.success({msg:"正在退出请稍后....",icon:!0,time:13e3,top:0});var b=[],d={experiments_updater:{}};a.versions.forEach(function(a){a.shot&&b.push(a)}),0==b.length&&c.go(a.gofromState);var e=[];b.forEach(function(a){var c=a;g(function(){W(c.shot,c.exp.id,function(a){var g="http://7xldge.com2.z0.glb.qiniucdn.com/"+a.key;e.push(g),d.experiments_updater[c.exp.id]={annotation:{snapshot:g}},e.length==b.length&&o.updateGroupWithExp(L.curGroup.id,d).then(function(a){M.emit("add_new_version"),M.disconnect(!0),M.removeAllListeners(),f.removeAll()})})})})},a.controllChangeEmit=function(a,b){B(a,b,E)},a.selectArrayControllChangeEmit=function(b,c){a.props[b]=c;var d="props."+b;B(d,c,E)},a.$on("colorpicker-closed",function(a,b){if(b.value){var c=/^rgb\((0|255|25[0-5]|2[0-5]\d|1\d\d|0?\d?\d),(0|255|25[0-5]|2[0-5]\d|1\d\d|0?\d?\d),(0|255|25[0-5]|2[0-5]\d|1\d\d|0?\d?\d)\)$/;c.test(b.value)&&B(b.name,b.value,E)}}),L.closeAllPropsTerm=function(){for(var a in L.propsTermObj)L.propsTermObj.hasOwnProperty(a)&&(L.propsTermObj[a]=!1)},a.startPage(),a.$on("$destroy",function(){M.emit("web-logout"),M.removeListener(),setTimeout(function(){M.disconnect(!0)},2e3)}),a.canEditView=function(){if(!a.curView)return 1;var b=a.curView.hasOwnProperty("canEdit");return b?a.curView.canEdit:1},a.canBindView=function(){if(!a.curView)return 1;var b=a.curView.hasOwnProperty("canBind");return b?a.curView.canBind:1}}]),angular.module("abtesting").directive("phoneView",["$rootScope","Constant",function(a,b){return{restrict:"A",scope:{view:"=",hview:"=",hilightedviews:"=",screenWidth:"=sw",screenHeight:"=sh",move:"&",select:"&"},link:function(c,d,e){function f(){j.prepend(s),j.append(t)}function g(a){a.ios||(a=a.properties),p=p>0?p:0;var b=a.width,c=a.height,d=a.x,e=a.y,f=n/l,g=o/m;return{x:d/f,y:a.ios?e/g:e/g,width:b/f,height:c/g}}function h(){if(m=j.outerHeight(),"undefined"==typeof k[0].naturalHeight)throw new Error("naturalWidth not support browsers");q=k[0].naturalHeight,q&&(p=o-q)}function i(a){a.ios||(a=a.properties),m=j.outerHeight(),q=k[0].naturalHeight;var b=0;q&&(b=o-q),n=c.screenWidth,o=c.screenHeight;var b=b>0?b:0,d=a.width,e=a.height,f=a.x,g=a.y,h=n/l,i=o/m,r=p/i;return{x:f/h,y:g/i-r,width:d/h,height:e/i}}var j=$(d),k=j.find("img"),l=j.outerWidth(),m=j.outerHeight(),n=0,o=0,p=0,q=0,r=[],s=$('<div class="view-box"></div>');s.hide();var t=$('<div id="hbox" class="hover-box"></div>');t.hide(),a.$on(b.EVENT_REDNER_PHONE_VIEW,function(a,b){c.view&&b.curView&&(c.view.properties=b.curView.properties,u(c.view))}),j.on("mousemove",function(a){var b=a.offsetX,d=a.offsetY,e=j.outerHeight(),f=l,g=c.screenWidth,h=c.screenHeight;d+=a.target.offsetTop,b+=a.target.offsetLeft;var i=Math.round(g/f*b),k=Math.round(h/e*d),m=c.move();m&&m({x:i,y:k})}),j.on("mouseleave",function(a){var b=c.move();b&&b(null)});var u=function(a){if(s.hide(),c.view&&c.view.properties){h(),n=c.screenWidth,o=c.screenHeight;var b=g(c.view);s.css({top:b.y,left:b.x,width:b.width,height:b.height}),s.show()}};c.$watch("view",u),t.on("click",function(a){var b=c.select();return b&&b(),!1}),c.$watch("hview",function(){if(!c.hview||!c.hview.properties)return void t.hide();h(),n=c.screenWidth,o=c.screenHeight;var a=g(c.hview);t.css({top:a.y,left:a.x,width:a.width,height:a.height}),t.show()}),c.$watch("hilightedviews",function(){r.forEach(function(a){a.remove()}),r=[],c.hilightedviews&&c.hilightedviews.forEach(function(a){if(a.properties){var b=$('<div class="highlight-box"></div>'),c=i(a);b.css({top:c.y,left:c.x,width:c.width,height:c.height}),b.show(),j.prepend(b),r.push(b)}})}),c.testdata=1,f()}}}]).directive("treeViews",["$compile","$rootScope",function(a,b){return{restrict:"A",scope:{treeId:"=",sw:"=",sh:"=",imgw:"=",imgh:"=",treeViews:"=",nodeClick:"&"},link:function(c,d,e){var f=e.treeId,g=$(d),h=(g.find("img"),g.parent()),i=(c.sw,c.sh,h.outerWidth()),j=h.outerHeight(),k=e.nodeId||"id";"views"==k?(i=h.outerWidth(),j=h.outerHeight()):(i=e.imgw,j=e.imgh);var l=(c.treeViews,e.nodeLabel||"label"),m=e.nodeChildren||"children";e.viewTreeStatus;if(f){c[f]=c[f]||{},c[f].selectNodeHead=function(a,d){a.stopPropagation(),b.curTouchView=d,b.curTouchEvent=a,c.nodeClick(d)},c[f].mouseenterHead=function(a){var b=$(a.target);$(".mobile-touch-hover").removeClass("mobile-touch-hover"),b.addClass("mobile-touch-hover")},c[f].mouseleaveHead=function(a){var b=$(a.target);b.removeClass("mobile-touch-hover")};var n=function(){return'<div data-ng-repeat="node in treeViews" data-ng-mouseleave="'+f+'.mouseleaveHead($event)"  data-ng-mouseenter="'+f+'.mouseenterHead($event)" data-ng-click="'+f+'.selectNodeHead($event,node)" class="mobile-touch-view" data-sw="sw" data-sh="sh"  data-imgw="'+i+'" data-imgh="'+j+'" autosize><div  data-tree-id="viewChild" data-node-click="nodeClick()" class="mobile-touch-inner" data-tree-views="node.'+m+'" data-node-id='+k+" data-node-label="+l+" data-node-children="+m+' data-sw="sw" data-sh="sh" data-imgw="'+i+'" data-imgh="'+j+'"></div></div>'},o=function(){var b=n();d.html("").append(a(b)(c))},p=function(a){setTimeout(function(){var b=g.parent();return i=b.outerWidth(),j=b.outerHeight(),a()},1500)};"views"==f?c.$watch("treeViews",function(a,b){p(function(){o()})}):o()}}}}]).directive("autosize",["$compile",function(a){return{restrict:"A",scope:!1,link:function(a,b,c){function d(a){var b=a.width,c=a.height,d=a.x,e=a.y,f=g/i,k=h/j;return{x:d/f,y:e/k,width:b/f,height:c/k}}function e(a){for(var b=0,c=0,d=a.parent();d.attr("data-tree-id")&&"views"!=d.attr("data-tree-id");){d=d.parent();var e=d.position();e&&(b+=e.top,c+=e.left),d=d.parent()}return{x:c,y:b}}var f=$(b),g=(f.parent().parent(),a.sw),h=a.sh,i=a.imgw,j=a.imgh,k=a.node.properties;if(k){var l=d(k),m=e(f),n=m.y,o=m.x;n>=0&&l.y&&l.y>n&&(l.y=l.y-n),o>=0&&l.x&&l.x>o&&(l.x=l.x-o),f.css({top:l.y,left:l.x,width:l.width,height:l.height})}}}}]).directive("fullHeight",function(){return{restrict:"A",scope:{offsetH:"=",childView:"="},link:function(a,b,c){function d(){var c=a.childView?$(b).find(a.childView):$(b),d=e.outerHeight(),f=a.offsetH;c.attr("style","height:"+d-f+";")}var e=$(window);d(),e.on("resize",function(){d()}),a.$watch("offsetH",function(){d()})}}}),angular.module("abtesting").config(["$stateProvider",function(a){a.state("mobileeditor",{url:"/mobileeditor",templateUrl:"app/mobileEditor/mobileEditor.html",controller:"MobileEditorCtrl",data:{pageTitle:"编辑器 A/B Testing"},role:{noExp:!0},resolve:{curApp:["AuthApi","App",function(a,b){console.log(123);var c=b.getAppID();return console.log(45),a.getAppById(c)}],curGroup:["ExpApi","App",function(a,b){var c=b.getCurGroupId()||b.getGroupIdForCookie();return a.getGroupById(c)}],allStatsData:["DataApi","App",function(a,b){return a.getStats(b.getAppID())}]}})}]),angular.module("abtesting").factory("socket",["socketFactory","$location","ENV",function(a,b,c){var d=c.H5_URL,e=io.connect(d),f=a({ioSocket:e});return f}]),angular.module("abtesting").controller("ModalAddAutoStateCtrl",["$scope","$uibModalInstance","App","H5Api","curGroup","ExpHelper",function(a,b,c,d,e,f){var g=this;g.curApp=c.getApp(),g.curGroup=e.data,g.curControl=g.curGroup.control,g.curExps=f.getValideExpsByGroup(g.curGroup),a.exps=g.curExps,a.cancel=function(){return b.close()},a.addStat=function(a){var b=_.get(a,"annotation.base_url"),e=window.open("about:blank","_blank"),f=d.openSdk({url:b,authkey:c.getAuthKey(),appid:c.getAppID(),groupid:c.getCurGroupId(),expid:a.id,appkey:g.curApp.app_key,mode:"urlsplite"});e.location.href=f}}]),angular.module("abtesting").controller("ModalWaitingToLoginCtrl",["$scope","$state","$timeout",function(a,b,c){var d=this;a.goToLogin=function(){b.go("login")},a.time=3,d.setTime=function(){a.time--,c(function(){d.setTime()},1e3),0==a.time&&a.goToLogin()},c(function(){d.setTime()},1e3)}]),angular.module("abtesting").controller("OptionAlertCtrl",["$scope","$uibModalInstance","App","$state","ExpApi","Constant","curAudienceId",function(a,b,c,d,e,f,g){var h=this;h.selectAudienceId=g,h.defualtSelect={name:"全部受众"},h.initSelectAudices=function(b){b?a.selectAudiences=h.indexAudiences[b]:a.selectAudiences=h.defualtSelect},e.getAllAudiencesById(c.getAppID()).then(function(b){a.audiences=_.filter(b.data.audiences,function(a){return a.deleted===f.AUDIENCE_STATUS_DEF&&!_.get(a,"conditions")}),h.indexAudiences=_.keyBy(a.audiences,"id"),a.audiences.push(h.defualtSelect),h.initSelectAudices(h.selectAudienceId)}),a.power=!1;var i=c.getCurUser().features;_.findIndex(i,function(b){if("audience"===b)return void(a.power=!0)}),a.cancel=function(){b.dismiss("cancel")},a.ok=function(){return b.close(a.selectAudiences)},a.editorGroup=function(){d.go("app.config.appAudience"),b.dismiss("cancel")}}]),angular.module("abtesting").controller("PowerCtrl",["$scope","App","$timeout","Constant","ExpHelper","curGroup","allGroup","stats","clientsResults","statResults","DataHelper","DataApi","ExpApi","contextData",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b){var c=[],d=b.z_effect,e=Math.sign(b.zvalue),f=e*Math.abs(d),g=.2;_.forEach(a.exps,function(a){var b={name:"",data:[],smooth:!0,type:"line",lineStyle:{normal:{color:a.isControl?"#4183cd":"#58c584",width:1}},symbol:"none"};b.name=a.isControl?"H0":"H1";for(var d=a.isControl?0:f,e=d-4;e<d+4;e+=g){var h=k.normalDistribution(e,d,1);b.data.push([e,h])}c.push(b)});var h={name:"",data:[[b.z_min,0],[b.z_min,.5]],smooth:!1,type:"line",symbol:"none",lineStyle:{normal:{color:"#58c584",type:"dashed",width:1}}};c.push(h),h={name:"",data:[[b.z_max,0],[b.z_max,.5]],smooth:!1,type:"line",symbol:"none",lineStyle:{normal:{color:"#58c584",type:"dashed",width:1}}},c.push(h),h={name:"-δ",data:[[-b.z_detect,0],[-b.z_detect,.5]],smooth:!1,type:"line",symbol:"none",lineStyle:{normal:{color:"#d2d2d2",type:"dashed",width:1}},z:0,markPoint:{label:{normal:{show:!0,formatter:"{a}"}},symbolSize:40,data:[{coord:[-b.z_detect,.5],itemStyle:{normal:{color:"#aaa"}}}]}},c.push(h),h={name:"δ",data:[[b.z_detect,0],[b.z_detect,.5]],smooth:!1,type:"line",symbol:"none",lineStyle:{normal:{color:"#d2d2d2",type:"dashed",width:1}},z:0,markPoint:{label:{normal:{show:!0,formatter:"{a}"}},symbolSize:40,data:[{coord:[b.z_detect,.5],itemStyle:{normal:{color:"#aaa"}}}]}},c.push(h);var i=Math.sign(b.zvalue)*b.z_alpha,j=k.normalDistribution(i,0,1);h={name:"",data:[[i,0],[i,j]],smooth:!1,type:"line",symbol:"none",lineStyle:{normal:{color:"#d2d2d2",width:1}}},c.push(h),h={name:"统计功效",data:[],smooth:!0,type:"line",symbol:"none",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{}},itemStyle:{normal:{color:"#EEF9F2"}}};for(var l=e>0?i:f-4,m=e>0?f+4:i,n=l;n<m;){var o=k.normalDistribution(n,f,1);h.data.push([n,o]),n+=g,n>m&&(n=m)}c.push(h),h={name:"置信区间",data:[{name:b.ci_low.toMyPrecision(3)+"%",value:[b.z_min,.45],symbol:"triangle",symbolSize:10},{name:b.variant.toMyPrecision(3)+"%",value:[b.zvalue,.45],symbol:"circle",symbolSize:8},{name:b.ci_high.toMyPrecision(3)+"%",value:[b.z_max,.45],symbol:"triangle",symbolSize:10}],smooth:!1,type:"line",hoverAnimation:!1,itemStyle:{normal:{color:"#58c584"}},lineStyle:{normal:{color:"#58c584",type:"dotted"}},z:3,label:{normal:{show:!0,position:[10,-10],formatter:"{b}"}}},c.push(h),a.distributionData.series=c}var p=this;p.curGroup=f.data,p.stats=h.data.stats,p.clientsResults=i.data.clients,p.statResults=j.data.results,p.curControl=p.curGroup.control,p.curExps=e.getValideExpsByGroup(p.curGroup),p.curStats=_.uniqWith(e.getCurStatsByGroup(p.stats,p.curGroup),_.isEqual),p.curVaildeExp=e.getValideExpsByGroup(p.curGroup),p.curExpsId=_.map(p.curVaildeExp,"id"),p.indexStatsByName=_.keyBy(p.stats,"name"),p.indexCurVaildeExp=_.keyBy(p.curVaildeExp,"id"),p.indexClientsResults=_.keyBy(p.clientsResults,"experiment_id"),p.indexStatResults=_.groupBy(p.statResults,"stat_key"),p.indexPVResults=_.keyBy(p.indexStatResults[d.SYSTEM_STATS_PV],"experiment_id"),p.customizer=function(a,b){return _.isUndefined(a)?b:a},p.defaults=_.partialRight(_.assignWith,p.customizer()),a.indexStatsByName=p.indexStatsByName,a.group=p.curGroup,a.exps=[],p.curExps.forEach(function(b){(b.isControl||b.id==n.expId)&&(a.exps.push(b),b.id==n.expId&&(a.exp=b))}),a.curStats=p.curStats,a.curStat=n.statName?n.statName:0!=p.curStats.length?p.curStats[0].name:"",a.indexClientsResults=p.indexClientsResults,a.varianceClients="样本均值",p.groupStartTime=a.group.control.start_date,p.groupStartDate=moment.unix(p.groupStartTime);var q=moment().subtract(6,"days"),r=moment();a.datePicker={},a.datePicker.date={startDate:q,endDate:r};var s=b.getDatePickerConfig();s.ranges["开始至今"]=[p.groupStartDate,moment()],a.datePickerConfig=s,p.getDatePickerEndDate=function(){var b=moment.range(a.datePicker.date.endDate,moment()).diff("days");return 0==b?moment():a.datePicker.date.endDate},a.curStatResult=[],p.timeCompareDataByDay=k.getTimeCompareDataByDay(moment(a.datePicker.date.startDate).subtract(1,"days"),p.getDatePickerEndDate()),p.timeCompareDataByHour=k.getTimeCompareDataByHour(moment(a.datePicker.date.startDate),p.getDatePickerEndDate()),p.timeReversByDay=p.timeCompareDataByDay.dataCompleteUtc,p.timeReversByHour=p.timeCompareDataByHour.dataCompleteUtc,_.reverse(p.timeReversByDay),_.reverse(p.timeReversByHour),p.sumCurStat=function(a){var b=_.reduce(_.map(a,"sum"),function(a,b){return a+b},0);return b},p.meanCurStat=function(a,b){var c=_.reduce(_.map(b,"sum"),function(a,b){return a+b},0),d=_.reduce(_.map(a,"client_sum"),function(a,b){return a+b},0);return{mean:c/d,UV:d}},p.orderTimeGetDataHandleTemlateFun=function(b,c){a.curStatResult=[],p.sumCurStatObject={},p.clientSumObject={},p.pvSumObject={},a.curStatObject={},a.varCurStatObject={},p.sourceClientsData=b.data.daily_clients?b.data.daily_clients:b.data.hourly_clients,p.sourceDataByDay=c.data.daily_results?c.data.daily_results:c.data.hourly_results,p.indexSourceClientsData=_.groupBy(p.sourceClientsData,"experiment_id"),p.indexSourceData=_.groupBy(p.sourceDataByDay,"experiment_id"),p.indexSourceDataByStatKey=_.groupBy(p.sourceDataByDay,"stat_key"),p.timeRevers=c.data.daily_results?p.timeReversByDay:p.timeReversByHour,_.forEach(p.curExpsId,function(b){p.compareDataByDay={},p.curLineSeriesObjectClients=[],p.lineSeriesObject={name:"",type:"line",created_at:"",data:[]},p.compareSumDataByDay=c.data.daily_results?_.zipObject(p.timeCompareDataByDay.dataCompleteUtc,p.timeCompareDataByDay.dataCompleteNullData):_.zipObject(p.timeCompareDataByHour.dataCompleteUtc,p.timeCompareDataByHour.dataCompleteNullData),p.compareMeanDataByDay=c.data.daily_results?_.zipObject(p.timeCompareDataByDay.dataCompleteUtc,p.timeCompareDataByDay.dataCompleteNullData):_.zipObject(p.timeCompareDataByHour.dataCompleteUtc,p.timeCompareDataByHour.dataCompleteNullData),p.curLineSeriesObjectAllData=p.indexSourceData[b],p.curLineSeriesObjectClients=p.indexSourceClientsData[b],p.curLineSeriesObjectData=_.filter(p.curLineSeriesObjectAllData,function(b){return b.stat_key==a.curStat}),a.curStatResult=p.curLineSeriesObjectData,p.tabSum=function(){n.type==d.STATUS_MEAN||n.type==d.STATUS_TOTAL?a.varCurStatObject[b]=_.find(p.indexStatResults[a.curStat],function(a){return a.experiment_id==b})?_.find(p.indexStatResults[a.curStat],function(a){return a.experiment_id==b}).variance:0:(p.countVarianceOfUv_mean=_.find(p.indexStatResults[a.curStat],function(a){return a.experiment_id==b})?_.find(p.indexStatResults[a.curStat],function(a){return a.experiment_id==b}).uv_mean:0,a.varCurStatObject[b]=p.countVarianceOfUv_mean*(1-p.countVarianceOfUv_mean)),a.varCurStatObject[b]=Math.sqrt(a.varCurStatObject[b]),n.type==d.STATUS_MEAN||n.type==d.STATUS_TOTAL?p.sumCurStatObject[b]=_.find(p.indexStatResults[a.curStat],function(a){return a.experiment_id==b})?_.find(p.indexStatResults[a.curStat],function(a){return a.experiment_id==b}).mean:0:p.sumCurStatObject[b]=_.find(p.indexStatResults[a.curStat],function(a){return a.experiment_id==b})?_.find(p.indexStatResults[a.curStat],function(a){return a.experiment_id==b}).uv_mean:0,p.clientSumObject[b]=p.meanCurStat(p.curLineSeriesObjectClients,p.curLineSeriesObjectData).UV,p.pvSumObject[b]=p.indexPVResults[b]?p.indexPVResults[b].sum:0},p.tabSum(),a.curStatObject=p.sumCurStatObject,a.clientSumObject=p.clientSumObject,a.pvSumObject=p.pvSumObject,p.lineSeriesObjectHour=_.map(p.curLineSeriesObjectData,"hour"),p.lineSeriesObjectMean=_.map(p.curLineSeriesObjectData,"mean"),p.lineSeriesObjectSum=_.map(p.curLineSeriesObjectData,"sum"),p.sameDataSum=_.zipObject(p.lineSeriesObjectHour,p.lineSeriesObjectSum),p.sameDataMean=_.zipObject(p.lineSeriesObjectHour,p.lineSeriesObjectMean),p.defaults(p.compareSumDataByDay,p.sameDataSum),p.defaults(p.compareMeanDataByDay,p.sameDataMean),p.indexCurVaildeExp[b]&&(p.lineSeriesObject.created_at=p.indexCurVaildeExp[b].created_at),p.indexCurVaildeExp[b].isControl&&(p.lineSeriesObject.name="原始版本"),p.indexCurVaildeExp[b].isControl||(p.lineSeriesObject.name=p.indexCurVaildeExp[b].name),a.statUnit==d.STATUS_TOTAL&&(p.lineSeriesObject.data=[],_.forEachRight(p.timeRevers,function(a){p.lineSeriesObject.data.push(p.compareSumDataByDay[a])})),a.statUnit==d.STATUS_MEAN&&(p.lineSeriesObject.data=[],_.forEachRight(p.timeRevers,function(a){p.lineSeriesObject.data.push(0==p.compareMeanDataByDay[a]?0:p.compareMeanDataByDay[a].toFixed(3))}))})},p.byDay=function(c){l.getStatResultsByDaily(b.getAppID(),a.datePicker.date.startDate.hour(0).minute(0).toISOString(),p.getDatePickerEndDate().toISOString(),c).then(function(c){l.getClientsResultsByDaily(b.getAppID(),a.datePicker.date.startDate.hour(0).minute(0).toISOString(),p.getDatePickerEndDate().toISOString()).then(function(a){p.orderTimeGetDataHandleTemlateFun(a,c)})})},p.byDay(a.curStat),a.getPVResult=function(a){if(a)return p.indexPVResults[a.id]},a.getStatResult=function(a,b){if(a){var c=p.indexStatResults[b],d=_.keyBy(c,"experiment_id");return d[a.id]}},a.getOutputCi=function(a,b,c){if(a){var e=a.stat_key,f=a.experiment_id,g=p.indexStatResults[e],h=_.keyBy(g,"experiment_id"),i=h[p.curControl.id],j=p.curExps.length-1>10?10:p.curExps.length-1,l=k.getMiniKOfZBK(p.curControl),m=n.newFormula;if(!p.indexClientsResults[p.curControl.id])return null;if(p.indexClientsResults[p.curControl.id].client_sum<30||p.indexClientsResults[f].client_sum<30)return null;if(i){var o=(i.mean,a.mean,i.variance,a.variance,p.indexClientsResults[p.curControl.id].client_sum),q=p.indexClientsResults[f].client_sum;if(n.type==d.STATUS_CONVERT||n.type==d.STATUS_CONVERTRATE)var r=k.calculate_statistical_power(i,a,o,q,b,c,!1,j,l,m);else var r=k.calculate_statistical_power(i,a,o,q,b,c,!0,j,l,m);return r}}},a.control_name="CONTROL",a.stat=a.statsArray;var h=[];a.stats={},a.linedataNullTime=[],a.linedataNullDataArray=[],a.linedataNullData={data:[],name:""},a.statsArray=[],a.distriPlodata={},a.comStatsObj={},a.disLabelArray=[],a.statUnit=d.STATUS_MEAN,a.showVariance=!1,a.chartPeriodStatus=d.BY_DAY,a.mde=3,a.alpha=5,a.confidence_level=95,a.groupname=a.group.name,a.control_name=a.group.control.name,a.curExps=[a.group.control].concat(a.group.experiments),a.distributionConfig={dataLoaded:!0},a.distributionData={grid:{show:!1,left:"5%",right:"2%",bottom:"7%"},tooltip:{trigger:"axis",formatter:function(b){var c=[],d="";return angular.isArray(b)?b.forEach(function(a){var b="异常数据";if("H0"==a.seriesName||"H1"==a.seriesName)if(angular.isArray(a.data)&&(b=a.data[1]),"-"!=a.data){var d=a.seriesName+":"+b+"<br/>";c.push(d)}else{var d=a.seriesName+":0<br/>";c.push(d)}}):(d=b.seriesName+":"+a.mde+"%",_.startsWith(b.seriesName,"-")&&(d=b.seriesName+":-"+a.mde+"%")),c.forEach(function(a){d+=a}),d}},xAxis:{type:"value",splitLine:{show:!1}},yAxis:{type:"value",max:.5,axisTick:{show:!1},axisLine:{lineStyle:{color:"#d2d2d2",width:1}},splitLine:{show:!1}},legend:{right:10,data:[{name:"统计功效",icon:"roundRect"},{name:"置信区间",icon:"triangle"}]}},p.expConfidence=function(){var b=a.exp,c=a.getStatResult(b,a.curStat);b&&(b.power=a.getOutputCi(c,a.mde/100,a.alpha/100)),b&&b.power&&(b.power.variant=(b.power.ci_low+b.power.ci_high)/2,b.significance_desc=b.power.pvalue<a.alpha/100?"统计显著":"非统计显著",o(b.power))},p.expConfidence(),a.$watch("mde",function(a,b){a!==b&&(a<=0||a>=100||p.expConfidence())}),a.$watch("alpha",function(b,c){b!==c&&(b<=0||b>=100||(a.confidence_level=Math.round(100-b),p.expConfidence()))})}]),angular.module("abtesting").controller("RegisterCtrl",["$scope","$timeout","Auth","alert","$uibModal",function(a,b,c,d,e){a.subDisabled=!1,a.formTest={password:""},a.acTest=!1,a.nuTest=!1,a.enTest=!1,a.changePass=function(b){var c=/.{8,}/,d=/[\d\W]/,e=/[a-zA-Z]/;return b?(a.acTest=c.test(b),a.nuTest=d.test(b),void(a.enTest=e.test(b))):(a.acTest=!1,a.nuTest=!1,void(a.enTest=!1))},a.sub=function(){c.register(a.formTest.invitationCode,a.formTest.email,a.formTest.password,function(b){if(b.data.hasOwnProperty("error_code"))return 20005==b.data.error_code?a.disabledInvitationCodeTip="请使用接收邀请码的邮箱注册":20002==b.data.error_code?a.invalidEmailTip="邮箱已经被注册":d.alert({content:b.data.reason_display,type:"fail"});e.open({templateUrl:"app/modalWaitingToLogin/modalWaitingToLogin.html",controller:"ModalWaitingToLoginCtrl",scope:a})})},$(document).on("click",".re-send-mail",function(){if(a.waitResend){var e=$(this);a.waitResend=!1,e.addClass("mca0a0a0"),b(function(){e.removeClass("mca0a0a0"),a.waitResend=!0},3e5),c.sendActivationEmail(a.user.email,function(a){return"string"==typeof a?void d.alert({content:a,type:"fail"}):void d.alert({content:"已经重新发送激活链接到您的邮箱，请查收。"})})}})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("register",{url:"/register",templateUrl:"app/register/register.html",controller:"RegisterCtrl",role:{noAuth:!0},data:{pageTitle:"注册 A/BTesting"}})}]),angular.module("abtesting").controller("RegisterSucCtrl",["$scope","$state","$stateParams","Auth","alert",function(a,b,c,d,e){var f=c.code,g=c.email;a.subDisabled=!1,a.tip="",f&&g&&d.activate(f,g,function(b){return"string"==typeof b?void(a.tip=b):(a.tip="您的帐号已经激活。",void(a.subDisabled=!0))}),a.toLogin=function(){a.subDisabled&&b.go("login")}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("registerSuc",{url:"/register_suc/:code/:email",templateUrl:"app/registerSuc/registerSuc.html",controller:"RegisterSucCtrl",role:{noAuth:!0},data:{pageTitle:"注册成功 A/BTesting"}})}]),angular.module("abtesting").controller("retentionplusCtrl",["$scope","$stateParams","App","$timeout","DataHelper","ExpHelper","Constant","DataApi","ExpApi","DataLogic","$q",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){m.curGroup=b.data,m.curControl=m.curGroup?m.curGroup.control:null,m.curUser=c.getCurUser();var d=Math.ceil((new Date).getTime()/1e3),e=m.curControl.start_date;m.curControl.end_date;m.startDaily=e>d?0:(d-e)/24/60/60;var g=moment().subtract(20,"days"),i=moment().subtract(1,"days");a.datePicker={},a.datePicker.date={startDate:g,endDate:i},a.retentionRole=1===m.curUser.retention,a.datePickerConfig=c.getDatePickerConfig(),a.datePickerConfig.ranges["开始至今"]=[m.groupStartDate,moment()],a.group=m.curGroup,a.groupname=m.curGroup.name,a.control_name=m.curControl.name,a.curExps=_.orderBy(f.getValideExpsByGroup(b.data),"created_at"),a.curExp=0!=a.curExps.length?a.curExps[0]:{},a.selected_experiments={},a.expsObj={},a.experiments=[],a.expgroups=[],a.weekFig=!1,a.nullDataFig=!1,a.retainedRateFig=!1,a.curTimes=["日留存","周留存"],a.curTime="日留存";var k=new Date;a.lastWeek=k.getTime()-6048e5,a.detailTrendData={},a.statUnit=0,a.statUnitName="天",m.READRETENTIONRATE=0,m.READRETENTIONNUMBER=1,a.chartPeriodStatus=m.READRETENTIONRATE,a.rstat=[{name:"次日留存",description:"第 1 天",statKey:"Clients-Retained-Daily",stat_Key:"Clients-New-Daily"},{name:"第 2 天留存",description:"第 2 天",statKey:"Clients-Retained-Daily-2",stat_Key:"Clients-New-Daily"},{name:"第 3 天留存",description:"第 3 天",statKey:"Clients-Retained-Daily-3",stat_Key:"Clients-New-Daily"},{name:"第 4 天留存",description:"第 4 天",statKey:"Clients-Retained-Daily-4",stat_Key:"Clients-New-Daily"},{name:"第 5 天留存",description:"第 5 天",statKey:"Clients-Retained-Daily-5",stat_Key:"Clients-New-Daily"},{name:"第 6 天留存",description:"第 6 天",statKey:"Clients-Retained-Daily-6",stat_Key:"Clients-New-Daily"},{name:"第 7 天留存",description:"第 7 天",statKey:"Clients-Retained-Daily-7",stat_Key:"Clients-New-Daily"}],m.darwBar=function(b){a.barChartData.series=[],m.objectDawBarArray=[],_.forEach(a.curExps,function(c){var d=j.retentionDarwTab(b,c,a.datePicker.date.startDate,a.datePicker.date.endDate),e=_.keyBy(d,"hour"),f=Object.keys(e),g={name:"",data:[],type:"bar",barGap:"100%",barMaxWidth:10};c.isControl?g.name="原始版本":g.name=c.name;for(var h=1;h<=7;h++){var i=0,k=0,l="Retained"+h;_.forEach(f,function(a){var b=e[a],c=b[l];c&&"-"!=c&&(k+=b[l],i+=b.newData)});var m=k/i;m?g.data.push(m):g.data.push(0)}a.barChartData.series.push(g)}),a.barChartData.tooltip.formatter=function(a){var b="",c="";_.forEach(a,function(a){c=a.name,b+=a.seriesName+":"+(100*a.value).toMyPrecision(2)+"%<br>"});var d=c+"<br>"+b;return d},a.barChartData.yAxis[0].axisLabel.formatter=function(a,b){var c=(100*a).toMyPrecision(2)+"%";return c}},m.darwTable=function(b,c){a.retainedStats=j.retentionDarwTab(b,c,a.datePicker.date.startDate,a.datePicker.date.endDate)},m.changControlName=function(){a.group.control?a.group.control.name="原始版本":""},m.changControlName(),a.changeExp=function(){a.curExp=a.curExps[a.ratentionplustTab],m.darwTable(a.statResultData,a.curExp,moment(a.datePicker.date.startDate).subtract(1,"days"),moment().subtract(2,"days"))},a.getRate=function(a,b){return"-"==b&&""==a?"":"-"==b&&"-"==a?"-":"-"==b?"-":b&&""==a?"":b&&"-"==a?"-":(a/b*100).toMyPrecision(2)+"%"},a.getRateFig=function(a,b){return"-"==b&&""==a?"":"-"==b&&"-"==a?"-":b&&""==a?"":b&&"-"==a?"-":_.floor((a/b*100).toMyPrecision(2))},a.getWeekRate=function(a,b){if(!a&&b)return 0;if(a&&!b)return"";if(a&&b)return(a/b*100).toMyPrecision(2)+"%"},a.$watch("chartPeriodStatus",function(b,c){b!==c&&(b==m.READRETENTIONRATE&&(a.retainedRateFig=!1),b==m.READRETENTIONNUMBER&&(a.retainedRateFig=!0))}),a.datePickerConfig.applyHandler=function(b,c){m.byDay(a.curExp)},a.$watch("curTime",function(b){"日留存"==b&&(a.weekFig=!1,a.curTime=b,m.byDay(a.curExp)),"周留存"==b&&(a.weekFig=!0,a.curTime=b,m.byDay(a.curExp))}),m.byDay=function(b){h.getRetainedData(c.getAppID(),a.datePicker.date.startDate.hour(0).minute(0).second(0).millisecond(0).toISOString(),moment(a.datePicker.date.endDate).add(7,"d").hour(0).minute(0).toISOString()).then(function(b){return m.darwBar(b),0==b.data.retained_results.length?a.nullDataFig=!0:(a.statResultData=b,void m.darwTable(b,a.curExp))})}}var m=this;a.barConfig={dataLoaded:!0},a.barChartData={tooltip:{trigger:"axis"},grid:{left:"10px",right:"10px",bottom:"20px",containLabel:!0},xAxis:[{type:"category",data:["次日留存","第二天留存","第三天留存","第四天留存","第五天留存","第六天留存","第七天留存"],axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1}}],yAxis:[{type:"value",axisLine:{show:!1},axisLabel:{},axisTick:{show:!1},splitLine:{lineStyle:{width:1,color:"#eeeeee",type:"solid"}}}],series:[]},k.all([i.getGroupById(c.getCurGroupId())]).then(function(a){l(a[0])},function(){})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.data.summary.detail.retentionplus",{url:"/retentionplus",templateUrl:"app/retentionplus/retentionplus.html",controller:"retentionplusCtrl",data:{pageTitle:"试验数据 A/BTesting"}})}]),angular.module("abtesting").controller("SelectLayerCtrl",["$scope","$uibModalInstance","App","$state","ExpApi","Constant","modelGroup","DataApi","allGroup","curPageGroup","ExpHelper","$anchorScroll",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=this;m.curApp=c.getApp(),a.selectLayer={},m.getInitData=function(){m.allGroup=[],e.getAllGroup(c.getAppID()).then(function(a){m.allGroup=k.getValideGroups(a.data.groups),m.allGroupName=_.map(m.allGroup,"name")})},m.getInitData(),a.changeLayer=function(b){return m.layersCount=b.count,"defualt"===b.layerId?(a.selectLayer=b,void(a.curLayer="默认层")):"new"===b.layerId?(a.selectLayer=b,m.creatLayerFig=!0,void(a.curLayer="不互斥")):(a.curLayer=b.name,void(b.layerId!==f.LAYER_BTN_DEF_ID&&b.layerId!==f.LAYER_BTN_NEW_ID&&(a.selectLayer=b)))};var n=g;a.cloneGroupNamePlaceHolder=n.name+"_副本",a.cancel=function(){b.dismiss("cancel")},a.newok=function(){if(a.cloneGroupName||(a.cloneGroupName=a.cloneGroupNamePlaceHolder),$.inArray(a.cloneGroupName,m.allGroupName)>-1)return a.cloneGroupNameTip="名字重复";if(!a.cloneGroupName)return a.cloneGroupNameTip="请填写试验名称";a.cloneGroupName?m.newCloneGroupName=a.cloneGroupName:m.newCloneGroupName=n.name+"_副本";var c={annotation:n.annotation,app_id:n.app_id,control:n.control,description:n.description,name:m.newCloneGroupName,status:f.EXP_STATUS_DEF,typ:n.typ};if("新建层"===a.selectLayer.name)m.createLayer(c);else if("默认层"===a.selectLayer.name)c=m.addControlAndExp(c),m.cloneGroup(c);else{var d=a.selectLayer.layerId;c=m.addControlAndExp(c,d),m.cloneGroup(c)}return b.close(c)},m.createLayer=function(a){return e.insertLayer(c.getAppID(),{name:"layer"+(m.layersCount+1),app_id:c.getAppID(),status:0,typ:0,description:""}).then(function(b){a=m.addControlAndExp(a,b.data.id),m.cloneGroup(a)}),a},m.addControlAndExp=function(a,b){var c={end:_.toNumber(moment().add("10","years").format("X"))};b&&"default"!=b?(a.layer_id=b,a.control.layer_id=b):(delete a.layer_id,delete a.control.layer_id),a.control.traffic=0,a.control.status=f.EXP_STATUS_DEF,a.control.end_date=c.end,a.description="";var d=k.getVaildeExps(n.experiments);return _.forEach(d,function(d){a.hasOwnProperty("layer_id")?d.layer_id=b:delete d.layer_id,d.traffic=0,d.status=f.EXP_STATUS_DEF,d.end_date=c.end}),a.experiments=d,a},m.cloneGroup=function(a){e.insertGroup(c.getAppID(),a).then(function(a){m.selectGroupLayer(a.data),a.data.traffic=0,j.unshift(a.data),i.unshift(a.data),l()})},m.selectGroupLayer=function(a){a.layer_id&&"default"!=a.layer_id?e.getLayer(a.layer_id).then(function(b){a.layer_name=b.data.name}):a.layer_name="默认层"}}]),angular.module("abtesting").controller("StatsCtrl",["$scope","$state","$location","Constant","alert","App","DataApi","ExpApi","ExpHelper","DataHelper","AbDispacher","$uibModal","H5Api","$q","$window","dataManager","ExpLogic",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=this;r.curApp=f.getApp(),p.register(["stats","curGroupData"],function(a){
r.stats=angular.copy(a.stats),r.group=angular.copy(a.curGroupData),r.refreshData()}),p.changeState(function(a){var b=_.keys(a);b.forEach(function(b){switch(b){case"curGroupData":r.group=angular.copy(a.curGroupData),g.getStats(f.getAppID()).then(function(a){r.stats=a.data.stats,r.refreshData()})}})}),r.refreshData=function(){r.allStats=r.stats,r.curGroup=r.group,r.curControl=r.group.control,r.curGroupAllStats=i.getCurStatsByGroup(r.allStats,r.curGroup),r.curExps=i.getValideExpsByGroup(r.group),r.sendStatsData=i.getStat(j.getVaildeStats(r.stats)),r.curGroupStats=i.getStat(r.curGroupAllStats),r.curGroupComStats=i.getComStat(r.curGroupAllStats),r.indexStats=_.keyBy(r.stats,"name"),r.indexCurGroupAllStats=_.keyBy(r.curGroupAllStats,"name"),r.indexCurGroupStats=_.keyBy(r.curGroupStats,"name"),r.indexCurGroupComStats=_.keyBy(r.curGroupComStats,"name"),a.curGroupStats=r.curGroupStats,a.curGroupComStats=r.curGroupComStats,a.curGroup=r.group,r.urls=angular.fromJson(_.get(r.curControl,"annotation.urls"))||[],a.isUrlSpliteExp=r.group.typ===d.EXP_TYPE_URL,a.isShowBuilderExp=r.curApp.typ===d.APP_TYPE_H5&&r.group.typ===d.EXP_TYPE_BUILD,a.isAndroidBuilderExp=r.curApp.typ===d.APP_TYPE_ANDIOD&&r.group.typ===d.EXP_TYPE_BUILD&&r.curControl.status===d.EXP_STATUS_DEF||r.curApp.typ===d.APP_TYPE_ANDIOD&&r.group.typ===d.EXP_TYPE_BUILD&&r.curControl.status===d.EXP_STATUS_RUN,a.isIosBuilderExp=r.curApp.typ===d.APP_TYPE_IOS&&r.group.typ===d.EXP_TYPE_BUILD&&r.curControl.status===d.EXP_STATUS_DEF||r.curApp.typ===d.APP_TYPE_IOS&&r.group.typ===d.EXP_TYPE_BUILD&&r.curControl.status===d.EXP_STATUS_RUN,r.getSystemStat(),a.comlisting=!0,a.showComHelpMsg=!0},r.getSystemStat=function(){return a.curAppType===d.APP_TYPE_H5?a.sysStats=f.getSystemH5Stat():(a.sysStats=f.getSystemStat(),r.curControl&&r.curControl.stats.forEach(function(b){if(b===d.SYSTEM_STATS_VISIT||b===d.SYSTEM_STATS_CRASH||b===d.SYSTEM_STATS_DURATION){var c=j.sysStatsChangeNameToChineses(r.indexStats[b]);c&&(c.sysEvent=!0),a.sysStats.push(c)}}),a.sysStats)},a.adding=function(){f.openPenlStat("s")},a.addingComStat=function(){f.openPenlStat("ss")},a.deleteComStat=function(b,c){b.stopPropagation(),e.confirm({content:"确认删除复合指标 "+c.name+"？",type:"fail"},function(){var b=r.curControl.stats.indexOf(c.name);a.curGroupComStats.indexOf(c);r.curControl.stats.splice(b,1);var d={experiments_updater:{}};_.forEach(r.curExps,function(a){d.experiments_updater[a.id]={stats:r.curControl.stats}}),h.updateGroupWithExp(r.curGroup.id,d).then(function(a){})})},r.curSelectStats=[],a.selectStatHandler=function(b){if(r.curControl.stats.indexOf(b.name)>=0)return e.alert({content:"试验已关注指标:"+b.statName,type:"fail"});if(b.name!==d.SYSTEM_STATS_VISIT&&b.name!==d.SYSTEM_STATS_CRASH&&b.name!==d.SYSTEM_STATS_DURATION||a.sysStats.push(b),r.indexCurGroupStats[b.name])return e.alert({content:"试验已关注指标:"+b.name});r.stats.push(b);var c=r.curControl.stats;c.push(b.name);var f={experiments_updater:{}};_.forEach(r.curExps,function(a){c=_.uniqWith(c,_.isEqual),f.experiments_updater[a.id]={stats:c}}),h.updateGroupWithExp(r.curGroup.id,f).then(function(a){})},a.selectComStatHandler=function(b){if(r.indexCurGroupComStats[b.name])return e.alert({content:"试验已关注复合指标:"+b.name});var c=b.formula.match(d.COMSTATFORMULARY_MATCH_REGEXP),f=[],g=[];r.stats.push(b),_.forEach(c,function(a){"PV"!==a&&"UV"!==a&&r.curControl.stats.indexOf(a)<0&&r.indexStats[a]&&(f.push(a),g.push(r.indexStats[a]))}),r.indexCurGroupComStats[b.name]=b;var i={experiments_updater:{}};_.forEach(r.curExps,function(a){a.stats.push(b.name),a.stats=a.stats.concat(f),a.stats=_.uniqWith(_.pull(a.stats,"UV","PV"),_.isEqual),i.experiments_updater[a.id]={stats:a.stats}}),h.updateGroupWithExp(r.curGroup.id,i).then(function(c){r.indexCurGroupAllStats.hasOwnProperty(b.name)||a.curGroupComStats.push(b)})},a.removeStatHandler=function(b,c){if(b.stopPropagation(),c){var g=c.hasOwnProperty("statName")?c.statName:c.name,i="";if(_.forEach(a.curGroupComStats,function(a){var b=a.formula.match(d.COMSTATFORMULARY_MATCH_REGEXP);b.indexOf(g)>-1&&(i+=a.name+"、")}),i=i.substr(0,i.lastIndexOf("、")))return e.alert({content:"要移除优化指标："+g+"<br>复合指标:"+i+"中，引用该优化指标，删除后将影响复合指标的数值",type:"fail"});if(c.isAutoSate){if(a.isShowBuilderExp)return a.addBuilderState();if(a.isUrlSpliteExp)return a.removeURLSpiteState()}e.confirm({content:"确定要移除优化指标："+g,type:"fail"},function(){var b=_.indexOf(r.curControl.stats,c.name);r.curControl.stats.splice(b,1);var e={experiments_updater:{}};if(r.curControl.typ===d.EXP_TYPE_BUILD&&f.getAppType()===d.APP_TYPE_ANDIOD||r.curControl.typ===d.EXP_TYPE_BUILD&&f.getAppType()===d.APP_TYPE_IOS){if(f.getAppType()===d.APP_TYPE_IOS&&c.isAutoSate)return a.addIosBuilderState();if(f.getAppType()===d.APP_TYPE_ANDIOD&&c.isAutoSate)return a.addAndroidBuilderState();_.forEach(r.curExps,function(a){e.experiments_updater[a.id]={stats:r.curControl.stats}}),h.updateGroupWithExp(r.curGroup.id,e)}else _.forEach(r.curExps,function(a){e.experiments_updater[a.id]={stats:r.curControl.stats}}),h.updateGroupWithExp(r.curGroup.id,e).then(function(a){})})}},a.focusTr=function(a,b){a.$show()},a.cleanStatForm=function(a,b,c){a.stopPropagation(),b.$cancel()},a.saveStat=function(a,b){b.description=a.description,g.updateStats(f.getAppID(),b).then(function(){k.refreshStatPanel()})},a.saveComStat=function(a,b){b.description=a.description,b.formula=a.formula,g.updateStats(f.getAppID(),b).then(function(){k.refreshStatPanel()})},r.updateH5Data=function(){q.updatePageCacheData(r.curGroup)},a.addAutoState=function(){var b=l.open({templateUrl:"app/modalAddAutoState/modalAddAutoState.html",controller:"ModalAddAutoStateCtrl",size:"addautostate",scope:a,resolve:{curGroup:function(){return h.getGroupById(f.getCurGroupId())}}});b.result.then(function(){r.updateH5Data()})},a.addBuilderState=function(){var a=window.open("about:blank","_blank"),b=m.openSdk({url:r.urls[0].url,authkey:f.getAuthKey(),appid:f.getAppID(),groupid:f.getCurGroupId(),expid:r.curControl.id,appkey:r.curApp.app_key});i.bindWindowClosed(a,function(){r.updateH5Data()}),a.location.href=b},a.addAndroidBuilderState=function(){b.go("mobileeditor")},a.addIosBuilderState=function(){b.go("iosMobileEditor")},r.removeAndroidBuilderStateInFlags=function(a,b){var c=angular.fromJson(a.flags.__autoexperiment__),d=[];if(c.stats)return c.stats.forEach(function(a){a.stat_key!=b&&d.push(a)}),c.stats=d,angular.toJson(c)},a.removeURLSpiteState=function(){var a=window.open("about:blank","_blank"),b=m.openSdk({authkey:f.getAuthKey(),url:_.get(r.curControl,"annotation.base_url"),appid:f.getAppID(),groupid:f.getCurGroupId(),expid:r.curControl.id,appkey:r.curApp.app_key,mode:"urlsplite"});i.bindWindowClosed(a,function(){r.updateH5Data()}),a.location.href=b},a.isAutoState=function(a){if(!r.curControl)return!1;if(!r.curControl.hasOwnProperty("flags"))return!1;for(var b in r.curControl.flags){var c=r.curControl.flags[b];if(!c||r.curGroup.typ==d.EXP_TYPE_CODE)return!1;var e=angular.fromJson(c);if("__autoexperiment__"==b&&e.hasOwnProperty("stats")){var f=e.stats,g=_.groupBy(f,"stat_key");return!!g.hasOwnProperty(a.name)}if("__autoexperiment__"!=b&&_.isObject(e)){var h=_.values(e)[0],i=h.data.stats,j=_.groupBy(i,"statName");return!!j.hasOwnProperty(a.name)}}return!1}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.data.testdata.h5version.autostats",{url:"/autostats",templateUrl:"app/stats/stats.html",controller:"StatsCtrl",data:{pageTitle:"试验设置 A/BTesting"}}),a.state("app.data.testdata.urlversion.urlstats",{url:"/urlstats",templateUrl:"app/stats/stats.html",controller:"StatsCtrl",data:{pageTitle:"试验设置 A/BTesting"}}),a.state("app.data.testdata.version.stats",{url:"/stats",templateUrl:"app/stats/stats.html",controller:"StatsCtrl",data:{pageTitle:"试验设置 A/BTesting"}})}]),angular.module("abtesting").controller("StylesCtrl",["$rootScope","$scope","App","$filter","curGroup","AuthApi","abToast",function(a,b,c,d,e,f,g){f.getUserInfo("hfd@appadhoc.com").then(function(a){b.useInfoData=a.data}),f.getUserInfo("limenglong@appadhoc.com").then(function(a){b.useInfoData2=a.data}),b.formTest={},b.users=[{id:1,name:"awesome user1",status:2,group:4,groupName:"admin"},{id:2,name:"awesome user2",status:void 0,group:3,groupName:"vip"},{id:3,name:"awesome user3",status:2,group:null}],b.removeUser=function(a){a.stopPropagation(),console.log("remove user click event")},b.cleanForm=function(a,b){a.stopPropagation(),b.$cancel()},b.showStatus=function(a){var c=[];return a.status&&(c=d("filter")(b.statuses,{value:a.status})),c.length?c[0].text:"Not set"},b.checkName=function(a,b){return a?void console.log(a,b):"请填写内容"},b.addUser=function(){b.inserted={id:b.users.length+1,name:"",status:null,group:null},b.users.push(b.inserted)},b.statuses=[{value:1,text:"status1"},{value:2,text:"status2"},{value:3,text:"status3"},{value:4,text:"status4"}],b.tableEditdelete=function(a,b){a.stopPropagation(),console.log("del item",b)},b.tableEditSuccess=function(a){return console.log("vaild success item data",a),!0},b.showAbtoastWarning=function(){g.warning({msg:"这是测试的warning方法",icon:!0,time:3e3,top:0})},b.showAbtoastSuccess=function(){g.success({msg:"这是测试的success方法",icon:!0,time:3e3,top:0})},b.showAbtoastInfo=function(){g.info({msg:"这是测试的info方法",icon:!0,time:3e3,top:0})},b.showAbtoastDanger=function(){g.danger({msg:"这是测试的danger方法",icon:!0,time:3e3,top:0})},b.navTitles=["test1","test2","test3"],b.navTitlesObjs=[{name:"这是名字1",title:"这是导航1"},{name:"这是名字2",title:"这是导航2"},{name:"这是名字3",title:"这是导航3"}],b.testTab=function(a){b.test=a},b.abTabClickNow=0,b.abTabClick=function(){b.abTabClickNow++},b.abTabClickdata={name:"目前没点击"},b.abTabClickModel=function(a){b.abTabClickdata=a},b.curGroup=e.data,b.isSelectings=!0,b.opens=function(){c.openPenls()},b.closes=function(){c.closePenls()},b.openstat=function(){c.openPenlStat()},b.closePenlStat=function(){c.closePenlStat()},b.openstat=function(){c.openPenlStat()},b.select=function(a){b.fei=a.name};var h=["#58c0c5","#ff8181","#f0c955","#5ab87f","#5a93cf","#8d8fc3","#ed9572","#a4cb64","#56b6ba","#e37bbe","#aa97c7","#eacf7d","#86797d","#b2c326","#6188e2"];b.lineConfig={dataLoaded:!0},b.lineOption={grid:{width:200,height:200,show:!1,left:"5%",right:"2%",bottom:"5%"},dataZoom:{show:!0},tooltip:{trigger:"axis"},legend:{bottom:"-5%",data:["版本一","版本二"]},xAxis:{type:"category",boundaryGap:!1,data:["10-1","10-2","10-3","10-4","10-5","10-6","10-7","10-8","10-9","10-10","10-11","10-12","10-13","10-14","10-15","10-16","10-17","10-18","10-19","10-20","10-21","10-22","10-23","10-24","10-25","10-26","10-27","10-28","10-29","10-30","11-1","11-2","11-3","11-4","11-5","11-6","11-7","11-8","11-9","11-10","11-11","11-12","11-13","11-14","11-15","11-16","11-17","11-18","11-19","11-20","11-21","11-22","11-23","11-24","11-25","11-26","11-27","11-28","11-29","11-30","11-31","12-1","12-2","12-3","12-4","12-5","12-6","12-7"],splitLine:{show:!1,lineStyle:{width:1,color:"#d2d2d2",type:"dashed"}}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{width:1,color:"#d2d2d2",type:"dashed"}}},series:[{name:"红色版本",type:"line",data:[4.3,5.1,4.3,5.2,5.4,4.7,3.5,4.1,5.6,7.4,6.9,7.1,7.9,7.9,7.5,6.7,7.7,7.7,7.4,7,7.1,5.8,5.9,7.4,8.2,8.5,9.4,8.1,10.9,10.4,10.9,12.4,12.1,9.5,7.5,7.1,7.5,8.1,6.8,3.4,2.1,1.9,2.8,2.9,1.3,4.4,4.2,3,3,3,3,3,3,3,3,3,3,3,3]},{name:"绿色版本",type:"line",data:[0,0,0,0,0,0,0,0,.1,0,.3,0,0,.4,0,.1,0,0,0,0,0,0,0,0,0,.6,1.2,1.7,.7,2.9,4.1,2.6,3.7,3.9,1.7,2.3,3,3.3,4.8,5,4.8,5,3.2,2,.9,.4,.3,.5,.4,.4,.3,.5,.4]}],color:h},b.barConfig={dataLoaded:!0},b.barOption={tooltip:{trigger:"item"},toolbox:{show:!0},legend:{data:["Growth","Budget 2011","Budget 2012"],itemGap:0},grid:{top:"12%",left:"1%",right:"10%",containLabel:!0},xAxis:[{type:"category",data:[122314]}],yAxis:[{type:"value",name:"Budget (million USD)",axisLabel:{formatter:function(a){return a=+a,isFinite(a)?echarts.format.addCommas(+a/1e3):""}}}],series:[{name:"Budget 2011",type:"bar",data:[14]},{name:"Budget 2012",type:"bar",data:[12]}]},b.pieOption={color:h,tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{bottom:"5%",data:[]},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:[{value:335,name:"直接访问"},{value:310,name:"邮件营销"},{value:234,name:"联盟广告"},{value:135,name:"视频广告"},{value:1548,name:"搜索引擎"}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},b.message="Hello",b.items=["The first choice!","And another choice for you.","but wait! A third!"],b.tabs=[{title:"Dynamic Title 1",content:"Dynamic content 1"},{title:"Dynamic Title 2",content:"Dynamic content 2",disabled:!0}],b.singleModel=1,b.radioModel="first",b.checkResults=[],b.isCollapsed=!1,b.totalItems=64,b.currentPage=4,b.setPage=function(a){b.currentPage=a},b.pageChanged=function(){},b.maxSize=5,b.bigTotalItems=175,b.bigCurrentPage=1,b.linedata={labels:["W1","W2","W3","W4","W5","W6","W7","W8","W9","W10"],series:[[1,2,4,8,6,-2,-1,-4,-6,-2]]},b.lineopts={axisY:{offset:25,labelOffset:{y:5}}},b.areadata={labels:[1,2,3,4,5,6,7,8],series:[[1,2,3,1,-2,0,1,0],[-2,-1,-2,-1,-2.5,-1,-2,-1],[0,0,0,1,2,2.5,2,1],[2.5,2,1,.5,1,.5,-1,-2.5]]},b.areaopts=angular.extend({showArea:!0,showLine:!1,fullWidth:!0,showPoint:!1,axisX:{showLabel:!1,showGrid:!1}},b.lineopts),b.bipolardata={labels:["W1","W2","W3","W4","W5","W6","W7","W8","W9","W10"],series:[[1,2,4,8,6,-2,-1,-4,-6,-2]]},b.bardata={labels:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],series:[[5,4,3,7,5,10,3],[3,2,9,5,4,6,4]]},b.stackbardata={labels:["Q1","Q2","Q3","Q4"],series:[[8e5,12e5,14e5,13e5],[2e5,4e5,5e5,3e5],[1e5,2e5,4e5,6e5]]},b.stackbaropts={stackBars:!0,axisY:{labelInterpolationFnc:function(a){return a/1e3+"k"}}},b.stackdraw=function(a){"bar"===a.type&&a.element.attr({style:"stroke-width: 40px"})},b.piechartdata={series:[20,30,25,25],labels:["20%","30%","25%","25%"]},b.donutdata={series:[48,17,19,16],labels:["Chrome: 48%","Firefox: 17%","IE: 19%","Other: 16%"]},b.donutopts={donut:!0,donutWidth:30,startAngle:0,total:0,showLabel:!0,labelOffset:25,labelDirection:"explode"},b.donutdraw=function(a){var b=["#6e94ea","#5bb2ee","#4bdbaa","#cce386","#998f90"];"label"==a.type&&(a.element._node.style.fill=b[a.index])},b.peekdraw=function(a){"bar"===a.type&&(a.group.append(new Chartist.Svg("circle",{cx:a.x2,cy:a.y2,r:2*Math.abs(a.value)+3,style:"fill: #4bdbaa"},"ct-slice")),a.element._node.style.stroke="#4bdbaa")},b.epcOpts={size:180,lineWidth:12,lineCap:"square",barColor:"#38b4ee"},b.epcPercent=80,b.today=function(){b.dt=new Date},b.today(),b.clear=function(){b.dt=null},b.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},b.toggleMin=function(){b.minDate=b.minDate?null:new Date},b.toggleMin(),b.maxDate=new Date(2020,5,22),b.open=function(a){b.status.opened=!0},b.setDate=function(a,c,d){b.dt=new Date(a,c,d)},b.dateOptions={formatYear:"yy",startingDay:1},b.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],b.format=b.formats[0],b.status={opened:!1};var i=new Date;i.setDate(i.getDate()+1);var j=new Date;j.setDate(i.getDate()+2),b.events=[{date:i,status:"full"},{date:j,status:"partially"}],b.getDayClass=function(a,c){if("day"===c)for(var d=new Date(a).setHours(0,0,0,0),e=0;e<b.events.length;e++){var f=new Date(b.events[e].date).setHours(0,0,0,0);if(d===f)return b.events[e].status}return""}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("styles",{url:"/styles",templateUrl:"app/styles/styles.html",controller:"StylesCtrl",data:{pageTitle:"??demos A/BTesting"},rolo:{noExp:!0},resolve:{curGroup:["ExpApi","App",function(a,b){return a.getGroupById(b.getCurGroupId())}]}})}]),angular.module("abtesting").controller("SummaryCtrl",["$scope","$sce","App","ExpApi","$state","$timeout","$location","$uibModal","Constant","$filter","ExpHelper","DataHelper","DataApi","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(d,f,g,j,n){p.curGroup=d.data,p.allStats=g.data.stats,p.ClientsArray=f.data.clients,p.StatsResults=j.data.results,p.covarianceData=n.data.results,p.curExps=k.getValideExpsByGroup(p.curGroup),p.curControl=p.curGroup.control,p.curExpName=l.getVaildeStatsNameArray(p.curExps),p.groupStartTime=p.curGroup.control.start_date,p.groupStartDate=moment.unix(p.groupStartTime),p.curUser=c.getCurUser(),p.curApp=c.getApp(),p.vaildeExpId=k.getValideExpIdsByGroup(p.curGroup),p.vaildeExp=k.getValideExpsByGroup(p.curGroup),p.vaildeStats=k.getCurStatsByGroup(p.allStats,p.curGroup),p.appDefStats=k.getAppDefStatsByGroup(p.curGroup,p.allStats)?k.getAppDefStatsByGroup(p.curGroup,p.allStats):[],p.vaildeStats=_.concat(p.vaildeStats,p.appDefStats),a.importDataRole=!(!p.curUser||1!==p.curUser.importData),p.countFormulaStat=0,p.countCommonStat=0,_.forEach(p.vaildeStats,function(a){a.formula?(p.countFormulaStat++,a.orderFormulaKey=p.countFormulaStat):(p.countCommonStat--,a.orderFormulaKey=p.countCommonStat)}),p.vaildeStatsNameArray=l.getVaildeStatsNameArray(p.vaildeStats),p.vaildeStatsResults=l.getVaildeStatsResults(p.StatsResults),p.indexClientsResults=_.keyBy(p.ClientsArray,"experiment_id"),p.indexStatResults=_.groupBy(p.StatsResults,"stat_key"),p.indexCovarianceData=_.groupBy(p.covarianceData,"stat_key"),a.indexCovarianceData=p.indexCovarianceData,p.formulaStatsResults=[],p.addPVAndUVToStatResults=function(){var a=[],b=[];_.forEach(p.indexClientsResults,function(a){p.uvObject={sum:"",mean:"",uv:"",uv_mean:"",experiment_id:"",stat_key:""},p.uvObject.sum=a.client_sum,p.uvObject.mean=a.client_sum,p.uvObject.uv=a.client_sum,p.uvObject.uv_mean=a.client_sum,p.uvObject.experiment_id=a.experiment_id,p.uvObject.stat_key="UV",b.push(p.uvObject)}),a=_.forEach(_.filter(p.StatsResults,{stat_key:"Event-GET_EXPERIMENT_FLAGS"}),function(a){a.stat_key="PV"}),p.formulaStatsResults=p.formulaStatsResults.concat(b),p.formulaStatsResults=p.formulaStatsResults.concat(a),p.formulaStatsResults=p.formulaStatsResults.concat(p.StatsResults)},p.addPVAndUVToStatResults(),p.creatComStatResults=function(){_.forEach(p.vaildeStats,function(a){if(a.formulafig=!1,a.formula){a.formulafig=!0;var b="";b=a.name;var c=[];_.forEach(p.vaildeExpId,function(b){var d={experiment_id:"",mean:"",sum:"",uv_mean:"",uv:"",stat_key:""};d.formula=!0,d.experiment_id=b,d.stat_key=a.name,d.mean=l.getComputedStatValue(p.formulaStatsResults,a,b,"mean"),d.uv_mean=l.getComputedStatValue(p.formulaStatsResults,a,b,"uv_mean"),d.uv=l.getComputedStatValue(p.formulaStatsResults,a,b,"uv_sum"),d.sum=l.getComputedStatValue(p.formulaStatsResults,a,b,"sum"),c.push(d)}),_.set(p.indexStatResults,b,c)}}),p.indexPVResults=_.keyBy(p.indexStatResults[i.SYSTEM_STATS_PV],"experiment_id")},p.creatComStatResults(),p.indexStatInfo=_.keyBy(p.vaildeStatsResults,"experiment_id"),_.forEach(p.vaildeStatsNameArray,function(a){return p.sameStats=l.getStatResultsByStat(p.StatsResults,a)}),a.group=p.curGroup,a.curExp=p.curExps,a.indexClients=p.indexClientsResults,a.indexStatInfo=p.indexStatInfo,a.vaildeExpId=p.vaildeExpId,a.vaildeExp=p.vaildeExp,a.vaildeStats=p.vaildeStats,a.curAppType=c.getAppType(),a.vaildeStatsNameArray=p.vaildeStatsNameArray,a.vaildeExpAndControl=p.vaildeExp,a.statUnit=i.STATUS_MEAN,a.meanType="人均",a.meanFig=!0,a.barChartData=[];var o=l.defaultSelectedEndDate(p.curGroup),q=moment(o).subtract(6,"days"),r=c.getDatePickerConfig();a.chartPeriodStatus=i.BY_DAY,a.datePicker={},a.datePicker.date={startDate:q,endDate:o},a.datePickerConfig=r,a.helphtml=b.trustAsHtml("<b>Clients：</b>试验期间的活跃用户总数<br /><b>总值：</b>试验期间的指标统计值总和<br /><b>平均：</b>总值/Clients<br /><b>变化：</b>测试版本相对基准版本的改进百分比<br /><b>95%置信区间：</b>改进百分比的准确可信区间"),p.getDatePickerEndDate=function(){var b=moment.range(a.datePicker.date.endDate,moment()).diff("days");return 0===b?moment():a.datePicker.date.endDate},a.seriesBody=[],a.barOption={tooltip:{trigger:"item"},toolbox:{show:!0},legend:{data:[],itemGap:0},grid:{show:!1,top:"12%",left:"2%",right:"10%",bottom:"20px",containLabel:!0},xAxis:[{type:"",data:[],axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1}}],yAxis:[{type:"value",name:"",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{width:1,color:"#eeeeee",type:"solid"}}}],series:a.seriesBody},a.lineConfig={dataLoaded:!0},p.timeObj=function(){var a=moment().subtract(3,"years").format("YYYY"),b=moment(1e3*p.curControl.start_date).format("YYYY"),c=a-b;c<0&&(r.ranges["开始至今"]=[moment(1e3*p.curControl.start_date),moment()])},p.timeObj(),a.showFilter=function(a){return a.status<=1},a.curStatResult=[],p.timeCompareDataByDay=l.getTimeCompareDataByDay(moment(a.datePicker.date.startDate).subtract(1,"days"),p.getDatePickerEndDate()),p.timeCompareDataByHour=l.getTimeCompareDataByHour(moment(a.datePicker.date.startDate),p.getDatePickerEndDate()),p.timeReversByDay=p.timeCompareDataByDay.dataCompleteUtc,p.timeReversByHour=p.timeCompareDataByHour.dataCompleteUtc,_.reverse(p.timeReversByDay),_.reverse(p.timeReversByHour),p.orderTimeGetDataHandleTemlateFun=function(b){a.lineOption.xAxis.data=[],a.lineOption.series=[];var c=b.data.hourly_clients?b.data.hourly_clients:b.data.daily_clients,d=_.groupBy(c,"experiment_id");_.forEach(a.vaildeExpAndControl,function(c,e){p.compareDat=b.data.daily_clients?_.zipObject(p.timeCompareDataByDay.dataCompleteUtc,p.timeCompareDataByDay.dataCompleteNullData):_.zipObject(p.timeCompareDataByHour.dataCompleteUtc,p.timeCompareDataByHour.dataCompleteNullData);var f={name:"",data:[],created_at:c.created_at,smooth:!0,type:"line"},g=d[c.id],h=_.map(g,"hour"),i=_.map(g,"client_sum"),j=_.zipObject(h,i),k=_.partialRight(_.assignWith,a.customizer());k(p.compareDat,j),p.timeUTC=b.data.daily_clients?p.timeCompareDataByDay.dataCompleteUtc:p.timeCompareDataByHour.dataCompleteUtc,_.forEachRight(p.timeUTC,function(a){f.data.push(p.compareDat[a])}),c.isControl?f.name="原始版本":f.name=c.name,a.lineOption.series.push(f),a.lineOption.series=_.orderBy(a.lineOption.series,"created_at")}),a.lineOption.grid.left=l.getValueTypeGridLeft(a.lineOption.series),a.lineOption.xAxis.data=b.data.daily_clients?p.timeCompareDataByDay.dataCompleteTime:p.timeCompareDataByHour.dataCompleteTime},a.getPVResult=function(a){if(a)return p.indexPVResults[a.id]},a.getStatResult=function(a,b){if(a){var c=p.indexStatResults[b.name];p.indexCovarianceData[b.name]&&(c=p.indexCovarianceData[b.name]);var d=_.keyBy(c,"experiment_id");return p.indexCovarianceData[b.name]&&d&&d[a.id]?(d[a.id].sum=_.keyBy(p.indexStatResults[b.name],"experiment_id")[a.id].sum,d[a.id]=l.getCompositeStatVariance(d[a.id])):d[a.id]}},a.testStatsFormualCovariance=function(a){return l.testStatsFormualCovariance(a)},a.getOutputVar=function(b,c){if(c){var d=c.stat_key,e=(c.experiment_id,p.indexStatResults[d]),f=_.groupBy(e,"experiment_id");if(f[p.curControl.id]){var g=f[p.curControl.id][0];if(0===g.sum)return 0;var h=a.statUnit==i.STATUS_TOTAL||a.statUnit==i.STATUS_MEAN?{sum:c.sum}:{sum:c.uv};return p.indexCovarianceData.hasOwnProperty(b.name)?(g=a.getStatResult(p.curControl,b),100*(c.mean/g.mean-1)):b.formula?100*(c.sum/g.sum-1):a.statUnit==i.STATUS_CONVERTRATE||a.statUnit==i.STATUS_CONVERT?h.variance=100*(c.uv_mean/g.uv_mean-1):h.variance=100*(c.mean/g.mean-1)}}},a.getOutputCi=function(b,c){if(b){var d,e,f=b.stat_key,g=b.experiment_id,h=[];if(p.indexCovarianceData[f]?(h=p.indexCovarianceData[f],d=_.keyBy(h,"experiment_id"),e=d[p.curControl.id]):(h=p.indexStatResults[f],d=_.keyBy(h,"experiment_id"),e=d[p.curControl.id]),e){var i=.05,j=p.curExps.length-1>10?10:p.curExps.length-1,k=l.getMiniKOfZBK(p.curControl);if(!p.indexClientsResults[p.curControl.id]||!p.indexClientsResults[g])return null;if(p.indexClientsResults[p.curControl.id].client_sum<30||p.indexClientsResults[g].client_sum<30)return null;if(e.hasOwnProperty("x_avg")){var m=l.getOutputCi(b,e,p.indexClientsResults[g].client_sum,p.indexClientsResults[p.curControl.id].client_sum,i,j,k);return m}return a.statUnit==a.Constant.STATUS_CONVERTRATE||a.statUnit==a.Constant.STATUS_CONVERT?l.getOutputCi(b,e,p.indexClientsResults[g].client_sum,p.indexClientsResults[p.curControl.id].client_sum,i,j,k,l.getDistinct):a.statUnit==a.Constant.STATUS_MEAN||a.statUnit==a.Constant.STATUS_TOTAL?l.getOutputCi(b,e,p.indexClientsResults[g].client_sum,p.indexClientsResults[p.curControl.id].client_sum,i,j,k):void 0}}};a.customizer=function(a,b){return _.isUndefined(a)?b:a};a.byDay=function(){a.lineOption.xAxis.data=[],a.lineOption.series=[],m.getClientsResultsByDaily(c.getAppID(),a.datePicker.date.startDate.hour(0).minute(0).toISOString(),p.getDatePickerEndDate().toISOString()).then(function(a){p.orderTimeGetDataHandleTemlateFun(a)})},a.byHour=function(){a.lineOption.xAxis.data=[],a.lineOption.series=[],m.getClientsResultsByHourly(c.getAppID(),a.datePicker.date.startDate.hour(0).minute(0).toISOString(),p.getDatePickerEndDate().toISOString()).then(function(a){p.orderTimeGetDataHandleTemlateFun(a)})},p.darwBar=function(){a.barChartData=[];var b=l.getNonFormulaStats(p.vaildeStats);_.forEach(b,function(b){var c={},d=p.indexStatResults[b.name];_.groupBy(d,"experiment_id");c=$.extend(!0,{},a.barOption);var e=b.hasOwnProperty("statName")?b.statName:b.name;c.xAxis[0].data.push(e),_.forEach(a.vaildeExpAndControl,function(d){var e={name:"",created_at:d.created_at,data:[],type:"bar",barGap:"100%",barMaxWidth:10},f=a.getStatResult(d,b);if(d.isControl?e.name="原始版本":e.name=d.name,f){if(a.statUnit===i.STATUS_MEAN){var g;g=f.formula?f.sum?f.sum.toMyPrecision(3):0:f.mean?f.mean.toMyPrecision(3):0,e.data.push(g)}if(a.statUnit===i.STATUS_TOTAL){var h;h=f.sum?f.sum.toMyPrecision(3):0,e.data.push(h)}if(a.statUnit===i.STATUS_CONVERT){var h;h=f.uv?f.uv.toMyPrecision(3):0,e.data.push(h)}if(a.statUnit===i.STATUS_CONVERTRATE){var g;g=f.formula?f.uv?f.uv.toMyPrecision(3):0:f.uv_mean?f.uv_mean.toMyPrecision(3):0,e.data.push(g)}}else e.data.push(0);c.series.push(e),c.series=_.orderBy(c.series,"created_at")}),a.barChartData.push(c)}),a.isSummeryLoading=!0},p.expConfidence=function(){_.forEach(a.vaildeExpAndControl,function(b){b.storeExpConfidence=b.storeExpConfidence?b.storeExpConfidence:{},a.statUnit==i.STATUS_TOTAL||a.statUnit==i.STATUS_MEAN?b.PV=p.indexPVResults[b.id]?p.indexPVResults[b.id].sum:0:b.PV=p.indexPVResults[b.id]?p.indexPVResults[b.id].sum:0,_.forEach(a.vaildeStats,function(c){var d=a.getStatResult(b,c);return d?(b.storeExpConfidence[c.name]={},b.storeExpConfidence[c.name].uv_mean=d.uv_mean?d.uv_mean.toMyPrecision(3):0,b.storeExpConfidence[c.name].uv=d.uv?d.uv.toMyPrecision(3):0,b.storeExpConfidence[c.name].sum=d.sum?d.sum.toMyPrecision(3):0,b.storeExpConfidence[c.name].mean=d.mean?d.mean.toMyPrecision(3):0,b.storeExpConfidence[c.name].variant=a.getOutputVar(c,d),void(b.storeExpConfidence[c.name].cirang=a.getOutputCi(d))):b.storeExpConfidence[c.name]={uv_mean:0,sum:0,mean:0,uv:0}})})},p.expConfidence(),a.$watch("chartPeriodStatus",function(b,c){b!==c&&(b===i.BY_DAY&&a.byDay(),b===i.BY_HOUR&&a.byHour())}),r.applyHandler=function(b,c){a.chartPeriodStatus===i.BY_HOUR&&a.byHour(),a.chartPeriodStatus===i.BY_DAY&&a.byDay(),p.timeCompareDataByDay=l.getTimeCompareDataByDay(moment(a.datePicker.date.startDate).subtract(1,"days"),p.getDatePickerEndDate()),p.timeCompareDataByHour=l.getTimeCompareDataByHour(moment(a.datePicker.date.startDate),p.getDatePickerEndDate()),p.timeReversByDay=p.timeCompareDataByDay.dataCompleteUtc,p.timeReversByHour=p.timeCompareDataByHour.dataCompleteUtc,_.reverse(p.timeReversByDay),_.reverse(p.timeReversByHour)},a.$watch("statUnit",function(b,c){b!==c&&(b==i.STATUS_TOTAL&&(a.meanType="总值",a.meanFig=!1,p.addPVAndUVToStatResults(),p.creatComStatResults(),p.darwBar(),p.expConfidence()),b==i.STATUS_CONVERT&&(a.meanType="转化人数",a.meanFig=!1,p.addPVAndUVToStatResults(),p.creatComStatResults(),p.darwBar(),p.expConfidence()),b===i.STATUS_CONVERTRATE&&(a.meanType="转化率",a.meanFig=!1,p.addPVAndUVToStatResults(),p.creatComStatResults(),p.darwBar(),p.expConfidence()),b===i.STATUS_MEAN&&(a.meanType="人均",a.meanFig=!0,p.darwBar(),p.addPVAndUVToStatResults(),p.creatComStatResults(),p.expConfidence()))}),a.refresh=function(){p.darwBar(),r.applyHandler()},a.refresh(),a.importData=function(){h.open({templateUrl:"components/importDataModel/importDataModel.html",size:"526px 200px",controller:"ImportDataModelCtrl",resolve:{groupid:function(){return p.curGroup.id}}})},a.goCurVersion=function(){var a=c.getCurVersionStateName(p.curApp,p.curGroup);e.go(a)}}var p=this;a.barConfig={dataLoaded:!0},a.datePicker={},a.datePicker.date={startDate:moment(),endDate:moment()},a.lineOption={grid:{left:"2%",right:"2%",bottom:"35px",top:"8%",borderColor:"#eeeeee"},tooltip:{trigger:"axis",formatter:function(a){var b,c=[],d="";return a.forEach(function(a){b=a.name;var d=a.seriesName+":"+a.data+"<br/>";c.push(d)}),a.length===c.length&&c&&c.forEach(function(a){d+=a}),b+"<br/>"+d}},xAxis:{splitLine:{show:!1},data:[],type:"category",boundaryGap:!1,axisLine:{lineStyle:{color:"#eeeeee"}},axisTick:{lineStyle:{color:"#eeeeee"}}},yAxis:{type:"value",axisLine:{show:!1},axisLabel:{show:!0,formatter:function(a,b){return a>9999?a/1e4+"W":a}},axisTick:{show:!1},splitLine:{lineStyle:{width:1,color:"#eeeeee",type:"solid"}}},series:[]},a.isSummeryLoading=!1,n.all([d.getGroupById(c.getCurGroupId()),1!=c.getCurUser().fabian?m.getClientsResults(c.getAppID()):m.getFabianClientsResults(c.getAppID()),m.getStats(c.getAppID()),1!=c.getCurUser().fabian?m.getStatResults(c.getAppID()):m.getFabianStatResults(c.getAppID()),m.getCovariance(c.getAppID())]).then(function(a){o(a[0],a[1],a[2],a[3],a[4])},function(){})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.data.summary",{url:"/summary",templateUrl:"app/summary/summary.html",controller:"SummaryCtrl",data:{pageTitle:"???? A/BTesting"}})}]),angular.module("abtesting").controller("TestdataCtrl",["$scope","$sce","$rootScope","$location","$timeout","$uibModal","App","alert","$state","$filter","Constant","ExpHelper","ExpApi","DataHelper","DataApi","AbDispacher","$q","dataManager","abToast",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(b,c,d,j,n,o){function t(){var a=f.open({templateUrl:"app/optionalert/optionalert.html",size:"526px 200px",controller:"OptionAlertCtrl",resolve:{curAudienceId:function(){return u.curControl.audience_id}}});a.result.then(function(a){v(a)})}if(a.getConditionStr=function(a){for(var b={left_bracket:"( ",not_equal:" != ",and:" && ",right_bracket:" )",equal:" = ",or:" || ",bigger:" > ",smaller:" < "},c="",d=0,e=(a||[]).length;d<e;d++){var f=a[d];"op"===f.typ&&(c+=b[f.name]),"param"===f.typ&&(c+=f.name)}return c},b){u.curGroup=b.data,u.groups=c.data.groups,u.stats=d.data.stats,u.allLayersData=j.data.layers,u.allExpGroups=n.data.experiments,u.allAudiences=o.data.audiences,a.curAppType=g.getAppType(),u.refreshData=function(){u.defaultLayer={name:"默认层",id:"default"},u.curControl=u.curGroup.control,u.curExps=l.getValideExpsByGroup(u.curGroup),u.curStats=l.getCurStatsByGroup(u.stats,u.curGroup),u.vaildeExpId=l.getValideExpIdsByGroup(u.curGroup),u.curLayer=_.keyBy(u.allLayersData,"id")[u.curGroup.layer_id]?_.keyBy(u.allLayersData,"id")[u.curGroup.layer_id]:u.defaultLayer,u.indexAudiences=_.keyBy(u.allAudiences,"id"),a.group=u.curGroup,a.curControl=u.curControl,a.curExps=_.sortBy(u.curExps,["created_at"]),a.curStats=u.curStats,a.indexAudiences=u.indexAudiences,a.hasAudience=!!_.get(u.curControl,"audience_id"),a.curConditionStr=a.getConditionStr(_.get(u.curControl,"conditions")),a.curAudience=a.indexAudiences[a.curControl.audience_id],a.chartPeriodStatus=1,u.appValideTraffic=l.getValideTrafficByGroups(u.groups),a.totalTraffic=l.getTrafficByGroup(u.curGroup),a.cur_traffic=l.getTrafficByGroup(u.curGroup),a.elseTraffic=u.appValideTraffic,a.totalVaildTraffic=u.appValideTraffic+a.cur_traffic,_.forEach(u.allExpGroups,function(a){a.layer_id||(a.layer_id="default")})},u.refreshData(),r.changeState(function(a){var b=_.keys(a);b.forEach(function(b){switch(b){case"curGroupData":u.curGroup=a.curGroupData;break;case"stats":u.stats=a.stats;break;case"allLayersData":u.allLayersData=a.allLayersData}}),u.refreshData()}),u.startAndStopPublish=function(b,c){var d;for(var e in b.control.flags)b.control.flags.hasOwnProperty(e)&&(d=encodeURI(e));
a.curAppType===k.APP_TYPE_H5&&c==k.EXP_STATUS_RUN&&b.typ!=k.EXP_TYPE_CODE&&m.updateFlageById(g.getAppID(),{default_value:"{}"},d);var f={experiments_updater:{},group_updater:{status:c}};_.forEach(u.curExps,function(a){f.experiments_updater[a.id]={status:c}}),m.updateGroupWithExp(a.group.id,f).then(function(a){g.setExp(a.data),p.refreshActionbarCtrl(),p.refreshSlideMenu(),a.data.status==k.EXP_STATUS_RUN&&(s.success({icon:!0,msg:"试验已经开始运行，稍后可查看试验数据",top:0,time:2e3}),g.openGroup(u.curGroup))})},u.pieItemData={name:"流量",type:"pie",radius:[0,50],center:["50%","50%"],label:{normal:{show:!1},emphasis:{show:!1}},lableLine:{normal:{show:!1},emphasis:{show:!0}},data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}},a.pieOptionOfLayer=function(){var b=[],c=[];u.layersId=[],u.layerTemplateData=[],u.useExpData=_.filter(u.allExpGroups,function(a){return 3!==a.status&&5!==a.status&&4!==a.status}),u.useGroupData=_.filter(u.groups,function(a){return 3!=a.status&&5!=a.status&&4!=a.status}),_.forEach(u.useExpData,function(a){a.layer_id||(a.layer_id="default")}),_.forEach(u.useGroupData,function(a){a.layer_id||(a.layer_id="default")}),u.indexExp=_.groupBy(u.useExpData,"group_id"),u.indexGroup=_.groupBy(u.useGroupData,"layer_id"),u.indexGroupById=_.keyBy(u.useGroupData,"id"),u.curLayerId=u.curGroup.layer_id?u.curGroup.layer_id:"default",_.forEach(u.useGroupData,function(a){a.traffic=_.sum(_.map(u.indexExp[a.id],"traffic"))});var d=u.indexGroup[u.curLayerId];u.surLayerTraffic=100-_.sum(_.map(d,"traffic")),_.forEach(d,function(a){var c=a.name;a.id!==u.curGroup.id&&b.push({name:c,value:a.traffic})}),_.forEachRight(u.curExps,function(a){var d=a.name,e={name:"",icon:"circle"};a.isControl&&(d="原始版本"),e.name=d,c.push(e),b.unshift({name:d,value:a.traffic})}),b.push({name:"剩余流量",value:u.surLayerTraffic,itemStyle:{normal:{color:"#eee"},emphasis:{color:"#eee"}}}),u.pieItemData.data=b,a.pieOption.series=[],a.pieOption.series.push(u.pieItemData),a.vaildLayerTraffic=u.indexGroupById[u.curGroup.id]?u.surLayerTraffic+u.indexGroupById[u.curGroup.id].traffic:u.surLayerTraffic,a.pieOption.legend={orient:"vertical",align:"left",top:"bottom",data:[]},a.pieOption.title.text=u.curLayer?u.curLayer.name:""},a.pieOptionOfLayer(),u.createPieDataTable=function(){var a=[];_.forEach(u.curExps,function(b){var c=b.name;b.isControl&&(c="原始版本"),a.push({name:c,value:b.traffic})})},u.createPieDataTable(),a.itemChange=function(b){a.editStatus=!0;var c=0,d=0;if(b.maxTrafficFig=!1,b.traffic.match(/\D/g))return b.maxTrafficFig=!0,b.tipError="请填写数字",b.traffic=0;""==b.traffic&&(b.traffic=0),b.traffic=_.toNumber(b.traffic);var e=_.filter(u.curExps,function(a){return a.id!=b.id});_.forEach(e,function(a){d+=_.toNumber(a.traffic)}),_.forEach(u.curExps,function(a){c+=_.toNumber(a.traffic)}),a.totalTraffic=c,c>a.vaildLayerTraffic&&(b.traffic=a.vaildLayerTraffic-d,a.totalTraffic=a.vaildLayerTraffic,b.maxTrafficFig=!0,b.tipError="最大可用流量"+b.traffic+"%")},a.launch=function(b){var c=f.open({animation:!0,templateUrl:"components/checkPwdModel/checkPwdModel.html",controller:"CheckPwdModelCtrl",windowClass:"modal-alert",size:"lg",resolve:{exp:function(){return b},content:function(){return"确定要发布试验版本"+b.name+"吗？<br>发布后，所有用户将会进入此版本。操作不可回滚!"}}});c.result.then(function(){var c=[];for(var d in b.flags){var e=encodeURI(d);c.push(m.updateFlageById(g.getAppID(),{default_value:b.flags[d]},e))}q.all(c).then(function(){var c={experiments_updater:{},group_updater:{status:k.EXP_STATUS_PUBLISH}};_.forEach(u.curExps,function(a){a.id!=b.id?c.experiments_updater[a.id]={status:k.EXP_STATUS_STOP}:c.experiments_updater[a.id]={status:k.EXP_STATUS_PUBLISH}}),m.updateGroupWithExp(a.group.id,c).then(function(a){p.refreshActionbarCtrl(),i.reload("app.data.testdata")})})})},a.startCampaign=function(){return 0==_.keys(a.group.control.flags).length||0==a.group.control.stats.length?h.alert({content:"您还未设置优化指标/变量",type:"fail"}):void h.confirm({content:"确定运行试验 "+a.groupname+" 中所有测试版本？",type:"query"},function(){var b=a.group;b.status=k.EXP_STATUS_RUN,b.start_date=Math.round(Date.now()/1e3),u.startAndStopPublish(b,k.EXP_STATUS_RUN)})},a.stopCampaign=function(){var b=a.group;return b.status==k.EXP_STATUS_STOP||b.status==k.EXP_STATUS_PUBLISH?void h.alert({type:"fail",content:"试验活动已经过期或结束"}):void h.confirm({type:"fail",content:"确定立刻结束试验活动 "+b.name+"？试验中所有测试版本都将结束。"},function(){var b=a.group;b.status=k.EXP_STATUS_STOP,b.start_date=Math.round(Date.now()/1e3),u.startAndStopPublish(b,k.EXP_STATUS_STOP)})},a.updateDescription=function(){e(function(){m.updateGroupById(a.group.id,{description:a.group.description}).then(function(a){})},300)},a.saveAll=function(){h.confirm({content:"确定更改试验流量?",type:"query"},function(){var b={experiments_updater:{}};_.forEach(u.curExps,function(a){b.experiments_updater[a.id]={traffic:a.traffic}}),m.updateGroupWithExp(a.group.id,b).then(function(a){i.reload()})})},a.filterPublish=function(a){return a.status==k.EXP_STATUS_PUBLISH};var v=function(b){var c=u.curExps;b.name==k.ADCANCED_ALL&&(b.id="",b.new_conditions=[]);var d={experiments_updater:{}};_.forEach(c,function(a){d.experiments_updater[a.id]={},d.experiments_updater[a.id]={audience_id:b.id,conditions:b.new_conditions}}),m.updateGroupWithExp(a.group.id,d).then(function(a){i.reload("app.data.testdata")})};a.optionAlert=function(){return a.curControl.status!==k.EXP_STATUS_DEF?h.alert({content:"为保证试验结果的准确性，在试验开始运行后，不可以更改定向设置。",type:"fail"}):void t()},a.editStatus=!1,a.resetAll=function(){i.reload()},u.updateH5Data=function(){var a=u.curGroup,b={group_updater:{}};b.group_updater[a.id]={id:a.id},m.updateGroupWithExp(u.curGroup.id,b)}}}var u=this;a.pieConfig={dataLoaded:!0},a.pieOption={tooltip:{show:!0,formatter:"{a} <br/>{b} : {c} ({d}%)",position:["50%","50%"]},title:{bottom:0,x:"36%",textStyle:{color:"#313131",fontSize:14}},legend:{data:[]},series:[]},a.curExps=[],a.avgTraffic=function(b){if(a.editStatus=!0,_.isUndefined(b))return a.totalTraffic=0;var c=b;if(0==b)return _.forEach(u.curExps,function(a){a.traffic=0}),a.totalTraffic=0;a.elseTraffic=a.vaildLayerTraffic-c,u.expTraffic=c/u.curExps.length,_.forEach(u.curExps,function(a){a.traffic=Math.floor(u.expTraffic)});var d=_.toString(u.expTraffic);d.indexOf(".")&&(c>a.totalTraffic&&(u.expTraffic=Math.floor(u.expTraffic),_.forEach(u.curExps,function(a){a.traffic=u.expTraffic}),a.totalTraffic=_.sum(_.map(u.curExps,"traffic"))),c<a.totalTraffic&&(u.expTraffic=Math.floor(u.expTraffic),_.forEach(u.curExps,function(a){a.traffic=u.expTraffic}),a.totalTraffic=_.sum(_.map(u.curExps,"traffic"))))},q.all([m.getGroupById(g.getCurGroupId()),m.getAllGroup(g.getAppID()),o.getStats(g.getAppID()),m.getAllLayers(g.getAppID()),m.getAllExp(g.getAppID()),m.getAllAudiencesById(g.getAppID())]).then(function(a){t(a[0],a[1],a[2],a[3],a[4],a[5])},function(){})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.data.testdata",{url:"/testdata",templateUrl:"app/testdata/testdata.html",controller:"TestdataCtrl",data:{pageTitle:"运行控制 A/BTesting"}})}]),angular.module("abtesting").controller("UrlCtrl",["$scope",function(a){a.message="Hello"}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.url",{url:"/url",templateUrl:"app/url/url.html",controller:"UrlCtrl"})}]),angular.module("abtesting").controller("UrllistsCtrl",["$scope","$state","$timeout","Constant","ExpHelper","ExpApi","App","H5Api","alert","$q","abToast","toScroll","DataHelper","curGroup","dataManager","ExpLogic",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this;q.curGroup=n.data,q.curExps=e.getValideExpsByGroup(q.curGroup),q.storeOriginCurExps=angular.copy(q.curExps),q.indexOfOriginCurExps=_.keyBy(q.storeOriginCurExps,"id"),q.curUrlSpliteKey="",a.DEFAULT_MODE=1,a.REGEXP_MODE=2,a.mode=a.REGEXP_MODE,a.initURLObj=function(a){a&&a.mode||(a.mode="equal")},a.addPage=function(){var b={mode:"",url:"",regexp:""};a.urls.push(b)},a.curControl=e.getControl(q.curExps),q.urls=angular.fromJson(_.get(a.curControl,"annotation.urls"))||[],a.urls=q.urls,a.urls.length||a.addPage(),q.getCurExps=function(){return a.curControl?void(a.curExps=a.curControl.hasOwnProperty("annotation")?q.curExps:[a.curControl]):a.curExps=[]},q.getCurExps(),q.getVersionTmpl=function(){var b=q.curGroup.experiments.length+1,c={name:"试验版本_"+b+"_"+q.curGroup.name,description:"",traffic:0,start_date:moment().valueOf(),end_date:moment().add(10,"years").valueOf(),flags:{},summary_conditions:{},custom_conditions:{},group_id:q.curGroup.id,stats:a.curControl.stats,typ:q.curGroup.control.typ};return a.curControl.layer_id&&(c.layer_id=a.curControl.layer_id),c},q.addNewFlag=function(a,b){var c={name:a,app_id:g.getAppID(),description:"Version of test pages in splite url",typ:"String",default_value:"{}"};f.createFlag(g.getAppID(),c).then(function(a){return b(a.data)})},q.getCurFlagKey=function(b){a.curControl.annotation.base_url=e.autoComplateURL(a.curControl.annotation.base_url);var c=encodeURIComponent(a.curControl.annotation.base_url),d="_"+c+"_";return _.hasIn(a.curControl.flags,d)?b({name:d}):void q.addNewFlag(d,function(a){return b(a.hasOwnProperty("error_code")&&10008===a.error_code?{name:d}:a)})},q.snapshotVersion=function(a,b){h.verSnapshot({url:a,name:b,type:"web"})},q.saveVersions=function(b){q.getCurFlagKey(function(c){q.curUrlSpliteKey=c.name;var d={experiments_updater:{}};_.forEach(a.curExps,function(a){a=q.toFlagJson(a,a.isControl);var b=q.comparePostChange(a);b.hasOwnProperty("base_url")&&(b.flags=a.flags),d.experiments_updater[a.id]=b}),f.updateGroupWithExp(q.curGroup.id,d).then(function(c){if(_.forEach(a.curExps,function(a){var b=_.get(a,"annotation.base_url");b&&q.snapshotVersion(b,a.id)}),b&&"function"==typeof b)return b()})})},a.controlURL,q.toFlagJson=function(b,c){var d=_.get(b,"annotation.base_url");c&&(a.controlURL=d),a.controlURL?a.controlURL:a.controlURL=a.curControl.annotation.base_url,q.curUrlSpliteKey="_"+encodeURIComponent(a.controlURL)+"_";var e=angular.fromJson(b.flags[q.curUrlSpliteKey]),f=e&&e.hasOwnProperty(a.controlURL)?_.get(e[a.controlURL],"data.stats"):[],g={mode:a.urls[0].mode,regexp:a.urls[0].regexp,url:a.controlURL,data:{newPageUrl:c?"":d,stats:[]}};f&&f.length>0&&(g.data.stats=f);var h={};return h[a.controlURL]=g,b.flags={},b.flags[q.curUrlSpliteKey]=angular.toJson(h),b},a.addVersion=function(){if(!(a.curExps.length<1)){var b=[],c=q.getVersionTmpl();a.curExps.forEach(function(a){a.hasOwnProperty("id")||b.push(a)}),1!=b.length&&a.curExps.push(c)}},a.delVersion=function(a){i.confirm({content:"确定要删除选择版本?"},function(){f.deleteExpById(a.id).then(function(){p.updatePageCacheData(q.curGroup)})})},a.nextStep=function(a){l.goAnchor("expinfo")},q.create=function(a,b){a&&(a.hasOwnProperty("form")&&delete a.form,f.creatExp(g.getAppID(),a).then(function(a){return b(a.data)}))},a.checkName=function(b,c){if(!b)return"试验名称必填";c.name=b;var d=_.filter(_.groupBy(a.curExps,"name"),function(a){return a.length>1});if(d.length>0)return"实验名称不能重复";var e=/^[\u4e00-\u9fa5A-Za-z][\u4e00-\u9fa5a-zA-Z0-9_]*$/;return e.test(b)?void 0:"请输入合法的试验名称"},a.checkURL=function(a){if(!a)return"URL必须填写";var b=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return b.test(a)?void 0:"请填写正确的URL地址"},q.comparePostChange=function(b,c){var d={};if(!b.hasOwnProperty("id"))return b;if(q.indexOfOriginCurExps[b.id].name!=b.name&&(d.name=b.name),q.indexOfOriginCurExps[b.id].description!=b.description&&(d.description=b.description),!q.indexOfOriginCurExps[b.id].hasOwnProperty("annotation"))return b.annotation.hasOwnProperty("base_url")&&(d.annotation={},d.annotation.base_url=b.annotation.base_url),d.annotation.urls=angular.toJson(a.urls),d;if(q.indexOfOriginCurExps[b.id].hasOwnProperty("annotation")){if(!q.indexOfOriginCurExps[b.id].annotation.hasOwnProperty("base_url"))return d.annotation.base_url=b.annotation.base_url,d;if(q.indexOfOriginCurExps[b.id].annotation.hasOwnProperty("base_url")&&q.indexOfOriginCurExps[b.id].annotation.base_url!=b.annotation.base_url)return d.annotation={},d.annotation.base_url=b.annotation.base_url,d}return d},a.saveExp=function(b,c){if(!c.isControl&&!_.get(a.curControl,"annotation.base_url"))return k.warning({msg:"请先填写对照版本的URL"}),"请先填写对照版本URL";var d=q.comparePostChange(c);if(c.id){if(!d.hasOwnProperty("base_url")){var e={experiments_updater:{}};return e.experiments_updater[c.id]=d,d.hasOwnProperty("annotation")&&(c=q.toFlagJson(c,c.isControl),d.flags=c.flags),f.updateGroupWithExp(q.curGroup.id,e).then(function(a){q.getCurExps()})}q.saveVersions()}else c=q.toFlagJson(c,c.isControl),q.create(c,function(b){p.updatePageCacheData(q.curGroup);var d=a.curExps.indexOf(c);d>-1&&(a.curExps[d]=b)})},a.cancel=function(b){if(!b.id){var c=a.curExps.indexOf(b);c>-1&&a.curExps.splice(c,1)}b.form.$cancel()},a.isExistNum=function(b){var c="";return a.curExps.forEach(function(a){c+=a.name}),c.indexOf(b)},a.copy=function(){var b=document.getElementById("copy-url-sdk");b.select(),document.execCommand("Copy"),a.copyTextTip="成功复制"},a.$watch("copyTextTip",function(){c(function(){a.copyTextTip=""},3e3)}),a.addVersionFig=function(){var b=!0;return 1!=a.curExps.length||a.curExps[0].hasOwnProperty("annotation")?a.curExps.length>=2&&a.curExps[1].hasOwnProperty("id")&&!a.curExps[1].hasOwnProperty("annotation")?b=!1:b:b=!1},o.changeState(function(b){var c=_.keys(b);c.forEach(function(c){switch(c){case"curGroupData":q.curGroup=angular.copy(b.curGroupData),q.curExps=e.getValideExpsByGroup(q.curGroup),a.curControl=e.getControl(q.curExps),q.indexOfOriginCurExps=_.keyBy(angular.copy(q.curExps),"id"),q.getCurExps()}})})}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.createInfo.url",{url:"/url",templateUrl:"app/urllists/urllists.html",controller:"UrllistsCtrl",data:{pageTitle:"试验版本 A/BTesting"},role:{noExp:!0},resolve:{curGroup:["App","ExpApi",function(a,b){return b.getGroupById(a.getCurGroupId())}]}})}]),angular.module("abtesting").controller("UrlversionCtrl",["$scope","$timeout","$state","Constant","alert","H5Api","ExpApi","App","ExpHelper","$q","DataHelper","curGroup","dataManager","ExpLogic",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.mode=a.REGEXP_MODE;var o=this;m.changeState(function(a){var b=_.keys(a);b.forEach(function(b){switch(b){case"curGroupData":o.curGroup=angular.copy(a.curGroupData),o.refreshData()}})}),o.curGroup=angular.copy(l.data),o.refreshData=function(){o.curExps=i.getValideExpsByGroup(o.curGroup),o.storeOriginCurExps=angular.copy(o.curExps),o.indexOfOriginCurExps=_.keyBy(o.storeOriginCurExps,"id"),o.curUrlSpliteKey="",a.curGroup=o.curGroup,a.curExps=o.curExps,a.copyTextTip="",a.curControl=i.getControl(a.curExps),o.urls=angular.fromJson(_.get(a.curControl,"annotation.urls"))||[],a.urls=o.urls,a.urls[0]&&a.urls[0].mode&&(a.mode=a.urls[0].mode),a.editMode=!1},o.refreshData(),o.getVersionTmpl=function(){for(var b=a.curExps.length;a.isExistNum(b)>-1;)++b;var c={annotation:{base_url:""},start_date:moment().valueOf(),end_date:moment().add(10,"years").valueOf(),name:"试验版本_"+b+"_"+o.curGroup.name,description:"",traffic:0,flags:{},summary_conditions:{},custom_conditions:{},group_id:o.curGroup.id,stats:a.curControl.stats,status:a.curControl.status,typ:a.curControl.typ};return a.curControl.layer_id&&(c.layer_id=a.curControl.layer_id),c},o.addNewFlag=function(a,b){var c={name:a,app_id:h.getAppID(),description:"Version of test pages in splite url",typ:"String",default_value:"{}"};g.createFlag(h.getAppID(),c).then(function(a){return b(a.data)})},o.snapshotVersion=function(a,b){f.verSnapshot({url:a,name:b,type:"web"})},o.getCurFlagKey=function(b){a.curControl.annotation.base_url=i.autoComplateURL(a.curControl.annotation.base_url);var c=encodeURIComponent(a.curControl.annotation.base_url),d="_"+c+"_";return _.hasIn(a.curControl.flags,d)?b({name:d}):void o.addNewFlag(d,function(a){return b(a.hasOwnProperty("error_code")&&10008===a.error_code?{name:d}:a)})},o.saveVersions=function(b){o.getCurFlagKey(function(c){o.curUrlSpliteKey=c.name;var d={experiments_updater:{}};_.forEach(a.curExps,function(a){a=o.toFlagJson(a,a.isControl),d.experiments_updater[a.id]=a}),g.updateGroupWithExp(o.curGroup.id,d).then(function(c){if(_.forEach(a.curExps,function(a){var b=_.get(a,"annotation.base_url");b&&o.snapshotVersion(b,a.id)}),b)return b()})})},o.toFlagJson=function(b,c){var d=_.get(b,"annotation.base_url");c&&(a.controlURL=d),a.controlURL?a.controlURL:a.controlURL=a.curControl.annotation.base_url,o.curUrlSpliteKey="_"+encodeURIComponent(a.controlURL)+"_";var e=angular.fromJson(b.flags[o.curUrlSpliteKey]),f=e&&e.hasOwnProperty(a.controlURL)?_.get(e[a.controlURL],"data.stats"):[],g={mode:a.urls[0].mode,regexp:a.urls[0].regexp,url:a.controlURL,data:{newPageUrl:c?"":d||"",stats:[]}};f&&f.length>0&&(g.data.stats=f);var h={};return h[a.controlURL]=g,b.flags={},b.flags[o.curUrlSpliteKey]=angular.toJson(h),b},a.addVersion=function(){if(!(a.curExps.length<1)){var b=[],c=o.getVersionTmpl();a.curExps.forEach(function(a){a.hasOwnProperty("id")||b.push(a)}),1!=b.length&&a.curExps.push(c)}},a.delVersion=function(a){e.confirm({content:"确定要删除选择版本?"},function(){g.deleteExpById(a.id).then(function(){n.updatePageCacheData(o.curGroup)})})},a.save=function(b){var c=_.filter(_.groupBy(a.curExps,"name"),function(a){return a.length>1});return c.length>0?e.alert({content:"实验名称不能重复",type:"fail"}):void(b.$valid&&o.saveVersions(function(){a.editMode=!1}))},a.edit=function(){a.editMode=!0},a.copy=function(){var b=document.getElementById("df");b.select(),document.execCommand("Copy"),a.copyTextTip="成功复制"},a.$watch("copyTextTip",function(){b(function(){a.copyTextTip=""},3e3)}),o.create=function(b,c){delete b.form;g.creatExp(h.getAppID(),b).then(function(b){if(a.curControl.status!==d.EXP_STATUS_RUN)return c(b.data);var e={};_.forEach(a.curExps,function(a){e[a.id]={status:d.EXP_STATUS_RUN}})})},a.checkName=function(b,c){if(!b)return"试验名称必填";c.name=b;var d=_.filter(_.groupBy(a.curExps,"name"),function(a){return a.length>1});if(d.length>0)return"实验名称不能重复";var e=/^[\u4e00-\u9fa5A-Za-z][\u4e00-\u9fa5a-zA-Z0-9_]*$/;return e.test(b)?void 0:"请输入合法的试验名称"},a.checkURL=function(a){if(!a)return"URL必须填写";var b=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return b.test(a)?void 0:"请填写正确的URL地址"},o.comparePostChange=function(a){var b={};return a.hasOwnProperty("id")?(o.indexOfOriginCurExps[a.id].name!=a.name&&(b.name=a.name),o.indexOfOriginCurExps[a.id].description!=a.description&&(b.description=a.description),o.indexOfOriginCurExps[a.id].hasOwnProperty("annotation")&&(o.indexOfOriginCurExps[a.id].annotation.hasOwnProperty("base_url")||(b.annotation.base_url=a.annotation.base_url),o.indexOfOriginCurExps[a.id].annotation.hasOwnProperty("base_url")&&o.indexOfOriginCurExps[a.id].annotation.base_url!=a.annotation.base_url&&(b.annotation={},b.annotation.base_url=a.annotation.base_url)),b):a},a.saveExp=function(b,c){if(!c.isControl&&!_.get(a.curControl,"annotation.base_url"))return abToast.warning({msg:"请先填写对照版本的URL"}),"请先填写对照版本URL";var d=o.comparePostChange(c);if(c.id){if(!d.hasOwnProperty("base_url")){var e={experiments_updater:{}};return e.experiments_updater[c.id]=d,c=o.toFlagJson(c,c.isControl),d.flags=c.flags,g.updateGroupWithExp(o.curGroup.id,e)}o.saveVersions()}else o.curUrlSpliteKey="_"+encodeURIComponent(a.curControl.annotation.base_url)+"_",c=o.toFlagJson(c,c.isControl),o.create(c,function(b){var d=a.curExps.indexOf(c);d>-1&&(a.curExps[d]=b)})},a.cancel=function(b){if(!b.id){var c=a.curExps.indexOf(b);c>-1&&a.curExps.splice(c,1)}b.form.$cancel()},a.isExistNum=function(b){var c="";return a.curExps.forEach(function(a){c+=a.name}),c.indexOf(b)}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.data.testdata.urlversion",{url:"/urlversion",templateUrl:"app/urlversion/urlversion.html",controller:"UrlversionCtrl",data:{pageTitle:"版本管理 A/BTesting"},resolve:{curGroup:["App","ExpApi",function(a,b){return b.getGroupById(a.getCurGroupId())}]}})}]),angular.module("abtesting").controller("VersionCtrl",["$scope","$state","$timeout","App","ExpHelper","ExpApi","alert","abToast","Constant","$q","AbDispacher","DataHelper","dataManager","ExpLogic",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=this;m.register(["curGroupData","flags"],function(a){o.flags=a.flags,o.curGroup=a.curGroupData,o.refreshData()}),a.curExps=[],m.changeState(function(a){var b=_.keys(a);b.forEach(function(b){switch(b){case"flags":o.flags=a.flags;break;case"curGroupData":o.curGroup=a.curGroupData}}),o.refreshData()}),o.refreshData=function(){o.curFlags=e.getValideFlagByGroup(o.flags,o.curGroup),o.curAllExpId=_.map(a.curExps,"id"),o.indexCurExps=_.groupBy(a.curExps,"id"),a.curGroup=o.curGroup,a.curFlags=o.curFlags,a.curControl=a.curGroup?a.curGroup.control:"",o.curLayerId=a.curControl.hasOwnProperty("layer_id")?a.curControl.layer_id:"",a.curExps=e.getValideExpsByGroup(a.curGroup),o.originCurExps=angular.copy(a.curExps),o.indexOriginCurExps=_.keyBy(o.originCurExps,"id"),o.expNames=_.keyBy(a.curExps,"name"),a.vaildeflags=_.flattenDepth(e.getVaildeFlags(o.flags),1),o.newExpStats=o.curGroup.hasOwnProperty("control")?o.curGroup.control.stats:"",o.newStatus=o.curGroup.hasOwnProperty("control")?o.curGroup.control.stats:"",o.newExpCustorm=o.curGroup.hasOwnProperty("control")?o.curGroup.control.conditions:"",o.newExpSummary=o.curGroup.hasOwnProperty("control")?o.curGroup.control.summary_conditions:"",o.getNewExpFlag()},o.getNewExpFlag=function(){if(o.newExpflag={},o.curGroup.hasOwnProperty("control"))for(var b in a.curGroup.control.flags)o.newExpflag[b]=a.curGroup.control.flags[b],_.isBoolean(a.curGroup.control.flags[b])&&(o.newExpflag[b]=!a.curGroup.control.flags[b])},o.updateExp=function(a,b){f.updateExpById(a.id,a).then(function(a){return b(a.data)})},o.addExp=function(a,b){f.creatExp(d.getAppID(),a).then(function(a){return b(a.data)})},o.curFlagsByname=_.groupBy(a.flags,"name"),o.updateEveryExp=function(b,c){var d=[];a.curExps.forEach(function(a){d.push(a)}),o.indexCurExps=_.keyBy(d,"id");var e={experiments_updater:{}};_.forEach(o.indexCurExps,function(a){"addFlag"===b&&("String"!==c.typ&&"string"!==c.typ||(a.flags[c.name]=c.default_value?c.default_value:""),"Number"!==c.typ&&"number"!==c.typ&&"Integer"!==c.typ||(a.flags[c.name]=c.default_value?c.default_value:0),"Boolean"!==c.typ&&"boolean"!==c.typ||(a.isControl?a.flags[c.name]=c.default_value:a.flags[c.name]=!c.default_value),e.experiments_updater[a.id]={flags:a.flags}),"delFlag"===b&&(_.unset(a.flags,c),e.experiments_updater[a.id]={flags:a.flags})}),f.updateGroupWithExp(o.curGroup.id,e).then(function(a){k.refreshFlagPanel()})},a.addFlags=function(){o.isRowLock()||d.openPenls()},a.select=function(b){return _.findIndex(a.curFlags,{name:b.name})>=0?g.alert({content:"变量"+b.name+"已经选取",type:"fail"}):(a.curFlags.push(b),o.updateEveryExp("addFlag",b),void(o.curFlagsByname=_.groupBy(a.curFlags,"name")))},a.delFlag=function(b){g.confirm({content:"确定要删除["+b.name+"]变量吗？"},function(){_.remove(a.curFlags,function(a){return a==b}),o.updateEveryExp("delFlag",b.name)})},o.isRowLock=function(){return!!a.editRowLock&&(h.warning({msg:"点击确定按钮以保存!"}),!0)},a.addExps=function(){if(!o.isRowLock()){d.closePenls();var b=l.getExpDistantDateRange();a.inserted={name:"",description:"",traffic:0,start_date:moment().valueOf(),end_date:b.end.valueOf(),flags:o.newExpflag,summary_conditions:o.newExpSummary,custom_conditions:o.newExpCustorm,group_id:a.curGroup.id,stats:o.newExpStats,typ:o.curGroup.typ},o.curLayerId&&(a.inserted.layer_id=o.curLayerId),a.curExps.push(a.inserted),a.editRowLock=!0}},a.types=[{key:"true",val:!0},{key:"false",val:!1}],a.cleanForm=function(b,c,d){if(a.editRowLock=!1,b.stopPropagation(),c.$cancel(),!d.id){var e=a.curExps.indexOf(d);e>-1&&a.curExps.splice(e,1)}},a.editRowLock=!1,a.focusTr=function(b,c){c.isControl||o.isRowLock()||(a.editRowLock=!0,o.expNames=_.keyBy(a.curExps,"name"),delete o.expNames[c.name],b.$show())},a.removeExp=function(a,b){a.stopPropagation(),g.confirm({content:"确认要删除["+b.name+"]版本?"},function(){({status:b.status,traffic:b.traffic});f.deleteExpById(b.id).then(function(a){n.updatePageCacheData()})})},o.compareSaveData=function(a,b){var c={flags:{}};return c.name=a.name,c.description=a.description,c.id=b.id,c.flags=b.flags,c},a.saveExp=function(b,c){a.editRowLock=!1,c.id?(c=o.compareSaveData(b,c),o.updateExp(c,function(b){var d=a.curExps.indexOf(c);a.curExps[d]=b,o.expNames=_.keyBy(a.curExps,"name"),o.curAllExpId=_.map(a.curExps,"id")})):o.addExp(c,function(b){var d=a.curExps.indexOf(c);a.curExps[d]=b,o.expNames=_.keyBy(a.curExps,"name"),o.curAllExpId=_.map(a.curExps,"id");var e={};e.id=b.id,b.hasOwnProperty("layer_id")&&(e.layer_id=b.layer_id),e.status=o.newStatus,o.updateExp(e,function(a){})}),o.curAllExpId=_.map(a.curExps,"id")},o.checkNumber=function(a){if(_.isNaN(_.toNumber(a)))return"输入不是一个数字"},a.checkExpName=function(a){return 0===a.length?"试验名称不能为空":o.expNames[a]?"试验名称不能重复":void 0},o.checkString=function(a){if(0===a.length)return"不能为空"},a.checkFlags=function(a,b){switch(b){case"String":return o.checkString(a);case"Number":case"Interger":return o.checkNumber(a)}},a.saveBtn=function(a,b){b.stopPropagation()}}]),angular.module("abtesting").config(["$stateProvider",function(a){a.state("app.data.testdata.version",{url:"/version",templateUrl:"app/version/version.html",controller:"VersionCtrl",data:{pageTitle:"版本管理  A/BTesting"}})}]),angular.module("abtesting").directive("abError",function(){return{require:"^abInputErrorBox",templateUrl:"components/abError/abError.html",restrict:"E",transclude:!0,scope:{checkMode:"@",type:"@",len:"@",custom:"="},link:function(a,b,c,d){var e=d.getErrorBoxContext();a.form=e.form,a.inputName=e.inputName,a.isShowDef=a.custom,a[a.type]=!0}}}),angular.module("abtesting").directive("abExpItem",function(){return{templateUrl:"components/abExpItem/abExpItem.html",restrict:"E",link:function(a,b,c){}}}),angular.module("abtesting").directive("abInputDesc",function(){return{templateUrl:"components/abInputDesc/abInputDesc.html",restrict:"E",transclude:!0,scope:{form:"=",inputName:"@"},link:function(a,b,c){}}}),angular.module("abtesting").controller("abInputErrorBox",["$scope",function(a){var b=this;b.getErrorBoxContext=function(){return a}}]),angular.module("abtesting").directive("abInputErrorBox",function(){return{templateUrl:"components/abInputErrorBox/abInputErrorBox.html",restrict:"E",transclude:!0,scope:{form:"=",inputName:"@"},controller:"abInputErrorBox"}}),angular.module("abtesting").directive("abInputIcon",["$timeout",function(a){return{templateUrl:"components/abInputIcon/abInputIcon.html",restrict:"E",scope:{form:"=",inputName:"@"},link:function(a,b,c){}}}]),angular.module("abtesting").controller("abNavCtrl",["$scope","$state","AuthApi","AuthHelper","$rootScope","Auth","App","$uibModal","alert",function(a,b,c,d,e,f,g,h,i){var j=this;j.curUser=g.getCurUser(),a.curUser=j.curUser,a.userInfoData=j.curUser,a.isCollapsed=!0,a.managementRole=1==j.curUser.management,a.refresh=function(){a.apps=[],a.myapps=[],a.colapps=[],j.curApp=g.getApp(),a.managementRole=1==j.curUser.management,_.isEmpty(j.curApp)&&(j.curApp={}),j.curApp.isMe=!0,a.curApp=j.curApp,c.getAllApp().then(function(b){j.apps=b?b.data.apps:"",j.myApps=d.getCurUserApps(j.apps,j.curUser.id),j.colapps=_.difference(j.apps,j.myApps),a.myapps=j.myApps,a.colapps=_.filter(j.colapps,function(a){return!a.name.startsWith("ABDemo_")})})},a.refresh(),a.openApp=function(a){_.get(a,"author_id")===j.curUser.id&&(a.isMe=!0),g.openApp(a)},a.exit=function(){return f.clearUser(),g.logout(),b.go("login")},a.goChangePass=function(){b.go("app.changePass")},a.navStatus=!1,j.initNavStatus=function(){b.current.role&&b.current.role.hasOwnProperty("noApp")&&(a.navStatus=!0)},j.bindNavStatusChnage=function(){e.$on("$stateChangeStart",function(b,c){c.role&&c.role.noApp?a.navStatus=!0:a.navStatus=!1;var d=g.getAppID();a.curApp&&a.curApp.id&&d!==a.curApp.id&&a.refresh()})},c.getNotifyRead().then(function(b){a.message=b?b.data.notifies:""}),a.deleteAllNotRead=function(b){i.confirm({content:"确认清空未读消息?",type:"fail"},function(){_.forEach(b,function(a){c.delNotifyRead(a.id)}),a.message.length=0})},a.seeContent=function(b){h.open({templateUrl:"app/NotifyContent/NotifyContent.html",controller:"NotifyContentCtrl",resolve:{curMeg:function(){return b},allNotMeg:function(){return a.message}}})},j.initNavStatus(),j.bindNavStatusChnage(),a.navStatus||a.refresh()}]),angular.module("abtesting").directive("abNav",["$state",function(a){return{templateUrl:"components/abNav/abNav.html",restrict:"E",replace:!1,transclude:!0,controller:"abNavCtrl"}}]),angular.module("abtesting").controller("abNavHasappCtrl",["$scope",function(a){a.menu=[{title:"概况",state:"app.main"},{title:"配置",state:"app.config.appConfig"}]}]),angular.module("abtesting").component("abNavHasapp",{templateUrl:"components/abNavHasapp/abNavHasapp.html",controller:"abNavHasappCtrl"}),angular.module("abtesting").controller("abNavNoappCtrl",["$scope",function(a){a.menu=[{title:"使用帮助",href:"http://doc.appadhoc.com/index.html"},{title:"博客",href:"http://www.appadhoc.com/blog",isClass:!0}],a.menu=[]}]),angular.module("abtesting").directive("abNavNoapp",function(){return{templateUrl:"components/abNavNoapp/abNavNoapp.html",restrict:"E",controller:"abNavNoappCtrl"}}),angular.module("abtesting").controller("abTabCtrl",["$scope",function(a){var b=this.navs=a.navs=[];this.navNow=0,this.paneIndex=0,this.getPaneIndex=function(){return this.paneIndex++},a.select=this.select=function(c,d){c&&(angular.forEach(b,function(a,b){a.selected=!1}),c.selected=!0,a.active&&(a.$parent[a.active]=d,a.$parent.$parent[a.active]=d))},a.click=function(b,c){a.select(b,c),"undefined"!=typeof b.tabNavModel?a.tabClick()(angular.fromJson(b.tabNavModel)):a.tabClick()},this.addNav=function(a){b.push(a)};var c=angular.element(".js-abtab-list")[0],d=angular.element(".js-abtab-list"),e=angular.element(".js-abtab-list-box");a.abTabShow=!1;var f=0,g=!0,h=0,i=0,j=0;a.mousedownRight=function(){var b=0;if(g){for(var d=0;d<4;d++)b+=c.children[d].clientWidth;e.css("max-width",b+"px"),a.abTabShow=!0,g=!1,j=c.childElementCount-4}},a.mouseupRight=function(){f<j&&(f++,h=4+f-1,i+=c.children[h].clientWidth,d.css("margin-left","-"+i+"px"))},a.clickLeft=function(){var a=0;f>0&&(h=4+f-1,a=c.children[h].clientWidth,i-=a,d.css("margin-left","-"+i+"px"),f--)}}]),angular.module("abtesting").directive("abTab",function(){return{templateUrl:"components/abTab/abTab.html",restrict:"EA",replace:!0,transclude:!0,controller:"abTabCtrl",scope:{tabClick:"&tabClick"},link:function(a,b,c,d){var e=d.navNow=c.defaultDisplay;e=e&&e<=a.navs.length-1?e:0,a.select(a.navs[e],e),c.nopane&&(a.nopane=c.nopane),c.noBottomLine&&(a.noBottomLine=c.noBottomLine),c.active&&(a.active=c.active,a.$parent[c.active]=e,a.$watch('$parent["'+c.active+'"]',function(b,c){a.select(a.navs[b],b)}),a.$parent.$parent[c.active]=e,a.$watch('$parent.$parent["'+c.active+'"]',function(b,c){a.select(a.navs[b],b)}))}}}),angular.module("abtesting").directive("abTabNav",function(){return{require:"^^abTab",restrict:"E",transclude:!0,scope:{title:"@",line:"@",icon:"@",width:"@",tabNavModel:"@"},templateUrl:"components/abTabNav/abTabNav.html",compile:function(a,b,c){return{post:function(a,b,c,d){d.addNav(a),b.remove(),d.select(d.navs[d.navNow?d.navNow:0])}}}}}),angular.module("abtesting").directive("abTabPane",function(){return{require:"^^abTab",restrict:"E",replace:!0,transclude:!0,scope:{offsetH:"=",position:"@"},templateUrl:"components/abTabPane/abTabPane.html",link:function(a,b,c,d){function e(){var b=f.outerHeight(),c=b-a.offsetH;g.css("height",c)}var f=$(window),g=$(b);a.paneIndex=d.getPaneIndex(),a.navs=d.navs,"absolute"===a.position&&(e(),f.on("resize",e))}}}),angular.module("abtesting").controller("abToastCtrl",["$scope","$animate",function(a,b){}]),angular.module("abtesting").directive("abToast",["$animate","$interval","abToast",function(a,b,c){return{templateUrl:"components/abToast/abToast.html",restrict:"EA",replace:!0,transclude:!0,controller:"abToastCtrl",
link:function(d,e,f,g){function h(){a.leave(e).then(function(){var a=c._before();a||c._reset()})}var i=f.index;d.icon="true"===f.icon,d.type=f["class"],d.click=function(){b.cancel(e[0].timer),h()},e[0].timer=b(h,f.time*i,1)}}}]),angular.module("abtesting").service("abToast",["$animate","$rootScope","$interval","$q","$timeout","$compile",function(a,b,c,d,e,f){function g(b){if(j)return n.promise;j=angular.element('<div class="abtoast-container" style="top:'+(angular.isUndefined(b)?48:b)+'px"></div>');var c=angular.element(document.querySelector("body")),d=angular.element(c).children(),e=d.eq(d.length-1);return a.enter(j,c,e).then(function(){n.resolve()}),n.promise}function h(a){var c=angular.element('<ab-toast icon="'+a.icon+'" time="'+a.time+'" index="'+k+'" class="'+a.type+'">'+a.msg+"</ab-toast>");return f(c)(b.$new())}function i(){var a=$(".abtoast-container");a.empty()}var j,k=0,l=2e3,m=[],n=d.defer(),o={success:function(a){this._show("abtoast-success",a)},warning:function(a){this._show("abtoast-warning",a)},danger:function(a){this._show("abtoast-danger",a)},info:function(a){this._show("abtoast-info",a)},removeAll:function(){i()},_show:function(a,b){if(b.time&&!angular.isNumber(b.time))throw"time参数必须是数字";if(b.top&&!angular.isNumber(b.top))throw"top参数必须是数字";if(b.icon&&"boolean"!=typeof b.icon)throw"icon参数必须是布尔值";g(b.top).then(function(){var c=$(j).children();k++;var d=h({msg:b.msg?b.msg:"",time:b.time?b.time:l,type:a,icon:!!b.icon&&b.icon});m.push(d),c.length||o._before()})},_reset:function(){0===angular.element(j).children().length&&(a.leave(j),j=null,k=0,n=d.defer())},_before:function(){return!!m.length&&(a.enter(m.shift(),j),!0)}};return o}]),angular.module("abtesting").controller("ActionbarCtrl",["$scope","ExpApi","Auth","$state","$rootScope","App","Constant","AuthApi","DataHelper",function(a,b,c,d,e,f,g,h,i){var j=this;j.curUser=f.getCurUser(),j.curApp=f.getApp(),h.getUserInfo(j.curUser.email).then(function(b){a.userInfoData=b.data}),a.refresh=function(){b.getGroupById(f.getCurGroupId()).then(function(b){a.group=b.data;var c=Math.ceil((new Date).getTime()/1e3),d=_.get(a.group,"control.start_date"),e=_.get(a.group,"control.end_date");a.startDaily=d<c?i.timeRangeDiffDays(d,c)+1:1,a.startDaily=Math.ceil(a.startDaily),a.endDaily=i.timeRangeDiffDays(d,e),a.endDaily=Math.ceil(a.endDaily),a.isdev=j.curApp.typ!==g.APP_TYPE_DEF})},a.refresh(),a.$on(g.EVENT_REFRESH_ACTIONBAE,function(){a.refresh()}),a.goCurVersion=function(){var b=f.getCurVersionStateName(j.curApp,a.group);return d.go(b)},a.goCurData=function(){var a=f.getCurDataStateName(j.curApp);return d.transitionTo(a)}}]),angular.module("abtesting").directive("actionbar",function(){return{templateUrl:"components/actionbar/actionbar.html",restrict:"E",controller:"ActionbarCtrl"}}),angular.module("abtesting").directive("bgHook",["$rootScope",function(a){return{restrict:"A",link:function(b,c,d){var e=$(c),f="ab-bg-",g=function(){var a=e.attr("class");if(a)for(var b=a.split(" "),c=0,d=b.length;c<d;c++){var g=b[c];g&&g.indexOf(f)>-1&&e.removeClass(g)}};a.$on("$stateChangeSuccess",function(a,b){if(b.name){var c=f+b.name.replace(/\./g,"-");g(),e.addClass(c)}})}}}]),angular.module("abtesting").directive("charge",["$state","DataHelper",function(a,b){return{templateUrl:"components/charge/charge.html",restrict:"EA",link:function(c,d,e){function f(d){if(d&&d.free){var e=_.get(d,"free.end"),f=(new Date).getTime(),g=(d.api?_.max(_.map(d.api,"day")):"",_.filter(d.api,function(a){return 0==b.timeRangeDiffDays(1e3*a.day,f)?a:0!=_.groupBy(d.api,"day")[_.max(_.map(d.api,"day"))].length?a:void 0})),h=_.filter(d.mau,function(a){return 0==b.timeRangeDiffDays(1e3*a.day,f)?a:0!=_.groupBy(d.mau,"day")[_.max(_.map(d.mau,"day"))].length?a:void 0}),i=(_.keyBy(d.pay,"end"),[]);i=_.filter(d.pay,function(a){if(b.isNewDateInTheTime(a))return a});var j=[];if(i.length>1)for(var k=0;k<i.length-1;k++)0==b.timeRangeDiffDays(i[k].end,i[k+1].begin)&&j.push(i[k+1]);_.reverse(j),0==j.length&&(j[0]=i[0]),c.expiryFig=!1;var l=0!==i.length?b.timeRangeDiffDays(f,1e3*j[0].end):32;c.expiryFig&&(g=_.groupBy(d.api,"day")[_.max(_.map(d.api,"day"))],h=_.groupBy(d.mau,"day")[_.max(_.map(d.mau,"day"))]),c.apiLimit=0!=i.length?i[0].num:"",d.free&&(c.isFree=b.timeRangeDiffDays(f,1e3*d.free.end+864e5)>0),c.isArrearage=!0,c.curUser=d,c.mauLimit=d.mau_limit?d.mau_limit:0,c.apiCount=_.last(g)?_.last(g).num:"",c.mauCount=_.last(h)?_.last(h).num:"",c.apiProportion=0!=c.apiLimit&&c.apiLimit?(c.apiCount/c.apiLimit*100).toFixed(1):0,c.mauProportion=0!=c.mauLimit&&c.mauLimit?(c.mauCount/c.mauLimit*100).toFixed(1):0,c.apiFlagTip=!1,c.mauFlagTip=!1,c.timeFlagTip=!1,c.serveOverdueFlag=!1,c.mauUnlimitedFig=!1,c.titleRedFlagTip=!1,c.freeDayTextFlag=!1,c.freeFindPayFig=!1,c.apiLimitTipFlg=!1,c.free_expiryFig=!1,c.freeDay=0,c.titleCon="",c.goChangePass=function(){a.go("app.changePass")},c.textTip="超出上限的数据将无法计入试验";var m=function(a){return!c.isFree&&c.apiCount>c.apiLimit&&(a.rate="100%",a.type=!1),a},n=function(a){var d={},e=Math.floor((new Date).getTime()/1e3),f=b.timeRangeDiffDays(1e3*a.begin,1e3*a.end),g=b.timeRangeDiffDays(1e3*a.begin,1e3*e),h=100*(g/f);return d.durDay=b.timeRangeDiffDays(moment(),1e3*a.end+864e5),a.free||(h=100*(c.apiCount/a.num),d.durDay=b.timeRangeDiffDays(moment(),1e3*q.end+864e5)),d.rate=h+"%",d.beginDate=a.begin,d.endDate=a.end,d.num=a.num,h<80?d.type=!0:d.type=!1,d},o=function(){var a={},d=(Math.floor((new Date).getTime()/1e3),{});if(c.dayRate)return d=c.dayRate;if(b.isNewDateInTheTime(c.curUser.free))return a.begin=c.curUser.free.begin,a.end=c.curUser.free.end,a.free=!0,d=n(a);var e=c.curUser.pay;return 0!=e.length?(e.forEach(function(a){if(b.isNewDateInTheTime(a)){var c={};return c.begin=a.begin,c.end=a.end,c.free=!1,c.num=a.num,d=n(c)}}),d):d.hasOwnProperty("rate")?void 0:d={rate:"100%",type:!1}},p=function(a){return a.durDay<30?(a.type=!1,a):a},q=b.getLastTimeoFNewDateInContinuousDate(c.curUser.pay);if(c.apiEndDate=q?moment(1e3*q.end).format("YYYY年MM月DD日"):c.expiryFig=!0,c.dayRate=m(p(o())),!c.isFree&&c.expiryFig)return c.userType="账户已经失效 ";if(c.isFree){if(c.userType="免费用户",c.apiProportion=c.apiCount,c.mauProportion=c.mauCount,e){c.freeDay=b.timeRangeDiffDays(f,1e3*e+864e5);moment(e).subtract(moment().second(),"seconds")}c.freeDay<15&&(c.freeDayFlag=!0),_.toNumber(c.freeDay)<=0&&(c.free_expiryFig=!0,c.userType="账号已失效"),d.pay&&_.forEach(d.pay,function(a){if(console.log(datahelper.timerangediffdays(1e3*d.free.end+864e5,1e3*a.begin)),0==datahelper.timerangediffdays(1e3*d.free.end+864e5,1e3*a.begin)||1==b.timeRangeDiffDays(1e3*d.free.end+864e5,1e3*a.begin))return c.free_expiryFig=!1,c.freeFindPayFig=!0})}c.isFree||(l=b.timeRangeDiffDays(moment(),1e3*q.end),c.userType="付费用户",0!=c.apiLimit&&0==c.apiCount&&(c.apiProportion=0),c.apiLimit>=999999999999999?(c.apiLimitTip="无限制",c.apiLimitTipFlg=!0):(c.apiLimitTipFlg=!1,console.log(c.apiLimit,"23"),c.apiLimitTip=c.apiLimit),80<c.apiProportion&&c.apiProportion<=100&&(c.apiFlagTip=!0,c.titleRedFlagTip=!0,c.textTip="您的API调用次数即将超出上限，为保证您的正常使用，请尽快与客户经理联系续费。"),100<c.apiProportion&&(c.apiFlagTip=!0,c.titleRedFlagTip=!0,c.textTip="您的api已经超出上限，将停止数据统计，请尽快与客户经理联系续费。"),1<l&&l<30&&(c.timeFlagTip=!0,c.titleRedFlagTip=!0,c.timeTip="您的账户还有"+l+"天到期."),1==l&&(c.timeFlagTip=!0,c.titleRedFlagTip=!0,c.timeTip="您的账户今天已到期。"),l<0&&(c.userType="账户已失效",c.isArrearage=!1,c.timeFlagTip=!1,c.serveOverdueFlag=!0,c.titleCon="服务已到期，已停止数据统计，查看详情"))}}c.$watch(e.source,function(a){f(a)},!0)}}}]),angular.module("abtesting").controller("CheckPwdModelCtrl",["$scope","App","$timeout","AuthApi","$uibModalInstance","exp","content",function(a,b,c,d,e,f,g){a.exp=f,a.pwd="",a.content=g,a.ok=function(f){if(f.pwd.$valid){var g=b.getCurUser();d.loginUser(g.email,a.pwd).then(function(a){return a.data.error_code?(c(function(){f.pwd.$setValidity("checkpwd",!1)}),c(function(){f.pwd.$setValidity("checkpwd",!0)},2e3)):void c(function(){f.pwd.$setValidity("checkpwd",!0),e.close()})})}},a.cancel=function(){e.dismiss("cancel")}}]),angular.module("abtesting").controller("EditmemberCtrl",["$scope","App","Constant","AuthApi","Apps","userInfo","$uibModalInstance","AbDispacher","abToast",function(a,b,c,d,e,f,g,h,i){a.formTest={},a.roles=[{name:"编辑者",key:c.ROLE_ADMIN},{name:"普通用户",key:c.ROLE_COLLABORATOR}],a.apps=e,a.userInfo=f,f.role==c.ROLE_ADMIN?a.curRole=a.roles[0]:a.curRole=a.roles[1],a.formTest.owner_comment=f.owner_comment?f.owner_comment:"",d.getAllAppById(f.id).then(function(b){a.appsStores=_.map(b.data.apps,"id")}),a.changeRole=function(b){a.curRole=b},a.cancel=function(){g.dismiss("cancel")},a.newok=function(){var b=a.appsStores,c={email:f.email,role:a.curRole.key,owner_comment:a.formTest.owner_comment,apps_id:b};d.updateMember(a.userInfo.id,c).then(function(a){return i.success({msg:"编辑成功",icon:!0,time:3e3,top:0}),h.refreshManagementCtrl(),g.close()})},a.appsStores=[],a.selectedApp=function(b){var c=a.appsStores.indexOf(b);c>-1?a.appsStores.splice(c,1):a.appsStores.push(b)}}]),angular.module("abtesting").directive("expBuildEdit",["ExpApi","App","Constant",function(a,b,c){return{templateUrl:"components/expBuildEdit/expBuildEdit.html",restrict:"E",scope:{exp:"=",previewHandler:"&",exps:"="},link:function(d,e,f){d.app=b.getApp(),d.isH5=d.app.typ===c.APP_TYPE_H5,d.isAndroid=d.app.typ===c.APP_TYPE_ANDIOD,d.show=function(){var a=d.previewHandler();if(a)return a(d.exp)},d.edit=function(a){d.exp.isControl||a.$show()},d.ok=function(b){a.updateExpById(d.exp.id,b).then(function(a){d.exp.displayName=a.data.name,d.exp.displayDescription=a.data.description})},d.cleanForm=function(a,b){a.stopPropagation(),b.$cancel()},d.checkExpName=function(a){if(0===a.length)return"试验名称不能为空";var b=_.keyBy(d.exps,"name");return delete b[d.exp.name],b&&b[a]?"试验名称不能重复":void 0}}}}]),angular.module("abtesting").controller("FirstModalCtrl",["$scope","$uibModalInstance",function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("abtesting").directive("flagPanle",["$timeout",function(a){return{restrict:"E",scope:{selectFlag:"&",close:"&",curgroup:"="},templateUrl:"components/flagpanel/flagpanel.html",controller:["$rootScope","$scope","$attrs","ExpApi","DataApi","ExpHelper","$timeout","App","$q","alert","Constant","AbDispacher","nzTour","dataManager",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=this;b.curApp=h.getApp(),b.successFig=!1,b.statsData=[],b.erroTipName="",b.createType="String",b.sucNameStat=!1,b.errNameStat=!1,b.sucFlagStat=!1,b.erroTipTyp="",b.types=[],b.flagRe="请填写字符串",b.tipFlag=!1,b.erroTipValue="请填写默认值，即原始版本对应的值，填写后不可修改",b.sucValueStat=!1,b.locked=!1,b.statCreat=!0,b.tipStat=!1,b.isSect=!0,b.isSelectTitle=!0,b.erroTipName="字母、数字或下划线",o.creatFlag=!0,b.Booleans=["false","true"],b.booleanFlag=!1,b.noStatFig=!1,b.nullDataFiag=!1,b.Constant=k,o.indexStats=[],o.kk=[],o.curGroup=h.getCurGroup(),b.vm={default_value:""},b.$on("panelsClose",function(a){b.locked=!1}),b.refresh=function(){o.indexCurGroupFlag=_.keys(o.curGroup.control.flags),d.getFlagsById(h.getAppID()).then(function(a){if(0==a.data.flags.length)return b.nullDataFiag=!0;var c=f.getVaildeFlags(a.data.flags);b.statsData=f.getCodeFlags(c),_.forEach(b.statsData,function(a){o.indexCurGroupFlag.indexOf(a.name)>=0&&(a.select=!0)}),b.statsData=_.orderBy(b.statsData,"name"),o.indexStats=_.keyBy(b.statsData,"name")})},b.refresh(),b.clickA=function(){b.isSelectTitle=!0},b.clickB=function(){b.isSelectTitle=!1},b.$on("panels",function(a){b.locked=!0,0===b.statsData.length&&setTimeout(function(){m.start(p)},200)}),b.lock=function(){h.closePenls();var a=b.close();if(a)return a()},b.selects=function(a){b.isSect=!1,b.statCreat=!1,a.select=!0;var c=b.selectFlag();c(a)},b.selectBoolean=function(a){"false"==a&&(b.createBoolean=!1,b.vm.default_value=!1),"true"==a&&(b.createBoolean=!0,b.vm.default_value=!0)},b.selType=function(a){b.types=[],b.createType=a,b.booleanFlag=!1,b.flagRe="",b.vm.default_value="","Boolean"==a&&(b.createBoolean="true",b.booleanFlag=!0,b.vm.default_value=!0),"String"==a&&(b.flagRe="请填写字符串"),"Number"==a&&(b.flagRe="请填写数字")},b.clickType=function(){b.tipFlag=!1,b.erroTipValue="请填写默认值，即原始版本对应的值，填写后不可修改",b.sucValueStat=!1,b.types=["String","Boolean","Number"]},b.create=function(a){if(!_.get(a,"name"))return b.tipStat=!0,b.erroTipName="请填写变量名称";if("String"==a.typ&&""==a.default_value||"Number"==a.typ&&""==a.default_value)return b.tipFlag=!0,b.erroTipValue="默认值不能为空";if("Number"==a.typ&&(a.default_value=_.toNumber(a.default_value)),_.get(o.indexStats,a.name))return j.alert({content:"变量已存在.",type:"fail"});if(b.canCreate=!0,a.select=!0,!b.tipStat){if("Number"==a.typ&&isNaN(a.default_value))return j.alert({content:"请填写数字",type:"fail"});var c=b.selectFlag();c(a),a.app_id=h.getAppID(),d.createFlag(h.getAppID(),a).then(function(){b.vm.default_value="",b.createType="String",b.successFig=!0,b.sucNameStat=!1,b.sucFlagStat=!1,b.sucValueStat=!1,b.booleanFlag=!1,a.select=!0,b.vm.createName="",b.vm.createDescrition="",b.flagRe="请填写字符串",b.statsData.unshift(a)})}},b.changeVal=function(a){return b.tipFlag=!1,0==a.length?(b.sucValueStat=!1,b.erroTipValue="请填写默认值，即原始版本对应的值，填写后不可修改"):(0!=a.length&&(b.sucValueStat=!0),"Number"==b.createType?isNaN(a)?(b.tipFlag=!0,b.erroTipValue="请填写数字啊"):b.erroTipValue="请填写默认值，即原始版本对应的值，填写后不可修改":void 0)},b.changeDes=function(a){0==a.length&&(b.sucFlagStat=!1),a.length>2&&(b.sucFlagStat=!0)},b.changeName=function(a){return b.erroTipName="字母，数字和下划线",b.tipStat=!1,b.errNameStat=!1,0==a.length?(b.tipStat=!1,b.errNameStat=!1,b.sucNameStat=!1):(a.length>2&&(b.sucNameStat=!0,b.errNameStat=!1),a.search("-")!=-1?(b.errNameStat=!0,b.tipStat=!0,b.erroTipName="不允许用中划线"):isNaN(a)?0==a.indexOf("_")&&(b.errNameStat=!0,a.lastIndexOf("_")==a.length-1)?(b.tipStat=!0,b.erroTipName="不允许同时用下划线开头和结尾"):/^[A-Za-z]\w*_*$/.test(a)?void 0:(b.tipStat=!0,b.errNameStat=!0,/[u4e00-u9fa5]*/.test(a)?b.erroTipName="不允许用中文":b.erroTipName="只能以字母来开头,不允许用其他字符开头"):(b.tipStat=!0,b.errNameStat=!0,b.erroTipName="不允许数字开头，只能以字母开头。"))},b.$on(k.EVENT_REFRESH_FLAG_PANEL,function(){b.refresh()}),n.changeState(function(a){var c=_.keys(a);c.forEach(function(c){switch(c){case"curGroupData":o.curGroup=angular.copy(a.curGroupData),b.refresh()}})});var p={config:{previousText:"上一步",nextText:"下一步",finishText:"完成"},steps:[{target:"#input-step",content:"填写变量名称集成到代码中。"},{target:"#input-step-val",content:"变量的默认值用于展示原始版本的默认值。"}]}}],link:function(a,b){a.indexCurGroupFlag={},a.$watch("curgroup",function(){a.curgroup&&a.curgroup.control&&(a.indexCurGroupFlag=a.curgroup.control.flags)})}}}]),angular.module("abtesting").controller("ImportDataModelCtrl",["$scope","App","DataApi","$uibModalInstance","groupid",function(a,b,c,d,e){var f="http://ics-api.appadhoc.com/csv/",g=moment().subtract(6,"days"),h=moment();a.datePicker={},a.datePicker.date={startDate:g,endDate:h};var i=b.getDatePickerConfig();i.applyHandler=function(b,d){var g=a.datePicker.date.startDate.hour(0).minute(0).toISOString(),h=a.datePicker.date.endDate.hour(23).minute(59).toISOString();c.getImportDataFilePath(g,h,e).then(function(b){a.url=f+b.data.filename,a.isDownload=!0})},a.datePickerConfig=i,a.url="",a.isDownload=!1}]),angular.module("abtesting").controller("InvitateCtrl",["$scope","App","Constant","$uibModalInstance","AuthApi","Apps","AbDispacher","abToast",function(a,b,c,d,e,f,g,h){a.formTest={},a.roles=[{name:"编辑者",key:c.ROLE_ADMIN,description:"可以操作可见的试验，也可以创建应用"},{name:"普通用户",key:c.ROLE_COLLABORATOR,description:"只能浏览，不能编辑"}],a.apps=f,a.curRole=a.roles[0],a.changeRole=function(b){a.curRole=b},a.cancel=function(){d.dismiss("cancel")},a.newok=function(){var b=a.appsStores,c={email:a.formTest.userEmail,role:a.curRole.key,owner_comment:a.formTest.owner_comment,apps_id:b};e.addMember(c).then(function(b){return 20002==b.data.error_code?(a.errorTipStat=!0,a.errorTip="邮箱已经注册"):(h.success({msg:"邮件发送成功",icon:!0,time:3e3,top:0}),g.refreshManagementCtrl(),d.close())})},a.appsStores=[],a.selectedApp=function(b){var c=a.appsStores.indexOf(b);c>-1?a.appsStores.splice(c,1):a.appsStores.push(b)}}]),angular.module("abtesting").component("loading",{templateUrl:"components/loading/loading.html"}),angular.module("abtesting").component("oNavbar",{templateUrl:"components/onavbar/onavbar.html",controller:["$rootScope","$scope","$timeout","App","$state",function(a,b,c,d,e){b.isShow=!0;var f={login:"",register:"",forgotPass:"",appForgotPass:""};f.hasOwnProperty(e.current.name)&&(b.isShow=!1)}]}),angular.module("abtesting").directive("point",function(){return{template:'<span class="ab-pdr10 ab-cir5 ab-bacdarksalmon {{iconClass}}"></span>',restrict:"E",link:function(a,b,c){var d="abcdefghijklmno",e=d.charAt(a.$index);a.iconClass="table-icon-"+e}}}),angular.module("abtesting").directive("sliderplus",["$timeout",function(a){return{templateUrl:"components/sliderplus/sliderplus.html",restrict:"E",scope:{save:"&",min:"=",max:"=",val:"=",modal:"=",step:"=",change:"&",remain:"=",show:"=",tposition:"="},link:function(b,c,d){b.saveOff=!0,b.showT=b.show,b.tposition=b.tposition;var e=b.save(),f=b.change();b.step||(b.step=1),b.savehandler=function(){b.saveOff=!0,e&&e(b.$parent)},b.changeModal=function(a){b.change(a)},b.change=function(c){b.saveOff&&(b.saveOff=!1),a(function(){b.modal=c}),f&&f(c,b)},b.$watch("modal",function(a){return _.isUndefined(a)?b.modal="":a>b.max?(b.change(b.max),b.modal=b.max):a<b.min?(b.change(b.min),b.modal=b.min):void 0}),b.stop=function(){b.remain<0&&a(function(){b.modal=b.modal+b.remain,b.$apply(),f&&f()})},b.modalChange=function(a){}}}}]),angular.module("abtesting").controller("slidingMenuCtrl",["$scope","$state","App","$rootScope","ExpApi","AuthApi","Constant","$timeout","$anchorScroll","$location","$uibModal","toScroll","Testlog",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=this;n.curApp=c.getApp(),n.curUser=c.getCurUser(),n.curGroup=c.getCurGroup(),n.curControl=n.curGroup.control,a.curApp=n.curApp,a.curGroup=n.curGroup,a.curUser=n.curUser,a.logsPanelSwitch=!1,a.openTestLogs=function(){a.logsPanelSwitch=!0},a.closeTestLogs=function(){a.logsPanelSwitch=!1},n.refresh=function(){n.curGroup=c.getCurGroup(),n.curControl=n.curGroup.control},n.refresh(),a.$on(g.EVENT_REFRESH_SLIDE_MENU,function(){n.refresh()}),a.curStateName=b.current.name,a.$on("$stateChangeSuccess",function(){a.curStateName=b.current.name}),a.goAnchor=function(a){l.goAnchor(a)},a.goVersionAnchor=function(){return"app.data.testdata.version.stats"===a.curStateName?a.goAnchor("version"):"app.data.testdata.h4version.autostats"===a.curStateName?a.goAnchor("h5version"):"app.data.testdata.urlversion.urlstats"===a.curStateName?a.goAnchor("urlversion"):void 0},a.importDataRole=!(!n.curUser||1!==n.curUser.importData),a.importData=function(){k.open({templateUrl:"components/importDataModel/importDataModel.html",size:"526px 200px",controller:"ImportDataModelCtrl",resolve:{groupid:function(){return n.curGroup.id}}})}}]),angular.module("abtesting").directive("slidingMenu",function(){return{templateUrl:"components/slidingMenu/slidingMenu.html",restrict:"E",controller:"slidingMenuCtrl"}}),angular.module("abtesting").directive("smartizenCharts",function(){return{restrict:"A",scope:{num:"="},link:function(a,b,c){var d=$(b),e=d.children()[0],f=$(e),g=d.parent(),h=g.width(),i=c.width||600,j="ct-square";i=1===a.num?h:i,i=2===a.num?h/2-40:i,i=3===a.num?h/3-40:i,j=1===a.num?"ct-double-octave":j,j=2===a.num?"ct-octave":j,j=3===a.num?"ct-perfect-fourth":j,d.css({width:i}),a.defClass=j,f.addClass(j)}}}),angular.module("abtesting").directive("statPanle",["$timeout",function(a){return{restrict:"E",scope:{selectStat:"&",selectComStat:"&",curgroup:"=",comstatFig:"=",namePanel:"@"},templateUrl:"components/statpanel/statpanel.html",controller:["$scope","$attrs","DataApi","alert","ExpApi","DataHelper","ExpHelper","App","Constant","$q","dataManager",function(a,b,c,d,e,f,g,h,i,j,k){var l=this;a.isSelectTitle=!0,a.Constant=i,a.curApp=h.getApp(),l.resetForm=function(){a.erroTipName="",a.vm={name:"",desc:"",formula:""},a.createType="string",a.sucNameStat=!1,a.errNameStat=!1,a.sucFlagStat=!1},a.refresh=function(){a.curOptimizeStats=[],l.curGroup=h.getCurGroup(),a.curGroup=l.curGroup,a.types=[],a.statsData=[],a.statsDatas=[],a.nullDataFig=!1,l.lock=function(){a.locked=!1},l.unlock=function(){a.locked=!0},l.resetForm(),a.$on("panels-stat"+a.namePanel,function(a){l.unlock()}),a.$on("panels-statClose"+a.namePanel,function(a){l.lock()}),c.getStats(h.getAppID()).then(function(b){if(0==b.data.stats.length)return a.nullDataFig=!0;l.sourceStats=angular.copy(b.data.stats);var c=f.getVaildeStats(b.data.stats);a.allValideStats=c,a.statsDatas=a.comstatFig?g.getComStat(c):g.getStat(c),a.statsDatas=_.orderBy(a.statsDatas,"name"),a.sendStatData=g.getStat(c),a.statsData=_.filter(a.statsDatas,function(a){return"UV"!==a.name&&"PV"!==a.name&&!a.name.startsWith("Event-")&&a.status!==i.STAT_STATUS_DELETE}),l.MakeSelectInStats(c)})},l.MakeSelectInStats=function(b){_.forEach(l.curGroup.control.stats,function(c){var d=_.find(g.getStat(b),["name",c]);d&&a.curOptimizeStats.push(d),_.forEach(a.statsData,function(a){a.name===c&&(a.select=!0)})})},a.refresh(),k.changeState(function(b){var c=_.keys(b);c.forEach(function(c){switch(c){case"curGroupData":l.curGroup=b.curGroupData,a.refresh()}})}),a.clickA=function(){l.resetForm(),a.isSelectTitle=!0},a.clickB=function(){a.isSelectTitle=!1},a.close=function(){l.lock()},a.checkStatFormula=function(b,c){f.checkFormula(c,a.sendStatData)===-1?b.statFormula.$setValidity("checkFormula",!1):b.statFormula.$setValidity("checkFormula",!0)},a.selects=function(b){b.select=!0;var c=a.comstatFig?a.selectComStat():a.selectStat();c(b)},a.nameChange=function(b,c){if(!a.allValideStats)return!1;for(var d={PV:"",UV:""},e=0;e<a.allValideStats.length;e++){var f=a.allValideStats[e];if(f.name===c||d.hasOwnProperty(c))return b.statName.$setValidity("exist",!1)}return b.statName.$setValidity("exist",!0)},l.addingFun=function(b,d){var e=_.keyBy(l.sourceStats,"name");if(e.hasOwnProperty(b)){var g=f.sysStatsChangeNameToChineses(e[b]),j=a.comstatFig?a.selectComStat():a.selectStat();return j(g)}c.updateStats(h.getAppID(),{app_id:h.getAppID(),name:b,description:d,status:i.STAT_STATUS_DEF,formula:""}).then(function(b){var c=f.sysStatsChangeNameToChineses(b.data),d=a.comstatFig?a.selectComStat():a.selectStat();d(c),l.sourceStats?l.sourceStats:[],l.sourceStats.push(b.data)})},a.adding=function(a,b){var c={};return c.name=a,c=f.sysStatsChangeNameToChineses(c),h.getAppType()===i.APP_TYPE_ANDIOD?d.confirm({content:"确定添加【"+c.statName+'】指标?需要在代码中集成，详细参考<a target="_blank" href="http://doc.appadhoc.com/sdk/androidSDK.html#stat">集成说明</a>'},function(){l.addingFun(a,b)}):h.getAppType()===i.APP_TYPE_IOS?d.confirm({content:"确定添加【"+c.statName+'】指标?需要在代码中集成，详细参考<a target="_blank" href="http://doc.appadhoc.com/sdk/iosSDK.html#stat">集成说明</a>'},function(){l.addingFun(a,b)}):void 0},a.create=function(b,d){a.canCreate=!0,f.checkFormula(d.formula,a.sendStatData)!==-1&&b.$valid&&a.canCreate&&(d.select=!0,c.updateStats(h.getAppID(),{app_id:h.getAppID(),name:d.name,description:d.desc||"",status:i.STAT_STATUS_DEF,formula:d.formula}).then(function(b){a.statsData.unshift(d);var c=a.comstatFig?a.selectComStat():a.selectStat();c(b.data),a.close()}))},a.indexCurGroupSatas={},a.$on(i.EVENT_REFRESH_STAT_PANEL,function(){a.refresh()})}]}}]),angular.module("abtesting").directive("testlog",["$log","App","ExpHelper","Constant","ExpApi","AuthApi","$q",function(a,b,c,d,e,f,g){return{templateUrl:"components/testlog/testlog.html",restrict:"EA",scope:{appid:"=",groupid:"=",close:"&"},controller:["$scope","$attrs",function(a,h){function i(e){function f(b){if(!b)return[];for(var c=[],e=0;e<b.length;e++){var f=b[e],g=a.handleFlags(f),h=a.handleStats(f),i=a.getGroupStatus(f.experiment_changes),j=a.getGroupStatus(f.group_change),k=a.handleDelteExp(f);a.trafficShow(f.experiment_changes),c.push({isShow:a.isHideTheData(f),flagsReduceShow:g.flagsReduceShow,flagsReduceArray:g.flagsReduceArray,flagsAddShow:g.flagsAddShow,flagsAddArray:g.flagsAddArray,statsReduceShow:h.statsReduceShow,statsReduceArray:h.statsReduceArray,statsAddShow:h.statsAddShow,statsAddArray:h.statsAddArray,isRun:i==d.EXP_STATUS_RUN,isStop:i==d.EXP_STATUS_STOP,isPublish:j==d.EXP_STATUS_PUBLISH,showDeleteExp:k.showDeleteExp,showDeleteName:k.name,isAddExp:a.isAddExp(f.experiment_changes),experiment_changes:f.experiment_changes,isChangeName:a.isChangeName(f.experiment_changes),created_at:f.created_at,user_id:f.user_id})}return c}a.statsObj={},a.statsObj[d.SYSTEM_STATS_DURATION]="访问时长",a.statsObj["Event-crash"]="崩溃次数",a.statsObj[d.SYSTEM_STATS_VISIT]="访问次数",a.openTestLogFig=!!e.changesLogData,a.changeTime=function(a){return _.isUndefined(a)?"":moment(1e3*a).format("YYYY-MM-DD HH:mm")},a.changesLogData=e.changesLogData,a.handleStats=function(a){var b=angular.toJson(a),c=/("stats":(\[[\d\w_,""-]*\]))/gi,d=b.match(c),e={},f={};if(_.forEach(d,function(a,b){var c="{"+a+"}";e[b]=angular.fromJson(c)}),f.statsReduceShow=!1,e.hasOwnProperty(1)&&e.hasOwnProperty(0)){var g=e[0].stats.concat(),h=e[1].stats.concat();if(g.length-h.length>0)return f.statsReduceShow=!0,f.statsReduceArray=_.pullAll(g,h),f;if(g=e[0].stats.concat(),h=e[1].stats.concat(),h.length-g.length>0)return f.statsAddShow=!0,f.statsAddArray=_.pullAll(h,g),f}return f},a.handleFlags=function(a){var b=angular.toJson(a),c=/([^"]([\d\w]*(?=":[^{])))/gi,d=/("flags":\{[a-zA-Z0-9,_:""]*\})/gi,e=_.uniq(b.match(d)),f=[],g={};if(_.forEach(e,function(a,b){var d=a.match(c)?a.match(c):[];f.push(d)}),f.length>=2){var h=f[0].concat(),i=f[1].concat();h.length-i.length>0&&(g.flagsReduceShow=!0,g.flagsReduceArray=_.pullAll(h,i)),h=f[0].concat(),i=f[1].concat(),i.length-h.length>0&&(g.flagsAddShow=!0,g.flagsAddArray=_.pullAll(i,h))}return g},a.handleDelteExp=function(a){var b=/("name":"[\d\w\u4E00-\u9FA5\uF900-\uFA2D@&*#$]*")/gi,c='"method":"delete"',d={},e=angular.toJson(a),f=_.uniq(e.match(b));return e.indexOf(c)>0&&f.forEach(function(a,b){var c="{"+a+"}",e=angular.fromJson(c);d.name=e.name,d.showDeleteExp=!0}),d};var g=function(){if(e){var a=_.keyBy(e.members,"id");if(b.getCurUser().hasOwnProperty("owner_id")&&e.members.length>0){var c=e.members[0];a[c.owner_id]={email:c.owner_email}}return b.getCurUser().hasOwnProperty("owner_id")||(a[b.getCurUser().id]={email:b.getCurUser().email}),a}};a.indexUsersEmail=g(),a.closeTestLog=function(){var b=a.close();b&&b()},a.openTestLog=function(){a.power=!0},a.$on("openTestLog",function(){a.openTestLog()}),a.changeAddShowForArray=function(a,b){var c=_.keys(a)[0];if(!c)return!1;if(!a[c].after.hasOwnProperty(b)||!a[c].before.hasOwnProperty(b))return!1;var d=0!=_.pullAll(a[c].after,a[c].before).length;return d},a.changeAddShowForObj=function(a,b){var c=_.keys(a)[0];if(!c)return!1;if(!a[c].after.hasOwnProperty(b)||!a[c].before.hasOwnProperty(b))return!1;var d=_.keys(a[c].after[b]).length-_.keys(a[c].before[b]).length>0;return d},a.changeAdd=function(a,b){var c=_.keys(a)[0],d=_.values(a),e=[],f=[];if(!c)return!1;if(!a[c].after.hasOwnProperty(b)||!a[c].before.hasOwnProperty(b))return!1;if("stats"==b){_.forEach(d,function(a){a&&(f.push({value:a.before[b],length:a.before[b].length}),e.push({value:a.after[b],length:a.after[b].length}))});var g=_.reverse(_.orderBy(f,["length"]))[0],h=_.reverse(_.orderBy(e,["length"]))[0];return h&&_.remove(h.value,function(a){if(g.length>0)return g.value.indexOf(a)>=0}),h.value}var i=_.pullAll(a[c].after[b],a[c].before[b]);if(!angular.isArray(i)&&i){var j=_.keys(a[c].before[b]);return _.omit(i,j)}return i},a.noShowKey={"Event-GET_EXPERIMENT_FLAGS":""},a.showKeyWant={"Event-session":"访问次数","Event-duration":"访问时长","Event-crash":"崩溃次数"},a.changeReduceShowForArray=function(a,b){var c=_.keys(a)[0];return!!c&&(!(!a[c].after.hasOwnProperty(b)||!a[c].before.hasOwnProperty(b))&&a[c].before[b].length-a[c].after[b].length>0)},a.changeReduceShowForObj=function(a,b){var c=_.keys(a)[0];return!!c&&(!(!a[c].after.hasOwnProperty(b)||!a[c].before.hasOwnProperty(b))&&_.keys(a[c].before[b]).length-_.keys(a[c].after[b]).length>0)},a.changeReduce=function(a,b){var c=_.keys(a)[0];return!!c&&(!(!a[c].after.hasOwnProperty(b)||!a[c].before.hasOwnProperty(b))&&("flags"==b?_.pullAll(_.keys(a[c].before[b]),_.keys(a[c].after[b])):_.pullAll(a[c].before[b],a[c].after[b])))},a.isAddExp=function(a){var b=_.keys(a)[0];return!!b&&(!(!a[b].hasOwnProperty("after")||!a[b].hasOwnProperty("before"))&&(!(0!=_.keys(a[b].before).length||!a[b].after.hasOwnProperty("name"))||void 0))},a.curExps=c.getValideExpsByGroup(b.getCurGroup()),a.indexCurExps=_.keyBy(a.curExps,"id"),a.changeNoArrayProShow=function(a,b){var c,d=_.keys(a);return 0!=d.length&&(c=d[0],!!c&&(!!a[c].after.hasOwnProperty(b)||void 0))},a.trafficShow=function(a){var b=_.keys(a);b.forEach(function(b){return a[b].after.traffic!=a[b].before.traffic?(a.trafficShow=!0,a[b].trafficShow=!0):(a.hasOwnProperty("trafficShow")&&1==a.trafficShow||(a.trafficShow=!1),a[b].trafficShow=!1,a[b].trafficShow=!1)})},a.getGroupStatus=function(a){if(a){var b=angular.toJson(a),c='after":{"status":"Running"',e='"after":{"status":"Stopped"';return b.indexOf(c)>=0?d.EXP_STATUS_RUN:b.indexOf(e)>=0?d.EXP_STATUS_STOP:void 0}},a.isChangeName=function(a){var b=_.keys(a);return!!(b.length>0&&a[b[0]].after.hasOwnProperty("name")&&a[b[0]].before.hasOwnProperty("name")&&a[b[0]].after.name!==a[b[0]].before.name)},a.isChangeGroupDescription=function(a){return!(!a.group_change.hasOwnProperty("after")||!a.group_change.hasOwnProperty("before"))&&(!(a.group_changele.after.hasOwnProperty("description")||!a.group_change.hasOwnProperty("description"))&&a.group_change.before.description!=a.group_change.after.description)},a.isHideTheData=function(b){var c=b.experiment_changes,d=_.keys(c),e=angular.toJson(b),f='"group_change":{"before":{},"after":{}},"experiment_changes":{}',g='"before":{},"after":{},"trafficShow":false';if(e.indexOf(f)>=0)return!1;if(e.indexOf(g)>=0)return!1;if(d.length>0){var h={flags:{}},i={};if(c[d[0]].after.hasOwnProperty("flags")){var j=angular.toJson(c[d[0]].before),k=angular.toJson(c[d[0]].after.flags),l=_.keys(c[d[0]].after.flags),m=!0;1==l.length&&(_.startsWith(l[0],"_",0)||(m=!1));angular.fromJson(c[d[0].after]);if(j==angular.toJson(h)&&k!=angular.toJson(i)&&m)return!1}}if(b.hasOwnProperty("group_change")&&b.group_change.after.hasOwnProperty("description")&&!c.hasOwnProperty("after"))return!1;if(e.indexOf("flags")>=0){if(a.isChangeName(b.experiment_changes))return!0;if(a.changeReduceShowForArray(b.experiment_changes,"stats")||a.changeAddShowForArray(b.experiment_changes,"stats"))return!0;if(e.indexOf("annotation")>=0)return!0;if(!a.changeAddShowForObj(b.experiment_changes,"flags")&&!a.changeReduceShowForObj(b.experiment_changes,"flags"))return!1}return!0};var h=f(a.changesLogData);a.exportslogs=h}a.Constant=d,g.all([f.getAllMembers(),e.getGroupLog(a.appid,a.groupid)]).then(function(a){var b={};b.members=a[0].data.members,b.changesLogData=a[1].data.change_logs,i(b)})}]}}]),angular.module("abtesting").service("Testlog",["$rootScope","Constant",function(a,b){return{open:function(){a.$broadcast("openTestLog")},close:function(){a.$broadcast("closeTestLog")}}}]),angular.module("abtesting").service("toScroll",function(){return{goAnchor:function(a){var b="#".concat(a),c=$(b);$("body,html").animate({scrollTop:c.offset().top-110},"fast")}}}),angular.module("abtesting").run(["$templateCache",function(a){a.put("app/NotifyContent/NotifyContent.html",'<div class="ab-modal ab-modal-success"><p class=ab-modal-title ng-bind-html=subject></p><p class=ab-modal-text style="text-align: left" ng-bind-html=megContent></p><div class=ab-modal-btns><button type=button class="ab-btn ab-btn-success" ng-click=cancel() style="width: 190px;height: 40px;margin-left: 20px;font-size: 16px">&nbsp;&nbsp;确定&nbsp;&nbsp;</button></div></div>'),a.put("app/alert/alert.html","<div class=ab-modal ng-class=\"{'ab-modal-question': type == 'query','ab-modal-error': type == 'fail'}\"><div class=ab-modal-text ng-bind-html=opts.content><!-- {{ opts.content }} --></div><div class=ab-modal-btns><button type=button class=\"ab-btn ab-btn-default\" ng-click=ok() ng-class=\"{'ab-btn-success':type == 'success' ,'ab-btn-danger':type == 'fail' }\">确定</button> <button type=button class=\"ab-btn ab-btn-default\" ng-click=cancel() ng-if=\"opts.model == 1\">取消</button></div></div>"),
a.put("app/app/app.html",'<ab-nav style=height:48px></ab-nav><div ui-view="" state-loader class=up></div>'),a.put("app/appAudience/appAudience.html",'<div class=ab-panel><div class=ab-panel-header>受众管理<a class="btn ab-question" uib-tooltip-template="\'appAudience-a.html\'" tooltip-placement=right tabindex=0 tooltip-trigger=focus> <i class="iconfont icon-question201 ab-question201"></i></a></div><div class=ab-panel-padding-body><div ng-if="(!hasgroup && !power) || (!hasgroup && power) || (hasgroup && !power)" style="text-align: center"><p class="fs-18 pt-30">创建受众分组</p><p class="fs-12 pt-20">即将满足条件的用户设置为一个群组，即可实现定向试验: 在选定的用户群中进行A/B测试。</p><div class=appaudience-box ng-if=!power><p class="dxsydiv fs-12"><i class="iconfont icon-crown"></i>&nbsp;您暂无权限使用此功能，请联系客户经理开通。</p></div><div class=appaudience-box ng-if="power && !hasgroup"><p class="dxsydiv fs-12">除了选择系统支持的标签外，您也可以通过代码自定义标签，详情参考<a class=ab-link href=http://doc.lpotest.com/sdk/index.html target=_blank>用户组集成说明</a>。</p><div class=text-center><button type=button class="ab-btn ab-btn-success ab-btn-md" ui-sref=app.config.appAudienceEdit style="margin-top: 24px">创建受众</button></div></div></div><div ng-if="hasgroup && power"><p>除了选择系统支持的标签外，您也可以通过代码自定义标签，详情参照<a class=ab-link href=http://doc.lpotest.com/sdk/index.html target=_blank>用户集成</a></p><p>设置定向试验，请进入试验中的 “运行控制界面”, 在流量面板中选定分组即可</p><table class=ab-table-edit><thead><tr><th>受众分组名称</th><th>描述</th><th>参与试验</th><th></th></tr></thead><tbody><tr ng-repeat="aud in advanceds | filter : showFilter | orderBy: [\'current\', \'-\']"><td><span ng-bind-html=aud.name></span></td><td><span ng-bind-html=aud.description ng-show="aud.cur_description==null"></span></td><td><p ng-repeat="group in indexAudienceGroups[aud.id]">{{group.name}}</p></td><td><button class=icon-success uib-tooltip=编辑受众 uib-tooltip-popup-delay=1000 ng-click=editAudience(aud) ng-show="aud.status<=1"><i class="iconfont icon-14pxedit"></i></button> <button class="icon-error mr15" uib-tooltip=弃用受众 uib-tooltip-popup-delay=1000 ng-click=delAudience(aud) ng-show="aud.status<=1 && indexAudienceGroup[aud.id].length > 0"><i class="iconfont icon-14pxdel"></i></button></td></tr></tbody></table><button class=ab-btn-icon ui-sref=app.config.appAudienceEdit><i class="iconfont icon-add02"></i> 新建受众</button></div></div><script type=text/ng-template id=appAudience-a.html><div class="uib-tooltip-content">\n    <p>设置受众组后，可以在试验中选择，只在选定的受众群体中运行试验。</p>\n    <p>详情参考<a href="http://doc.lpotest.com/expFlow/orientationTest.html" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script></div>'),a.put("app/appAudienceEdit/appAudienceEdit.html",'<div class=ad-edit-box><div class=ad-edit-topicon><i class="icon iconfont icon-free01"></i></div><p class=text-center>受众分组</p><div style="padding: 0 24px"><form class=form-horizontal name=myform novalidate><div class=form-group><label for=detail class="col-sm-2 control-label">分组名称</label><div class="col-sm-8 col-sm-offset-1"><input ng-enter=checkName() class="ab-input ab-input-block" ng-model=curAudience.name placeholder=中英文、数字或下划线 name=name></div></div><div class=form-group><label for=detail class="col-sm-2 control-label">分组描述</label><div class="col-sm-8 col-sm-offset-1"><input ng-enter="" id=description class="ab-input ab-input-block" placeholder=选填 ng-model=curAudience.description name=detail></div></div><div class=form-group><label for=inputPassword3 class="col-sm-2 control-label">受众条件</label><div class="col-sm-9 col-sm-offset-1"><div ng-repeat="item in conditionlist" class=ad-brackets><p></p><div class="ab-select-wrapper ad-fix-level" ng-if="$index > 0"><select class=ab-select ng-model=item.logic data-ng-change=conditionDataChanage() ng-class="{\'ab-height-a\':item.logic == \'or\',\'ab-height-b\':item.logic ==\'and\'}"><option value=or>或者</option><option value=and>并且</option></select></div><p></p><div class=ad-condition-box><i class="iconfont icon-code0301 ad-fix-icon"></i><div class=ad-condition-group ng-repeat="condition in item.conditions"><p></p><div class=ab-select-wrapper ng-if="$index > 0"><select class=ab-select ng-model=condition.logic data-ng-change=conditionDataChanage() ng-class="{\'ab-height-a\':condition.logic == \'or\',\'ab-height-b\':condition.logic ==\'and\'}"><option value=or selected>或者</option><option value=and>并且</option></select></div><p></p><div class=ab-select-wrapper ng-show=!condition.type.custom><select class=ab-select style="max-width: 210px" ng-model=condition.type ng-options="i.name for i in conditions | filter: appTypeFilter" data-ng-change=conditionChange(condition)></select></div><input name=typename ng-show=condition.type.custom ng-model=condition.typename class="ab-input ab-select-wrapper" placeholder=请输入条件名称 data-ng-change=conditionDataChanage() required><div class=ab-select-wrapper><select class=ab-select ng-model=condition.op ng-options="o.label for o in ops | filter: condition.type.type" data-ng-change=conditionDataChanage()></select></div><div class=ab-select-wrapper ng-show=!condition.type.input><select class=ab-select style=max-width:120px ng-options="val for (key,val) in condition.type.options" ng-model=condition.val data-ng-change=conditionDataChanage()></select></div><input name=type.val class="ab-input ab-select-wrapper" ng-model=condition.val data-ng-change=conditionDataChanage() ng-show=condition.type.input placeholder=请输入条件值 required> <a ng-click=resetItem($index,item)><i class="iconfont icon-h5tool701"></i></a></div><a class="btn btn-link" ng-click=addCondition(item)><i class="iconfont icon-add02"></i>添加条件</a></div></div><a class="btn btn-link ad-fix-level" ng-click=addBrackets(item)><i class="iconfont icon-add01"></i>添加括号</a></div></div><div class=form-group><label for=detail class="col-sm-2 control-label">受众表达式</label><div class="col-sm-8 col-sm-offset-1"><pre ng-bind=conditionstr style="min-height: 35px"></pre><div class="clearfix audience-edit-double-btn"><button class="ab-btn ab-btn-default ab-btn-md" ui-sref=app.config.appAudience>&nbsp;&nbsp;&nbsp;取消&nbsp;&nbsp;&nbsp;</button> <button class="ab-btn ab-btn-success ab-btn-md" ng-click=save()>&nbsp;&nbsp;&nbsp;保存&nbsp;&nbsp;&nbsp;</button></div></div></div></form></div></div>'),a.put("app/appConfig/appConfig.html",'<div class=ab-panel><div class=ab-panel-header>SDK</div><div class=ab-panel-padding-body><p class="text-center appconfig-title">App Key</p><div class="sdk-code-appkey ab-cilip"><span ng-copy="copied = true">{{app.app_key}}</span> <i ng-show=copied style=font-size:12px;color:#d2d2d2>复制成功</i> <a uib-tooltip=点击复制 class="iconfont icon-48pxclone ab-sdk-copy" ngclipboard data-clipboard-text={{app.app_key}} ngclipboard-success=onCopySuccess();></a></div><!-- <p class="text-center" >试验变量、优化指标的集成可以与创建试验并行，需保证变量名称、指标名称在代码与平台中一致，否则无法生效。\n            <br>参考<a class="link" href="http://doc.lpotest.com/sdk/index.html" target="_blank">集成说明</a>，或者<a class="link" href="http://doc.lpotest.com/index.html" target="_blank">平台使用说明</a>。\n          <p> --><!-- sdk config --><form novalidate autocomplete=off id=myForms name=nForm ng-show="curApp.typ == Constant.APP_TYPE_IOS || curApp.typ == Constant.APP_TYPE_ANDIOD"><p class="text-center appconfig-title-sdk">SDK配置 <button class="btn ab-question" uib-tooltip-placement=bottom ng-click=openSdkConfig(nForm) ng-show=!editFig type=button><i class="iconfont icon-14pxedit ab-question201"></i></button> <a tabindex=0 class="btn ab-question" tooltip-placement=right uib-tooltip-template="\'sdk-config.html\'" tooltip-trigger=focus><i class="iconfont icon-question201 ab-question201"></i></a></p><h6 class="sdk-tilte text-center">仅对android SDK 2.3.0 、iOS SDK 2.3.3以上生效</h6><div class="text-center sdk-config"><div class=sdk-input><div><p>版本更新间隔时间</p><span class=appconfig-num ng-show=!editFig>{{sdkConfig.getflag_interval}}秒</span><div style="text-align: left"><input name=apitime ng-show=editFig type=number style="min-width:80px; width:100px" ng-model=formTest.apitime min=1 max=259200 class=ab-input required><ab-input-error-box form=nForm input-name=apitime class=sdk-input-errorbox ng-show=editFig><ab-error type=required>不能为空</ab-error><ab-error type=min len=1></ab-error><ab-error type=max len=259200></ab-error></ab-input-error-box></div></div><!--<div>--><!--<p>指标上报间隔时间</p>--><!--<span class="appconfig-num" ng-show="!editFig">{{sdkConfig.track_interval}}秒</span>--><!--<input ng-show="editFig" name="trackertime" type="number" style="min-width:80px; width:100px"  ng-model="formTest.trackertime"  min="1" max="259200" class="ab-input ab-input-block" required>--><!--<ab-input-error-box form="nForm" input-name="trackertime"  class="sdk-input-errorbox" ng-show="editFig">--><!--<ab-error type="required">不能为空</ab-error>--><!--<ab-error type="min" len="1"></ab-error>--><!--<ab-error type="max" len="259200"></ab-error>--><!--</ab-input-error-box>--><!--</div>--><div style=width:100px><p>最小生效版本号</p><span ng-show=!editFig>{{sdkConfig.app_lowest_version}}</span> <input ng-show=editFig name=lowest_version style="min-width:80px; width:100px" ng-model=formTest.lowest_version class=ab-input></div></div><ul ng-show=editFig><li><button class=sdk-save ng-disabled=!nForm.$valid ng-click=verifyPwd()>保存</button> <button ng-click=openSdkConfig(nForm) class=sdk-save>取消</button></li></ul></div></form><div class="ab-grid ab-form-row" ng-show="curApp.typ == Constant.APP_TYPE_H5"><div style=text-align:center><div class=url-version-sdk style="margin:0 auto;width: 577px"><p>请在所有试验页面的&lt;head/&gt;部分加入javascript代码，否则无法读取和编辑页面。<a class=ab-link href=http://doc.lpotest.com/sdk/htmlSDK.html>查看集成文档</a></p><textarea style=overflow-y:hidden;padding:10px class=textarea-code readonly rows=6 id=copy-appconfig>\n              <!-- lpotest sdk -->\n<script src=https://sdk.appadhoc.com/ab.plus.js></script>\n<script>\nlpo(\'init\', {\n  appKey: \'{{app.app_key}}\'\n})\n</script>\n              <!-- lpotest sdk end -->\n            </textarea><div class=appconfig-sdk-copy><i class="iconfont icon-copy" uib-tooltip=点击复制 ng-click=copy()></i> <i class=appconfig-sdk-tip ng-show=copySDKTFlg>复制成功</i></div></div></div></div><!-- <p  class="url-version-copytip">{{copySDkTip}}</p> --></div></div><script type=text/ng-template id=sdk-config.html><div class="uib-tooltip-content">\n     <p>版本更新间隔时间，可降低API调用次数，但同时也会降低用户更新试验版本的频率。</p>\n     <p>最小生效版本号，填写希望参与到试验中的用户所使用的应用版本。低于设定版本号的用户将不会参与试验和产生API调用。</p>\n     <p>详情参考<a href="http://doc.lpotest.com/appExp/createApp.html#sdk" target="_blank" class="ab-link">使用文档</a></p>\n   </div></script>'),a.put("app/appFlags/appFlags.html",'<div class=ab-panel><div class=ab-panel-header>试验变量</div><div class=ab-panel-padding-body><table class=ab-table-edit><thead><tr><th>变量名称</th><th width=40%>说明</th><th>类型</th><th>默认值</th></tr></thead><tbody><tr class="text-center hi" ng-show="flags.length <= 0"><td colspan=4>未设置变量</td></tr><tr ng-repeat="flag in flags" ng-class="{\'ab-table-edit-focus\': flagform.$visible }" ng-click=focusTr(flagform)><td ng-bind=flag.name></td><td><span editable-text=flag.description e-name=description e-form=flagform uib-tooltip=点击修改>{{flag.description}}</span><form editable-form name=flagform ng-show=flagform.$visible onbeforesave=saveFlag($data,flag) class=ab-table-edit-form-inline><button type=submit ng-disabled=flagform.$waiting class=icon-success><i class="iconfont icon-14pxright"></i></button> <button type=button ng-disabled=flagform.$waiting ng-click="cleanForm($event,flagform, flag)" class=icon-error><i class="iconfont icon-14pxwrong"></i></button></form></td><td ng-bind=flag.typ></td><td ng-bind=flag.default_value></td></tr></tbody></table></div></div>'),a.put("app/appForgotPass/appForgotPass.html",'<o-navbar style=height:48px></o-navbar><div class=a-afp-container><div class=app-forget-pass><h3 class=fp-title>找回密码</h3><div class=appforgotpass-content><form novalidate name=nForm><input name=forgetPassword class="ab-input ab-input-block" placeholder=请输入您注册的用户邮箱，我们将会给您发送重置密码链接 ng-model=formTest.forgetPassword required ng-pattern=/^([a-zA-Z0-9_\\.\\-])+\\@(([a-zA-Z0-9\\-])+\\.)+([a-zA-Z0-9]{2,4})+$/ ><ab-input-icon ng-hide=email.tip form=nForm input-name=forgetPassword></ab-input-icon><ab-input-error-box form=nForm input-name=forgetPassword><ab-error type=required custom=true>注册邮箱不能为空</ab-error><ab-error type=pattern custom=true>输入的邮箱格式不对，请重新输入</ab-error></ab-input-error-box><p class=appforgotpass-error ng-bind=email.tip></p><input type=button style="padding:6px 118px" class="ab-btn register-sub" ng-disabled=!nForm.forgetPassword.$valid value=申请找回密码 ng-click=forgotFn()></form></div></div></div>'),a.put("app/appStats/appStats.html",'<div class=ab-panel><div class=ab-panel-header>优化指标</div><div class=ab-panel-padding-body><table class=ab-table-edit><thead><tr><th width=20%>优化指标</th><th width="">说明</th></tr></thead><tbody><tr class=def-info ng-hide=curAppStats><td>暂无数据</td><td></td></tr><tr class=ab-table-edit-control ng-repeat="s in sysStats | orderBy: [\'sysEvent\']"><td><span uib-tooltip={{s.name}} ng-bind-html=s.name></span></td><td><span ng-bind-html=s.description></span></td></tr><tr ng-class="{\'ab-table-edit-focus\': rowform.$visible }" ng-click=focusTr(rowform) ng-repeat="s in curAppStats | ChangeName  | orderBy: [\'sysEvent\', \'current\', \'status\', \'name\']"><td><span uib-tooltip={{s.name}} ng-bind-html=s.name></span></td><td><span editable-text=s.description e-form=rowform e-name=description uib-tooltip="{{s.sysEvent?\'\':\'点击修改\'}}">{{s.description}}</span><form editable-form name=rowform ng-show=rowform.$visible onbeforesave=saveStat($data,s) class=ab-table-edit-form-inline><button type=submit ng-disabled=rowform.$waiting class=icon-success><i class="iconfont icon-14pxright"></i></button> <button type=button ng-disabled=rowform.$waiting ng-click="cleanForm($event,rowform, curExp)" class=icon-error><i class="iconfont icon-14pxwrong"></i></button></form></td></tr></tbody></table><table class=ab-table-edit><thead><tr><th width=20%>复合指标</th><th width=40%>说明</th><th>计算公式</th></tr></thead><tbody><tr class="text-center hi" ng-show="curAppComStats.length <= 0"><td colspan=4>未设置复合指标</td></tr><tr ng-class="{\'ab-table-edit-focus\': comform.$visible }" ng-click="focusTr(comform, s)" ng-repeat="s in curAppComStats | orderBy: [\'sysEvent\', \'name\']"><td><span ng-bind-html=s.name uib-tooltip={{s.name}}></span></td><td><span editable-text=s.description e-name=description e-form=comform uib-tooltip=点击修改>{{s.description}}</span><form editable-form name=comform ng-show=comform.$visible onbeforesave=saveStat($data,s) class=ab-table-edit-form-inline><button type=submit ng-disabled=comform.$waiting class=icon-success><i class="iconfont icon-14pxright"></i></button> <button type=button ng-disabled=comform.$waiting ng-click="cleanForm($event,comform, curExp)" class=icon-error><i class="iconfont icon-14pxwrong"></i></button></form></td><td><span ng-bind=s.formula ng-show="s.cur_formula==null"></span></td></tr></tbody></table></div></div><script type=text/ng-template id=status-a.html><div class="uib-tooltip-content">\n    <p>请确保优化指标已经在代码中正确集成，</p>\n\n    <p>您可在此增加或删除优化指标，</p>\n\n    <p>请注意在试验过程中在后台增加和删除指标不会导致数据统计不完整。</p>\n  </div></script><script type=text/ng-template id=status-b.html><div class="uib-tooltip-content">\n    <p>支持在现有优化指标上进行 + - * / 和 () 运算。</p>\n\n    <p>例如，转化率的复合指标计算公式可以定义为：“ConversionStat/PageviewStat”，</p>\n\n    <p>其中 ConversionStat 和 PageviewStat 需要先定义为优化指标。</p>\n  </div></script>'),a.put("app/appcreate/appcreate.html",'<div class=body-container><div class=app-create-container><div class=ab-grid><div class="ab-col ab-col-16"><div class=ab-panel><div class=ab-panel-header>创建App</div><div class=ab-panel-padding-body><div class=ab-grid><div class="ab-col ab-col-9 ab-col-offset-3"><div class="m-appcreate appcreate"><form novalidate autocomplete=off name=nForm><p>开始A/B测试之前，请先创建您的应用。在此填写应用名称,并选择类型。 在开始试验之前,请在您的应用中集成SDK,详情请参考<a href=http://doc.lpotest.com/sdk/index.html target=_blank class=ab-link>SDK集成文档</a>。有关平台使用请参考<a href=http://doc.lpotest.com target=_blank class=ab-link>使用说明</a>。</p><div style="margin:24px 0 30px 0"><input name=name class="ab-input ab-input-block" placeholder=请输入项目名称 ng-model=formTest.name required minlength=2 maxlength=30 ng-pattern=/^[A-Za-z_0-9\\u4E00-\\u9FA5]+$/ style="font-size: 14px"><ab-input-icon form=nForm input-name=name></ab-input-icon><ab-input-desc form=nForm input-name=name>只允许字母、数字和中文</ab-input-desc><ab-input-error-box form=nForm input-name=name><ab-error type=required custom=true>请填写应用名称</ab-error><ab-error type=pattern></ab-error><ab-error type=minlength custom=true len=2>您的名称最少2个字符，请重新输入</ab-error></ab-input-error-box></div><div class=appcreate-bot style=padding-bottom:24px><ul class="typelist clearfix ab-form-row"><li><label for=app-h5 class=text-center><i class="icon iconfont appcreate-type-icon icon-web" ng-class="{\'active\':formTest.typ == Constant.APP_TYPE_H5}"></i> <span class=appcreate-type-des>H5</span></label><input class=appcreate-type-hide type=radio id=app-h5 ng-model=formTest.typ value={{Constant.APP_TYPE_H5}} required></li><li><label for=app-android class=text-center><i class="icon iconfont appcreate-type-icon icon-14pxandroid" ng-class="{\'active\':formTest.typ == Constant.APP_TYPE_ANDIOD}"></i> <span class=appcreate-type-des>Android</span></label><input class=appcreate-type-hide type=radio id=app-android ng-model=formTest.typ value={{Constant.APP_TYPE_ANDIOD}} required></li><li><label for=app-ios class=text-center><i class="icon iconfont appcreate-type-icon icon-14pxapple" ng-class="{\'active\':formTest.typ == Constant.APP_TYPE_IOS}"></i> <span class=appcreate-type-des>IOS</span></label><input class=appcreate-type-hide type=radio id=app-ios value={{Constant.APP_TYPE_IOS}} ng-model=formTest.typ required></li><li ng-show=isLpoRole><label for=app-lpo class=text-center><i class="icon iconfont appcreate-type-icon icon-px_LPO" ng-class="{\'active\':formTest.typ == Constant.APP_TYPE_LPO}"></i> <span class=appcreate-type-des>LPO</span></label><input class=appcreate-type-hide type=radio id=app-lpo value={{Constant.APP_TYPE_LPO}} ng-model=formTest.typ required></li><!-- <li>\n          <label for="app-code" class="text-center"  >\n            <i class="icon iconfont appcreate-type-icon icon-code01" ng-class="{\'active\':formTest.typ == Constant.APP_TYPE_DEF}"></i>\n            <span class="appcreate-type-des" >其他</span>\n          </label>\n          <input  class="appcreate-type-hide" type="radio" id="app-code" value={{Constant.APP_TYPE_DEF}}  ng-model="formTest.typ"  required>\n        </li> --></ul><a class="ab-btn ab-btn-default ab-btn-md" ui-sref=app.appmanage ng-hide=succesPanel><i class="icon iconfont icon-left01"></i>&nbsp;返回列表</a> <button class="ab-btn ab-btn-success ab-btn-md ab-form-row" ng-hide=succesPanel ng-disabled=!nForm.$valid ng-click=sub()>完成</button><div ng-show=succesPanel><!--<p>应用唯一的APPKey如下,请在您的应用中集成SDK, 详情请参考<a class="ab-link" href="http://doc.lpotest.com/sdk/index.html" target="_blank">SDK集成文档</a></p>--><!--<div class="app-create-sdk-box ab-form-row">--><!--<span>APP Key: {{curAppObj.app_key}}</span>--><!--<i uib-tooltip="点击复制" class="iconfont icon-48pxclone app-copy" ngclipboard data-clipboard-text={{app.app_key}} ngclipboard-success="onCopySuccess();"></i>--><!--<span ng-show="copied"  class="appcreate-copy-tip">复制成功</span>--><!--</div>--><div><a class="ab-btn ab-btn-default ab-btn-md" ui-sref=app.appmanage><i class="icon iconfont icon-left01"></i>&nbsp;返回列表</a> <a class="ab-btn ab-btn-success ab-btn-md" ng-click=toCreate()>&nbsp;&nbsp;&nbsp;创建A/B测试&nbsp;&nbsp;&nbsp;</a></div></div></div></form></div></div></div></div></div></div></div></div></div>'),a.put("app/appinfo/appinfo.html",'<div class=app-container><div class=container><div class=ab-panel><div class=ab-panel-header>应用信息</div><div class=ab-panel-body><table class="table table-blue table-no"><thead><tr><th width=245 class=m-h-54>应用名称</th><th width=410 class=m-h-54>AppKey</th><th width=541 class=m-h-54>应用链接</th></tr></thead><tbody><tr><th><i class="w-20 m-ai-logo icon iconfont icon-14pxandroid" ng-if="curApp.typ == Constant.APP_TYPE_ANDIOD"></i> <i class="w-20 m-ai-logo icon iconfont icon-14pxh5" ng-if="curApp.typ == Constant.APP_TYPE_H5"></i> <i class="w-20 m-ai-logo icon iconfont icon-14pxapple" ng-if="curApp.typ == Constant.APP_TYPE_IOS"></i> <span ng-bind=curApp.name></span></th><td ng-bind=curApp.app_key></td><td class=m-ai-td><form novalidate name=nForm><div class=m-ai-link><input class=no-act ng-model=curApp.url ng-blur=update() ng-enter=update()></div></form></td></tr></tbody></table></div></div><div class=m-ai-back ng-click=back()><i class="icon iconfont icon-left01"></i> <span>返回</span></div></div></div>'),a.put("app/appmanage/appmanage.html",'<loading ng-hide=isLoading></loading><div class=m-am-content style=position:relative ng-if=isLoading><div class="apm-bar ab-grid" style=background-color:white><div class="m-am-nav ab-col ab-col-16" style="border-bottom: 1px solid #d2d2d2">应用列表<!--<button class="m-mt-16 m-di ab-btn ab-btn-default ab-btn-oval ab-btn-sm" style="margin-right: 15px;margin-left: 20px;" ng-click="openApp(demoApp)">编程试验Demo</button>--><!--\n         -<button class="m-mt-16 m-di ab-btn ab-btn-default ab-btn-oval ab-btn-sm" ng-click="openApp(h5demoApp)" style="margin-left: 20px;">Demo</button>\n         --> <button class="m-fr btn ab-icontext-btn" ng-click=create() style="margin-top: 10px"><i class="iconfont icon-add02"></i>新建应用</button><!--<a href="http://doc.lpotest.com/sdk/index.html" target="_blank" class="ab-link m-am-nav-m">查看集成文档</a>--></div></div><div class=ab-grid><div class="ab-col ab-col-16"><div ng-if="myApps.length == 0 && colapps.length == 0" ng-click=create()><p class=ab-tac>您还没有创建应用，请点击添加</p><div class="ab-def-add m-am-add"><div></div><div></div></div></div><table class=m-am-tab ng-if="myApps.length > 0 ||  colapps.length > 0"><thead><tr><th width=250>应用名称</th><th width=70%>AppKey</th><th width=225>操作</th></tr></thead><tbody><tr ng-class-even="\'apm-list-even\'" ng-repeat="item in myApps"><td><i class="w-20 logo icon iconfont" ng-class="{\'icon-14pxapple\':item.typ == Constant.APP_TYPE_IOS, \'icon-14pxandroid\': item.typ == Constant.APP_TYPE_ANDIOD, \'icon-14pxh5\': item.typ == Constant.APP_TYPE_H5, \'icon-code01\': item.typ == Constant.APP_TYPE_DEF, \'icon-px_LPO\': item.typ == Constant.APP_TYPE_LPO}"></i> <span class=w-200 ng-bind=item.name></span></td><td ng-bind=item.app_key></td><td><a href=javascript:; ng-click=openApp(item) class=ab-fontchangecolor-blacktogreen><span>进入应用</span> <i class="icon iconfont icon-right01"></i> </a><a href=javascript:; ng-click=delAppBymyapps(item) class=ab-fontchangecolor-blacktogreen><span>删除</span></a></td></tr><tr ng-class-even="\'apm-list-even\'" ng-repeat="item in colapps track by $index"><td><i class="w-20 logo icon iconfont" ng-class="{\'icon-14pxapple\':item.typ == Constant.APP_TYPE_IOS, \'icon-14pxandroid\': item.typ == Constant.APP_TYPE_ANDIOD, \'icon-14pxh5\': item.typ == Constant.APP_TYPE_H5,  \'icon-code01\': item.typ == Constant.APP_TYPE_DEF}"></i> <span class=w-200 ng-bind=item.name></span></td><td ng-bind=item.app_key></td><td><a href=javascript:; ng-click=openApp(item) class=ab-fontchangecolor-blacktogreen><span>进入应用</span> <i class="icon iconfont icon-right01"></i> </a><a href=javascript:; ng-click=delAppBycolapps(item) class=ab-fontchangecolor-blacktogreen><span>删除</span></a></td></tr></tbody></table></div></div></div>'),a.put("app/changeEmail/changeEmail.html",'<div class=a-cp-container><div class="m change-email-panel ab-panel"><h3 class=change-email-tiltle>修改邮箱</h3><div class="content change-email-ab-btn"><form name=nForm novalidate autocomplete=off><div class="change-email-margn change-email-margnb"><input type=email name=oldEmail class="ab-input ab-input-block" placeholder=现有邮箱 value="{{curUser.email }}" disabled required></div><div style=margin-bottom:20px><input type=email name=email class="ab-input ab-input-block" placeholder=新邮箱 ng-model=formTest.email required ng-pattern=emailRegexp><ab-input-icon form=nForm input-name=email></ab-input-icon><ab-input-error-box form=nForm input-name=email><ab-error type=required custom=true>邮箱不能为空</ab-error><ab-error type=pattern custom=true>邮箱格式错误，请重新输入</ab-error></ab-input-error-box><p ng-bind=emailErrorTip></p></div><div style=position:relative><input type=email name=emailTwo class="ab-input ab-input-block" placeholder=请再次填写新邮箱 ng-model=formTest.emailTwo required ng-pattern=emailRegexp ng-change=checkRepeatEmail(nForm)><ab-input-icon form=nForm input-name=emailTwo></ab-input-icon><ab-input-error-box form=nForm input-name=emailTwo><ab-error type=required custom=true>邮箱不能为空</ab-error><ab-error type=pattern custom=true>邮箱格式错误，请重新输入</ab-error><ab-error type=repact custom=true>两次邮箱不一致</ab-error></ab-input-error-box></div><button type=button class="ab-btn change-email-sub" ng-disabled="!nForm.$valid || nForm.emailTwo.$$rawModelValue != nForm.email.$$rawModelValue" ng-click=sub() style="width: 100%">修改邮箱</button></form></div></div></div>'),a.put("app/changePass/changePass.html",'<div class=a-cp-container><div class="ab-panel change-pass-panel"><div style=background:#eee><h3 class=change-pass-tiltle>账号信息</h3></div><div class="ab-panel-body change-pass-panel-body"><p class="change-pass-panel-p change-pass-panel-p-border"><span>账号：{{curUser.email}}</span></p><p class=change-pass-panel-p ng-class="{\'change-pass-panel-p-border\':curUser.owner_email}"><span>等级：{{roles[curUser.role].name}}</span></p><p ng-show=curUser.owner_email class=change-pass-panel-p style=border-style:none><span>所属团队：{{curUser.owner_email}},如果需要邀请新成员和修改权限，请联系该账户。</span></p></div></div><div class="ab-panel change-pass-panel"><div style=background:#eee><h3 class=change-pass-tiltle>付费状态</h3></div><div class="ab-panel-body change-pass-panel-body"><div class=ab-oh><div class=changepass-history>当前状态</div><div class=changepass-history-status><p>{{curUserStatus}}</p><p ng-if=apiMax>本月API上限{{apiMax}}</p><p ng-if=endDate>到期时间:{{endDate}}</p><p><a class=ab-link href=https://www.appadhoc.com/charge.html target=_blank>计费说明</a></p></div></div><div class=changepass-history-panel><div class=changepass-history>历史消耗</div><div class=changepass-history-status><div class=btn-group uib-dropdown uib-keyboard-history><button id=simple-btn-keyboard-history type=button class="btn btn-down btn-down-lg" uib-dropdown-toggle>{{curHistory}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role=menu aria-labelledby=simple-btn-keyboard-history><li class=dropdown-item role=menuitem ng-repeat="m in historyList " ng-click=searchHistoryConsumption(m)><span ng-bind=m.history uib-tooltip-html="\'{{m.history}}\'"></span></li></ul></div><div class=ab-mgt10><p>api调用：{{allDailyApiCount}}</p><p>月活：{{allUV}}</p></div></div></div></div></div><div class="m change-pass-panel ab-panel"><h3 class=change-pass-tiltle>修改密码</h3><div class="content change-pass-ab-btn"><form name=nForm novalidate autocomplete=off><div class="change-pass-margn change-pass-margnb"><input type=password name=oldPassword class="ab-input ab-input-block" placeholder=用户旧密码 ng-model=formTest.oldPassword required><ab-input-icon form=nForm input-name=oldPassword></ab-input-icon><ab-input-error-box form=nForm input-name=oldPassword><ab-error type=required custom=true>密码不能为空</ab-error><ab-error type=pattern custom=true>密码格式错误，请重新输入</ab-error></ab-input-error-box><p ng-bind=passwordErrorTip></p></div><div style=margin-bottom:20px><input type=password name=password class="ab-input ab-input-block" placeholder=密码需要8位以上字符，带英文字母与数字或特殊符号 ng-model=formTest.password required ng-change=changePass(formTest.password)><ab-input-icon form=nForm input-name=password></ab-input-icon><ab-input-error-box form=nForm input-name=password><ab-error type=required custom=true>密码不能为空</ab-error><ab-error type=pattern custom=true>密码格式错误，请重新输入</ab-error></ab-input-error-box><p ng-bind=passwordErrorTip></p></div><div class="register-mb ab-oh register-pass-test"><div class=r ng-class="{\'register-pass-active\':acTest,\'register-pass\':!acTest}"><span>8位以上</span> <i class="icon iconfont icon-checkmark01 reg-icon" ng-show=acTest></i></div><div class=r ng-class="{\'register-pass-active\':nuTest,\'register-pass\':!nuTest}"><span>数字或特殊符号</span> <i class="icon iconfont icon-checkmark01 reg-icon" ng-show=nuTest></i></div><div class=r ng-class="{\'register-pass-active\':enTest,\'register-pass\':!enTest}"><span>英文字母</span> <i class="icon iconfont icon-checkmark01 reg-icon" ng-show=enTest></i></div></div><div style=position:relative><input type=password name=passwordTwo class="ab-input ab-input-block" ng-class="{\'register-passtwo-tip\':nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue}" placeholder=请再次填写相同密码 ng-model=formTest.passwordTwo required><ab-input-icon form=nForm input-name=passwordTwo ng-hide=" nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue"></ab-input-icon><ab-input-error-box form=nForm input-name=passwordTwo><ab-error type=required custom=true>密码不能为空</ab-error></ab-input-error-box><i class="iconfont icon-bigwrong01 ab-input-icon-wrong register-passtwo-erroicon" ng-show=" nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue"></i><p ng-show=" nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue" class=errorTip>两次密码不一致</p></div><button type=button class="ab-btn change-pass-back" ng-click=back()><i class="icon iconfont icon-left01" style="margin: 3px 4px 0px -6px"></i>返回</button> <input type=button class="ab-btn change-pass-sub" value=修改密码 ng-disabled="!nForm.$valid || nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue" ng-click=sub() style="width: 68%"></form></div></div></div>'),a.put("app/config/config.html",'<div class=body-container><!-- tab bar box --><div class=app-config-tabbar><div class=ab-btn-group><button class="btn ab-btn-press-lg" ui-sref=app.config.appConfig ui-sref-active=active>应用配置</button> <button class="btn ab-btn-press-lg" ui-sref=app.config.appAudience ui-sref-active=active>定向受众</button> <button class="btn ab-btn-press-lg" ui-sref=app.config.appFlags ui-sref-active=active>试验变量</button> <button class="btn ab-btn-press-lg" ui-sref=app.config.appStats ui-sref-active=active>优化指标</button></div></div><!-- config container box --><div class=ab-grid><div class="ab-col ab-col-16"><div class=app-config-container ui-view></div></div></div></div>'),a.put("app/create/create.html",'<div class=body-container><div class=container-h5><div class=ab-grid><div class="ab-col ab-col-1"><div style=width:100%;visibility:hidden>2213</div><ul class=create-menu-anchor><li><a>1</a></li></ul></div><div class="ab-col ab-col-15"><div class=ab-panel style="margin-top: 5px"><div class=ab-panel-header>1. 基本信息</div><div class=ab-panel-padding-body><form novalidate name=nForm><div class=ab-grid><div class="ab-col ab-col-10 ab-col-offset-3"><div class=ab-form-row><input ng-model=group.name class="ab-input ab-input-block ab-input-14" required name=name ng-pattern=/^[\\u4e00-\\u9fa5A-Za-z][\\u4e00-\\u9fa5a-zA-Z0-9_]*$/ placeholder=输入试验名称 exist=indexGroupName><ab-input-icon form=nForm input-name=name></ab-input-icon><ab-input-error-box form=nForm input-name=name><ab-error type=required custom=true>试验名称不能为空</ab-error><ab-error type=pattern custom=true>请输入合法的试验名称</ab-error><ab-error type=exist custom=true>试验名称已存在</ab-error></ab-input-error-box></div><div class=ab-form-row><input class="ab-input ab-input-block" name=description ng-model=group.description placeholder=输入试验描述></div><!-- select layer begin --><div class=create-layer ng-if=layerRole><div><layer on-select=changeLayer></layer><a tabindex=0 class="btn ab-question" tooltip-placement=right uib-tooltip-template="\'create-layer-a.html\'" tooltip-trigger=focus><i class="iconfont icon-question201 ab-question201"></i></a></div></div><!-- select layer end --><ul class="page-index-lists clearfix ab-grid"><li ng-if=h5 class=ab-col-3><a ng-class="{\'on\': on == Constant.EXP_TYPE_BUILD}" href=javascript:; ng-click=select(Constant.EXP_TYPE_BUILD)><i class="ab-fontgray iconfont icon-eye01"></i> <span>可视化模式&nbsp; <button class="btn ab-question" tabindex=0 tooltip-placement=bottom tooltip-trigger=focus uib-tooltip-template="\'h5index-tip-build.html\'" style=padding-left:0 type=button><i class="iconfont icon-question201 ab-question201"></i></button></span></a></li><li ng-if=android class=ab-col-3><a ng-class="{\'on\': on == Constant.EXP_TYPE_BUILD}" href=javascript:; ng-click=select(Constant.EXP_TYPE_BUILD)><i class="ab-fontgray iconfont icon-eye01"></i> <span>可视化模式&nbsp; <button class="btn ab-question" tabindex=0 tooltip-placement=bottom tooltip-trigger=focus uib-tooltip-template="\'h5index-tip-build.html\'" style=padding-left:0 type=button><i class="iconfont icon-question201 ab-question201"></i></button> </span></a><span style=color:#a0a0a0 ng-if=!androidRole><a class=ab-link href=https://www.appadhoc.com/charge.html target=_block>请联系客户经理开通</a></span></li><li ng-if=ios class=ab-col-3><a ng-class="{\'on\': on == Constant.EXP_TYPE_BUILD}" href=javascript:; ng-click=select(Constant.EXP_TYPE_BUILD)><i class="ab-fontgray iconfont icon-eye01"></i> <span>可视化模式&nbsp; <button class="btn ab-question" tabindex=0 tooltip-placement=bottom tooltip-trigger=focus uib-tooltip-template="\'h5index-tip-build.html\'" style=padding-left:0 type=button><i class="iconfont icon-question201 ab-question201"></i></button> </span></a><span style=color:#a0a0a0 ng-if=!iosRole><a class=ab-link href=https://www.appadhoc.com/charge.html target=_block>请联系客户经理开通</a></span></li><li class=ab-col-3><a ng-class="{\'on\': on == Constant.EXP_TYPE_CODE}" href=javascript:; ng-click=select(Constant.EXP_TYPE_CODE)><i class="ab-fontgray iconfont icon-code0201"></i> <span>编程模式&nbsp; <button class="btn ab-question" tabindex=0 tooltip-placement=bottom tooltip-trigger=focus uib-tooltip-template="\'h5index-tip-code.html\'" style=padding-left:0 type=button><i class="iconfont icon-question201 ab-question201"></i></button></span></a></li><li ng-if=urlSpliteRole class=ab-col-3><a ng-class="{\'on\': on == Constant.EXP_TYPE_URL}" href=javascript:; ng-click=select(Constant.EXP_TYPE_URL)><i class="ab-fontgray iconfont icon-url201"></i> <span>多链接模式&nbsp; <button class="btn ab-question" tabindex=0 tooltip-placement=bottom tooltip-trigger=focus uib-tooltip-template="\'h5index-tip-url.html\'" style=padding-left:0 type=button><i class="iconfont icon-question201 ab-question201"></i></button></span></a></li></ul><div ng-if="type == Constant.EXP_TYPE_BUILD && android" class=ab-form-row><p>请在手机上安装 <a href=http://doc.lpotest.com/sdk/testTools.html target=_blank>Tester</a>，然后进入编辑器编辑试验版本。</p></div><div ng-if="type == Constant.EXP_TYPE_BUILD && ios" class=ab-form-row><p>请在APP中加入<a href=http://doc.lpotest.com/sdk/iosSDK.html#debug target=_blank>[调试代码]</a>，之后启动APP点击悬浮按钮进入编辑器。</p></div><div ng-if="type == Constant.EXP_TYPE_BUILD && h5" class=ab-form-row><div><div ng-repeat="url in urls" class="ab-grid clearfix"><div class="ab-col ab-col-4" style="padding-left: 0"><div class=ab-select-wrapper ng-show="mode == REGEXP_MODE"><select class=ab-select ng-init=initURLObj(url) ng-model=url.mode><option value=equal selected>完全匹配</option><option value=regex>模糊匹配</option></select></div><a tabindex=0 class="btn ab-question" tooltip-placement=right uib-tooltip-template="\'h5urls-b.html\'" tooltip-trigger=focus style="padding-top: 5px;padding-left:12px;position:absolute"><i class="iconfont icon-question201 ab-question201"></i></a></div><div class="form-group-24 ab-col ab-col-12" ng-class="{\'ab-col-12\': mode == DEFAULT_MODE, \'ab-col-12\': mode == REGEXP_MODE}"><input type=url name=url ng-model=url.url class="ab-input ab-input-block" ng-change=changeURL(url.url) placeholder=请填写完整的试验页面链接，用于加载编辑器 required><ab-input-icon form=nForm input-name=url></ab-input-icon><ab-input-error-box form=nForm input-name=url><ab-error type=required custom=true>请填写页面URL</ab-error><ab-error type=url custom=true>URL格式错误</ab-error></ab-input-error-box><div ng-show=isExistParams><p ng-hide=filterParamsSuccess>URL中可能包含无用参数，是否自动去除参数？<br>您也可以自行检查页面链接，有关链接参数的说明请参考<a href=http://doc.lpotest.com/H5exp/Visual.html#newl target=_blank class=ab-link>使用帮助</a>。</p><p ng-show="filterParamsFail || filterParamsFail">URL参数过滤失败,请自行检查页面链接，有关链接参数的说明请参考<a href=http://doc.lpotest.com/H5exp/Visual.html#newl target=_blank class=ab-link>使用帮助</a>。</p><p ng-show=filterParamsSuccess>识别到的渠道参数是:{{h5FlagTmplKeywords || \'无\'}}</p><div class=ab-form-ab ng-hide=filterParmasFail><button type=button class="ab-btn ab-btn-success ab-btn-sm" ng-click=autoFilterParams(url.url) ng-hide=filterParamsSuccess>自动过滤URL参数</button></div></div></div><div class="ab-col ab-col-4"></div><div class="form-group-24 ab-col ab-col-12 ab-col-offset-4"><input name="{{ \'gurl\' + $index }}" ng-model=url.regexp class="ab-input ab-input-block" ng-if="url.mode == \'regex\'" placeholder=请填写包含通配符的规则链接 required><ab-input-icon form=nForm input-name="{{\'grul\'+ $index}}"></ab-input-icon><ab-input-error-box form=nForm input-name="{{\'gurl\' + $index}}"><ab-error type=required custom=true>规则链接必填</ab-error></ab-input-error-box><!--<div ng-show="nForm.$submitted || nForm[\'gurl\' + $index].$touched">--><!--<span class="text-danger" ng-show="form[\'gurl\' + $index].$error.required">规则链接必填</span>--><!--</div>--></div></div></div><div ng-if=isExpEnv><div class="ab-col ab-col-4">试验环境: <a tabindex=0 class="btn ab-question" tooltip-placement=right uib-tooltip-template="\'env-a.html\'" tooltip-trigger=focus style="padding-top: 2px;padding-left:12px;position:absolute"><i class="iconfont icon-question201 ab-question201"></i></a></div><div class="ab-col ab-col-5"><div class=ab-select-wrapper><select class=ab-select name=envs ng-options="i as i.iname for i in envs" ng-model=selectEnvs.select></select></div></div></div><br><br></div></div></div><div class="ab-grid ab-form-row" ng-show=h5><div class="ab-col ab-col-9 ab-col-offset-3"><!--<div class="url-version-sdk" style="position:relative;width:98%;">--><!--<p>请在所有试验页面的&lt;head/&gt;部分加入javascript代码，否则无法读取和编辑页面。</p>--><!--<textarea style="overflow-y:hidden" class="textarea-code" readonly="readonly" rows="6" id="copy-url-sdk">--><!--[> adhoc sdk <]--><!--<script src="https://sdk.appadhoc.com/ab.plus.js"></script>--><!--<script>--><!--adhoc(\'init\', {--><!--appKey: \'{{app.app_key}}\'--><!--})--><!--</script>--><!--[> adhoc sdk end <]--><!--</textarea>--><!--<i class="iconfont icon-copy url-version-copy" uib-tooltip="点击复制" ng-click="copy()"></i>--><!--<p  class="url-version-copytip">{{copyTextTip}}</p>--><!--</div>--></div></div><div class="ab-grid ab-form-row" ng-show=ptmindRole><div class="ab-col ab-col-9 ab-col-offset-3"><div class=url-version-sdk style=position:relative;width:98%><p>集成ptmind热图功能，请先开通 <a class=ab-link href=http://www.ptmind.com/ target=_blank>ptmind</a>账号，将以下代码中{{sid}}替换为自己的sid</p><textarea style=overflow-y:hidden class=textarea-code readonly rows=8 id=copy-url-sdk>\n<!-- ptmind sdk -->\n<script>\n    window._pt_lt = new Date().getTime();\n    window._pt_sp_2 = [];\n    _pt_sp_2.push(\'setAccount,{{sid}}\');\n    var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");\n    (function() {\n        var atag = document.createElement(\'script\'); atag.type = \'text/javascript\'; atag.async = true;\n        atag.src = _protocol + \'js.ptengine.cn/{{sid}}.js\';\n        var s = document.getElementsByTagName(\'script\')[0];\n        s.parentNode.insertBefore(atag, s);\n    })();\n</script>\n<!-- ptmidn sdk end -->\n                    </textarea><i class="iconfont icon-copy url-version-copy" uib-tooltip=点击复制 ng-click=copy()></i><p class=url-version-copytip>{{copyTextTip}}</p></div></div></div><div class="ab-grid ab-form-row"><div class="ab-col ab-col-offset-7"><button type=submit class="ab-btn ab-btn-success ab-btn-md" ng-click=nextStep(nForm) ng-disabled="submitPadding || !curLayer">下一步&nbsp;&nbsp;<i class="iconfont icon-14pxd"></i></button></div></div></form></div></div></div></div></div></div><script type=text/ng-template id=h5index-tip-code.html><div class="tooltip-content">\n编程模式试验提供更多自定义的功能，需要在代码中进行集成。\n<p ng-if="h5">详情参考<a href="http://doc.lpotest.com/H5exp/" target="_blank" class="ab-link">使用文档</a></p>\n<p ng-if="android || ios">详情参考<a href="http://doc.lpotest.com/mobileexp/" target="_blank" class="ab-link">使用文档</a></p>\n<p ng-if="!android&&!ios&&!h5">详情参考<a href="http://doc.lpotest.com/expFlow/" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script><script type=text/ng-template id=h5index-tip-build.html><div class="tooltip-content">\n    通过可视化编辑器创建试验版本、追踪元素点击，目前支持编辑页面中元素的图片、文字、颜色和尺寸等。\n    <p ng-if="h5">详情参考<a href="http://doc.lpotest.com/H5exp/" target="_blank" class="ab-link">使用文档</a></p>\n    <p ng-if="android || ios">详情参考<a href="http://doc.lpotest.com/mobileexp/" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script><script type=text/ng-template id=h5index-tip-url.html><div class="tooltip-content">\n  将多个URL合并分流。当用户访问试验URL时，将会自动分流到各个试验页面中，并获取行为数据。\n  <p ng-if="h5">详情参考<a href="http://doc.lpotest.com/H5exp/" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script><script type=text/ng-template id=create-layer-a.html><div class="tooltip-content" style="width:150px">\n  <p>如果您希望试验之间流量互不重叠，可选择将试验放在同一层；</p>\n  <p>如果希望使用较多流量，可选择将试验放在不同的层。详情参考<a class="ab-link" href="http://doc.lpotest.com/expFlow/stratifiedFlow.html" target="_blank">使用说明</a>。</p>\n </div></script><script type=text/ng-template id=h5urls-b.html><div class="tooltip-content h5urls-tooltip-content">\n       <h5>完全匹配：</h5>\n       <p>请填写完整的页面链接，只有用户访问的页面完全匹配该网址试验才会生效。</p>\n       <h5>模糊匹配：</h5>\n       <p>可使用通配符*代替任意字符串，例如http://www.lpotest.com/*.html 。同时，您需要填写<br>一个真实的完整链接用于加载编辑器，例如 http://www.appadhoc.com/index.html</p>\n       <p>详情参考<a href="http://doc.lpotest.com/H5exp/Visual.html#new" target="_blank" class="ab-link">使用文档</a></p>\n    </div></script><script type=text/ng-template id=env-a.html><div class="tooltip-content h5urls-tooltip-content">\n       <h5>试验环境：</h5>\n       <p>选择试验环境后，只有在指定的环境中试验才会生效。</p>\n    </div></script>'),
a.put("app/createInfo/createInfo.html",'<div class=body-container><div class=container-h5><div class=ab-grid><div class="ab-col ab-col-1"><div style=width:100%;visibility:hidden>2213</div><ul class=create-menu-anchor><li ng-click=goStep(1)><a>1</a></li><li ng-show="$state.includes(\'app.createInfo.expversion\') || $state.includes(\'app.createInfo.lists\') || $state.includes(\'app.createInfo.url\')" ng-click=goStep(2)><a>2</a></li><li ng-show="$state.includes(\'app.createInfo.expversion.expInfo\') || $state.includes(\'app.createInfo.lists.expInfo\') || $state.includes(\'app.createInfo.url.stats\')" ng-click=goStep(3)><a>3</a></li></ul></div><div class="ab-col ab-col-15"><div class=ab-panel style="margin-top: 5px" id=createinfo><div class=ab-panel-header>1. 基本信息</div><div class=ab-panel-padding-body><div class=ab-grid><div class="ab-col ab-col-16 createinfo-one-content"><div class=ab-form-row><div class="ab-col ab-col-13"><p class="createinfo-one-name createinfo-text-overflow">{{ curGroup.name }}</p><div class="createinfo-one-description createinfo-text-overflow"><form name=urlForm editable-form onaftersave=saveTestURL() novailidata noautocomplate style="min-height: 24px; line-height: 24px"><span editable-text=curGroup.description e-name=url e-class="ab-input ab-input-block">{{ curGroup.description || \'点击此处填写试验描述\'}}</span> <span><button type=button class=icon-success ng-click=urlForm.$show() ng-show=!urlForm.$visible><i class="iconfont icon-14pxedit"></i></button><!-- buttons to submit / cancel form --> <span ng-show=urlForm.$visible><button type=submit class="ab-btn ab-btn-primary ab-btn-sm" ng-disabled=urlForm.$waiting>保存</button> <button type=button class="ab-btn ab-btn-default ab-btn-sm" ng-disabled=urlForm.$waiting ng-click=urlForm.$cancel()>取消</button></span></span></form></div><p class="createinfo-one-layer createinfo-text-overflow">{{ curLayerName }}</p></div><div class="ab-col ab-col-3 creatinfo-one-icon"><ul class="page-index-lists clearfix"><li ng-if="curGroup.typ === Constant.EXP_TYPE_BUILD"><a class=on href=javascript:;><i class="ab-fontgray iconfont icon-eye01"></i> <span>可视化模式</span></a></li><li ng-if="curGroup.typ === Constant.EXP_TYPE_CODE"><a class=on href=javascript:;><i class="ab-fontgray iconfont icon-code0201"></i> <span>编程模式</span></a></li><li ng-if="curGroup.typ === Constant.EXP_TYPE_URL"><a class=on href=javascript:;><i class="ab-fontgray iconfont icon-url201"></i> <span>多链接模式</span></a></li></ul></div></div></div></div></div></div><div ui-view></div></div></div></div></div><script type=text/ng-template id=h5index-tip-code.html><div class="tooltip-content">\n编程模式试验提供更多自定义的功能，需要在代码中进行集成。\n  </div></script><script type=text/ng-template id=h5index-tip-build.html><div class="tooltip-content">\n    通过可视化编辑器创建试验版本、追踪元素点击，目前支持编辑页面中元素的图片、文字、颜色和尺寸等。\n  </div></script><script type=text/ng-template id=h5index-tip-url.html><div class="tooltip-content">\n  将多个URL合并分流。当用户访问试验URL时，将会自动分流到各个试验页面中，并获取行为数据。\n  </div></script><script type=text/ng-template id=create-layer-a.html><div class="tooltip-content" style="width:150px">\n  <p>如果您希望试验之间流量互不重叠，可选择将试验放在同一层；</p>\n  <p>如果希望使用较多流量，可选择将试验放在不同的层。详情参考<a class="ab-link" href="http://doc.lpotest.comexpFlow/stratifiedFlow.html" target="_blank">使用说明</a>。</p>\n </div></script><script type=text/ng-template id=h5urls-b.html><div class="tooltip-content h5urls-tooltip-content">\n       <h5>完全匹配：</h5>\n       <p>请填写完整的页面链接，只有用户访问该链接时才会进入试验。（默认匹配以?连接的后缀，<br>例如页面链接 http://www.lpotest.com/index.html?q=a ，<br>只需填写http://www.appadhoc.com/index.html 即可。）</p>\n       <h5>模糊匹配：</h5>\n       <p>可使用通配符*代替任意字符串，例如http://www.lpotest.com/*.html 。同时，您需要填写<br>一个真实的完整链接用于加载编辑器，例如 http://www.appadhoc.com/index.html</p>\n       <p><a class="ab-link" href="http://doc.lpotest.comview/create.html#链接匹配" target="_blank">详情参考文档</a></p>\n    </div></script>'),a.put("app/data/data.html","<navbar id=main-anchor></navbar><actionbar></actionbar><sliding-menu></sliding-menu><div class=app-container><div class=main-container ui-view state-loader></div></div>"),a.put("app/detail/detail.html",'<!--<div class="clearfix mb20">\n  <div uib-dropdown class="btn-group">\n    <button uib-dropdown-toggle class="btn btn-default" type="button" id="segmenu">\n      细分：{{current_segment}}\n      <span class="caret"></span>\n    </button>\n    <ul uib-dropdown-menu role="menu" aria-labelledby="segmenu">\n      <li role="menuitem"><a class="action" tabindex="-1" ng-click="changeSegment()">所有用户</a></li>\n      <li class="divider"></li>\n      <li role="menuitem" ng-repeat="seg in segments"><a class="action" tabindex="-1" ng-click="changeSegment(seg)">{{seg.keyname}} ({{seg.value}})</a></li>\n    </ul>\n  </div>\n</div>--><div class=ab-panel id=detail><div class=ab-panel-header style="min-width: 990px"><div class=ab-panel-left-box><div class=btn-group uib-dropdown uib-keyboard-nav><button id=simple-btn-keyboard-nav type=button class="btn btn-down-noborder btn-down-md" uib-dropdown-toggle ng-disabled=disabled>{{curStat.hasOwnProperty(\'statName\')? curStat.statName:curStat.name}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem ng-repeat="m in curStats track by $index | ChangeName" ng-click=changeStat(m) ng-show=!m.formula><span ng-bind="m.hasOwnProperty(\'statName\') ? m.statName : m.name" uib-tooltip-html="\'{{m.hasOwnProperty(\'statName\') ? m.statName : m.name}}<br/>{{m.description}}\'"></span></li></ul></div><a class="btn ab-question" uib-tooltip-template="\'detail-b.html\'" tooltip-placement=right tabindex=0 tooltip-trigger=focus><i class="iconfont icon-question201 ab-question201"></i></a></div><div class="ab-btn-group ab-panel-center-box"><button class="btn ab-btn-press-sm" ng-model=statUnit uib-btn-radio=0>均值</button> <button class="btn ab-btn-press-sm" ng-model=statUnit uib-btn-radio=1>总值</button> <button class="btn ab-btn-press-sm" ng-model=statUnit uib-btn-radio=2>转化人数</button> <button class="btn ab-btn-press-sm" ng-model=statUnit uib-btn-radio=3>转化率</button></div><!-- <div class="ab-btn-group ab-panel-padright-box">\n     <button id="btnPeriodHour" class="btn ab-btn-press-sm" ng-model="chartPeriodStatus" uib-btn-radio="0" uib-tooltip="周期：小时">按时</button>\n     <button id="btnPeriodDay" class="btn ab-btn-press-sm" ng-model="chartPeriodStatus" uib-btn-radio="1" uib-tooltip="周期：天">按日</button>\n   </div> --><div class=ab-panel-right-box><div class=ab-btn-group style="margin-top: -24px"><button id=btnPeriodHour class="btn ab-btn-press-sm" ng-model=chartPeriodStatus uib-btn-radio=0 uib-tooltip=周期：小时>按时</button> <button id=btnPeriodDay class="btn ab-btn-press-sm" ng-model=chartPeriodStatus uib-btn-radio=1 uib-tooltip=周期：天>按日</button></div><p style="width:205px;position: relative;display: inline-block;margin: -8px 0 0 10px"><input date-range-picker class="pull-right btn-time ab-input-date-down date-picker" type=button options=datePickerConfig ng-model=datePicker.date id=summaryFlow><label class="ab-input-date-down-icon iconfont icon-down01" for=summaryFlow></label></p></div></div><div class="ab-panel-padding-body page-charts"><div ng-show=dimensionRole><span style=font-size:14px>维度：</span><div class=btn-group uib-dropdown uib-keyboard-nav><button id=simple-btn-keyboard-nav1 type=button class="btn btn-down btn-down-md" uib-dropdown-toggle ng-disabled=disabledDimension>{{curDimensionsType.name}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-nav1><li class=dropdown-item role=menuitem ng-repeat="m in curDimensionsTypes" ng-click=getCurDimensionsKeys(m)><span ng-bind=m.name uib-tooltip-html="\'{{m.name}}\'"></span></li></ul></div><div class=btn-group uib-dropdown uib-keyboard-nav><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-md" uib-dropdown-toggle ng-show="curDimensionsKey && curDimensionsType.key != \'all\'">{{curDimensionsKey.name}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem ng-repeat="m in curDimensionsKeys" ng-click=getCurDimensionsValues(m)><span ng-bind=m.name uib-tooltip-html="\'{{m.name}}\'"></span></li></ul></div><span style=font-size:14px ng-show="allDimensionsDataFig && curDimensionsType.key != \'all\'">是</span><div class=btn-group uib-dropdown uib-keyboard-nav ng-show="allDimensionsDataFig && curDimensionsType.key != \'all\'"><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-lg" uib-dropdown-toggle ng-disabled=disabled>{{curDimensionsValue}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem ng-repeat="m in curDimensionsValues " ng-click=selectDimension(m)><span ng-bind=m uib-tooltip-html="\'{{m}}\'"></span></li></ul></div><div class="btn-group clearfix" ng-if="lookDimensions && curDimensionsKey"><button class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm" style=margin-left:20px;font-size:14px ng-bind=lookDimensions ng-click=getDimensionsData()></button></div><div style="padding-left: 20px; color:#d2d2d2" class="btn-group clearfix" ng-show="!curDimensionsKey && curDimensionsType.key != \'all\' ">暂无维度数据</div></div><div style=padding-left:15px ng-show=!dimensionRole>维度： <span class=text-muted>暂无权限,请联系客户经理开通。</span></div><div class=ab-grid><ng-echarts class="ab-col ab-col-16" style=padding:0px;height:300px ec-config=trendmapConfig ec-option=trendmapData></ng-echarts></div><ul class="chartist-pie-label list-unstyled list-inline m-mt-20" ng-class="{\'text-center\': exps.length<=10,\'text-left\': exps.length>10}"><li ng-repeat="exp in exps|orderBy:\'created_at\'"><point></point><span ng-bind=exp.name ng-if=!exp.isControl></span> <span ng-if=exp.isControl>原始版本</span></li></ul></div><!-- data table --><div class="ab-panel-padding-body summary-table" table-scroll style=overflow-x:auto><table class=ab-table><thead><tr><th><p class=ab-table-header>版本</p></th><th uib-tooltip-template="\'detail-e.html\'"><p class=ab-table-header>UV</p><p class=ab-table-child-header>系统预置，进入试验版本的访客数</p></th><!-- <th ng-show="curAppType == Constant.APP_TYPE_H5" uib-tooltip-template="\'detail-f.html\'">\n            <p class="ab-table-header">PV</p>\n            <p class="ab-table-child-header">系统预置，试验页面的展示次数</p>\n          </th> --><th><p class=ab-table-header ng-bind="curStat.hasOwnProperty(\'statName\') ? curStat.statName : curStat.name"></p><p class=ab-table-child-header ng-bind=convertStat></p></th><th uib-tooltip-template="\'detail-d.html\'"><p class=ab-table-child-header ng-bind=varianceClients></p></th><th><p class=ab-table-header uib-tooltip-template="\'detail-c.html\'">变化 [95%置信区间]</p></th></tr></thead><tbody><tr ng-repeat="exp in exps|orderBy:\'created_at\'"><td><point></point>&nbsp; <span class=ab-table-child-header uib-tooltip-html="\'原始版本<br/>{{exp.description}}\'" ng-if=exp.isControl>原始版本 &nbsp;({{exp.traffic}}%)</span> <span class=ab-table-child-header uib-tooltip-html="\'{{exp.name}}<br/>{{exp.description}}\'" ng-if=!exp.isControl>{{exp.name}}&nbsp;({{exp.traffic}}%)</span></td><td ng-show="curDimensionsType.key === \'all\'"><div ng-show=!curStatResult[exp.id]>{{indexFabinClientsResults[exp.id] ? indexFabinClientsResults[exp.id].client_sum.toMyPrecision(3) : 0}}</div><div ng-show=curStatResult[exp.id]>{{curStatObject[exp.id] ? curStatObject[exp.id].client_sum.toMyPrecision(3) : 0}}</div></td><td ng-show="curDimensionsType.key !== \'all\'">{{ curStatObject[exp.id] ? curStatObject[exp.id].client_sum.toMyPrecision(3) : 0 }}</td><!-- <td ng-show="curAppType == Constant.APP_TYPE_H5">\n            <div>{{pvSumObject[exp.id]?pvSumObject[exp.id].sum.toMyPrecision(3):0}}</div>\n          </td> --><td><span>{{curStatObject[exp.id]?curStatObject[exp.id].sum.toMyPrecision(3):0}}</span></td><td><span>{{curStatObject[exp.id]?curStatObject[exp.id].mean:0}}</span></td><td><button ng-hide="exp.isControl " class=detail-button-no ng-click="goStatePower(curStat, exp)"><!-- <div class="ab-font16 ab-fontgreen ab-cursor" ng-hide="exp.isControl" > --><!-- <div class="ab-font16 ab-fontgreen ab-cursor" ng-hide="exp.isControl" > --><!-- <ui-variant-percent percent="output_var(exp.name, stat)" uib-tooltip="相比原始版本变化度"></ui-variant-percent> --><ui-variant-percent percent="exp[\'storeExpConfidence\'].variant" uib-tooltip=相比原始版本变化度 ng-show="r.name!==\'原始版本\'" notip=true></ui-variant-percent><ui-ci-range range="exp[\'storeExpConfidence\'].cirang" ng-show="r.name!==\'原始版本\'" uib-tooltip=95%置信区间 notip=true></ui-ci-range></button></td></tr></tbody></table></div></div><script type=text/ng-template id=detail-a.html><div class="uib-tooltip-content">\n    显著性\n      表明该测试版本相比 原始版本 在指标 {{stat}} 上有统计意义上的显著变化，可得出结论。\'无显著变化\'可能是因为活跃用户数不够，或者该测试版本所作改动对用户行为无明显影响。\n  </div></script><script type=text/ng-template id=detail-b.html><div class="tooltip-content">\n    <ul>\n      <li>\n        <strong>折线图</strong> 按时段的指标数据走势\n      </li>\n      <li>\n        <strong>总值</strong> 试验累计指标总值\n      </li>\n      <li><strong>均值</strong>: 指标总值/试验UV</li>\n      <li><strong>转化人数</strong>: 触发事件的人数</li>\n      <li><strong>转化率</strong>: 转化人数/试验UV</li>\n    </ul>\n  </div></script><script type=text/ng-template id=detail-c.html><div class="uib-tooltip-content">\n      <p>变化度表示测试版本较原始版本提升百分比。</p>\n      <p>置信区间描述了测试版本比对照版本在95%的置信水平上的提升范围。</p>\n      <p>例如，当测试版本在试验报告的数据变化中显示为“+55%[+50%,+60%]”。那么版本上线后有95%的机率实现50%-60%的提升。</p>\n    </div></script><script type=text/ng-template id=detail-d.html><div class="uib-tooltip-content">\n      <p>{{curStat.hasOwnProperty(\'statName\')? curStat.statName:curStat.name}}</p>\n      <p>{{varianceClients}}</p>\n    </div></script><script type=text/ng-template id=detail-e.html><div class="tooltip-content">\n    <ul>\n      <li>\n        <p>UV</p>\n        <p>系统预置，进入试验的访客数，累计排重</p>\n      </li>\n    </ul>\n  </div></script><script type=text/ng-template id=detail-f.html><div class="tooltip-content">\n    <ul>\n      <li>\n        <p>PV</p>\n        <p>系统预置，试验页面的展示次数</p>\n      </li>\n    </ul>\n  </div></script><div ui-view></div>'),a.put("app/devtest/devtest.html",'<loading ng-hide=isLoading></loading><div class=ab-panel id=devtest ng-if=isLoading><div class=ab-panel-header>集成调试<div class=devtest-expsbar><ab-tab no-pane=true active=abTabNow><ab-tab-nav title="{{ exp.isControl ? \'原始版本\' : exp.name }}" ng-repeat="exp in curExpsNav"></ab-tab-nav></ab-tab></div></div><div class="panel-heading clearfix" style="padding: 14px 10px">开始试验之前，请确保所有试验页面中已经正确集成SDK和相关代码，否则试验无法生效，您可在此验证集成效果。详情参考<a href=http://doc.lpotest.com/expFlow/debug.html target=_blank class=ab-link>使用文档</a>。</div><div class=ab-panel-padding-body><div class=ab-grid><div class="ab-col ab-col-5"><div class=devtest-build-box ng-if=isShowImg><img class=devtest-img ng-src="{{selectExp.previewImg || \'assets/images/img-loading.bc6fc55b.png\'}}" onerror="this.src=\'assets/images/img-loading.bc6fc55b.png\';this.className=\'pull-left\';" alt=iphone></div><!--  code mode --><div class="ab-exp-list clearfix" ng-show="curGroup.typ == Constant.EXP_TYPE_CODE"><div class="devtest-expitem ab-expitem-header"><div class=ab-expitem-head><span class=ab-expitem-name>变量名称</span></div><div class=ab-expitem-body><div class=ab-expitem-box ng-repeat="(key,val) in selectExp.flags"><span uib-tooltip={{curFlags[key].description}}>{{ curFlags[key].name}}</span><br><span class=ab-expitem-desc>{{curFlags[key].typ}}</span></div><div class=ab-expitem-box ng-show=!selectExp.flags>未添加试验变量</div></div></div><div class=devtest-expitem ng-class="{\'ab-expitem-control\': selectExp.isControl}"><div class=ab-expitem-head><span class="ab-expitem-name ab-expitem-text">{{ selectExp.isControl ? \'原始版本\' : selectExp.name}}</span><br></div><div class=ab-expitem-body><div class=ab-expitem-box ng-repeat="(key, val) in selectExp.flags"><span>{{val}}</span></div><div class=ab-expitem-box ng-show=!selectExp.flags>未添加试验变量</div></div></div></div><!-- code mode end --></div><div class="ab-col ab-col-11"><!-- android or ios experiment show qrcode --><div class=ab-form-row ng-show="curAppType != Constant.APP_TYPE_H5"><qrcode size=98 data={{selectExp.qr_code}} style="margin: 30px 0"></qrcode><p ng-show="curAppType == Constant.APP_TYPE_ANDIOD">调用<a class=ab-link href=http://doc.lpotest.com/sdk/androidSDK.html#debug target=_blank>集成调试</a>代码，启动APP，即可点击悬浮按钮，扫码预览该版本，优化指标将在下表展示。</p><p ng-show="curAppType == Constant.APP_TYPE_IOS">调用<a class=ab-link href=http://doc.lpotest.com/sdk/iosSDK.html target=_blank>集成调试</a>代码，启动APP，即可点击悬浮按钮，扫码预览该版本，优化指标将在下表展示。</p></div><!-- h5 code exp test --><p ng-show="curAppType == Constant.APP_TYPE_H5 && curGroup.typ == Constant.EXP_TYPE_CODE">请填写下面测试页面链接，然后点击按钮即可加入版本。版本纪录将保留在本地，如果要退出版本，请手动清除页面cookie。</p><div class=devtest-code-input ng-show="(curAppType == Constant.APP_TYPE_H5 || curAppType == Constant.APP_TYPE_DEF) && curGroup.typ == Constant.EXP_TYPE_CODE" style="padding-bottom: 30px"><form name=urlForm editable-form onaftersave=saveTestURL() novailidata noautocomplate style="min-height: 24px; line-height: 24px">测试页面链接 : <span editable-url=curGroup.annotation.base_url e-name=url onbeforesave=checkTestURL($data) e-class="ab-input ab-input-block">{{ curGroup.annotation.base_url || \'点击此处填写试验页面链接，然后预览\'}}</span><div class=pull-right><button type=button class=icon-success ng-click=urlForm.$show() ng-show=!urlForm.$visible><i class="iconfont icon-14pxedit"></i></button><!-- buttons to submit / cancel form --> <span ng-show=urlForm.$visible><button type=submit class="ab-btn ab-btn-primary ab-btn-sm" ng-disabled=urlForm.$waiting>保存</button> <button type=button class="ab-btn ab-btn-default ab-btn-sm" ng-disabled=urlForm.$waiting ng-click=urlForm.$cancel()>取消</button></span></div></form></div><div class=ab-form-row ng-show="curAppType == Constant.APP_TYPE_H5 && curGroup.typ == Constant.EXP_TYPE_CODE"><button class="ab-btn ab-btn-default text-center" ng-click=devCodeVersion()>点击预览</button> <button class="ab-btn ab-btn-default text-center" ng-click=makeWeixinDevCode() uib-tooltip="ClientId 用于微信小程序调试">点击生成ClientId</button></div><div class=ab-form-row ng-if="isShowImg && curAppType == Constant.APP_TYPE_H5"><p>点击按钮跳转到您的网站，即可预览该版本，检验版本配置，优化指标将在下表展示。</p><button class="ab-btn ab-btn-default text-center" ng-show="curGroup.typ == Constant.EXP_TYPE_BUILD" ng-click=devVersion()>点击预览</button> <button class="ab-btn ab-btn-default text-center" ng-show="curGroup.typ == Constant.EXP_TYPE_URL" ng-click=devUrlVersion()>点击预览</button></div><!-- dev test data table --><div class="ab-panel-padding-body summary-table" table-scroll style=overflow-x:auto;padding:0px><table class="ab-table abdevest-table"><thead><tr><th ng-repeat="item in sysStats track by $index" style="min-width: 220px" ng-show="item.name !=\'Event-GET_EXPERIMENT_FLAGS\'"><div ng-bind="item.hasOwnProperty(\'statName\')? item.statName:item.name"></div><!--<div class="ab-font12 ab-fonta0a0 ab-cursor" ng-bind="item.description"></div>--></th><th ng-repeat="item in curStats track by $index" style="min-width: 220px"><div ng-bind=item.name></div><!--<div class="ab-font12 ab-fonta0a0 ab-cursor" ng-bind="item.description"></div>--></th></tr></thead><tbody><tr><td ng-repeat="item in sysStats" ng-show="item.name !=\'Event-GET_EXPERIMENT_FLAGS\'"><span ng-show="curAppType !== Constant.APP_TYPE_H5 && item.name !==\'UV\' && item.name!== \'PV\'" ng-bind="dataTable[item.name].hasOwnProperty(\'client_sum \')? dataTable[item.name].client_sum : dataTable[item.name].sum.toMyPrecision(3) || 0"></span> <span ng-bind="dataTable.PV.sum || 0" ng-show="curAppType == Constant.APP_TYPE_H5 && item.name == \'PV\'"></span> <span ng-bind="dataTable.UV.client_sum || 0" ng-show="item.name == \'UV\'"></span></td><!-- <td ng-show="curAppType == Constant.APP_TYPE_H5" ng-bind=""></td> --><td ng-repeat="item in curStats" ng-bind="dataTable[item.name].sum || 0"></td></tr></tbody></table></div><div class=panel-body><br><button type=button class="ab-btn ab-btn-default ab-btn-block" ng-click=refreshData()>刷新数据</button></div><!-- dev test table data end --></div></div></div></div>'),a.put("app/error/error.html",'<div class=error-page><p>网络好像开小差了，请稍后刷新重试...</p><div class=error-img></div><button class="ab-btn ab-btn-success ab-btn-md error-refresh" ng-click=refresh()>刷新</button></div>'),a.put("app/exps/exps.html",'<div class=body-container><div class=exps-menus><button type=button class=exps-create-btn ui-sref=app.create><i class="iconfont icon-14pxadd"></i>&nbsp;创建试验</button><ul class=exps-menus-list><li><a ng-click="curTabIndex = 0" ng-class="{\'active\': curTabIndex == 0}"><i class="iconfont icon-px_All"></i>全部</a></li><li><a ng-click="curTabIndex = 1" ng-class="{\'active\': curTabIndex == 1}"><i class="iconfont icon-px_Stop"></i>未开始</a></li><li><a ng-click="curTabIndex = 2" ng-class="{\'active\': curTabIndex == 2}"><i class="iconfont icon-px_Start"></i>运行中</a></li><li><a ng-click="curTabIndex = 4" ng-class="{\'active\': curTabIndex == 4}"><i class="iconfont icon-px_Stopwatch"></i>已停止</a></li></ul><div style=padding:20px><input class="ab-input ab-input-block" name=search id=search ng-model=searchKey ng-enter=search() placeholder=搜索></div></div><div class=exp-container><div ng-if="currentPageStores.length < 1 && expgroups.length > 0" class=exps-menu-list-def><p><i class="iconfont icon-abMan"></i>&nbsp;您没有 <span ng-show="radioModel == Constant.EXP_STATUS_DEF">未运行的</span> <span ng-show="radioModel == Constant.EXP_STATUS_RUN">运行中的</span> <span ng-show="radioModel== Constant.EXP_STATUS_STOP">已停止的</span> 试验</p></div><div ng-if="expgroups.length == 0" class=exps-def-box><p class=exps-def-box-title>点击创建您的第一个试验</p><div style="margin-bottom: 48px"><button class="ab-btn ab-btn-success ab-btn-md" ui-sref=app.create><i class="iconfont icon-add"></i>&nbsp;创建试验</button></div><!--<p>在开始试验前,请确保您的应用已经正确集成SDK。您的APPKey为:</p>--><!--<div class="sdk-code-appkey ab-cilip">--><!--<span > AppKey: {{app.app_key}}</span>--><!--<i uib-tooltip="点击复制" class="iconfont icon-48pxclone ab-sdk-copy"  ngclipboard data-clipboard-text={{app.app_key}} ngclipboard-success="onCopySuccess();"></i>--><!--<span ng-show="copied"  class="sdk-copy-tip">复制成功</span>--><!--</div>--><!--<a class="ab-link" href="http://doc.lpotest.com/sdk/">点击查看集成文档</a>--></div><loading ng-hide=isLoading></loading><div ng-show="currentPageStores.length > 0"><ul><li style=background-color:#fff><ul ng-repeat="g in currentPageStores|orderBy:\'-control.created_at\'"><ab-exp-item></ab-exp-item><hr ng-hide=$last style="width:95%;border-top:1px solid #d2d2d2;margin: 0 30px"></ul></li></ul><nav class=text-center><uib-pagination total-items=totalItems ng-model=currentPage ng-change=select(currentPage) max-size=5 items-per-page=numPerPage rotate=false previous-text=&lsaquo; next-text=&rsaquo;></uib-pagination></nav></div></div></div>'),a.put("app/expstats/expInfo.html",'<div class=ab-panel id=expinfo><div class=ab-panel-header>3.优化指标 <button class="btn ab-question" uib-tooltip-template="\'expinfo-tooltip-a.html\'" tooltip-placement=right tooltip-trigger=focus><i class="iconfont icon-question201 ab-question201"></i></button></div><div class=ab-panel-padding-body><table class=ab-table-edit><thead><tr><th width=20%>指标名称</th><th width=80%>说明</th><th></th></tr></thead><tbody><!-- <tr class="ab-table-edit-control" ng-repeat="s in sysStats | orderBy: [\'sysEvent\']">\n                   <td><span uib-tooltip= {{s.name}} ng-bind-html=" s.hasOwnProperty(\'statName\')?s.statName:s.name"></span></td>\n                   <td>\n                     <span ng-bind-html="s.description" ></span>\n                   </td>\n                   <td></td>\n                 </tr> --><tr class=ab-table-edit-control ng-repeat="s in sysStats  | orderBy: [\'sysEvent\']"><td><span uib-tooltip={{s.name}} ng-bind-html="s.hasOwnProperty(\'statName\')? s.statName:s.name"></span> <button ng-click=removeStatHandler($event,s) class=icon-del uib-tooltip=删除指标 ng-show="!rowform.$visible && s.name!= \'UV\' && s.name !=\'PV\'"><i class="iconfont icon-14pxdel"></i></button></td><td><span ng-bind=s.description e-name=description e-placeholder=描述信息 e-form=rowform></span> <a ng-show="s.name !=\'UV\' && s.name != \'PV\' && curAppType == Constant.APP_TYPE_ANDIOD" target=_blank href=http://doc.lpotest.com/sdk/androidSDK.html#stat>集成文档</a> <a ng-show="s.name !=\'UV\' && s.name != \'PV\' && curAppType == Constant.APP_TYPE_IOS" target=_blank href=http://doc.lpotest.com/sdk/iosSDK.html#stat>集成文档</a><form editable-form name=rowform ng-show=rowform.$visible onbeforesave=saveStat($data,s) class=ab-table-edit-form-inline><button type=submit ng-disabled=rowform.$waiting class=icon-success><i class="iconfont icon-14pxright"></i></button> <button type=button ng-disabled=rowform.$waiting ng-click="cleanStatForm($event,rowform, curExp)" class=icon-error><i class="iconfont icon-14pxwrong"></i></button></form></td><td></td></tr><tr ng-class="{\'ab-jable-edit-focus\': rowform.$visible }" ng-click="focusTr(rowform, s)" ng-repeat="s in curGroupStats | ChangeName | orderBy: [\'sysEvent\', \'name\']"><td><span uib-tooltip={{s.name}} ng-bind-html=s.name></span> <button ng-click=removeStatHandler($event,s) class=icon-del uib-tooltip=删除指标 ng-show=!rowform.$visible><i class="iconfont icon-14pxdel"></i></button></td><td><span editable-text=s.description e-name=description e-placeholder=描述信息 e-form=rowform uib-tooltip="{{s.sysEvent?\'\':\'点击修改\'}}">{{s.description}}</span><form editable-form name=rowform ng-show=rowform.$visible onbeforesave=saveStat($data,s) class=ab-table-edit-form-inline><button type=submit ng-disabled=rowform.$waiting class=icon-success><i class="iconfont icon-14pxright"></i></button> <button type=button ng-disabled=rowform.$waiting ng-click="cleanStatForm($event,rowform, curExp)" class=icon-error><i class="iconfont icon-14pxwrong"></i></button></form></td><td ng-init="s.isAutoSate = isAutoState(s)"><i ng-show=s.isAutoSate uib-tooltip=通过编辑器添加 class="iconfont icon-link0201"></i></td></tr><tr class=def-info ng-hide=curGroupStats><td>暂无数据</td><td></td><td></td></tr></tbody></table><div class=ab-form-row><button type=button ng-show=isShowUrlSpliteExp class=ab-btn-icon ng-click=addAutoState()><i class="iconfont icon-add02"></i>跟踪元素点击</button> <button type=button ng-show="isShowBuilderExp&& urls" class=ab-btn-icon ng-click=addBuilderState()><i class="iconfont icon-add02"></i>跟踪元素点击</button> <button type=button ng-show=isShowIosBuilderExp class=ab-btn-icon ng-click=addIosBuilderState()><i class="iconfont icon-add02"></i>跟踪元素点击</button> <button type=button ng-show=isShowAndriodBuilderExp class=ab-btn-icon ng-click=addAndroidBuilderState()><i class="iconfont icon-add02"></i>跟踪元素点击</button> <button type=button class=ab-btn-icon ng-click=adding()><i class="iconfont icon-add02"></i>添加编程指标</button></div><div><stat-panle name-panel=s select-stat=selectStatHandler></stat-panle></div><table class=ab-table-edit><thead><tr><th width=20%>复合指标名称</th><th width=40%>说明</th><th width=40%>计算公式</th></tr></thead><tbody><tr class="text-center hi" ng-show="curGroupComStats.length <= 0 && comlisting"><td colspan=4>未设置复合指标</td></tr><tr ng-class="{\'ab-table-edit-focus\': comform.$visible }" ng-click="focusTr(comform, s)" ng-repeat="s in curGroupComStats | orderBy: [\'sysEvent\',\'name\']"><td><span ng-bind-html=s.name uib-tooltip={{s.name}}></span> <button ng-click=deleteComStat($event,s) class=icon-del uib-tooltip=删除指标 ng-show=!comform.$visible><i class="iconfont icon-14pxdel"></i></button></td><td><span editable-text=s.description e-name=description e-placeholder=描述信息 e-form=comform uib-tooltip="{{s.sysEvent?\'\':\'点击修改\'}}">{{s.description }}</span><form editable-form name=comform ng-show=comform.$visible onbeforesave=saveComStat($data,s) class=ab-table-edit-form-inline><button type=submit ng-disabled=comform.$waiting class=icon-success><i class="iconfont icon-14pxright"></i></button> <button type=button ng-disabled=comform.$waiting ng-click="cleanStatForm($event,comform, curExp)" class=icon-error><i class="iconfont icon-14pxwrong"></i></button></form></td><td><span editable-text=s.formula e-name=formula e-placeholder=计算公式 e-form=comform onbeforesave=checkComFormula($data) e-disabled=false>{{s.formula}}</span></td></tr></tbody></table><div class=ab-form-row><button type=button class=ab-btn-icon ng-click=addingComStat()><i class="iconfont icon-add02"></i>添加复合指标</button></div><div><stat-panle name-panel=ss select-com-stat=selectComStatHandler class=expInfo-comstat-input curgroup=curGroupComStats comstat-fig=true></stat-panle></div><div class="ab-grid ab-form-row"><div class=ab-col-16 style=text-align:center><button type=button class="ab-btn ab-btn-success ab-btn-md" ng-click=nextStep()>完成</button></div></div><script type=text/ng-template id=status.html><div class="uib-tooltip-content">\n              试验中需要追踪的数据项，通过可视化编辑器添加。在试验运行时也可以编辑优化指标，编辑后即时生效。\n            </div></script><script type=text/ng-template id=comstats.html><div class="uib-tooltip-content">\n              支持在现有优化指标上进行 + - * / 和 () 运算。例如，转化率的复合指标计算公式可以定义为：“ConversionStat/PageviewStat”，其中 ConversionStat 和 PageviewStat 需要先定义为优化指标。\n            </div></script></div></div><script type=text/ng-template id=expinfo-tooltip-a.html><div class="uib-tooltip-content">\n    <p>优化指标即您在本次测试中所要验证或优化的数据项，例如按钮的点击次数。<br>\n      在编程模式下，您需要在代码中集成优化指标，此处填写的名称必须与代码中一致。 参见<a class="ab-link" href="http://doc.lpotest.com/sdk/htmlSDK.html#上报指标" target="_blank">SDK集成文档。</a></p>\n    <p>复合指标用来将已有的优化指标进行组合计算，它包含一个计算公式，用来在已有优化指标的基础上计算出一个复合型的指标数值。<br>\n\n    计算公式：支持在现有优化指标上进行 + - * / 和 () 运算。例如，转化率的复合指标计算公式可以定义为：“ConversionStat/PageviewStat”，转化次数 ConversionStat 和页面浏览量 PageviewStat 都是需要汇报的优化指标</p>\n  </div></script>'),a.put("app/expversion/expversion.html",'<div class=ab-panel id=expversion><div class=ab-panel-header>2. 试验版本<button class="btn ab-question" uib-tooltip-template="\'expversion-tooltip-a.html\'" tooltip-placement=right tooltip-trigger=focus><i class="iconfont icon-question201 ab-question201"></i></button></div><div class=ab-panel-padding-body><div class="ab-exp-list ab-form-row clearfix"><div class="ab-expitem ab-expitem-header" id=step1><div class=ab-expitem-head><span class=ab-expitem-name>变量名称</span></div><div class=ab-expitem-body><div class=ab-expitem-box ng-repeat="flag in curFlags"><span uib-tooltip={{flag.name}} class="ab-breakword ab-w180">{{flag.name}}</span><br><span class=ab-expitem-desc>{{flag.typ}}</span> <a class=ab-btn-icon-delflag ng-click=delFlag(flag) uib-tooltip=删除变量><i class="iconfont icon-clouse01"></i></a></div><div class=ab-expitem-box ng-show="curFlags.length === 0">未添加试验变量</div></div></div><div class=ab-expitem ng-class="{\'ab-expitem-control\': exp.isControl}" ng-repeat="exp in curExps | orderBy: \'created_at\'" id="{{\'step-\' + $index }}"><div class=ab-expitem-head><span editable-text=exp.name e-name=name e-class=ab-input class="ab-expitem-name ab-expitem-text" e-placeholder=版本名称 e-form=expform onbeforesave=checkExpName($data)>{{exp.isControl ? \'原始版本\' :exp.name}}</span><br><span editable-text=exp.description e-name=description e-class=ab-input class=ab-expitem-text e-placeholder=版本描述 e-form=expform>{{exp.description}}</span><div class=ab-expitem-groups ng-if=!exp.isControl ng-show=!expform.$visible><button class=ab-btn-icon-edit ng-click="focusTr(expform, exp)" uib-tooltip=编辑版本 id="{{\'step-edit-\' + $index}}"><i class="iconfont icon-14pxedit"></i></button> <button class=ab-btn-icon-del ng-click="removeExp($event, exp)" uib-tooltip=删除版本><i class="iconfont icon-14pxdel"></i></button></div></div><div class=ab-expitem-body><div class=ab-expitem-box ng-repeat="flag in curFlags"><span ng-if="flag.typ === \'String\'" editable-text=exp.flags[flag.name] e-name=flag.name e-class=ab-input e-placeholder=值 onbeforesave=checkFlags($data,flag.typ) e-form=expform edit-disabled={{exp.isControl}} class="ab-breakword ab-w180" uib-tooltip={{exp.flags[flag.name]}}>{{ exp.flags[flag.name]}} </span><span ng-if="flag.typ === \'Number\' || flag.typ === \'Integer\'" editable-number=exp.flags[flag.name] e-name=flag.name e-class=ab-input e-placeholder=值 onbeforesave=checkFlags($data,flag.typ) e-form=expform edit-disabled={{exp.isControl}}>{{ exp.flags[flag.name]}} </span><span ng-if="flag.typ === \'Boolean\'" editable-select=exp.flags[flag.name] e-name=flag.name e-form=expform e-ng-options="s.val as s.key for s in types">{{ exp.flags[flag.name] }}</span></div><div class=ab-expitem-box ng-show="curFlags.length === 0">未添加试验变量</div></div><div class="ab-expitem-footer clearfix" ng-show="expform.$visible && !exp.isControl"><form editable-form name=expform onbeforesave=saveExp($data,exp) class="form-buttons form-inline" shown="inserted == exp"><button type=submit class="ab-btn ab-btn-success pull-right" ng-disabled=rowform.$waiting>确定</button> <button type=button class="ab-btn ab-btn-default pull-right" style=margin-right:12px ng-disabled=rowform.$waiting ng-click="cleanForm($event, expform, exp)">取消</button></form></div></div></div><flag-panle select-flag=select close=flagPanleClose curgroup=curFlags></flag-panle><div class=ab-form-row><button class=ab-btn-icon ng-click=addExps()><i class="iconfont icon-add02"></i> 添加版本</button> <button class=ab-btn-icon ng-click=opens() id=first-add-flag><i class="iconfont icon-add02"></i> 添加变量</button></div><div class="ab-grid ab-form-row"><div class="ab-col ab-col-offset-7"><button class="ab-btn ab-btn-success ab-btn-md" ng-click=next()>下一步&nbsp;<i class="iconfont icon-14pxd"></i></button></div></div></div></div><div ui-view></div><script type=text/ng-template id=integrateddebug-tipNewExp.html><div >\n    <ul>\n    <li align=\'left\'>{{val}}</li>\n    <li align=\'center\'> 单击进行编辑</li>\n    </ul>\n  </div></script><script type=text/ng-template id=integrateddebug-tipNewExpDescri.html><div >\n    <ul>\n    <li align=\'left\'>{{curExp.description}}</li>\n    <li align=\'center\'> 单击进行编辑</li>\n    </ul>\n  </div></script><script type=text/ng-template id=aa.html><div >\n    <ul>\n    <li ng-show="curExp.isControl">原始版本不可编辑</li>\n    <li ng-show="!rowform.$visible && !curExp.isControl" align=\'center\'> 单击进行编辑</li>\n    <li ng-show="rowform.$visible"></li>\n    </ul>\n  </div></script><script type=text/ng-template id=expversion-tooltip-a.html><div >\n    <p>试验版本即将要进行对比测试的不同产品方案。</p>\n\n    <p>试验版本通过试验变量控制。首先明确您将要进行测试的版本方案，例如一个按钮的不同色值和大小，则需要两个试验变量BtnColor和BtnSize。之后建立试验版本，为每个版本填写对应的值。</p>\n\n\n    您需要将变量集成到代码中。 参见<a class="ab-link" href="http://doc.lpotest.com/sdk/htmlSDK.html" target="_blank">SDK集成文档</a>。<br>\n    变量的默认值表示在原始的版本中对应的值，请务必正确填写。<br>\n    变量的名称必须与代码中一致，否则无法生效。<br>\n    在同一应用下创建的试验变量可以被其他试验调用，在引用已有的变量时，请确认代码中已经正确集成。<br>\n    <p ng-if="h5">详情参考<a href="http://doc.lpotest.com/H5exp/coding.html#ver" target="_blank" class="ab-link">使用文档</a></p>\n    <p ng-if="android || ios">详情参考<a href="http://doc.lpotest.com/mobileexp/coding.html#ver" target="_blank" class="ab-link">使用文档</a></p>\n    <p ng-if="!android&&!ios&&!h5">详情参考<a href="http://doc.lpotest.com/expFlow/ver.html" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script>'),
a.put("app/forgotPass/forgotPass.html",'<o-navbar style=height:56px></o-navbar><div class=m-fp-container><div class="m forgot-pass"><h3 class="m-mb-8 cpTitle">找回密码</h3><div class="content login-ab-btn"><form novalidate name=nForm autocomplete=off><div class=logind><input type=password name=password class="ab-input ab-input-block" placeholder=请填写密码 ng-model=formTest.password required ng-change=changePass(formTest.password)><!--<ab-input-icon form="nForm" input-name="password"></ab-input-icon>--><!--<ab-input-error-box form="nForm" input-name="password">--><!--<ab-error type="required" custom="true">密码不能为空</ab-error>--><!--<ab-error type="pattern" custom =\'true\'>密码格式错误，请重新输入</ab-error>--><!--</ab-input-error-box>--><!--<p class="errorTip" ng-bind="passwordErrorTip"></p>--></div><div class="register-mb ab-oh register-pass-test"><div class=r ng-class="{\'register-pass-active\':acTest,\'register-pass\':!acTest}"><span>8位以上</span> <i class="icon iconfont icon-checkmark01 reg-icon" ng-show=acTest></i></div><div class=r ng-class="{\'register-pass-active\':nuTest,\'register-pass\':!nuTest}"><span>数字或特殊符号</span> <i class="icon iconfont icon-checkmark01 reg-icon" ng-show=nuTest></i></div><div class=r ng-class="{\'register-pass-active\':enTest,\'register-pass\':!enTest}"><span>英文字母</span> <i class="icon iconfont icon-checkmark01 reg-icon" ng-show=enTest></i></div></div><div style=position:relative><input type=password name=passwordTwo class="ab-input ab-input-block" ng-class="{\'register-passtwo-tip\':nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue}" placeholder=请再次填写相同密码 ng-model=formTest.passwordTwo required><ab-input-icon form=nForm input-name=passwordTwo ng-hide=" nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue"></ab-input-icon><ab-input-error-box form=nForm input-name=passwordTwo><ab-error type=required custom=true>密码不能为空</ab-error></ab-input-error-box><i class="iconfont icon-bigwrong01 ab-input-icon-wrong register-passtwo-erroicon" ng-show=" nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue"></i><p ng-show=" nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue" class=errorTip>两次密码不一致</p></div><button class="ab-btn register-sub" ng-disabled="!nForm.$valid || nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue" ng-click=sub()>重置密码</button></form></div></div></div>'),a.put("app/forgotPassSuc/forgotPassSuc.html",'<o-navbar style=height:56px></o-navbar><div class=m-fps-container><div class="m forgot-pass-suc"><h3 class="m-mb-8 cp-title">找回密码</h3><div class=content><form novalidate name=nForm><p class=fps-tip>您的登录密码已经重置生效。</p><a class=sub ui-sref=login>点此登录</a></form></div></div></div>'),a.put("app/h5/h5.html","<stepbar></stepbar><div class=app-container><div class=container-h5><div class=container ui-view state-loader></div></div></div>"),a.put("app/h5index/h5index.html",'<div class=clearfix><div class=m-h5i-mainl><h3 class="page-index-tit text-center">创建试验</h3><p class="page-index-tip text-center">请选择试验类型</p><div class=page-index-listbox><ul class="page-index-lists clearfix"><li ng-if=h5><a ng-class="{\'on\': on == Constant.EXP_TYPE_BUILD}" href=javascript:; ng-click=select(Constant.EXP_TYPE_BUILD)><i class="ab-fontgray iconfont icon-eye01"></i> <span>可视化编辑模式&nbsp;<i class="iconfont icon-question01" tooltip-placement=bottom uib-tooltip-template="\'h5index-tip-build.html\'" style=color:#d2d2d2></i> </span></a><span style=color:#a0a0a0 ng-if=!h5Role>新版本即将发布<br>敬请期待</span></li><!-- <li ng-if="android">\n          <a ng-class="{\'on\': on == Constant.EXP_TYPE_BUILD}" href="javascript:;" ng-click="select(Constant.EXP_TYPE_BUILD)">\n            <i class="ab-fontgray iconfont icon-eye01"></i>\n            <span>可视化编辑模式&nbsp;<i class="iconfont icon-question01" tooltip-placement="bottom" uib-tooltip-template="\'h5index-tip-build.html\'" style="color:#d2d2d2"></i> </span>\n          </a>\n        </li> --><li><a ng-class="{\'on\': on == Constant.EXP_TYPE_CODE}" href=javascript:; ng-click=select(Constant.EXP_TYPE_CODE)><i class="ab-fontgray iconfont icon-code0201"></i> <span>编程模式&nbsp;<i class="iconfont icon-question01" tooltip-placement=bottom uib-tooltip-template="\'h5index-tip-code.html\'" style=color:#d2d2d2></i></span></a></li><li ng-if=urlSpliteRole><a ng-class="{\'on\': on == Constant.EXP_TYPE_URL}" href=javascript:; ng-click=select(Constant.EXP_TYPE_URL)><i class="ab-fontgray iconfont icon-url201"></i> <span>多链接合并模式&nbsp;<i class="iconfont icon-question01" tooltip-placement=bottom uib-tooltip-template="\'h5index-tip-url.html\'" style=color:#d2d2d2></i></span></a></li></ul></div><div class=clearfix><button type=button class="ab-btn ab-btn-success ab-btn-md pull-right" ng-click=nextStep()>下一步&nbsp;&nbsp;<i class="iconfont icon-right01"></i></button></div></div></div><script type=text/ng-template id=h5index-tip-code.html><div class="tooltip-content">\n编程模式试验提供更多自定义的功能，需要在代码中进行集成。\n  </div></script><script type=text/ng-template id=h5index-tip-build.html><div class="tooltip-content">\n    通过可视化编辑器创建试验版本、追踪元素点击，目前支持编辑页面中元素的图片、文字、颜色和尺寸等。\n  </div></script><script type=text/ng-template id=h5index-tip-url.html><div class="tooltip-content">\n  将多个URL合并分流。当用户访问试验URL时，将会自动分流到各个试验页面中，并获取行为数据。\n  </div></script>'),a.put("app/h5lists/h5lists.html",'<div class=ab-panel id=h5lists><div class=ab-panel-header>2. 试验版本<a class="btn ab-question" uib-tooltip-template="\'lists-a.html\'" tooltip-placement=right tabindex=0 tooltip-trigger=focus> <i class="iconfont icon-question201 ab-question201"></i></a></div><div class="clearfix h5lists-select-url" ng-show="curApp.typ === Constant.APP_TYPE_H5"><!--<div class="col-md-3" ng-show="false">--><!--<div class="btn-group" uib-dropdown uib-keyboard-nav>--><!--<button id="simple-btn-keyboard-nav" type="button" class="btn btn-down btn-down-md" uib-dropdown-toggle >--><!--{{selectURL.url}}--><!--</button>--><!--<ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role="menu" aria-labelledby="simple-btn-keyboard-nav">--><!--<li class="dropdown-item" role="menuitem" ng-repeat="url in urls" ng-click="selectURLHandler(url)">{{dic[url.mode]}}<p class="dropdown-item-br">{{url.url}}</p>--><!--</ul>--><!--</div>--><!--</div>--><div class=h5lists-url-singeline uib-tooltip="{{selectURL.url}} ">试验链接: ({{ dic[selectURL.mode] }})&nbsp;{{selectURL.url}}<span ng-show="selectURL.mode === \'regex\'" style=margin-left:20px>(匹配规则)&nbsp;{{selectURL.regexp }}</span> &nbsp;&nbsp; <span ng-show=curGroup.control.annotation.keywords>自动匹配过滤的无效参数: {{curGroup.control.annotation.keywords}}</span> <span ng-show=expenv style=margin-left:20px>(试验环境)&nbsp;{{expenv.iname}}</span> <button type=button class="btn ab-icontext-btn pull-right" ng-click=editURL(selectURL)><i class="iconfont icon-14pxeye"></i> 进入编辑器</button></div></div><div class="clearfix h5lists-select-url" ng-show="curApp.typ === Constant.APP_TYPE_ANDIOD"><div class=h5lists-url-singeline>请在手机上安装 <a class=ab-link href=http://doc.lpotest.com/sdk/testTools.html target=_blank>Tester</a>，然后进入编辑器编辑试验版本。 <button type=button class="btn ab-icontext-btn pull-right" ng-click=editMobile()><i class="iconfont icon-14pxeye"></i> 进入编辑器</button></div></div><div class="clearfix h5lists-select-url" ng-show="curApp.typ === Constant.APP_TYPE_IOS"><div class=h5lists-url-singeline>请在APP中加入 <a class=ab-link href=http://doc.lpotest.com/sdk/iosSDK.html#debug target=_blank>[调试代码]</a>，之后启动APP点击悬浮按钮进入编辑器。 <button type=button class="btn ab-icontext-btn pull-right" ng-click=editIosMobile()><i class="iconfont icon-14pxeye"></i> 进入编辑器</button></div></div><div class=ab-panel-padding-body><div class=ab-form-row><exp-build-edit ng-repeat="item in experiments| filter: filterDelExp | orderBy : \'created_at\'" exp=item preview-handler=toExp exps=experiments></exp-build-edit></div><div class=ab-form-row><div class=ab-grid><div class="ab-col ab-col-offset-7"><button class="ab-btn ab-btn-success ab-btn-md" ng-click=nextStep()>下一步&nbsp;&nbsp;<i class="icon iconfont icon-14pxd"></i></button></div></div></div></div></div><div ui-view></div><script type=text/ng-template id=lists-a.html><div class="uib-tooltip-content">\n    <p>将原始网页作为对照版本，通过可视化编辑器生成需要的试验版本。在试验结束之前，可以随时编辑版本。</p>\n    <p>详情参考<a href="http://doc.lpotest.com/H5exp/Visual.html#ver" target="_blank" class="ab-link">使用文档</a></p>\n    <p>\n    请在所有试验页面的< head/>部分加入javascript代码，否则无法读取和编辑页面。集成代码参考 <a href="http://doc.lpotest.com/sdk/htmlSDK.html" target="_blank" class="ab-link"> 使用文档</a>\n    </p>\n  </div></script>'),a.put("app/h5version/h5version.html",'<div class=ab-panel id=h5version><div class=ab-panel-header>试验版本<a class="btn ab-question" tabindex=0 tooltip-trigger=focus uib-tooltip-template="\'h5version.html\'" tooltip-placement=right uib-tooltip-placement=bottom> <i class="iconfont icon-question201 ab-question201"></i></a><div class=ab-panel-right-box><!--<button type="button" class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm" ng-click="edit()">编辑</button>--></div></div><div class="clearfix h5lists-select-url" ng-show="curApp.typ === Constant.APP_TYPE_H5 && group.status == Constant.EXP_STATUS_DEF || curApp.typ === Constant.APP_TYPE_H5 && group.status == Constant.EXP_STATUS_RUN "><div class=h5lists-url-singeline uib-tooltip-template="\'h5-regexp-url.html\'">试验链接: ({{ dic[selectURL.mode] }})&nbsp;<span>{{selectURL.url}}</span> <span ng-show=expenv style=margin-left:20px>(试验环境)&nbsp;{{expenv.iname}}</span> <span ng-show="selectURL.mode === \'regex\'" style=margin-left:20px>(匹配规则)&nbsp;{{selectURL.regexp }}</span> <button type=button class="btn ab-icontext-btn pull-right" ng-click=editURL(selectURL)><i class="iconfont icon-14pxeye"></i> 进入编辑器</button></div></div><div class="clearfix h5lists-select-url" ng-show="curApp.typ === Constant.APP_TYPE_ANDIOD && group.status == Constant.EXP_STATUS_DEF || curApp.typ === Constant.APP_TYPE_ANDIOD && group.status == Constant.EXP_STATUS_RUN "><div class=h5lists-url-singeline>请在手机上安装 <a class=ab-link href=http://doc.lpotest.com/sdk/testTools.html target=_blank>Tester</a>，然后进入编辑器编辑试验版本。 <button type=button class="btn ab-icontext-btn pull-right" ng-click=editMobile()><i class="iconfont icon-14pxeye"></i> 进入编辑器</button></div></div><div class="clearfix h5lists-select-url" ng-show="curApp.typ === Constant.APP_TYPE_IOS && group.status == Constant.EXP_STATUS_DEF || curApp.typ === Constant.APP_TYPE_IOS && group.status == Constant.EXP_STATUS_RUN "><div class=h5lists-url-singeline>请在APP中加入 <a class=ab-link href=http://doc.lpotest.com/sdk/iosSDK.html#debug target=_blank>[调试代码]</a>，之后启动APP点击悬浮按钮进入编辑器。 <button type=button class="btn ab-icontext-btn pull-right" ng-click=editIosMobile()><i class="iconfont icon-14pxeye"></i> 进入编辑器</button></div></div><div class=ab-panel-padding-body><div class="clearfix ab-form-row"><exp-build-edit ng-repeat="item in curExps | orderBy : \'created_at\'" exp=item preview-handler=show exps=curExps></exp-build-edit></div></div><script type=text/ng-template id=h5version.html><div class="uib-tooltip-content">\n        使用可视化编辑器编辑生成的版本。在试验运行中也可以编辑，编辑后将会更新线上版本。\n        <p>\n          请在所有试验页面的< head/>部分加入javascript代码，否则无法读取和编辑页面。集成代码参考 <a href="http://doc.lpotest.com/sdk/htmlSDK.html" target="_blank" class="ab-link"> 使用文档</a>\n        </p>\n      </div></script><script type=text/ng-template id=h5-regexp-url.html><div class="uib-tooltip-content">\n      试验链接: ({{ dic[selectURL.mode] }})&nbsp;{{selectURL.url}}<span ng-show="selectURL.mode === \'regex\'" style="margin-left:19px;">(匹配规则)&nbsp;{{selectURL.regexp }}</span>\n      </div></script></div><div ui-view></div>'),a.put("app/iosMobileEditor/iosMobileEditor.html",'<div class=mobile-wrapper><div class=mobile-alert-wrapper ng-show="connectStatus && app.typ === Constant.APP_TYPE_IOS"><div class=mobile-alert-container><span ng-show="!isConnect && !mobileDisconnect "><span ng-show=waitingConnect><p class=text-title>连接 iOS 应用 ...</p><p class=text-sm-g>请在APP中加入<a class=ab-link href=http://doc.lpotest.comsdk/iosSDK.html#debug target=_blank>[调试代码]</a> ，之后启动APP点击悬浮按钮进入编辑器。</p></span><span ng-show=!waitingConnect><p class=text-title>未检测到手机连接!请确认网络状况，或按照以下方式重试:</p><p class=text-sm-g>1、刷新本页面</p><p class=text-sm-g>2、在手机上结束APP后台进程并重新连接</p></span></span><span ng-show="isConnect && !mobileDisconnect"><p class=text-title>已经有其他窗口连接编辑器,请检查您的浏览器，或者检查其他人的浏览器。</p></span><span ng-show=mobileDisconnect><p class=text-title>APP已断开连接！</p><p class=text-sm-g>如果要继续编辑,请在手机上结束APP进程后重新连接</p></span><span ng-show=mobile-kick><p class=text-title>有新的移动设备正在连接编辑器！</p><p class=text-sm-g>不支持多人同时编辑,请确认编辑人员和设备后,刷新页面重新连接</p></span></div></div><!-- 左侧 --><div class=mobile-panel-sm><div class=mobile-row><div class=btn-group uib-dropdown uib-keyboard-nav><button class="btn btn-down btn-down-md mobile-btn-down" id=simple-btn-keyboard-andoridnav type=button uib-dropdown-toggle ng-disabled=disabled>{{curVersion.displayName}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-andoridnav><li class=dropdown-item role=menuitem ng-repeat="m in versions" ng-click=showVersion(m)><span ng-bind=m.displayName></span></li></ul></div><button class="iconfont icon-add02 mobile-btn-i mobile-spacing mobile-success" ng-click=addVersion()></button> <button class="iconfont icon-14pxdel mobile-btn-i mobile-spacing mobile-alert" ng-disabled="curVersion.exp.id == group.control.id" ng-click=deleteVersion()></button></div><div class=mobile-record ng-show="!connectStatus && !mobileDisconnect"><ab-tab><div style="border-bottom:1px solid #d2d2d2"><div style=margin-bottom:-8px><ab-tab-nav title=界面修改></ab-tab-nav><ab-tab-nav title=优化指标></ab-tab-nav><ab-tab-nav title=组件树></ab-tab-nav></div></div><ab-tab-pane offset-h=94><div class=mobile-record-items><div class=mobile-record-item ng-repeat="change in changes" ng-class="{\'active\': selectedChange==change}" ng-show="change.properties[0].property !=\'stat_key\'"><div class=mobile-record-info><p>{{ change.position[change.position.length - 1].view }}</p><span>{{getLabelFromProperty(change)}}：</span> <span ng-show="change.properties[0].property !=\'backgroundImage\'"><label ng-show="change.properties[0].property !=\'image\'" ng-bind-html=getURLFromProperty(change)></label></span><img ng-src="{{change.properties[0].property ==\'backgroundImage\'?getURLFromProperty(change):\'\'}}" height=32px ng-if="change.properties[0].property ==\'backgroundImage\'"> <img ng-src="{{change.properties[0].property ==\'image\'?getURLFromProperty(change):\'\'}}" height=32px ng-show="change.properties[0].property ==\'image\'"></div><span class="iconfont icon-clouse01 mobile-record-icon-del" uib-tooltip=撤销修改 uib-tooltip-popup-delay=1000 ng-click=undoChanges(change)></span></div></div></ab-tab-pane><ab-tab-pane><div ng-show="canBindView() === 0"><p>该元素暂不支持绑定事件</p></div><div ng-show="!storeStat[curNode.elemId]&& canBindView() === 1" ng-init=setFormScope(this)><div><div class=mobile-record-indexs><label class=mobile-record-index-btn ng-class="{\'ab-btn-primary\':trackStatBy == \'add\' }" ng-model=trackStatBy ng-click="changeTrackStatType(\'add\')">新的指标</label><label class=mobile-record-index-btn ng-class="{\'ab-btn-primary\':trackStatBy == \'choose\' }" ng-model=trackStatBy ng-click="changeTrackStatType(\'choose\')">选择已有指标</label></div><form name=statsNameForm><ul ng-if="trackStatBy !=\'choose\'" class=mobile-editor-tab-stats-form><input name=statsName class="ab-input form-control ab-mb-15" placeholder=名称，字母，下划线 ng-model=formTest.newStatName ng-pattern=/^[A-Za-z]\\w*$/ required ng-show="trackStatBy==\'add\'"><ab-input-error-box form=statsNameForm input-name=statsName class=ios-mobile-editor-stats-errorbox><ab-error type=pattern custom=true>仅支持英文开头，可以包含数字或下划线</ab-error><ab-error type=required custom=true>指标名不能为空</ab-error></ab-input-error-box><p ng-show=stateErrorTip>{{stateErrorTip}}</p><input class="form-control ab-input ab-mb-15" placeholder=指标说明 ng-model=formTest.newStatDescription ng-show="trackStatBy==\'add\'"> <button class="ab-btn ab-btn-default ab-btn-primary" ng-click=addStat(formTest.newStatName,formTest.newStatDescription)>确定</button></ul><div ng-if="trackStatBy ==\'choose\'"><div class=moblie-record-choose-indexs ng-repeat="s in curNoFormulaStats" ng-click=trackStat(s)><span ng-class="{\'mobile-editor-icon-button-name\':s.description ==\'\'}" uib-tooltip={{s.description}} uib-tooltip-popup-delay=1000>{{s.name}}</span> <i class="icon iconfont icon-add02 mobile-record-choose-index-icon-add"></i></div></div></form></div></div><div ng-show=curView><div class=moblie-record-choose-indexs ng-repeat="item in storeStat[curNode.elemId]" ng-if=item.id ng-click=showStatElems(item)><span>{{item.id}}</span> <i class="icon iconfont icon-clouse01 mobile-record-choose-index-icon-add" uib-tooltip="取消跟踪优化指标 {{item.id}}" ng-click=cleanStat(index,item)></i></div></div><div ng-show=!curView><div class=moblie-record-choose-indexs ng-repeat="item in allSelectedStats" ng-click=showStatElems(item)><span>{{item.name}}</span> <i class="icon iconfont icon-clouse01 mobile-record-choose-index-icon-add" uib-tooltip="取消跟踪优化指标 {{item.name}}" ng-click=cleanStat(index,item)></i></div></div></ab-tab-pane><ab-tab-pane offset-h=94 position=absolute class=mobile-record-tree><div class="ab-panel mobile-editor-tabpanel" ng-init=setTreeScope(this)><div class=mobile-record-view-tree><div data-angular-treeview=true data-tree-id=componentsTree data-tree-model=treedata data-node-id=id data-node-label=class_name data-node-children=children data-view-tree-status=viewTreeStatus ng-click=treeHandler($event);></div></div></div></ab-tab-pane></ab-tab></div></div><!-- 中间 --><div class=mobile-panel><div ng-click=endEditing()><img src=assets/images/loading2.50c5e3e7.gif alt=loading.gif class=mobile-loading ng-show=loadingStatus><p ng-bind=statusMsg></p><div class=mobile-phone><div class=phone-label><label>{{curConnectMobile.deviceName}}</label></div><div class=phone-body phone-view view=curView hview=hoverNode hilightedviews=highlightedViews sw=screenWidth sh=screenHeight move=phoneTouchMove select=phoneTouchSelect><img ng-src={{phoneImage}} alt="" width=100% height=100% style=background-color:#efefef></div></div></div></div><!-- 右侧 --><div class=mobile-panel-sm><div class=mobile-row><button class="mobile-operat-btn mobile-default" ng-click=refresh()>刷新</button> <button class="mobile-operat-btn mobile-default" ng-click=resetVersion()>重置</button> <button class="mobile-operat-btn mobile-success" ng-click=saveVersions()>保存</button> <button class="mobile-operat-btn mobile-alert" ng-click=finishEditing()>退出</button></div><div class=mobile-tool-panel ng-show="canEditView() === 0"><p>该元素暂不支持属性修改</p></div><div class=mobile-tool-panel ng-show="canEditView() === 1"><div class=mobile-panel-body ng-show=curView><span ng-show="isIosHasTheProperty(\'title\')"><p class=text-sm-g>内容</p><textarea rows=5 class="mobile-textarea mobile-active mobile-row" ng-blur="controllChangeEmit(\'props.title\',props.title)" ng-model=props.title></textarea></span><span ng-show="isIosHasTheProperty(\'text\')"><p class=text-sm-g>内容</p><textarea rows=5 class="mobile-textarea mobile-active mobile-row" ng-blur="controllChangeEmit(\'props.text\',props.text)" ng-model=props.text></textarea></span><span ng-show="isIosHasTheProperty(\'font\')"><p class=text-sm-g>字体设置</p><!-- 字号大小 --> <input class="mobile-input mobile-input-sm mobile-active" ng-blur="controllChangeEmit(\'props.text_size\',props.text_size)" type=number min=0 max=99 ng-model=props.text_size> </span><!-- 字体对齐 --><!--<div class="mobile-row">--><!--<div class="btn-group" uib-dropdown uib-keyboard-nav>--><!--<button class="btn btn-down btn-down-md mobile-btn-down" id="simple-btn-keyboard-andoridnav-text-size" type="button" uib-dropdown-toggle ng-disabled="disabled">--><!--{{indexOfTextAlignments[props.textAlignment].label}}--><!--</button>--><!--<ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role="menu" aria-labelledby="simple-btn-keyboard-andoridnav-text-size">--><!--<li class="dropdown-item" role="menuitem" ng-repeat="m in  textAlignments" ng-click="selectArrayControllChangeEmit(\'textAlignment\',m.val)">--><!--<span ng-bind="m.label"></span>--><!--</li>--><!--</ul>--><!--</div>--><!--</div>--><!-- 字体颜色 --> <span ng-show="isIosHasTheProperty(\'textColor\')"><p class=text-sm-g>字体颜色</p><input class="mobile-input mobile-input-md mobile-active" colorpicker=rgba colorpicker-position=left ng-model=props.text_color> <button class="iconfont icon-Color mobile-btn-i mobile-success mobile-spacing mobile-row" colorpicker=rgba colorpicker-position=left ng-model=props.text_color></button> </span><!-- 标题字体颜色 --> <span ng-show="isIosHasTheProperty(\'titleColor\')"><p class=text-sm-g>字体颜色</p><input class="mobile-input mobile-input-md mobile-active" colorpicker=rgba colorpicker-position=left ng-model=props.titleColor> <button class="iconfont icon-Color mobile-btn-i mobile-success mobile-spacing mobile-row" colorpicker=rgba colorpicker-position=left ng-model=props.titleColor></button> </span><!-- icon颜色 --> <span ng-show="isIosHasTheProperty(\'tintColor\')&& isHaveIconImage()"><p class=text-sm-g>icon颜色</p><input class="mobile-input mobile-input-md mobile-active" colorpicker=rgba colorpicker-position=left ng-model=props.tintColor> <button class="iconfont icon-Color mobile-btn-i mobile-success mobile-spacing mobile-row" colorpicker=rgba colorpicker-position=left ng-model=props.tintColor></button></span><p class=text-sm-g>背景设置</p><!-- 设置背景色 --><div ng-show="isIosHasTheProperty(\'backgroundColor\')"><input class="mobile-input mobile-input-md mobile-active" colorpicker-position=left colorpicker=rgba ng-model=props.bg_color> <button class="iconfont icon-Color mobile-btn-i mobile-success mobile-spacing mobile-row" colorpicker=rgba colorpicker-position=left colorpicker-is-open=isBgColorOpen ng-model=props.bg_color></button></div><!-- 设置背景图 --><div class=mobile-row ng-show="isIosHasTheProperty(\'backgroundImage\')"><button type=button class="btn btn-down btn-down-md" ng-model=props.backgroundImage ng-file-select=onFileSelect($files) onclick="this.value = null">背景图片上传 <i class="fa fa-image"></i></button> <span ng-build=selectFile.progress.p></span></div><div class=mobile-row ng-show="isIosHasTheProperty(\'image\')&& !isIosHasTheProperty(\'tintColor\')"><button type=button class="btn btn-down btn-down-md" ng-file-select=onFileSelectFrontImage($files) onclick="this.value = null">选择图片上传<i class="fa fa-image"></i></button> <span ng-build=selectFile.progress.p></span></div><div class=mobile-row ng-show="isIosHasTheProperty(\'image\')&& isIosHasTheProperty(\'tintColor\')"><button type=button class="btn btn-down btn-down-md" ng-file-select=onFileSelectFrontImage($files) onclick="this.value = null">icon图片上传<i class="fa fa-image"></i></button> <span ng-build=selectFile.progress.p></span></div><span ng-show="isIosHasTheProperty(\'size\')"><span class=text-sm-g>宽度设置</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" ng-blur="controllChangeEmit(\'props.width\',props.width)" type=number min=0 max=20000 ng-model=props.width></span><br><span ng-show="isIosHasTheProperty(\'size\')"><span class=text-sm-g>高度设置</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" ng-blur="controllChangeEmit(\'props.height\',props.height)" type=number min=0 max=20000 ng-model=props.height></span><p class=text-sm-g>元素位置</p><span ng-show="isIosHasTheProperty(\'center\')"><span class="text-sm-g mobile-spacing">距离左侧</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" ng-blur="controllChangeEmit(\'props.centerX\',props.centerX)" type=number ng-model=props.centerX min=0 max=999999></span><br><span ng-show="isIosHasTheProperty(\'center\')"><span class="text-sm-g mobile-spacing">距离上面</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" ng-blur="controllChangeEmit(\'props.centerY\',props.centerY)" type=number ng-model=props.centerY min=0 max=999999></span><br><span ng-show="isIosHasTheProperty(\'contentEdgeInsets\')"><p class=text-sm-g>元素内填充</p><span class="text-sm-g mobile-spacing">上内边距</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" ng-blur="controllChangeEmit(\'props.paddingTop\',props.paddingTop)" type=number ng-model=props.paddingTop min=0 max=999999><br><span class="text-sm-g mobile-spacing">下内边距</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" ng-blur="controllChangeEmit(\'props.paddingBottom\',props.paddingBottom)" type=number ng-model=props.paddingBottom min=0 max=999999><br><span class="text-sm-g mobile-spacing">左内边距</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" ng-blur="controllChangeEmit(\'props.paddingLeft\',props.paddingLeft)" type=number ng-model=props.paddingLeft min=0 max=999999><br><span class="text-sm-g mobile-spacing">右内边距</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" ng-blur="controllChangeEmit(\'props.paddingRight\',props.paddingRight)" type=number ng-model=props.paddingRight min=0 max=999999><br></span><span ng-show="isIosHasTheProperty(\'alpha\')"><span class=text-sm-g>透明度：{{props.alpha}}</span> <span class=mobile-spacing style=width:180px;display:inline-block><sliderplus tposition="\'center\'" change=alphaSlider modal=props.alpha ng-model=props.alpha min=0 step=0.1 max=1 value=props.alpha></sliderplus></span></span></div></div></div></div><!-- <div class="mobile-editor-container clearfix" >\n\n\t<div class="ab-panel-header" style="border: 1px solid #d2d2d2;position:relative">\n\t\t<span class="headingtitle">\n\n   <div class="btn-group" uib-dropdown uib-keyboard-nav>\n       <button id="simple-btn-keyboard-andoridnav" type="button" class="btn btn-down btn-down-lg" uib-dropdown-toggle ng-disabled="disabled">\n          {{curVersion.displayName}}\n       </button>\n       <ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role="menu" aria-labelledby="simple-btn-keyboard-andoridnav">\n           <li class="dropdown-item" role="menuitem" ng-repeat="m in versions" ng-click="showVersion(m)" >\n             <span ng-bind="m.displayName" ></span>\n           </li>\n       </ul>\n   </div>\n    <button  class="ab-btn iconfont icon-add02" style="background:#f5f5f5" ng-click="addVersion()">\n    </button>\n\t\t<button  class="ab-btn iconfont icon-14pxdel" ng-disabled="curVersion.exp.id == group.control.id" style="background:#f5f5f5" ng-click="deleteVersion()"></button>\n\t\t<div class="moblie-header-panel">\n\n\t\t\t<button ng-click="refresh()">刷新</button>\n\t\t\t<button  ng-click="resetVersion()">重置</button>\n\t\t\t<button ng-click="saveVersions()" >保存</button>\n\t\t\t<button ng-click="finishEditing()">退出</button>\n\t\t</div>\n\t</div>\n\n\t<div class="ab-panel-body phone-container fullheight" ng-show="connectStatus && app.typ === Constant.APP_TYPE_IOS">\n\t\t<div class="ab-panel-body col-lg-offset-2 col-lg-8" style="margin-left:24%;margin-right:24%;margin-top: 18%;">\n\t\t<div class="mobile-editor-tipconnect">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-lg-6">\n\n\t\t\t\t\t<div ng-show="!isConnect && !mobileDisconnect ">\n\t\t\t\t\t\t<div ng-show="waitingConnect">\n\t\t\t\t\t\t\t<h4>连接 iOS 应用 ...</h4>\n\t\t\t\t\t\t\t<p class="mt20">\n\t\t\t\t\t\t\t\t请在APP中加入 <a class="ab-link" href="http://doc.lpotest.comsdk/iosSDK.html#debug" target="_blank">[调试代码]</a>，之后启动APP点击悬浮按钮进入编辑器。\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t <div ng-show="!waitingConnect">\n\t\t\t\t\t\t \t<h4>未检测到手机连接!请确认网络状况，或按照以下方式重试:</h4>\n\t\t\t\t\t\t\t<p class="mt20 ">1、刷新本页面</p>\n\t\t\t\t\t\t\t<p  class="mt20">2、在手机上结束APP后台进程并重新连接</p>\n\t\t\t\t\t\t </div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div ng-show="isConnect && !mobileDisconnect">\n\t\t\t\t\t\t<h2 class="text-danger">已经有其他窗口连接编辑器,请检查您的浏览器，或者检查其他人的浏览器。</h2>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div ng-show="mobileDisconnect">\n\n\t\t\t\t\t\t<h2 class="text-danger">APP已断开连接！</h2>\n\t\t\t\t\t\t<p  class="mt20">如果要继续编辑,请在手机上结束APP进程后重新连接</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n\t</div>\n\n\t<div class="ab-panel-body phone-container fullheight" ng-show="!connectStatus && !mobileDisconnect">\n\t\t<div class="mobile-edit-menu-panel fullheight" >\n\n\t\t\t<ab-tab class="view-tab" style="background:#fff">\n\t\t\t\t<ab-tab-nav title="界面修改"></ab-tab-nav>\n\t\t\t\t<ab-tab-nav title="优化指标"></ab-tab-nav>\n\t\t\t\t<ab-tab-nav title="组件树"></ab-tab-nav>\n\n        <ab-tab-pane offset-h="94" position="absolute" class="fix-ab-tab-pane">\n\t\t\t\t\t<div class="ab-panel mobile-editor-tabpanel" ng-repeat="change in changes" >\n\t\t\t\t\t\t<div class="ab-panel-body" ng-show="change.properties[0].property !=\'stat_key\'" style="position:relative" ng-class="{\'active\': selectedChange==change}" >\n\t\t\t\t\t\t\t<div class="clearfix">\n\t\t\t\t\t\t\t\t<div class="desc-wrap">\n\t\t\t\t\t\t\t\t\t<div class="mobile-editor-desc-head">\n\t\t\t\t\t\t\t\t\t\t<h5  class="mobile-editor-views-h5">{{ change.position[change.position.length - 1].view }}</h5>\n\t\t\t\t\t\t\t\t\t\t <label>{{getLabelFromProperty(change)}}</label>\n\t\t\t\t\t\t\t\t\t\t <div ng-show="change.properties[0].property !=\'backgroundImage\'">\n\t\t\t\t\t\t\t\t\t\t \t<label class="sub-head small text-muted" ng-show="change.properties[0].property !=\'image\'" ng-bind-html="getURLFromProperty(change)"></label>\n\t\t\t\t\t\t\t\t\t\t </div>\n\n\t\t\t\t\t\t\t\t\t\t<img ng-src="{{change.properties[0].property ==\'backgroundImage\'?getURLFromProperty(change):\'\'}}" height=\'32px\' ng-if="change.properties[0].property ==\'backgroundImage\'" />\n\t\t\t\t\t\t\t\t\t\t<img ng-src="{{change.properties[0].property ==\'image\'?getURLFromProperty(change):\'\'}}" height=\'32px\' ng-show="change.properties[0].property ==\'image\'" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span uib-tooltip="撤销修改" uib-tooltip-popup-delay="1000" ng-click="undoChanges(change)" class="action right mobile-editor-glyphicon iconfont icon-clouse01"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n        </ab-tab-pane>\n\n        <ab-tab-pane>\n\t\t\t\t\t<div class="ab-panel mobile-editor-tabpanel" ng-show="!storeStat[curNode.elemId]&& curView" ng-init="setFormScope(this)">\n\n\t\t\t\t\t\t<div class="panel-body" >\n\t\t\t\t\t\t\t<div   class="mobile-editor-tab-stats">\n\t\t\t\t\t\t\t\t<label class="ab-btn" ng-class="{\'ab-btn-primary\':trackStatBy == \'add\' }" ng-model="trackStatBy"  ng-click="changeTrackStatType(\'add\')"> 新的指标</label>\n\t\t\t\t\t\t\t\t<label  class="ab-btn" ng-class="{\'ab-btn-primary\':trackStatBy == \'choose\' }" ng-model="trackStatBy"  ng-click="changeTrackStatType(\'choose\')"> 选择已有指标</label>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<form name="statsNameForm">\n\t\t\t\t\t\t\t\t<ul ng-if="trackStatBy !=\'choose\'"  class="mobile-editor-tab-stats-form ab-position-relative">\n\n\t\t\t\t\t\t\t\t\t \t<input type="text" name=\'statsName\' class=" ab-input form-control ab-mb-15" placeholder="名称，字母，下划线" ng-model="formTest.newStatName" ng-pattern="/^[A-Za-z]\\w*$/" required  ng-show="trackStatBy==\'add\'"/>\n\t\t\t\t\t          <ab-input-error-box form="statsNameForm" input-name="statsName"  class="ios-mobile-editor-stats-errorbox">\n\t\t\t\t\t\t\t\t\t\t\t<ab-error type="pattern" custom="true" >仅支持英文开头，可以包含数字或下划线</ab-error>\n\t\t\t\t\t\t\t\t\t\t\t<ab-error type="required" custom="true" >指标名不能为空</ab-error>\n\t\t\t\t\t          </ab-input-error-box>\n\t\t\t\t\t\t\t\t\t\t<p ng-show="stateErrorTip">{{stateErrorTip}}</p>\n\t\t\t\t\t\t\t\t\t\t<input type="text" class="form-control ab-input ab-mb-15" placeholder="指标说明" ng-model="formTest.newStatDescription"  ng-show="trackStatBy==\'add\'"/>\n\t\t\t\t\t\t\t\t\t\t<button class="ab-btn ab-btn-default ab-btn-primary" ng-click="addStat(formTest.newStatName,formTest.newStatDescription)">确定</button>\n\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t<ul ng-if="trackStatBy ==\'choose\'">\n\t\t\t\t\t\t\t\t\t<li ng-repeat="s in curNoFormulaStats"  class="mobile-editor-stats">\n\t\t\t\t\t\t\t\t\t\t<button  class="mobile-editor-icon-button" ng-click="trackStat(s)">\n\t\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-button-name-def">\n\t\t\t\t\t\t\t\t\t\t\t\t <li ng-class="{\'mobile-editor-icon-button-name\':s.description ==\'\'}" >{{s.name}}</li>\n\t\t\t\t\t\t\t\t\t\t\t\t <li   class="ab-fonta0a0" ng-if="s.description">{{s.description}}</li>\n\t\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-add02">\n\t\t\t\t\t\t\t\t\t\t\t \t<i  class="icon iconfont icon-add02"></i>\n\t\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</form>\n    \t\t\t\t\t\t</div>\n\n    \t\t\t\t\t</div>\n\n    \t\t\t\t\t<div class="ab-panel mobile-editor-tabpane" ng-show="curView" >\n\t\t\t\t\t\t\t<ul style="padding:10px">\n\t\t\t\t\t\t\t\t<li ng-repeat="item in storeStat[curNode.elemId]" ng-if="item.id"  class="mobile-editor-stats">\n\t\t\t\t\t\t\t\t\t<button  class="mobile-editor-icon-button" ng-click="showStatElems(item)">\n\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-button-name-def">\n\t\t\t\t\t\t\t\t\t\t\t <li style="margin-top:9px">{{item.id}}</li>\n\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-add02">\n\t\t\t\t\t\t\t\t\t\t \t\t<i uib-tooltip="取消跟踪优化指标 {{item.id}}" class="action right iconfont icon-clouse01" ng-click="cleanStat(index,item)"></i>\n\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</ul>\n\n\n\n    \t\t\t\t</div>\n  \t\t\t\t\t<div class="ab-panel mobile-editor-tabpanel" ng-show="!curView">\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t<li ng-repeat="item in allSelectedStats"  class="mobile-editor-stats">\n\t\t\t\t\t\t\t\t\t<button  class="mobile-editor-icon-button" ng-click="showStatElems(item)">\n\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-button-name-def">\n\t\t\t\t\t\t\t\t\t\t\t <li style="margin-top:9px">{{item.name}}</li>\n\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-add02">\n\t\t\t\t\t\t\t\t\t\t \t\t<i uib-tooltip="取消跟踪优化指标 {{item.name}}" class="action right iconfont icon-clouse01" ng-click="cleanStat(index,item)"></i>\n\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</ul>\n  \t\t\t\t</div>\n\n        </ab-tab-pane>\n\n        <ab-tab-pane offset-h="94" position="absolute" class="fix-ab-tab-pane">\n\t\t\t\t\t<div class="ab-panel mobile-editor-tabpanel" ng-init="setTreeScope(this)">\n\t\t\t\t\t<div class="view-tree">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tdata-angular-treeview="true"\n\t\t\t\t\t\t\t\tdata-tree-id="componentsTree"\n\t\t\t\t\t\t\t\tdata-tree-model="treedata"\n\t\t\t\t\t\t\t\tdata-node-id="id"\n\t\t\t\t\t\t\t\tdata-node-label="class_name"\n\t\t\t\t\t\t\t\tdata-node-children="children"\n\t\t\t\t\t\t\t\tdata-view-tree-status="viewTreeStatus"\n\t\t\t\t\t\t\t\tng-click="treeHandler($event);">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n          </div>\n        </ab-tab-pane>\n\t\t\t</ab-tab>\n\n\t\t</div>\n\t\t<div class="mobile-editor-textarea fullheight phonebg" ng-click="endEditing()">\n\t\t\t<img src="assets/images/loading2.50c5e3e7.gif" alt="loading.gif" class="mobile-loading" ng-show="loadingStatus"/>\n\t\t\t<p class="mt20 ml30"  ng-bind="statusMsg"></p>\n\t\t\t<div class="iosphone-view">\n\t\t\t\t<div class="phone-label">\n\t\t\t\t\t<label>{{curConnectMobile.deviceName}}</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="phone-body"\n\t\t\t\tphone-view\n\t\t\t\tview=\'curView\'\n\t\t\t\thview=\'hoverNode\'\n\t\t\t\thilightedviews=\'highlightedViews\'\n\t\t\t\tsw=\'screenWidth\'\n\t\t\t\tsh=\'screenHeight\'\n\t\t\t\tmove=\'phoneTouchMove\'\n\t\t\t\tselect="phoneTouchSelect">\n\t\t\t\t\t<img ng-src="{{phoneImage}}" alt="" width="100%" height="100%" style="background-color:#efefef;"/>\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="mobile-editor-props fullheight" ng-show="curView">\n\t\t\t<form  name="nForm" novalidate autocomplete="off" >\n\n\n\t\t\t<uib-accordion close-others="oneAtATime" class="accordion">\n\n\t\t\t <uib-accordion-group class="accordion-group mobile-editor-tableparent" is-open="layoutOpen">\n\t\t\t\t\t <uib-accordion-heading>\n\t\t\t\t\t\t\t 布局属性 <i class="pull-right iconfont" ng-class="{\'icon-down01\': layoutOpen, \'icon-up01\': !layoutOpen}"></i>\n\t\t\t\t\t </uib-accordion-heading>\n\t\t\t\t\t <table class="ab-table view-table">\n\t\t\t\t\t <tbody>\n\t\t\t\t\t\t <tr ng-show="isIosHasTheProperty(\'size\')">\n\t\t\t\t\t\t\t <td>\n\t\t\t\t\t\t\t\t \t<span>宽度</span>\n\t\t\t\t\t\t\t\t\t<input type="number" class="ab-input"  min="0" max="20000" ng-model="props.width">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t <tr ng-show="isIosHasTheProperty(\'size\')">\n\t\t\t\t\t\t\t<td>\n\t \t\t\t\t\t\t\t <span>高度</span>\n\t \t\t\t\t\t\t\t <input type="number" class="ab-input"  min="0" max="20000" ng-model="props.height">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t <tr ng-show="isIosHasTheProperty(\'textAlignment\')">\n\t\t\t\t\t\t\t <td>\n\t\t\t\t\t\t\t\t <span>文字对齐</span>\n\t\t\t\t\t\t\t\t <div class="ab-select-wrapper">\n\t\t\t\t\t\t\t\t\t <select class="ab-select"  ng-options="item.val as item.label for item in textAlignments" ng-model="props.textAlignment">\n\t\t\t\t\t\t\t\t\t </select>\n\t\t\t\t\t\t\t\t </div>\n\t\t\t\t\t\t\t </td>\n\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t <tr ng-show="isIosHasTheProperty(\'center\')">\n\t\t\t\t\t\t\t <td>\n\t\t\t\t\t\t\t\t <span>位置 x</span>\n\t\t\t\t\t\t\t\t <input type="number" ng-model="props.centerX"  class="ab-input" min="0" max="999999" >\n\t\t\t\t\t\t\t </td>\n\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t <tr ng-show="isIosHasTheProperty(\'center\')">\n\t\t\t\t\t\t\t <td>\n\t\t\t\t\t\t\t\t <span>位置 y</span>\n\t\t\t\t\t\t\t\t<input type="number" ng-model="props.centerY"  class="ab-input" min="0" max="999999" >\n\t\t\t\t\t\t\t </td>\n\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t <tr ng-show="isIosHasTheProperty(\'contentEdgeInsets\')">\n\t\t\t\t\t\t\t <td>\n\t\t\t\t\t\t\t\t <span>上内边距</span>\n\t\t\t\t\t\t\t\t <input type="number"  ng-model="props.paddingTop"  class="ab-input" min="0" max="999999" >\n\t\t\t\t\t\t\t </td>\n\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t <tr  ng-show="isIosHasTheProperty(\'contentEdgeInsets\')">\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t <span>下内边距</span>\n\t\t\t\t\t\t\t\t <input type="number"  ng-model="props.paddingBottom"   class="ab-input" min="0" max="999999" >\n\t\t\t\t\t\t\t </td>\n\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t <tr  ng-show="isIosHasTheProperty(\'contentEdgeInsets\')">\n\t\t\t\t\t\t\t <td>\n\t\t\t\t\t\t\t \t<span>左内边距</span>\n\t\t\t\t\t\t\t\t<input type="number" ng-model="props.paddingLeft"  class="ab-input" min="0" max="999999" >\n\t\t\t\t\t\t\t </td>\n\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t <tr  ng-show="isIosHasTheProperty(\'contentEdgeInsets\')">\n\t\t\t\t\t\t\t <td>\n\t\t\t\t\t\t\t\t <span>右内边距</span>\n\t\t\t\t\t\t\t\t <input type="number" ng-model="props.paddingRight"   class="ab-input" min="0" max="999999" >\n\t\t\t\t\t\t\t </td>\n\t\t\t\t\t\t </tr>\n\t\t\t\t\t </tbody>\n\t\t\t\t </table>\n\n\t\t\t </uib-accordion-group>\n\n\t\t\t <uib-accordion-group class="accordion-group mobile-editor-tableparent" is-open="styleOpen">\n\t\t\t\t\t <uib-accordion-heading>\n\t\t\t\t\t\t\t 样式属性 <i class="pull-right iconfont" ng-class="{\'icon-down01\': styleOpen, \'icon-up01\': !styleOpen}"></i>\n\t\t\t\t\t </uib-accordion-heading>\n\t\t\t\t\t <table class="ab-table mobile-editor-abfl">\n\t\t\t\t\t\t\t <tbody>\n\t\t\t\t\t\t\t\t <tr  ng-show="isIosHasTheProperty(\'font\')">\n\t\t\t\t\t\t\t\t\t <td>\n\t\t\t\t\t\t\t\t\t\t<span>字体大小</span>\n\t\t\t\t\t\t\t\t\t \t<input type="number" class="ab-input"  min="0" max="99" ng-model="props.text_size">\n\t\t\t\t\t\t\t\t \t</td>\n\t\t\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t\t\t <tr ng-show="isIosHasTheProperty(\'textColor\')">\n\t\t\t\t\t\t\t\t\t<td style="position:relative">\n\t\t\t\t\t\t\t\t\t\t\t<span class="ab-fl">字体颜色</span>\n\t\t\t\t\t\t\t\t\t\t <div class="input-group mt5">\n\t\t\t\t\t\t\t\t\t\t\t <input type="text"  colorpicker="rgba" colorpicker-is-open="isTextColorOpen" ng-model="props.text_color" class="ab-input" />\n\t\t\t\t\t\t\t\t\t\t </div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t  </tr>\n\t\t\t\t\t\t\t\t <tr ng-show="isIosHasTheProperty(\'titleColor\')">\n\t\t\t\t\t\t\t\t\t<td style="position:relative">\n\t\t\t\t\t\t\t\t\t\t\t<span class="ab-fl">字体颜色</span>\n\t\t\t\t\t\t\t\t\t\t <div class="input-group mt5">\n\t\t\t\t\t\t\t\t\t\t\t <input type="text"  colorpicker="rgba"  ng-model="props.titleColor" class="ab-input" />\n\t\t\t\t\t\t\t\t\t\t </div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t  </tr>\n  \t\t\t\t\t\t\t\t <tr ng-show="isIosHasTheProperty(\'tintColor\')&& isHaveIconImage()">\n  \t\t\t\t\t\t\t\t\t<td style="position:relative">\n  \t\t\t\t\t\t\t\t\t\t\t<span class="ab-fl">icon颜色</span>\n  \t\t\t\t\t\t\t\t\t\t <div class="input-group mt5">\n  \t\t\t\t\t\t\t\t\t\t\t <input type="text"  colorpicker="rgba"  ng-model="props.tintColor" class="ab-input" />\n  \t\t\t\t\t\t\t\t\t\t </div>\n  \t\t\t\t\t\t\t\t\t</td>\n  \t\t\t\t\t\t\t\t  </tr>\n\t\t\t\t\t\t\t\t  <tr ng-show="isIosHasTheProperty(\'backgroundColor\')">\n\t\t\t\t\t\t\t\t\t<td style="position:relative">\n\t\t\t\t\t\t\t\t\t\t<span class="ab-fl">背景颜色</span>\n\t\t\t\t\t\t\t\t\t\t <div class="input-group mt5" >\n\t\t\t\t\t\t\t\t\t\t\t <input type="text" colorpicker="rgba"  colorpicker-is-open ="isBgColorOpen" ng-model="props.bg_color" class="ab-input" />\n\t\t\t\t\t\t\t\t\t\t </div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t  </tr>\n\t\t\t\t\t\t\t\t  <tr ng-show="isIosHasTheProperty(\'alpha\')">\n\t\t\t\t\t\t\t\t\t<td>\n \t\t\t\t\t\t\t\t\t \t<span class="ab-fl mobile-editor-aplpha">透明度:{{props.alpha}}</span>\n \t\t\t\t\t\t\t\t\t\t<sliderplus modal=\'props.alpha\' tposition="\'center\'" change="alphaSlider" ng-model="props.alpha"  min="0" step="0.1" max="1" value="props.alpha" style="width:180px;padding-top:17px"></sliderplus>\n\t\t\t\t\t\t\t\t\t</td>\n \t\t\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t\t\t <tr >\n\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t <div style="margin-bottom: 20px;" ng-show="isIosHasTheProperty(\'backgroundImage\')">\n\t\t\t\t\t\t\t\t\t\t \t<button type="button" class="btn  btn-down btn-down-md " ng-model="props.backgroundImage"  ng-file-select="onFileSelect($files)" onclick="this.value = null">选择背景图片并上传 <i class="fa fa-image"></i></button>\n\t\t\t\t\t\t\t\t\t\t \t<span ng-build="selectFile.progress.p"></span>\n\t\t\t\t\t\t\t\t\t\t </div>\n\t\t                     \t\t\t <div ng-show="isIosHasTheProperty(\'image\')&& !isIosHasTheProperty(\'tintColor\')">\n\t\t\t\t\t\t\t\t\t\t\t <button type="button" class="btn  btn-down btn-down-md"   ng-file-select="onFileSelectFrontImage($files)" onclick="this.value = null">选择图片并上传 <i class="fa fa-image"></i></button>\n\t\t\t\t\t\t\t\t\t\t\t <span ng-build="selectFile.progress.p"></span>\n\t\t                    \t\t\t </div>\n \t\t                     \t\t\t <div ng-show="isIosHasTheProperty(\'image\')&& isIosHasTheProperty(\'tintColor\')">\n \t\t\t\t\t\t\t\t\t\t\t <button type="button" class="btn  btn-down btn-down-md"   ng-file-select="onFileSelectFrontImage($files)" onclick="this.value = null">选择icon图片并上传 <i class="fa fa-image"></i></button>\n \t\t\t\t\t\t\t\t\t\t\t <span ng-build="selectFile.progress.p"></span>\n \t\t                    \t\t\t </div>\n\t\t\t\t\t\t\t\t\t  </td>\n\t\t\t\t\t\t\t\t </tr>\n\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t</table>\n\t\t\t</uib-accordion-group>\n\n\t\t\t<uib-accordion-group class="accordion-group ab-mgb100" is-open="contentOpen" is-disabled="status.isFirstDisabled">\n\t\t\t <uib-accordion-heading>\n\t\t\t\t 内容属性 <i class="pull-right iconfont" ng-class="{\'icon-down01\': contentOpen, \'icon-up01\': !contentOpen}"></i>\n\t\t\t </uib-accordion-heading>\n\n\t\t\t\t <div ng-show="isIosHasTheProperty(\'title\')">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<label class="text-uppercase small text-bold">内容</label>\n\t\t\t\t\t\t<textarea rows="5" class="form-control resize-v" ng-model="props.title" ></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t \t<div  ng-show="isIosHasTheProperty(\'text\')">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<label class="text-uppercase small text-bold">内容</label>\n\t\t\t\t\t\t<textarea rows="5" class="form-control resize-v" ng-model="props.text" ></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t </uib-accordion-group>\n\n\n\n\t\t </uib-accordion>\n\t\t</form>\n\n\t\t</div>\n\t</div>\n\n</div> -->'),
a.put("app/layer/layer.html",'<div class=ab-layer><div class=btn-group uib-dropdown uib-keyboard-nav><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-lg" uib-dropdown-toggle ng-bind=selectLayer.name>加载中...</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem ng-repeat="m in curAllLayers track by $index" ng-click=changeLayer(m)><span>{{m.name}} &nbsp;</span><span ng-show=m.traffic>(可用流量{{m.traffic}}%)</span><span ng-show="m.traffic===0">(可用流量0%)</span><p class=dropdown-item-br></p><div ng-show="m.layerId != \'new\'" class=creat-mutual><div ng-show="m.groups.length!=0" class=layer-group-names>与<span class=layer-group-name ng-repeat="l in m.groups track by $index">{{l.name}}</span>互斥</div><div ng-show="m.groups.length ==0">该层没有试验</div></div><p></p></li></ul></div></div>'),a.put("app/login/login.html",'<o-navbar style=height:56px></o-navbar><div class=login-container><div class="m login"><h3 class=title>用户登录</h3><div class="content login-ab-btn"><form name=nForm novalidate autocomplete=off><!--<p class="tip">如果您还没有注册成为LpoTest用户，<a class="ab-link" ui-sref="register">请点击这里</a>10秒完成注册</p>--><div class=logind><input name=name class="ab-input ab-input-block" placeholder=请填写邮箱账户 ng-model=formTest.name required ng-pattern=/^([a-zA-Z0-9_\\.\\-])+\\@(([a-zA-Z0-9\\-])+\\.)+([a-zA-Z0-9]{2,4})+$/ ><ab-input-icon form=nForm input-name=name></ab-input-icon><ab-input-error-box form=nForm input-name=name><ab-error type=required custom=true>用户名不能为空</ab-error><ab-error type=pattern custom=true>邮箱账号输入错误，请重新输入</ab-error></ab-input-error-box></div><div class=logine><input type=password name=password class="ab-input ab-input-block" placeholder=请填写密码 ng-model=formTest.password required autofocus><ab-input-icon form=nForm input-name=password></ab-input-icon><ab-input-error-box form=nForm input-name=password><ab-error type=required custom=true>密码不能为空</ab-error><ab-error type=passwordTest custom=true>密码输入错误，请重新输入</ab-error></ab-input-error-box><p ng-bind=errorTip class=errorTip></p></div><!--<div class="m-oh login-forget">--><!--<a ui-sref="appForgotPass" class="forget-pass">忘记密码？</a>--><!--</div>--><div class=login-sub><input type=submit class="btn login-btn" ng-disabled=!nForm.$valid value=登录 ng-click=login(nForm)></div></form></div></div></div>'),a.put("app/management/management.html",'<div class="ab-panel management-panel change-pass-ab-btn"><div class=ab-panel-header>团队成员<div class=ab-panel-right-box><button type=button class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm" ng-click=invitate() style="font-size:12px;margin-top: -7px">邀请成员</button></div></div><table class=ab-table><thead><tr><th><p class=ab-table-header>账号</p></th><th><p class=ab-table-header>说明</p></th><th><p class=ab-table-header>账号等级</p></th><th><p class=ab-table-header>参与APP</p></th><th><p class=ab-table-header>操作</p></th></tr></thead><tbody><tr><td><span>{{curOwner.email}}</span></td><td><span>我自己</span></td><td><span>创建者</span></td><td><span>全部</span></td><td></td></tr><tr ng-repeat="m in members"><td><span>{{m.email}}</span></td><td><span class=ab-table-child-header>{{m.owner_comment}}</span></td><td><span class=ab-table-child-header>{{roles[m.role].name}}</span></td><td><ul ng-repeat="a in m.apps"><li style=font-size:12px>{{a.name}}</li></ul></td><td><div><button class="icon iconfont icon-14pxedit management-button" uib-tooltip-html="\'编辑成员\'" ng-click=edit(m) style="margin-right: 10px"></button> <button class=management-button ng-click=addAndCanelBlacklist(m)><span ng-bind=blockedContent[m.blocked] style=font-size:12px>加入黑名单</span></button></div></td></tr></tbody></table><button class="ab-btn change-pass-back" ng-click=goback()>返回</button></div>'),a.put("app/mobileEditor/mobileEditor.html",'<div class=mobile-wrapper><div class=mobile-alert-wrapper ng-show="connectStatus && app.typ == Constant.APP_TYPE_ANDIOD"><div class=mobile-alert-container><span ng-show="!isConnect && !mobileDisconnect "><span ng-show=waitingConnect><p class=text-title>连接 Android 应用 ...</p><p class=text-sm-g>请在测试手机上打开<a class=ab-link href=http://doc.lpotest.com/sdk/testTools.html target=_blank>Tester</a> ，选择“点击开始编辑试验版本”，启动相关 Android 应用使之进入编辑状态。</p></span><span ng-show=!waitingConnect><p class=text-title>未检测到手机连接!请确认网络状况，或按照以下方式重试:</p><p class=text-sm-g>1、刷新本页面</p><p class=text-sm-g>2、在手机上结束APP后台进程并重新连接</p></span></span><span ng-show="isConnect && !mobileDisconnect"><p class=text-title>已经有其他窗口连接编辑器,请检查您的浏览器，或者检查其他人的浏览器。</p></span><span ng-show=mobileDisconnect><p class=text-title>APP已断开连接！</p><p class=text-sm-g>如果要继续编辑,请在手机上结束APP进程后重新连接</p></span><span ng-show=mobile-kick><p class=text-title>有新的移动设备正在连接编辑器！</p><p class=text-sm-g>不支持多人同时编辑,请确认编辑人员和设备后,刷新页面重新连接</p></span><div class="col-lg-offset-2 col-lg-3"><i class="fa fa-mobile hugeicon"></i></div></div></div><!-- 左侧 --><div class=mobile-panel-sm><div class=mobile-row><div class=btn-group uib-dropdown uib-keyboard-nav><button class="btn btn-down btn-down-md mobile-btn-down" id=simple-btn-keyboard-andoridnav type=button uib-dropdown-toggle ng-disabled=disabled>{{curVersion.displayName}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-andoridnav><li class=dropdown-item role=menuitem ng-repeat="m in versions" ng-click=showVersion(m)><span ng-bind=m.displayName></span></li></ul></div><button class="iconfont icon-add02 mobile-btn-i mobile-spacing mobile-success" ng-click=addVersion()></button> <button class="iconfont icon-14pxdel mobile-btn-i mobile-spacing mobile-alert" ng-disabled="curVersion.exp.id == group.control.id" ng-click=deleteVersion()></button></div><div class=mobile-record ng-show="!connectStatus && !mobileDisconnect"><ab-tab><div style="border-bottom:1px solid #d2d2d2"><div style=margin-bottom:-8px><ab-tab-nav title=界面修改></ab-tab-nav><ab-tab-nav title=优化指标></ab-tab-nav><ab-tab-nav title=组件树></ab-tab-nav></div></div><ab-tab-pane offset-h=94><div class=mobile-record-items><div class=mobile-record-item ng-repeat="change in changes" ng-class="{\'active\': selectedChange==change}" ng-click=showChangeElems(change)><div class=mobile-record-info><p class=mobile-record-text>{{ change.position[change.position.length - 1].view }}</p><div class=mobile-record-text style=display:block>{{getLabelFromProperty(change)}}：</div><span class=mobile-record-text ng-show="change.properties[0].type !=\'image\'">{{ getURLFromProperty(change) }} <span ng-show=showDp(change)>dp222</span></span> <img ng-src="{{change.properties[0].type ==\'image\'?getURLFromProperty(change):\'\'}}" ng-show="change.properties[0].type ==\'image\'"></div><span class="iconfont icon-clouse01 mobile-record-icon-del" uib-tooltip=撤销修改 uib-tooltip-popup-delay=1000 ng-click=undoChanges(change)></span></div></div></ab-tab-pane><ab-tab-pane><div ng-show="canBindView() === 0"><p>该元素暂不支持绑定事件</p></div><div ng-show="!storeStat[curNode.elemId]&& canBindView() === 1" ng-init=setFormScope(this)><div><div class=mobile-record-indexs><label class=mobile-record-index-btn ng-class="{\'ab-btn-primary\':trackStatBy == \'add\' }" ng-model=trackStatBy ng-click="changeTrackStatType(\'add\')">新的指标</label><label class=mobile-record-index-btn ng-class="{\'ab-btn-primary\':trackStatBy == \'choose\' }" ng-model=trackStatBy ng-click="changeTrackStatType(\'choose\')">选择已有指标</label></div><form name=statsNameForm><ul ng-if="trackStatBy !=\'choose\'" class=mobile-editor-tab-stats-form><input class="ab-input form-control ab-mb-15" placeholder=名称，字母，下划线 ng-model=formTest.newStatName ng-pattern=/^[A-Za-z]\\w*$/ required ng-show="trackStatBy==\'add\'"> <input class="form-control ab-input ab-mb-15" placeholder=指标说明 ng-model=formTest.newStatDescription ng-show="trackStatBy==\'add\'"> <button class="ab-btn ab-btn-default ab-btn-primary" ng-click=addStat(formTest.newStatName,formTest.newStatDescription)>确定</button></ul><div ng-if="trackStatBy ==\'choose\'"><div class=moblie-record-choose-indexs ng-repeat="s in curNoFormulaStats" ng-click=trackStat(s)><span ng-class="{\'mobile-editor-icon-button-name\':s.description ==\'\'}" uib-tooltip={{s.description}} uib-tooltip-popup-delay=1000>{{s.name}}</span> <i class="icon iconfont icon-add02 mobile-record-choose-index-icon-add"></i></div></div></form></div></div><div ng-show=curView><div class=moblie-record-choose-indexs ng-repeat="item in storeStat[curNode.elemId]" ng-if=item.id ng-click=showStatElems(item)><span>{{item.id}}</span> <i class="icon iconfont icon-clouse01 mobile-record-choose-index-icon-add" uib-tooltip="取消跟踪优化指标 {{item.id}}" ng-click=cleanStat(index,item)></i></div></div><div ng-show=!curView><h3>所有指标</h3><hr><div class=moblie-record-choose-indexs ng-repeat="item in allSelectedStats" ng-click=showStatElems(item)><span>{{item.name}}</span> <i class="icon iconfont icon-clouse01 mobile-record-choose-index-icon-add" uib-tooltip="取消跟踪优化指标 {{item.name}}" ng-click=cleanStat(index,item)></i></div></div></ab-tab-pane><ab-tab-pane offset-h=94 position=absolute class=mobile-record-tree><div class="ab-panel mobile-editor-tabpanel" ng-init=setTreeScope(this)><div class=mobile-record-view-tree><div data-angular-treeview=true data-tree-id=componentsTree data-tree-model=treedata data-node-id=id data-node-label=class_name data-node-children=children data-view-tree-status=viewTreeStatus ng-click=treeHandler($event);></div></div></div></ab-tab-pane></ab-tab></div></div><!-- 中间 --><div class=mobile-panel><div ng-click=endEditing()><img src=assets/images/loading2.50c5e3e7.gif alt=loading.gif class=mobile-loading ng-show=loadingStatus><p ng-bind=statusMsg></p><div class=mobile-phone><div class=phone-label><label>{{curConnectMobile.deviceName}}</label></div><div class=phone-body phone-view view=curView hview=hoverNode hilightedviews=highlightedViews sw=screenWidth sh=screenHeight move=phoneTouchMove select=phoneTouchSelect><img ng-src={{phoneImage}} alt="" width=100% height=100% style=background-color:#efefef></div></div></div></div><!-- 右侧 --><div class=mobile-panel-sm><div class=mobile-row><button class="mobile-operat-btn mobile-default" ng-click=refresh()>刷新</button> <button class="mobile-operat-btn mobile-default" ng-click=resetVersion()>重置</button> <button class="mobile-operat-btn mobile-success" ng-click=saveVersions()>保存</button> <button class="mobile-operat-btn mobile-alert" ng-click=finishEditing()>退出</button></div><div class=mobile-tool-panel ng-show="canEditView() === 0"><p>该元素暂不支持属性修改</p></div><div class=mobile-tool-panel ng-show="canEditView() === 1"><div class=mobile-panel-body ng-show=curView><span ng-show="isAndroidHasTheProperty(\'text\')" is-disabled=status.isFirstDisabled><form role=form class="ng-pristine ng-valid"><p class=text-sm-g>内容</p><textarea rows=5 class="mobile-textarea mobile-active" ng-model=props.text ng-blur="controllChangeEmit(\'props.text\',props.text)" ng-disabled="!props.hasOwnProperty(\'text\')"></textarea><p class=text-sm-g>文本提示</p><textarea rows=5 class="mobile-textarea mobile-active" ng-model=props.hint ng-blur="controllChangeEmit(\'props.hint\',props.hint)" ng-disabled="!props.hasOwnProperty(\'hint\')"></textarea></form></span><p class=text-sm-g ng-show="isAndroidHasTheProperty(\'text_size\')">字体设置</p><!-- 字号大小 --> <input class="mobile-input mobile-input-sm mobile-active mobile-row mobile-spacing" type=number min=0 max=99 ng-model=props.text_size ng-blur="controllChangeEmit(\'props.text_size\',props.text_size)" ng-show="isAndroidHasTheProperty(\'text_size\')"><!-- 字体倾斜 --><!-- <div class="mobile-select mobile-spacing mobile-row" ng-show="isAndroidHasTheProperty(\'text_style\')">\n\n\t\t\t\t\t<select class="ab-select mobile-active" ng-options="item.val as item.label for item in textStyles" ng-model="props.text_style"></select>\n\t\t\t\t</div> --><div class="mobile-row mobile-spacing" ng-show="isAndroidHasTheProperty(\'text_size\')"><div class=btn-group uib-dropdown uib-keyboard-nav><button class="btn btn-down btn-down-md mobile-btn-down" id=simple-btn-keyboard-andoridnav-text-size type=button uib-dropdown-toggle ng-disabled=disabled>{{indexOfTextStyles[props.text_style].label}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-andoridnav-text-size><li class=dropdown-item role=menuitem ng-repeat="m in  textStyles" ng-click="selectArrayControllChangeEmit(\'text_style\',m.val)"><span ng-bind=m.label></span></li></ul></div></div><!-- 字体对齐 --><div class="mobile-row mobile-spacing" ng-show="isAndroidHasTheProperty(\'text_size\')"><div class=btn-group uib-dropdown uib-keyboard-nav><button class="btn btn-down btn-down-md mobile-btn-down" id=simple-btn-keyboard-andoridnav-text-size type=button uib-dropdown-toggle ng-disabled=disabled>{{indexOfGravitys[props.text_gravity].label}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-andoridnav-text-size><li class=dropdown-item role=menuitem ng-repeat="m in  gravitys" ng-click="selectArrayControllChangeEmit(\'text_gravity\',m.val)"><span ng-bind=m.label></span></li></ul></div></div><!-- 字体颜色 --> <span class=mobile-spacing ng-show="isAndroidHasTheProperty(\'text_color\')"><input class="mobile-input mobile-input-md mobile-active" colorpicker=rgb ng-model=props.text_color> <button class="iconfont icon-Color mobile-btn-i mobile-success mobile-spacing mobile-row" colorpicker-position=left colorpicker=rgb ng-model=props.text_color></button></span><p class=text-sm-g>背景设置</p><!-- 设置背景色 --> <span ng-show="isAndroidHasTheProperty(\'bg_color\')"><input class="mobile-input mobile-input-md" colorpicker=rgb ng-model=props.bg_color> <button class="iconfont icon-Color mobile-btn-i mobile-success mobile-spacing mobile-row" colorpicker=rgb colorpicker-position=left ng-model=props.bg_color></button> </span><!-- 设置背景图 --><div class=mobile-row ng-show="isAndroidHasTheProperty(\'bg_color\')"><button type=button class="btn btn-down btn-down-md" ng-file-select=onFileSelect($files) onclick="this.value = null">背景图片上传 <i class="fa fa-image"></i></button> <span ng-build=selectFile.progress.p></span></div><div class=mobile-row ng-show="isAndroidHasTheProperty(\'src_bitmap\')"><button type=button class="btn btn-down btn-down-md" ng-file-select=onFileSelectFrontImage($files) onclick="this.value = null">选择图片上传 <i class="fa fa-image"></i></button> <span ng-build=selectFile.progress.p></span></div><p class=text-sm-g>宽度</p><div class="mobile-select mobile-row mobile-spacing"><div class=btn-group uib-dropdown uib-keyboard-nav><button class="btn btn-down btn-down-md mobile-btn-down" id=simple-btn-keyboard-andoridnav-size-width type=button uib-dropdown-toggle ng-disabled=disabled>{{indexOfsizes[props.sizeX].label}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-andoridnav-size-width><li class=dropdown-item role=menuitem ng-repeat="m in  sizes" ng-click="selectArrayControllChangeEmit(\'sizeX\',m.val)"><span ng-bind=m.label></span></li></ul></div></div><input class="mobile-input mobile-input-sm mobile-active mobile-row mobile-spacing" ng-blur="controllChangeEmit(\'props.width\',props.width)" ng-show="props.sizeX == 0" type=number min=0 max=20000 ng-model=props.width><p class=text-sm-g>高度</p><div class="mobile-select mobile-row mobile-spacing"><div class=btn-group uib-dropdown uib-keyboard-nav><button class="btn btn-down btn-down-md mobile-btn-down" id=simple-btn-keyboard-andoridnav-size-height type=button uib-dropdown-toggle ng-disabled=disabled>{{indexOfsizes[props.sizeY].label}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-andoridnav-size-height><li class=dropdown-item role=menuitem ng-repeat="m in  sizes" ng-click="selectArrayControllChangeEmit(\'sizeY\',m.val)"><span ng-bind=m.label></span></li></ul></div></div><input class="mobile-input mobile-input-sm mobile-active mobile-row mobile-spacing" ng-blur="controllChangeEmit(\'props.height\',props.height)" ng-show="props.sizeY == 0" ng-blur="" type=number min=0 max=20000 ng-model=props.height><p class=text-sm-g>元素位置</p><span ng-show="isAndroidHasTheProperty(\'translationX\')"><span class="text-sm-g mobile-spacing">距离左侧：</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" ng-blur="controllChangeEmit(\'props.translationX\',props.translationX)" type=number ng-model=props.translationX min=0 max=999999></span><br><span ng-show="isAndroidHasTheProperty(\'translationY\')"><span class="text-sm-g mobile-spacing">距离上面：</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" type=number ng-blur="controllChangeEmit(\'props.translationY\',props.translationY)" ng-model=props.translationY min=0 max=999999></span><p class=text-sm-g>元素内填充</p><span ng-show="isAndroidHasTheProperty(\'paddingTop\')"><span class="text-sm-g mobile-spacing">上内边距：</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" type=number ng-blur="controllChangeEmit(\'props.paddingTop\',props.paddingTop)" ng-model=props.paddingTop min=0 max=999999></span><br><span ng-show="isAndroidHasTheProperty(\'paddingBottom\')"><span class="text-sm-g mobile-spacing">下内边距：</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" type=number ng-model=props.paddingBottom ng-blur="controllChangeEmit(\'props.paddingBottom\',props.paddingBottom)" min=0 max=999999></span><br><span ng-show="isAndroidHasTheProperty(\'paddingLeft\')"><span class="text-sm-g mobile-spacing">左内边距：</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" type=number ng-model=props.paddingLeft ng-blur="controllChangeEmit(\'props.paddingLeft\',props.paddingLeft)" min=0 max=999999></span><br><span ng-show="isAndroidHasTheProperty(\'paddingRight\')"><span class="text-sm-g mobile-spacing">右内边距：</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" type=number ng-model=props.paddingRight ng-blur="controllChangeEmit(\'props.paddingRight\',props.paddingRight)" min=0 max=999999></span><br><span ng-show="isAndroidHasTheProperty(\'maxlines\')"><span class=text-sm-g>文字最多行数</span> <input class="mobile-input mobile-input-sm mobile-active mobile-spacing mobile-row" type=number ng-model=props.maxlines ng-blur="controllChangeEmit(\'props.maxlines\',props.maxlines)" min=0 max=2147483647></span><br><span ng-show="isAndroidHasTheProperty(\'ellipsize\')"><span class=text-sm-g>文字滚动方式</span><div class="mobile-select mobile-row mobile-spacing"><div class="mobile-select mobile-row"><div class=mobile-row><div class=btn-group uib-dropdown uib-keyboard-nav><button class="btn btn-down btn-down-md mobile-btn-down" id=simple-btn-keyboard-andoridnav-ellipsize type=button uib-dropdown-toggle ng-disabled=disabled>{{indexOfEllipsize[props.sizeY].label}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-andoridnav-ellipsize><li class=dropdown-item role=menuitem ng-repeat="m in  ellipsizes" ng-click="selectArrayControllChangeEmit(\'ellipsize\',m.val)"><span ng-bind=m.label></span></li></ul></div></div></div></div></span><br><span ng-show="isAndroidHasTheProperty(\'alpha\')"><span class=text-sm-g>透明度：{{props.alpha}}</span> <span class=mobile-spacing style=width:180px;display:inline-block><sliderplus tposition="\'center\'" change=alphaSlider modal=props.alpha ng-model=props.alpha min=0 step=0.1 max=1 value=props.alpha></sliderplus></span></span><br><span ng-show="isAndroidHasTheProperty(\'visibility\')"><span class=text-sm-g>隐藏/显示</span><div class="mobile-select mobile-row mobile-spacing"><!-- <select class="ab-select mobile-active" ng-options="item.val as item.label for item in visibilitys" ng-model="props.visibility"></select> --><div class="mobile-select mobile-row"><div class=mobile-row><div class=btn-group uib-dropdown uib-keyboard-nav><button class="btn btn-down btn-down-md mobile-btn-down" id=simple-btn-keyboard-andoridnav-visibility type=button uib-dropdown-toggle ng-disabled=disabled>{{indexOfVisibiltys[props.visibility].label}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-andoridnav-visibility><li class=dropdown-item role=menuitem ng-repeat="m in  visibilitys" ng-click="selectArrayControllChangeEmit(\'visibility\',m.val)"><span ng-bind=m.label></span></li></ul></div></div></div></div></span><br><!--<span ng-show="isAndroidHasTheProperty(\'text_selectable\')">--><!--<p class="text-sm-g mobile-row">文本复制</p>--><!--<div class="mobile-row">--><!--<input class="mobile-spacing" type="radio" ng-model="props.text_selectable" value="true">是--><!--<input type="radio" ng-model="props.text_selectable" value="false">否--><!--</div>--><!--</span>--></div></div></div></div><!-- <div class="mobile-editor-container clearfix">\n\n\t<div class="ab-panel-header" style="border: 1px solid #d2d2d2;position:relative">\n\t\t<span class="headingtitle">\n\n\t\t<div class="btn-group" uib-dropdown uib-keyboard-nav>\n\t\t\t<button id="simple-btn-keyboard-andoridnav" type="button" class="btn btn-down btn-down-lg" uib-dropdown-toggle ng-disabled="disabled">\n          {{curVersion.displayName}}\n       </button>\n\t\t\t<ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role="menu" aria-labelledby="simple-btn-keyboard-andoridnav">\n\t\t\t\t<li class="dropdown-item" role="menuitem" ng-repeat="m in versions" ng-click="showVersion(m)">\n\t\t\t\t\t<span ng-bind="m.displayName"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<button class="ab-btn iconfont icon-add02" style="background:#f5f5f5" ng-click="addVersion()">\n    </button>\n\t\t<button class="ab-btn iconfont icon-14pxdel" ng-disabled="curVersion.exp.id == group.control.id" style="background:#f5f5f5" ng-click="deleteVersion()"></button>\n\t\t<div class="moblie-header-panel">\n\n\t\t\t<button ng-click="refresh()">刷新</button>\n\t\t\t<button ng-click="resetVersion()">重置</button>\n\t\t\t<button ng-click="saveVersions()">保存</button>\n\t\t\t<button ng-click="finishEditing()">退出</button>\n\t\t</div>\n\t</div>\n\n\t<div class="ab-panel-body phone-container clearfix fullheight" ng-show="connectStatus && app.typ == Constant.APP_TYPE_ANDIOD">\n\t\t<div class="ab-panel-body col-lg-offset-2 col-lg-8" style="margin-left:24%;margin-right:24%;margin-top: 18%;">\n\t\t\t<div class="mobile-editor-tipconnect">\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-lg-6">\n\t\t\t\t\t\t<div ng-show="!isConnect && !mobileDisconnect ">\n\t\t\t\t\t\t\t<div ng-show="waitingConnect">\n\t\t\t\t\t\t\t\t<h4>连接 Android 应用 ...</h4>\n\t\t\t\t\t\t\t\t<p class="mt20">\n\t\t\t\t\t\t\t\t\t请在测试手机上打开 <strong><a class="ab-link" href="http://doc.lpotest.com/sdk/testTools.html" target="_blank">AdhocTester</a></strong>，选择“<strong>点击开始编辑试验版本</strong>”，启动相关 Android 应用使之进入编辑状态。\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t <div ng-show="!waitingConnect">\n\t\t\t\t\t\t\t \t<h4>未检测到手机连接!请确认网络状况，或按照以下方式重试:</h4>\n\t\t\t\t\t\t\t\t<p class="mt20 ">1、刷新本页面</p>\n\t\t\t\t\t\t\t\t<p  class="mt20">2、在手机上结束APP后台进程并重新连接</p>\n\t\t\t\t\t\t\t </div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div ng-show="isConnect && !mobileDisconnect">\n\t\t\t\t\t\t\t<h2 class="text-danger">已经有其他窗口连接编辑器,请检查您的浏览器，或者检查其他人的浏览器。</h2>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div ng-show="mobileDisconnect">\n\n\t\t\t\t\t\t\t<h2 class="text-danger">APP已断开连接！</h2>\n\t\t\t\t\t\t\t<p  class="mt20">如果要继续编辑,请在手机上结束APP进程后重新连接</p>\n \t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="col-lg-offset-2 col-lg-3">\n\t\t\t\t\t\t<i class="fa fa-mobile hugeicon"></i>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="ab-panel-body phone-container fullheight" ng-show="!connectStatus && !mobileDisconnect">\n\t\t<div class="mobile-edit-menu-panel fullheight">\n\n\t\t\t<ab-tab class="view-tab" style="background:#fff">\n\t\t\t\t<ab-tab-nav title="界面修改"></ab-tab-nav>\n\t\t\t\t<ab-tab-nav title="优化指标"></ab-tab-nav>\n\t\t\t\t<ab-tab-nav title="组件树"></ab-tab-nav>\n\n\t\t\t\t<ab-tab-pane offset-h="94" position="absolute" class="fix-ab-tab-pane">\n\t\t\t\t\t<div class="ab-panel mobile-editor-tabpanel" ng-repeat="change in changes">\n\t\t\t\t\t\t<div class="ab-panel-body" style="position:relative" ng-class="{\'active\': selectedChange==change}" ng-click="showChangeElems(change)">\n\t\t\t\t\t\t\t<div class="clearfix">\n\t\t\t\t\t\t\t\t<div class="desc-wrap">\n\t\t\t\t\t\t\t\t\t<div class="mobile-editor-desc-head">\n\t\t\t\t\t\t\t\t\t\t<h5 class="mobile-editor-views-h5">{{ change.position[change.position.length - 1].view }}</h5>\n\t\t\t\t\t\t\t\t\t\t<label>{{getLabelFromProperty(change)}}</label>\n\t\t\t\t\t\t\t\t\t\t<label class="sub-head small text-muted" ng-show="change.properties[0].type !=\'image\'">{{ getURLFromProperty(change) }} <span ng-show="showDp(change)">dp222</span></label>\n\t\t\t\t\t\t\t\t\t\t<img ng-src="{{change.properties[0].type ==\'image\'?getURLFromProperty(change):\'\'}}" height=\'32px\' ng-show="change.properties[0].type ==\'image\'" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span uib-tooltip="撤销修改" uib-tooltip-popup-delay="1000" ng-click="undoChanges(change)" class="action right mobile-editor-glyphicon iconfont icon-clouse01"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</ab-tab-pane>\n\n\t\t\t\t<ab-tab-pane>\n\t\t\t\t\t<div class="ab-panel mobile-editor-tabpanel" ng-show="!storeStat[curNode.elemId]&& curView" ng-init="setFormScope(this)">\n\n\t\t\t\t\t\t<div class="panel-body">\n\t\t\t\t\t\t\t<div class="mobile-editor-tab-stats">\n\t\t\t\t\t\t\t\t<label class="ab-btn" ng-class="{\'ab-btn-primary\':trackStatBy == \'add\' }" ng-model="trackStatBy" ng-click="changeTrackStatType(\'add\')"> 新的指标</label>\n\t\t\t\t\t\t\t\t<label class="ab-btn" ng-class="{\'ab-btn-primary\':trackStatBy == \'choose\' }" ng-model="trackStatBy" ng-click="changeTrackStatType(\'choose\')"> 选择已有指标</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<form name="statsNameForm">\n\t\t\t\t\t\t\t\t<ul ng-if="trackStatBy !=\'choose\'" class="mobile-editor-tab-stats-form">\n\n\t\t\t\t\t\t\t\t\t<input type="text" class=" ab-input form-control ab-mb-15" placeholder="名称，字母，下划线" ng-model="formTest.newStatName" ng-pattern="/^[A-Za-z]\\w*$/" required ng-show="trackStatBy==\'add\'" />\n\t\t\t\t\t\t\t\t\t<input type="text" class="form-control ab-input ab-mb-15" placeholder="指标说明" ng-model="formTest.newStatDescription" ng-show="trackStatBy==\'add\'" />\n\t\t\t\t\t\t\t\t\t<button class="ab-btn ab-btn-default ab-btn-primary" ng-click="addStat(formTest.newStatName,formTest.newStatDescription)">确定</button>\n\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t<ul ng-if="trackStatBy ==\'choose\'">\n\t\t\t\t\t\t\t\t\t<li ng-repeat="s in curNoFormulaStats" class="mobile-editor-stats">\n\t\t\t\t\t\t\t\t\t\t<button class="mobile-editor-icon-button" ng-click="trackStat(s)">\n\t\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-button-name-def">\n\t\t\t\t\t\t\t\t\t\t\t\t <li ng-class="{\'mobile-editor-icon-button-name\':s.description ==\'\'}" >{{s.name}}</li>\n\t\t\t\t\t\t\t\t\t\t\t\t <li   class="ab-fonta0a0" ng-if="s.description">{{s.description}}</li>\n\t\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-add02">\n\t\t\t\t\t\t\t\t\t\t\t \t<i  class="icon iconfont icon-add02"></i>\n\t\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="ab-panel mobile-editor-tabpane" ng-show="curView">\n\t\t\t\t\t\t<ul style="padding:10px">\n\t\t\t\t\t\t\t<li ng-repeat="item in storeStat[curNode.elemId]" ng-if="item.id" class="mobile-editor-stats">\n\t\t\t\t\t\t\t\t<button class="mobile-editor-icon-button" ng-click="showStatElems(item)">\n\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-button-name-def">\n\t\t\t\t\t\t\t\t\t\t\t <li style="margin-top:9px">{{item.id}}</li>\n\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-add02">\n\t\t\t\t\t\t\t\t\t\t \t\t<i uib-tooltip="取消跟踪优化指标 {{item.id}}" class="action right iconfont icon-clouse01" ng-click="cleanStat(index,item)"></i>\n\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</ul>\n\n\n\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ab-panel mobile-editor-tabpanel" ng-show="!curView">\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li ng-repeat="item in allSelectedStats" class="mobile-editor-stats">\n\t\t\t\t\t\t\t\t<button class="mobile-editor-icon-button" ng-click="showStatElems(item)">\n\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-button-name-def">\n\t\t\t\t\t\t\t\t\t\t\t <li style="margin-top:9px">{{item.name}}</li>\n\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t\t <ul  class="mobile-editor-icon-add02">\n\t\t\t\t\t\t\t\t\t\t \t\t<i uib-tooltip="取消跟踪优化指标 {{item.name}}" class="action right iconfont icon-clouse01" ng-click="cleanStat(index,item)"></i>\n\t\t\t\t\t\t\t\t\t\t </ul>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\n\t\t\t\t</ab-tab-pane>\n\n\t\t\t\t<ab-tab-pane offset-h="94" position="absolute" class="fix-ab-tab-pane">\n\t\t\t\t\t<div class="ab-panel mobile-editor-tabpanel" ng-init="setTreeScope(this)">\n\t\t\t\t\t\t<div class="view-tree">\n\t\t\t\t\t\t\t<div data-angular-treeview="true" data-tree-id="componentsTree" data-tree-model="treedata" data-node-id="id" data-node-label="class_name" data-node-children="children" data-view-tree-status="viewTreeStatus" ng-click="treeHandler($event);">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</ab-tab-pane>\n\t\t\t</ab-tab>\n\n\t\t</div>\n\t\t<div class="mobile-editor-textarea fullheight phonebg" ng-click="endEditing()">\n\t\t\t<img src="assets/images/loading2.50c5e3e7.gif" alt="loading.gif" class="mobile-loading" ng-show="loadingStatus" />\n\t\t\t<p class="mt20 ml30" ng-bind="statusMsg"></p>\n\t\t\t<div class="phone-view">\n\t\t\t\t<div class="phone-label">\n\t\t\t\t\t<label>{{curConnectMobile.deviceName}}</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="phone-body" phone-view view=\'curView\' hview=\'hoverNode\' hilightedviews=\'highlightedViews\' sw=\'screenWidth\' sh=\'screenHeight\' move=\'phoneTouchMove\' select="phoneTouchSelect">\n\n\t\t\t\t\t<img ng-src="{{phoneImage}}" alt="" width="100%" height="100%" style="background-color:#efefef;" />\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="mobile-editor-props fullheight" ng-show="curView">\n\t\t\t<uib-accordion close-others="oneAtATime" class="accordion">\n\n\t\t\t\t<uib-accordion-group class="accordion-group mobile-editor-tableparent" is-open="layoutOpen">\n\t\t\t\t\t<uib-accordion-heading>\n\t\t\t\t\t\t布局属性 <i class="pull-right iconfont" ng-class="{\'icon-down01\': layoutOpen, \'icon-up01\': !layoutOpen}"></i>\n\t\t\t\t\t</uib-accordion-heading>\n\t\t\t\t\t<table class="ab-table view-table">\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr ng-show= "isAndroidHasTheProperty(\'translationX\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span>位置 x</span>\n\t\t\t\t\t\t\t\t\t<input type="number" ng-model="props.translationX" class="ab-input" min="0" max="999999">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show= "isAndroidHasTheProperty(\'translationY\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span>位置 y</span>\n\t\t\t\t\t\t\t\t\t<input type="number" ng-model="props.translationY" class="ab-input" min="0" max="999999">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show= "isAndroidHasTheProperty(\'paddingTop\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span>上内边距</span>\n\t\t\t\t\t\t\t\t\t<input type="number" ng-model="props.paddingTop"  class="ab-input" min="0" max="999999">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show= "isAndroidHasTheProperty(\'paddingBottom\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span>下内边距</span>\n\t\t\t\t\t\t\t\t\t<input type="number" ng-model="props.paddingBottom"  class="ab-input" min="0" max="999999">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show= "isAndroidHasTheProperty(\'paddingLeft\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span>左内边距</span>\n\t\t\t\t\t\t\t\t\t<input type="number" ng-model="props.paddingLeft"  class="ab-input" min="0" max="999999">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'paddingRight\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span>右内边距</span>\n\t\t\t\t\t\t\t\t\t<input type="number" ng-model="props.paddingRight"  class="ab-input" min="0" max="999999">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'text_gravity\')">\n\t\t\t\t\t\t\t\t<td >\n\t\t\t\t\t\t\t\t\t<span>对齐</span>\n\t\t\t\t\t\t\t\t\t<div class="ab-select-wrapper">\n\t\t\t\t\t\t\t\t\t\t<select class="ab-select" ng-options="item.val as item.label for item in gravitys" ng-model="props.text_gravity">\n\t\t\t\t\t\t\t\t\t\t </select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr >\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t尺寸:\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t\t<ul  class="mobile-editor-size-con">\n\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t<span>横向</span>\n\t\t\t\t\t\t\t\t\t\t\t<div class="ab-select-wrapper">\n\t\t\t\t\t\t\t\t\t\t\t\t<select class="ab-select" ng-options="item.val as item.label for item in sizes" ng-model="props.sizeX">\n\t\t\t\t\t\t\t\t\t\t\t\t </select>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t<li ng-show="props.sizeX == 0">\n\t\t\t\t\t\t\t\t\t\t\t\t<span>宽度</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="number" class="ab-input" min="0" max="20000" ng-model="props.width">\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t\t<ul  class="mobile-editor-size-con">\n\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t<span>纵向</span>\n\t\t\t\t\t\t\t\t\t\t\t<div class="ab-select-wrapper">\n\t\t\t\t\t\t\t\t\t\t\t\t<select class="ab-select" ng-options="item.val as item.label for item in sizes" ng-model="props.sizeY">\n\t\t\t\t\t\t\t\t\t\t\t\t </select>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t<li ng-show="props.sizeY == 0">\n\t\t \t\t\t\t\t\t\t\t\t<span>高度</span>\n\t\t\t \t\t\t\t\t\t\t\t<input type="number" class="ab-input" min="0" max="20000" ng-model="props.height">\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\n\t\t\t\t</uib-accordion-group>\n\n\t\t\t\t<uib-accordion-group class="accordion-group mobile-editor-tableparent" is-open="styleOpen">\n\t\t\t\t\t<uib-accordion-heading>\n\t\t\t\t\t\t样式属性 <i class="pull-right iconfont" ng-class="{\'icon-down01\': styleOpen, \'icon-up01\': !styleOpen}"></i>\n\t\t\t\t\t</uib-accordion-heading>\n\t\t\t\t\t<table class="ab-table mobile-editor-abfl">\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'text_size\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span>字体大小</span>\n\t\t\t\t\t\t\t\t\t<input type="number" class="ab-input" min="0" max="99" ng-model="props.text_size">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'text_style\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span>字体设置</span>\n\t\t\t\t\t\t\t\t\t<div class="ab-select-wrapper">\n\t\t\t\t\t\t\t\t\t\t<select class="ab-select" ng-options="item.val as item.label for item in textStyles" ng-model="props.text_style">\n\t\t\t\t\t\t\t\t\t\t </select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'ellipsize\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span>文字滚动方式</span>\n\t\t\t\t\t\t\t\t\t<div class="ab-select-wrapper">\n\t\t\t\t\t\t\t\t\t\t<select class="ab-select" ng-options="item.val as item.label for item in ellipsizes" ng-model="props.ellipsize">\n\t\t\t\t\t\t\t\t\t\t </select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'maxlines\')">\n\t\t\t\t\t\t\t\t<td style="position:relative">\n\t\t\t\t\t\t\t\t\t<span class="ab-fl">文字最大行数</span>\n\t\t\t\t\t\t\t\t\t<div class="input-group mt5">\n\t\t\t\t\t\t\t\t\t\t<input type="number"  ng-model="props.maxlines" class="ab-input" min=0 max =2147483647 />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'text_color\')">\n\t\t\t\t\t\t\t\t<td style="position:relative">\n\t\t\t\t\t\t\t\t\t<span class="ab-fl">字体颜色</span>\n\t\t\t\t\t\t\t\t\t<div class="input-group mt5">\n\t\t\t\t\t\t\t\t\t\t<input type="text" colorpicker="rgb"  colorpicker-position="left" ng-model="props.text_color" class="ab-input" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'bg_color\')">\n\t\t\t\t\t\t\t\t<td style="position:relative">\n\t\t\t\t\t\t\t\t\t<span class="ab-fl">背景颜色</span>\n\t\t\t\t\t\t\t\t\t<div class="input-group mt5">\n\t\t\t\t\t\t\t\t\t\t<input type="text" colorpicker="rgb"  colorpicker-position="left" ng-model="props.bg_color" class="ab-input" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\n\t\t\t\t\t\t\t<tr >\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<div style="margin-bottom: 20px;" ng-show="isAndroidHasTheProperty(\'bg_color\')">\n\t\t\t\t\t\t\t\t\t\t<button type="button" class="btn  btn-down btn-down-md " ng-file-select="onFileSelect($files)" onclick="this.value = null">选择背景图片并上传 <i class="fa fa-image"></i></button>\n\t\t\t\t\t\t\t\t\t\t<span ng-build="selectFile.progress.p"></span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div ng-show="isAndroidHasTheProperty(\'src_bitmap\')">\n\t\t\t\t\t\t\t\t\t\t<button type="button" class="btn  btn-down btn-down-md" ng-file-select="onFileSelectFrontImage($files)" onclick="this.value = null" >选择图片并上传 <i class="fa fa-image"></i></button>\n\t\t\t\t\t\t\t\t\t\t<span ng-build="selectFile.progress.p"></span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'alpha\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span class="ab-fl mobile-editor-aplpha">透明度:{{props.alpha}}</span>\n\t\t\t\t\t\t\t\t\t<sliderplus tposition="\'center\'" change="alphaSlider" modal="props.alpha" ng-model="props.alpha" min="0" step="0.1" max="1" value="props.alpha" style="width:180px;padding-top:17px"></sliderplus>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'visibility\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span>隐藏/显示</span>\n\t\t\t\t\t\t\t\t\t<div class="ab-select-wrapper">\n\t\t\t\t\t\t\t\t\t\t<select class="ab-select" ng-options="item.val as item.label for item in visibilitys" ng-model="props.visibility">\n\t\t\t\t\t\t\t\t\t\t </select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'text_selectable\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span class="ab-fl mobile-editor-aplpha">文本复制</span>\n\t\t\t\t\t\t\t\t  <div  class="mobile-editor-textcopy">\n  \t\t\t\t\t\t\t\t\t\t<input type="radio" ng-model="props.text_selectable" value="true">是\n\t\t\t\t\t\t\t\t\t\t\t<input type="radio" ng-model="props.text_selectable" value="false">否\n\t\t\t\t\t\t\t\t  </div>\n\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr ng-show="isAndroidHasTheProperty(\'scrollBarFadingEnbled\')">\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<span class="ab-fl mobile-editor-aplpha">滚动条显示</span>\n\t\t\t\t\t\t\t\t\t<div  class="mobile-editor-textcopy">\n\t\t\t\t\t\t\t\t\t\t\t<input type="radio" ng-model="props.scrollBarFadingEnbled" value="true">是\n\t\t\t\t\t\t\t\t\t\t\t<input type="radio" ng-model="props.scrollBarFadingEnbled" value="false">否\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</uib-accordion-group>\n\n\t\t\t\t<uib-accordion-group ng-show="isAndroidHasTheProperty(\'text\')" class="accordion-group ab-mgb100" is-open="contentOpen" is-disabled="status.isFirstDisabled">\n\t\t\t\t\t<uib-accordion-heading>\n\t\t\t\t\t\t内容属性 <i class="pull-right iconfont" ng-class="{\'icon-down01\': contentOpen, \'icon-up01\': !contentOpen}"></i>\n\t\t\t\t\t</uib-accordion-heading>\n\n\t\t\t\t\t<form role="form" class="ng-pristine ng-valid">\n\n\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t<label class="text-uppercase small text-bold">内容</label>\n\t\t\t\t\t\t\t<textarea rows="5" class="form-control resize-v" ng-model="props.text" ng-disabled="!props.hasOwnProperty(\'text\')"></textarea>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t<label class="text-uppercase small text-bold">文本提示</label>\n\t\t\t\t\t\t\t<textarea rows="5" class="form-control resize-v" ng-model="props.hint" ng-disabled="!props.hasOwnProperty(\'hint\')"></textarea>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</form>\n\t\t\t\t</uib-accordion-group>\n\n\t\t\t</uib-accordion>\n\n\t\t</div>\n\t</div>\n</div> -->'),
a.put("app/modalAddAutoState/modalAddAutoState.html",'<div class="ab-modal ab-modal-success"><p class=ab-modal-title>请选择版本添加指标</p><p class=ab-modal-text style=color:#ff8181>请先进入原始版本添加需要的优化指标，然后在其他版本中也绑定该指标。</p><ul class=model-exps-list><li ng-repeat="exp in exps"><span class=modal-url>({{exp.isControl ? \'原始版本\' :exp.name}})&nbsp;&nbsp;{{exp.annotation.base_url}}</span> <button class="ab-btn ab-btn-default ab-btn-sm pull-right" ng-click=addStat(exp)>编辑</button></li></ul><div class=ab-modal-btns><button type=button class="ab-btn ab-btn-default ab-btn-block" ng-click=cancel() style="width: 150px;height: 40px;font-size: 16px">&nbsp;&nbsp;取消&nbsp;&nbsp;</button></div></div>'),a.put("app/modalWaitingToLogin/modalWaitingToLogin.html",'<div class="ab-modal ab-modal-success"><h3 class=ab-modal-title>恭喜注册成功</h3><p><span>{{time}}</span>秒后会自动跳转到登录页面，或点此 <a ui-sref=login>登录</a></p></div>'),a.put("app/optionalert/optionalert.html",'<div class="ab-modal ab-modal-success" ng-show=!power><p class=ab-modal-title>定向试验</p><p class=ab-modal-text>设置定向试验后，试验将只在所选用户群中生效</p><p class=ab-modal-text style="color: #ccc">该功能为高级付费功能，请联系客服了解详情。</p><div class=ab-modal-btns><button type=button class="ab-btn ab-btn-default" ng-click=cancel() style="width: 150px;height: 40px;font-size: 16px">&nbsp;&nbsp;取消&nbsp;&nbsp;</button> <a type=button class="ab-btn ab-btn-success ab-modal-btn-right" href=http://www.appadhoc.com/charge.html target=_blank style="width: 190px;height: 40px;line-height:25px;margin-left: 20px;font-size: 16px">&nbsp;&nbsp;&nbsp;&nbsp;了解详情&nbsp;&nbsp;&nbsp;&nbsp;</a></div></div><div class="ab-modal ab-modal-success" ng-show=power><p class=ab-modal-title>定向试验</p><p class=ab-modal-text>请选择试验生效的用户群体</p><div class=ab-select-wrapper><select class=ab-select ng-model=selectAudiences ng-options="i.name for i in audiences" style="width: 350px"></select></div><div class=ab-modal-text style="padding-top: 20px">请在开始试验之前设置定向试验，试验开始后将不可更改。<br>设置定向试验后，试验将只在所选用户群中生效，<br>流量百分比为该部分用户的比例。 <a href=javascript:; style="color: #4183cd" ng-click=editorGroup()>点此编辑用户群</a></div><div class=ab-modal-btns><button type=button class="ab-btn ab-btn-default" ng-click=cancel() style="width: 150px;height: 40px;font-size: 16px">&nbsp;&nbsp;取消&nbsp;&nbsp;</button> <button type=button class="ab-btn ab-btn-success" ng-click=ok() style="width: 190px;height: 40px;margin-left: 20px;font-size: 16px">&nbsp;&nbsp;确定&nbsp;&nbsp;</button></div></div>'),a.put("app/power/power.html",'<!-- <div class="detailTable panel-body-scroll summary-table" style="margin-bottom:20px;" table-scroll> --><div class="detailTable panel-body-scroll summary-table ab-panel" style=margin-bottom:20px table-scroll><!-- <div  class="power-tilte"> --><div class=ab-panel-header>统计功效：<span ng-bind=curStat></span>- <span ng-bind=indexStatsByName[curStat].description></span></div><table class=ab-table><thead><tr><th><p>版本(样本)</p></th><th><p>UV</p><p class=ab-font12>样本容量</p></th><th><p ng-bind=varianceClients></p></th><th><p>样本标准差</p></th></tr></thead><tbody><tr ng-repeat="exp in exps|orderBy:\'created_at\'"><td><span uib-tooltip-html="\'原始版本<br/>{{exp.description}}\'" ng-if=exp.isControl>原始版本 &nbsp;({{exp.traffic}}%)</span> <span uib-tooltip-html="\'{{exp.name}}<br/>{{exp.description}}\'" ng-if=!exp.isControl>{{exp.name}}&nbsp;({{exp.traffic}}%)</span></td><td><div class=ab-font12>{{indexClientsResults[exp.id]?indexClientsResults[exp.id].client_sum.toMyPrecision(5):0}}</div></td><td ng-show="curAppType == Constant.APP_TYPE_H5"><div class=ab-font12>{{pvSumObject?pvSumObject[exp.id].toMyPrecision(5):0}}</div></td><td><span class=ab-font12>{{curStatObject[exp.id]?curStatObject[exp.id].toMyPrecision(5):0}}</span></td><td><span class=ab-font12>{{varCurStatObject[exp.id]?varCurStatObject[exp.id].toMyPrecision(5):0}}</span></td></tr></tbody></table></div><div class="detailTable panel-body-scroll summary-table ab-panel" style=margin-bottom:20px table-scroll><div style=background:#eee class=power-sub-tilte><div style="padding:0px 25px"><label>显著性检验标准 α：</label><input style=min-width:75px;width:75px class=ab-input ng-model=alpha> <span>%</span><br><span>可查看（1-α）置信区间</span></div><div style="padding-left: 25px;  border-left: 1px solid #d2d2d2"><label>最小重要变化(效果 δ)：</label><input style=min-width:75px;width:75px class=ab-input ng-model=mde><spn>%</spn><br><span>可查看较原始版本变化度达到δ时的统计功效</span></div></div><div class=power-ab-table><table class=ab-table><tbody><tr><td><p>变化(效果) [{{confidence_level}}% 置信区间]</p></td><td><div>{{exp.power.variant.toMyPrecision(3)}}% {{\'[\'+exp.power.ci_low.toMyPrecision(4) + \'%, \' + exp.power.ci_high.toMyPrecision(4)+\'%]\'}}</div></td><td><div>{{exp.power.effect_desc}}</div></td></tr><tr><td><p>p-value</p><p class=ab-font12>显著性水平</p></td><td>{{exp.power.pvalue.toMyPrecision(3)}}</td><td><div>{{exp.significance_desc}}</div></td></tr><tr><td><p>统计功效</p></td><td><div>{{exp.power.mpower.toMyPrecision(3)}} (基于 {{exp.power.effect_size.toMyPrecision(3)}}% 的效果)</div></td><td><div>{{exp.power.power_desc}}</div></td></tr></tbody></table><div class=power-tip>表格如果看不懂，点这个 <a href=http://doc.lpotest.com/dataDecision/interpret.html target=_blank class=ab-link>链接</a> 试一下.</div></div><div class=ab-panel-padding-body><div class="text-center ab-testpostbody clearfix"><div class=ab-inblock><ng-echarts style=width:900px;height:500px;float:left ec-config=distributionConfig ec-option=distributionData></ng-echarts></div></div></div></div>'),a.put("app/register/register.html",'<o-navbar style=height:56px></o-navbar><div class=m-r-container><div class="m register"><h3 class=title>用户注册</h3><div class="content login-ab-btn"><form novalidate name=nForm autocomplete=off><p class=register-tip>如果您已经是注册用户，请<a class=ab-link ui-sref=login>点击这里登录</a></p><p class="register-apply text-center">还没有邀请码？请先<a href=# target=_blank class=ab-link>申请试用</a></p><div class="logind register-mb"><input name=invitationCode class="ab-input ab-input-block" placeholder=请填写7位邀请码 ng-model=formTest.invitationCode required ng-pattern=/^.{7}$/ ><ab-input-icon form=nForm input-name=invitationCode></ab-input-icon><ab-input-error-box form=nForm input-name=invitationCode><ab-error type=required custom=true>邀请码不能为空</ab-error><ab-error type=pattern custom=true>邀请码错误，请重新输入</ab-error></ab-input-error-box><p class=errorTip ng-bind=disabledInvitationCodeTip></p></div><div class="logind register-mb"><input name=email class="ab-input ab-input-block" placeholder=请填写邮箱账号 ng-model=formTest.email required ng-pattern=/^([a-zA-Z0-9_\\.\\-])+\\@(([a-zA-Z0-9\\-])+\\.)+([a-zA-Z0-9]{2,4})+$/ ><ab-input-icon form=nForm input-name=email></ab-input-icon><ab-input-error-box form=nForm input-name=email><ab-error type=required custom=true>邮箱账号不能为空</ab-error><ab-error type=pattern custom=true>邮箱格式错误，请重新输入</ab-error></ab-input-error-box><p class=errorTip ng-bind=invalidEmailTip></p></div><div class=logind style=margin-bottom:20px><input type=password name=password class="ab-input ab-input-block" placeholder=请填写密码 ng-model=formTest.password required ng-change=changePass(formTest.password)><ab-input-icon form=nForm input-name=password></ab-input-icon><ab-input-error-box form=nForm input-name=password><ab-error type=required custom=true>密码不能为空</ab-error><ab-error type=pattern custom=true>密码格式错误，请重新输入</ab-error></ab-input-error-box><p class=errorTip ng-bind=passwordErrorTip></p></div><div class="register-mb ab-oh register-pass-test"><div class=r ng-class="{\'register-pass-active\':acTest,\'register-pass\':!acTest}"><span>8位以上</span> <i class="icon iconfont icon-checkmark01 reg-icon" ng-show=acTest></i></div><div class=r ng-class="{\'register-pass-active\':nuTest,\'register-pass\':!nuTest}"><span>数字或特殊符号</span> <i class="icon iconfont icon-checkmark01 reg-icon" ng-show=nuTest></i></div><div class=r ng-class="{\'register-pass-active\':enTest,\'register-pass\':!enTest}"><span>英文字母</span> <i class="icon iconfont icon-checkmark01 reg-icon" ng-show=enTest></i></div></div><div class=logind style=position:relative><input type=password name=passwordTwo class="ab-input ab-input-block" ng-class="{\'register-passtwo-tip\':nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue}" placeholder=请再次填写相同密码 ng-model=formTest.passwordTwo required><ab-input-icon form=nForm input-name=passwordTwo ng-hide=" nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue"></ab-input-icon><ab-input-error-box form=nForm input-name=passwordTwo><ab-error type=required custom=true>密码不能为空</ab-error></ab-input-error-box><i class="iconfont icon-bigwrong01 ab-input-icon-wrong register-passtwo-erroicon" ng-show=" nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue"></i><p ng-show=" nForm.passwordTwo.$$rawModelValue && nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue" class="ab-input-desc ab-input-error">两次密码不一致</p></div><div class="clause-box m-oh" ng-class="{true: \'clause-box-on\', false: \'\'}[user.bClause]" ng-click=clauseFn()><label for=df style=display:block class="icon iconfont register-checkbox" ng-class="{\'icon-checkmark01\':nForm.checkbox.$valid,\'register-pass-active\':nForm.checkbox.$valid}"></label><p>注册用户同意&nbsp;<a class=ab-link href=https://www.appadhoc.com/clause.html target=_blank>吆喝科技服务条款</a>&nbsp;。</p><input id=df type=checkbox name=checkbox class="ab-input register-checkbox-hidden" ng-model=formTest.checkbox required></div><button class="ab-btn register-sub" ng-disabled="!nForm.$valid || nForm.passwordTwo.$$rawModelValue != nForm.password.$$rawModelValue" ng-click=sub()>注册</button></form></div></div></div>'),a.put("app/registerSuc/registerSuc.html",'<div class=m-rs-container><div class="m forgot-pass-suc"><h3 class="m-mb-8 cp-title">激活账号</h3><div class=content><form novalidate name=nForm><p class="m-mh-22 fps-tip" ng-bind=tip></p><a class=sub ng-class="{\'sub-disabled\' : !subDisabled}" ng-click=toLogin()>点此登录</a></form></div></div></div>'),a.put("app/retentionplus/retentionplus.html",'<div class=ab-panel id=retentionplus><div class=ab-panel-header style="min-width: 990px">留存数据<div class=ab-panel-right-box><div class=ab-btn-group style=margin-right:50px;top:-12px><button id=btnPeriodHour class="btn ab-btn-press-sm" ng-model=chartPeriodStatus uib-btn-radio=0>率</button> <button id=btnPeriodDay class="btn ab-btn-press-sm" ng-model=chartPeriodStatus uib-btn-radio=1>数</button></div><!-- <div class="ab-btn-group" style="margin-right:50px;top:-12px;">\n        <button id="btnPeriodHour" class="btn ab-btn-press-sm" ng-model="curTime" uib-btn-radio="\'日留存\'">日</button>\n        <button id="btnPeriodDay" class="btn ab-btn-press-sm" ng-model="curTime" uib-btn-radio="\'周留存\'">周</button>\n      </div> --><p style="width:205px;position: relative;display: inline-block;margin: -8px 0 0 10px"><input date-range-picker class="pull-right btn-time ab-input-date-down date-picker" type=button options=datePickerConfig ng-model=datePicker.date id=summaryFlow><label class="ab-input-date-down-icon iconfont icon-down01" for=summaryFlow></label></p></div></div><div class=ab-panel-padding-body ng-show=retentionRole><div class="text-center ab-testpostbody clearfix"><div class=ab-grid><ng-echarts class="ab-col ab-col-16" style=padding:0;height:300px ec-config=barConfig ec-option=barChartData></ng-echarts></div></div></div><div class=ab-panel-padding-body ng-show=!retentionRole><div class=appaudience-box><p class="text-center fs-12"><i class="iconfont icon-crown"></i>&nbsp;您暂无权限使用此功能，请联系客户经理开通。</p></div></div><!-- table --><div class=ab-panel-padding-body ng-show=retentionRole><ab-tab no-pane=true tab-click=changeExp(nav) active=ratentionplustTab class=abtab-overflow><!-- <ab-tab-nav title="{{nav.name}}" line="!$last" ng-repeat="nav  in curExps | ChangeName"></ab-tab-nav> --><ab-tab-nav title={{nav.name}} ng-repeat="nav  in curExps | ChangeName"></ab-tab-nav></ab-tab><table class=ab-table-mini><thead><tr ng-show=!weekFig><th>时段</th><th>新增用户</th><th ng-repeat="s in rstat">{{s.name}}</th></tr><tr ng-show=weekFig><th>时段</th><th>本周新增</th><th>次周留存</th><th>次周留存率</th></tr></thead><tbody><tr ng-show=weekFig ng-repeat="h in retainedStats"><td ng-show=h.newWeekData||h.retainedWeekData>{{h.weekhour}}</td><td ng-show=h.newWeekData||h.retainedWeekData>{{h.newWeekData}}</td><td ng-show=h.newWeekData||h.retainedWeekData>{{h.retainedWeekData}}</td><td ng-show=h.newWeekData||h.retainedWeekData>{{getWeekRate(h.retainedWeekData,h.newWeekData)}}</td></tr><tr ng-show=!weekFig ng-repeat="h in retainedStats"><td>{{h.hour}}</td><td>{{h.newData}}</td><td ng-class="\'rb\'+getRateFig(h.Retained1,h.newData)"><span ng-show=retainedRateFig>{{h.Retained1}}</span><br ng-show=retainedRateFig><span ng-show=!retainedRateFig>{{getRate(h.Retained1,h.newData)}}</span></td><td ng-class="\'rb\'+getRateFig(h.Retained2,h.newData)"><span ng-show=retainedRateFig>{{h.Retained2}}</span><br ng-show=retainedRateFig><span ng-show=!retainedRateFig>{{getRate(h.Retained2,h.newData)}}</span></td><td ng-class="\'rb\'+getRateFig(h.Retained3,h.newData)"><span ng-show=retainedRateFig>{{h.Retained3}}</span><br ng-show=retainedRateFig><span ng-show=!retainedRateFig>{{getRate(h.Retained3,h.newData)}}</span></td><td ng-class="\'rb\'+getRateFig(h.Retained4,h.newData)"><span ng-show=retainedRateFig>{{h.Retained4}}</span><br ng-show=retainedRateFig><span ng-show=!retainedRateFig>{{getRate(h.Retained4,h.newData)}}</span></td><td ng-class="\'rb\'+getRateFig(h.Retained5,h.newData)"><span ng-show=retainedRateFig>{{h.Retained5}}</span><br ng-show=retainedRateFig><span ng-show=!retainedRateFig>{{getRate(h.Retained5,h.newData)}}</span></td><td ng-class="\'rb\'+getRateFig(h.Retained6,h.newData)"><span ng-show=retainedRateFig>{{h.Retained6}}</span><br ng-show=retainedRateFig><span ng-show=!retainedRateFig>{{getRate(h.Retained6,h.newData)}}</span></td><td ng-class="\'rb\'+getRateFig(h.Retained7,h.newData)"><span ng-show=retainedRateFig>{{h.Retained7}}</span><br ng-show=retainedRateFig><span ng-show=!retainedRateFig>{{getRate(h.Retained7,h.newData)}}</span></td></tr></tbody></table><div ng-show=nullDataFig class="text-center retention-nulldata">暂无留存数据</div></div></div><script type=text/ng-template id=detail-a.html><div class="uib-tooltip-content">\n    显著性 表明该测试版本相比 原始版本 在指标 {{stat}} 上有统计意义上的显著变化，可得出结论。\'无显著变化\'可能是因为活跃用户数不够，或者该测试版本所作改动对用户行为无明显影响。\n  </div></script>'),a.put("app/selectlayer/selectlayer.html",'<div class="ab-modal ab-modal-success"><h2>克隆试验</h2><input class="ab-input clone-input-name" ng-model=cloneGroupName placeholder={{cloneGroupNamePlaceHolder}} ng-value=cloneGroupName><p ng-bind=cloneGroupNameTip class=clonegroup-errortip></p><p style="text-align: center;padding-top: 10px" ng-hide=layerRole>请选择克隆的试验所在层</p><div><layer on-select=changeLayer></layer></div><p style="text-align: center;padding-top: 30px">复制当前试验，将创建一个与当前配置相同的试验，<br>包括试验版本、优化指标等，确定执行此操作？</p><p style="text-align: center;color:#ff8181">因克隆的试验具有强相关性，请不要与原试验同时运行，<br>否则将会造成数据干扰。</p><div class=ab-modal-btns><button type=button class="ab-btn ab-btn-default ab-modal-btn" ng-click=cancel()>&nbsp;&nbsp;取消&nbsp;&nbsp;</button> <button type=button class="ab-btn ab-btn-success ab-modal-btn ab-modal-btn-right" ng-click=newok()>&nbsp;&nbsp;确定&nbsp;&nbsp;</button></div></div>'),a.put("app/stats/stats.html",'<div class=ab-panel id=stats><div class=ab-panel-header>优化指标<a class="btn ab-question" uib-tooltip-template="\'status-a.html\'" tooltip-placement=right tabindex=0 tooltip-trigger=focus> <i class="iconfont icon-question201 ab-question201"></i></a></div><div class=ab-panel-padding-body><table class=ab-table-edit><thead><tr><th width=20%>指标名称</th><th width=80%>说明</th><th></th></tr></thead><tbody><tr class=def-info ng-hide=curGroupStats><td>暂无数据</td><td></td></tr><!-- <tr class="ab-table-edit-control" ng-repeat="s in sysStats | orderBy: [\'sysEvent\']">\n             <td><span uib-tooltip= {{s.name}} ng-bind-html=" s.hasOwnProperty(\'statName\')?s.statName:s.name"></span></td>\n             <td>\n               <span ng-bind-html="s.description" ></span>\n             </td>\n             <td></td>\n           </tr> --><tr class=ab-table-edit-control ng-repeat="s in sysStats  | orderBy: [\'sysEvent\']"><td><span uib-tooltip={{s.name}} ng-bind-html="s.hasOwnProperty(\'statName\')? s.statName:s.name"></span> <button ng-click=removeStatHandler($event,s) class=icon-del uib-tooltip=删除指标 ng-show="!rowform.$visible && s.name!= \'UV\' && s.name !=\'PV\'"><i class="iconfont icon-14pxdel"></i></button></td><td><span ng-bind=s.description e-name=description e-placeholder=描述信息 e-form=rowform></span> <a ng-show="s.name !=\'UV\' && s.name != \'PV\' && curAppType == Constant.APP_TYPE_ANDIOD" target=_blank href=http://doc.lpotest.comsdk/androidSDK.html#stat>集成文档</a> <a ng-show="s.name !=\'UV\' && s.name != \'PV\' && curAppType == Constant.APP_TYPE_IOS" target=_blank href=http://doc.lpotest.comsdk/iosSDK.html#stat>集成文档</a><form editable-form name=rowform ng-show=rowform.$visible onbeforesave=saveStat($data,s) class=ab-table-edit-form-inline><button type=submit ng-disabled=rowform.$waiting class=icon-success><i class="iconfont icon-14pxright"></i></button> <button type=button ng-disabled=rowform.$waiting ng-click="cleanStatForm($event,rowform, curExp)" class=icon-error><i class="iconfont icon-14pxwrong"></i></button></form></td><td></td></tr><tr ng-class="{\'ab-jable-edit-focus\': rowform.$visible }" ng-click="focusTr(rowform, s)" ng-repeat="s in curGroupStats | ChangeName | orderBy: [\'sysEvent\', \'name\']"><td><span uib-tooltip={{s.name}} ng-bind-html=s.name></span> <button ng-click=removeStatHandler($event,s) class=icon-del uib-tooltip=删除指标 ng-show=!rowform.$visible><i class="iconfont icon-14pxdel"></i></button></td><td><span editable-text=s.description e-name=description e-placeholder=描述信息 e-form=rowform uib-tooltip="{{s.sysEvent?\'\':\'点击修改\'}}">{{s.description}}</span><form editable-form name=rowform ng-show=rowform.$visible onbeforesave=saveStat($data,s) class=ab-table-edit-form-inline><button type=submit ng-disabled=rowform.$waiting class=icon-success><i class="iconfont icon-14pxright"></i></button> <button type=button ng-disabled=rowform.$waiting ng-click="cleanStatForm($event,rowform, curExp)" class=icon-error><i class="iconfont icon-14pxwrong"></i></button></form></td><td ng-init="s.isAutoSate = isAutoState(s)"><i ng-show=s.isAutoSate uib-tooltip=通过编辑器添加 class="iconfont icon-link0201"></i></td></tr></tbody></table><button type=button class=ab-btn-icon ng-show=isUrlSpliteExp ng-click=addAutoState()><i class="iconfont icon-add02"></i>跟踪元素点击</button> <button type=button ng-show=isShowBuilderExp class=ab-btn-icon ng-click=addBuilderState()><i class="iconfont icon-add02"></i>跟踪元素点击</button> <button type=button ng-show=isIosBuilderExp class=ab-btn-icon ng-click=addIosBuilderState()><i class="iconfont icon-add02"></i>跟踪元素点击</button> <button type=button ng-show=isAndroidBuilderExp class=ab-btn-icon ng-click=addAndroidBuilderState()><i class="iconfont icon-add02"></i>跟踪元素点击</button> <button type=button class=ab-btn-icon ng-click=adding() ng-disabled="curGroup.status ==Constant.EXP_STATUS_PUBLISH"><i class="iconfont icon-add02"></i>添加编程指标</button><div><stat-panle class=stats-panleicon select-stat=selectStatHandler curgroup=curGroupStats name-panel=s></stat-panle></div></div><div class=ab-panel-padding-body><table class=ab-table-edit><thead><tr><th width=20%>复合指标名称</th><th width=40%>说明</th><th width=40%>计算公式</th></tr></thead><tbody><tr class="text-center hi" ng-show="curGroupComStats.length <= 0 && comlisting"><td colspan=4>未设置复合指标</td></tr><tr ng-class="{\'ab-table-edit-focus\': comform.$visible }" ng-click="focusTr(comform, s)" ng-repeat="s in curGroupComStats | orderBy: [\'sysEvent\',\'name\']"><td><span ng-bind-html=s.name uib-tooltip={{s.name}}></span> <button ng-click=deleteComStat($event,s) class=icon-del uib-tooltip=删除指标 ng-show=!comform.$visible><i class="iconfont icon-14pxdel"></i></button></td><td><span editable-text=s.description e-name=description e-placeholder=描述信息 e-form=comform uib-tooltip="{{s.sysEvent?\'\':\'点击修改\'}}">{{s.description }}</span><form editable-form name=comform ng-show=comform.$visible onbeforesave=saveComStat($data,s) class=ab-table-edit-form-inline><button type=submit ng-disabled=comform.$waiting class=icon-success><i class="iconfont icon-14pxright"></i></button> <button type=button ng-disabled=comform.$waiting ng-click="cleanStatForm($event,comform, curExp)" class=icon-error><i class="iconfont icon-14pxwrong"></i></button></form></td><td><span editable-text=s.formula e-name=formula e-placeholder=计算公式 e-form=comform onbeforesave=checkComFormula($data) e-disabled=false>{{s.formula}}</span></td></tr></tbody></table><button type=button class=ab-btn-icon ng-click=addingComStat() ng-disabled="curGroup.status ==Constant.EXP_STATUS_PUBLISH"><i class="iconfont icon-add02"></i>添加复合指标</button><div><stat-panle select-com-stat=selectComStatHandler curgroup=curGroupComStats name-panel=ss comstat-fig=true></stat-panle></div></div></div><script type=text/ng-template id=status-a.html><div class="uib-tooltip-content">\n    <p>请确保优化指标已经在代码中正确集成，</p>\n    <p>您可在此增加或删除优化指标，</p>\n    <p>请注意如果在试验过程中在后台增加和删除指标不会导致数据统计不完整。</p>\n    <p>详情参考<a href="http://doc.lpotest.comexpFlow/stat.html" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script>'),a.put("app/styles/demos/abmodal.html",'<div class="ab-modal ab-modal-success"><p class=ab-modal-title>尊敬的用户</p><p class=ab-modal-text>您的免费期还剩10天，请合理安排实验计划。</p><div class=ab-modal-btns><button type=button class="ab-btn ab-btn-default" ng-click=cancel()>&nbsp;&nbsp;取消&nbsp;&nbsp;</button> <button type=button class="ab-btn ab-btn-success ab-modal-btn-right" ng-click=newok()>&nbsp;&nbsp;确定&nbsp;&nbsp;</button></div></div><div class="ab-modal ab-modal-error"><p class=ab-modal-title>尊敬的用户</p><p class=ab-modal-text>您的免费期还剩10天，请合理安排实验计划。</p><div class=ab-modal-btns><button type=button class="ab-btn ab-btn-default" ng-click=cancel()>&nbsp;&nbsp;取消&nbsp;&nbsp;</button> <button type=button class="ab-btn ab-btn-success ab-modal-btn-right" ng-click=newok()>&nbsp;&nbsp;确定&nbsp;&nbsp;</button></div></div><div class="ab-modal ab-modal-question"><p class=ab-modal-title>尊敬的用户</p><p class=ab-modal-text>您的免费期还剩10天，请合理安排实验计划。</p><div class=ab-modal-btns><button type=button class="ab-btn ab-btn-default" ng-click=cancel()>&nbsp;&nbsp;取消&nbsp;&nbsp;</button> <button type=button class="ab-btn ab-btn-success ab-modal-btn-right" ng-click=newok()>&nbsp;&nbsp;确定&nbsp;&nbsp;</button></div></div>'),a.put("app/styles/demos/abpanel.html",'<h2>ab-panel</h2><div><code><pre>\n\n      &lt;div class="ab-panel"&gt;\n        &lt;div class="ab-panel-header"&gt;\n          优化指标\n          &lt;div class="ab-panel-right-box"&gt;\n            &lt;button type="button" class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm"&gt;添加复合指标&lt;/button&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class="ab-panel-body"&gt;我是内容&lt;/div&gt;\n      &lt;/div&gt;\n\n      &lt;div class="ab-panel"&gt;\n        &lt;div class="ab-panel-header"&gt;\n          优化指标\n          &lt;div class="ab-panel-right-box"&gt;\n            &lt;button type="button" class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm"&gt;添加复合指标&lt;/button&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class="ab-panel-padding-body"&gt;我是带内边距的内容&lt;/div&gt;\n      &lt;/div&gt;\n\n    </pre></code></div><div class=ab-panel><div class=ab-panel-header>我是AB-panel的头部标题</div><div class=ab-panel-body>我是内容</div></div><div class=ab-panel><div class=ab-panel-header>流量走势图 <a class="btn ab-question" uib-tooltip-placement=bottom uib-tooltip-template=""><i class="iconfont icon-question201 ab-question201"></i></a><div class=ab-panel-right-box><p style="width:205px;position: relative"><input date-range-picker="" class="pull-right btn-time form-control date-picker ng-pristine ng-valid ng-isolate-scope ng-touched" type=button options=datePickerConfig ng-model=datePicker.date id=summaryFlow value="07/05/2016 - 07/11/2016"><label class="ab-input-date-down-icon iconfont icon-down01" for=summaryFlow></label></p></div><div class="btn-group ab-panel-right-box" style=margin-right:12px><label class="btn btn-press ng-pristine ng-untouched ng-valid" ng-model=chartPeriodStatus uib-btn-radio=0>按时</label><label class="btn btn-press ng-pristine ng-untouched ng-valid active" ng-model=chartPeriodStatus uib-btn-radio=1>按日</label></div></div><div class=ab-panel-body>我是内容</div></div><div class=ab-panel><div class=ab-panel-header>试验报告<div class=ab-panel-right-box><button type=button class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm" ui-sref=app.data.testdata>导出数据</button> <button type=button class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm" ui-sref=app.data.testdata>运行控制</button></div><div class="btn-group ab-panel-right-box" style="margin-right: 36%"><label class="btn btn-press ng-pristine ng-untouched ng-valid active" ng-model=statUnit uib-btn-radio=0>均值</label><label class="btn btn-press ng-pristine ng-untouched ng-valid" ng-model=statUnit uib-btn-radio=1>总值</label></div></div><div class=ab-panel-padding-body>我是带内边距的内容</div></div><div class=ab-panel><div class=ab-panel-header>试验版本 <a class="btn ab-question" uib-tooltip-placement=bottom uib-tooltip-template=""><i class="iconfont icon-question201 ab-question201"></i></a></div><div class=ab-panel-padding-body>我是带内边距的内容</div></div><div class=ab-panel><div class=ab-panel-header>优化指标 <a class="btn ab-question" uib-tooltip-placement=bottom uib-tooltip-template=""><i class="iconfont icon-question201 ab-question201"></i></a><div class=ab-panel-right-box><button type=button class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm" ng-click=adding() ng-disabled="curGroup.status ==Constant.EXP_STATUS_PUBLISH">添加优化指标</button></div></div><div class=ab-panel-padding-body>我是带内边距的内容</div></div><div class=ab-panel><div class=ab-panel-header>优化指标 <a class="btn ab-question" uib-tooltip-placement=bottom uib-tooltip-template=""><i class="iconfont icon-question201 ab-question201"></i></a><div class=ab-panel-right-box><button type=button class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm" ng-click=addingComStat() ng-disabled="curGroup.status ==Constant.EXP_STATUS_PUBLISH">添加复合指标</button></div></div><div class=ab-panel-padding-body>我是带内边距的内容</div></div><div class=ab-panel><div class=ab-panel-header>1.基本信息 <a class="btn ab-question" uib-tooltip-placement=bottom uib-tooltip-template=""><i class="iconfont icon-question201 ab-question201"></i></a><div class=ab-panel-right-box><button type=button class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm" ng-click=addingComStat() ng-disabled="curGroup.status ==Constant.EXP_STATUS_PUBLISH">添加复合指标</button></div></div><div class=ab-panel-padding-body>我是带内边距的内容</div></div><div>panel中新的问号样式 <button class="btn ab-question" uib-tooltip-placement=bottom uib-tooltip-template=""><i class="iconfont icon-question201 ab-question201"></i></button></div>'),a.put("app/styles/demos/abtab.html",'<h2>abtab demos</h2><hr><!--  abnav-tab --><div style=background-color:#eee;margin-top:30px;padding:50px><ab-tab><ab-tab-nav title="nav1 (0)" icon=icon-gear101 line=true></ab-tab-nav><ab-tab-nav title="nav2 (222220)" icon=icon-stop01 line=true></ab-tab-nav><ab-tab-nav title="nav3 (4)" icon=icon-star01></ab-tab-nav><ab-tab-pane index=0><p>内容1</p><ab-tab><ab-tab-nav title="nav4 (0)"></ab-tab-nav><ab-tab-nav title="nav5 (222220)"></ab-tab-nav><ab-tab-pane><p>内容4</p></ab-tab-pane><ab-tab-pane><p>内容5</p></ab-tab-pane></ab-tab></ab-tab-pane><ab-tab-pane><p>内容2</p></ab-tab-pane><ab-tab-pane><em>内容3</em></ab-tab-pane></ab-tab><br><br><ab-tab default-display=1 active=test><ab-tab-nav width=true title={{navTitle}} line={{!$last}} ng-repeat="navTitle in navTitles"></ab-tab-nav><ab-tab-pane><p>test3</p></ab-tab-pane><ab-tab-pane><p>test4</p></ab-tab-pane><ab-tab-pane><p>test5</p><a href=javascript:; ng-click=testTab(1)>选择第二个tab</a></ab-tab-pane></ab-tab><br><br><div class="panel panel-default ab-testpost"><div class="panel-heading clearfix" style=height:52px><span class="ab-pr20 ab-mgt3">试验报告 <a class=btn><i class="iconfont icon-question01" style=color:#d2d2d2></i></a></span><div class=text-center style="margin-top: -49px"><ab-tab default-display=2 active=testNoPane no-pane=true tab-click=abTabClick() no-bottom-line=true><ab-tab-nav width=true title=3创建试验 line=true></ab-tab-nav><ab-tab-nav width=true title=4创建试验创建试验创建试验 line=true></ab-tab-nav><ab-tab-nav width=true title=5创建试验></ab-tab-nav></ab-tab></div><div class=pull-right style="margin-top: -46px"><button type=button class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm">运行控制</button></div></div><div class=panel-body>当前是{{testNoPane}}个<br>一共点击了{{abTabClickNow?abTabClickNow:0}}次</div></div><br><br><ab-tab default-display=1 active=abTabClicktest tab-click=abTabClickModel><ab-tab-nav width=true title={{navTitlesObj.title}} line={{!$last}} ng-repeat="navTitlesObj in navTitlesObjs" tab-nav-model={{navTitlesObj}}></ab-tab-nav><ab-tab-pane><p>test23,{{abTabClickdata.name}}</p></ab-tab-pane><ab-tab-pane><p>test24,{{abTabClickdata.name}}</p></ab-tab-pane><ab-tab-pane><p>test25,{{abTabClickdata.name}}</p></ab-tab-pane></ab-tab></div><br><p>HTML</p><code><pre>\n    &lt;ab-tab&gt;\n      &lt;ab-tab-nav title="nav1 (0)" icon="icon-gear101" line="true"&gt;&lt;/ab-tab-nav&gt;\n      &lt;ab-tab-nav title="nav2 (222220)" icon="icon-stop01" line="true"&gt;&lt;/ab-tab-nav&gt;\n      &lt;ab-tab-nav title="nav3 (4)" icon="icon-star01"&gt;&lt;/ab-tab-nav&gt;\n      &lt;ab-tab-pane index="0"&gt;\n        &lt;p&gt;内容1&lt;/p&gt;\n        &lt;ab-tab&gt;\n          &lt;ab-tab-nav title="nav4 (0)"&gt;&lt;/ab-tab-nav&gt;\n          &lt;ab-tab-nav title="nav5 (222220)"&gt;&lt;/ab-tab-nav&gt;\n          &lt;ab-tab-pane&gt;\n            &lt;p&gt;内容4&lt;/p&gt;\n          &lt;/ab-tab-pane&gt;\n          &lt;ab-tab-pane&gt;\n            &lt;p&gt;内容5&lt;/p&gt;\n          &lt;/ab-tab-pane&gt;\n        &lt;/ab-tab&gt;\n      &lt;/ab-tab-pane&gt;\n      &lt;ab-tab-pane&gt;\n        &lt;p&gt;内容2&lt;/p&gt;\n      &lt;/ab-tab-pane&gt;\n      &lt;ab-tab-pane&gt;\n        &lt;em&gt;内容3&lt;/em&gt;\n      &lt;/ab-tab-pane&gt;\n    &lt;/ab-tab&gt;\n    &lt;br&gt;\n    &lt;br&gt;\n    &lt;ab-tab default-display="1" active="test"&gt;\n      &lt;ab-tab-nav width="true" title="{{navTitle}}" line="{{!$last}}" ng-repeat="navTitle in navTitles"&gt;&lt;/ab-tab-nav&gt;\n      &lt;ab-tab-pane&gt;\n        &lt;p&gt;test3&lt;/p&gt;\n      &lt;/ab-tab-pane&gt;\n      &lt;ab-tab-pane&gt;\n        &lt;p&gt;test4&lt;/p&gt;\n      &lt;/ab-tab-pane&gt;\n      &lt;ab-tab-pane&gt;\n        &lt;p&gt;test5&lt;/p&gt;\n        &lt;a href="javascript:;" ng-click="testTab(1)"&gt;选择第二个tab&lt;/a&gt;\n      &lt;/ab-tab-pane&gt;\n    &lt;/ab-tab&gt;\n    &lt;br&gt;\n    &lt;br&gt;\n    &lt;div class="panel panel-default ab-testpost"&gt;\n      &lt;div class="panel-heading clearfix" style="height:52px"&gt;\n        &lt;span class="ab-pr20 ab-mgt3"&gt;试验报告\n          &lt;a class="btn"&gt;\n            &lt;i class="iconfont icon-question01" style="color:#d2d2d2"&gt;&lt;/i&gt;\n          &lt;/a&gt;\n        &lt;/span&gt;\n        &lt;div class="text-center" style="margin-top: -49px;"&gt;\n          &lt;ab-tab default-display="2" active="testNoPane" no-pane="true" tab-click="abTabClick()" no-bottom-line="true"&gt;\n            &lt;ab-tab-nav width="true" title="3创建试验" line="true"&gt;&lt;/ab-tab-nav&gt;\n            &lt;ab-tab-nav width="true" title="4创建试验创建试验创建试验" line="true"&gt;&lt;/ab-tab-nav&gt;\n            &lt;ab-tab-nav width="true" title="5创建试验"&gt;&lt;/ab-tab-nav&gt;\n          &lt;/ab-tab&gt;\n        &lt;/div&gt;\n        &lt;div class="pull-right" style="margin-top: -46px;"&gt;\n          &lt;button type="button" class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm"&gt;运行控制&lt;/button&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class="panel-body"&gt;\n        当前是{{testNoPane}}个\n        &lt;br&gt;\n        一共点击了{{abTabClickNow?abTabClickNow:0}}次\n      &lt;/div&gt;\n    &lt;/div&gt;\n    &lt;br&gt;\n    &lt;br&gt;\n    &lt;ab-tab default-display="1" active="abTabClicktest" tab-click="abTabClickModel"&gt;\n      &lt;ab-tab-nav width="true" title="{{navTitlesObj.title}}" line="{{!$last}}" ng-repeat="navTitlesObj in navTitlesObjs" tab-nav-model="{{navTitlesObj}}"&gt;&lt;/ab-tab-nav&gt;\n      &lt;ab-tab-pane&gt;\n        &lt;p&gt;test23,{{abTabClickdata.name}}&lt;/p&gt;\n      &lt;/ab-tab-pane&gt;\n      &lt;ab-tab-pane&gt;\n        &lt;p&gt;test24,{{abTabClickdata.name}}&lt;/p&gt;\n      &lt;/ab-tab-pane&gt;\n      &lt;ab-tab-pane&gt;\n        &lt;p&gt;test25,{{abTabClickdata.name}}&lt;/p&gt;\n      &lt;/ab-tab-pane&gt;\n    &lt;/ab-tab&gt;\n  </pre></code><br><p>controller</p><code><pre>\n    $scope.navTitles = [\n      \'test1\',\n      \'test2\',\n      \'test3\'\n    ];\n    $scope.navTitlesObjs = [\n      {\n        name:\'这是名字1\',\n        title:\'这是导航1\'\n      },\n      {\n        name:\'这是名字2\',\n        title:\'这是导航2\'\n      },\n      {\n        name:\'这是名字3\',\n        title:\'这是导航3\'\n      }\n    ]\n    //tab切换数据 end\n    //tab切换事件 start\n    $scope.testTab = function (iNow) {\n      $scope.test = iNow;\n    }\n    //tab切换事件 end\n    //部分tab的点击事件 start\n    $scope.abTabClickNow = 0;\n    $scope.abTabClick = function(){\n      $scope.abTabClickNow++;\n    };\n    $scope.abTabClickdata = {\n      name:\'目前没点击\'\n    };\n    $scope.abTabClickModel = function(abTabClickdata){\n      $scope.abTabClickdata = abTabClickdata;\n    };\n    //部分tab的点击事件 end\n'+"  </pre></code><br><h4>ab-tab参数设置</h4><br><p><strong>default-display(可选)</strong>：初始显示第几个，默认是第一个(0)。</p><p><strong>active(可选)</strong>：active的值是挂在在当前控制器的$scope上面的，通过改变active值，即可实现实时切换。设置的数值即是当前索引。</p><p><strong>no-pane(可选)</strong>：noPane=true时，可以不写ab-tab-pane组件，便于灵活放在任意处，操作数据类型的tab比较方便。</p><p><strong>tab-click(可选)</strong>：tab-click传递一个tab导航点击事件，必须是function，如'test()'。如果ab-tab-nav有tab-nav-model参数，那么可传递的值为函数名，如'test'。在scope中的test方法会有一个当前循环的对象返回。</p><p><strong>no-bottom-line(可选)</strong>：true取消下边框</p><br><h4>ab-tab-nav参数设置</h4><br><p><strong>title(必须)</strong>：tab切换的标题。支持html格式。</p><p><strong>line(可选)</strong>：是否在右侧有灰线，默认是没有。</p><p><strong>width(可选)</strong>：是否固定宽度，默认是false不固定。设置了之后只显示8个文字的宽度，多出来的省略号显示。</p><p><strong>icon(可选)</strong>：设置tab切换标题的icon，只需填写相应的class名即可。</p><p><strong>tab-nav-model(可选)</strong>：配合ab-tab标签中的tab-click一起使用。传入当前循环的对象数据。必须是json对象形式。</p><br><br>"),
a.put("app/styles/demos/abtoast.html",'<h2>abtoast demos</h2><hr><button type=button ng-click="tabToastIndex = 1;showAbtoastSuccess()">abToast显示success</button> <button type=button ng-click="tabToastIndex = 2;showAbtoastInfo()">abToast显示info</button> <button type=button ng-click="tabToastIndex = 3;showAbtoastDanger()">abToast显示danger</button> <button type=button ng-click="tabToastIndex = 4;showAbtoastWarning()">abToast显示warning</button><br><code ng-if="tabToastIndex === 1"><pre style=border-bottom:none;margin:0;padding-bottom:0>\n    abToast.success({\n      msg:\'这是测试\',\n      icon: true,\n      time: 3000,\n      top:0\n    });\n  </pre></code> <code ng-if="tabToastIndex === 2"><pre style=border-bottom:none;margin:0;padding-bottom:0>\n    abToast.info({\n      msg:\'这是测试的info方法\',\n      icon: true,\n      time: 3000,\n      top:0\n    });\n  </pre></code> <code ng-if="tabToastIndex === 3"><pre style=border-bottom:none;margin:0;padding-bottom:0>\n    abToast.danger({\n      msg:\'这是测试的danger方法\',\n      icon: true,\n      time: 3000,\n      top:0\n    });\n  </pre></code> <code ng-if="tabToastIndex === 4"><pre style=border-bottom:none;margin:0;padding-bottom:0>\n    abToast.warning({\n      msg:\'这是测试的warning\',\n      icon: true,\n      time: 3000,\n      top:0\n    });\n  </pre></code><h4>abToast参数设置</h4><br><p><strong>msg(必须)</strong>：提示的内容，支持html。</p><br><p><strong>icon(可选)</strong>：提示的内容左边的喇叭icon，默认是false不显示。</p><br><p><strong>time(可选)</strong>：提示的内容消失的时间，默认是2s。</p><br><p><strong>top(可选)</strong>：提示的内容向上的距离，默认是56px。</p><br><br>'),a.put("app/styles/demos/button.html",'<h2>Button demos</h2><hr><h3>Button demos1</h3><hr><div><button class="ab-btn ab-btn-circle ab-btn-primary"><span class=ab-btn-iconDefine><i class="iconfont icon-more01"></i> </span><span>详情1</span></button> <button class="ab-btn ab-btn-circle ab-btn-success"><span class=ab-btn-iconDefine><i class="iconfont icon-more01"></i> </span><span>详情2</span></button> <button class="ab-btn ab-btn-circle ab-btn-danger"><span class=ab-btn-iconDefine><i class="iconfont icon-more01"></i> </span><span>详情3</span></button> <button class="ab-btn ab-btn-circle ab-btn-disabled"><span class=ab-btn-iconDefine><i class="iconfont icon-more01"></i> </span><span>详情4</span></button> <button class="ab-btn ab-btn-circle ab-btn-default"><span class=ab-btn-iconDefine><i class="iconfont icon-more01"></i> </span><span>详情5</span></button></div><div><code><pre>\n        &lt;button class="ab-btn ab-btn-circle ab-btn-primary" &gt;\n          &lt;span class="ab-btn-iconDefine"&gt;\n            &lt;i class="iconfont icon-more01"&gt;&lt;/i&gt;\n          &lt;/span&gt;\n          &lt;span&gt;详情1&lt;/span&gt;\n        &lt;/button&gt;\n    </pre><pre>\n        &lt;button class="ab-btn ab-btn-circle ab-btn-success" &gt;\n          &lt;span class="ab-btn-iconDefine"&gt;\n            &lt;i class="iconfont icon-more01"&gt;&lt;/i&gt;\n          &lt;/span&gt;\n          &lt;span&gt;详情2&lt;/span&gt;\n        &lt;/button&gt;\n    </pre><pre>\n        &lt;button class="ab-btn ab-btn-circle ab-btn-danger" &gt;\n          &lt;span class="ab-btn-iconDefine"&gt;\n            &lt;i class="iconfont icon-more01"&gt;&lt;/i&gt;\n          &lt;/span&gt;\n          &lt;span&gt;详情3&lt;/span&gt;\n        &lt;/button&gt;\n    </pre><pre>\n        &lt;button class="ab-btn ab-btn-circle ab-btn-disabled" &gt;\n          &lt;span class="ab-btn-iconDefine"&gt;\n            &lt;i class="iconfont icon-more01"&gt;&lt;/i&gt;\n          &lt;/span&gt;\n          &lt;span&gt;详情4&lt;/span&gt;\n        &lt;/button&gt;\n    </pre><pre>\n        &lt;button class="ab-btn ab-btn-circle ab-btn-default" &gt;\n          &lt;span class="ab-btn-iconDefine"&gt;\n            &lt;i class="iconfont icon-more01"&gt;&lt;/i&gt;\n          &lt;/span&gt;\n          &lt;span&gt;详情5&lt;/span&gt;\n        &lt;/button&gt;\n    </pre></code></div><h3>Button demos2</h3><hr><div><button class="ab-btn ab-btn-default ab-btn-circle"><span class=ab-btn-iconDefine><i class="iconfont icon-edit01"></i> </span><span>编辑</span></button></div><div><code><pre>\n      &lt;button class="ab-btn ab-btn-default ab-btn-circle" &gt;\n        &lt;span class="ab-btn-iconDefine"&gt;\n          &lt;i class="iconfont icon-edit01"&gt;&lt;/i&gt;\n        &lt;/span&gt;\n        &lt;span&gt;编辑&lt;/span&gt;\n      &lt;/button&gt;\n    </pre></code></div><h3>Button demos3</h3><hr><div><button class="ab-btn ab-btn-circle ab-btn-primary"><span class=ab-btn-iconDefine><i class="iconfont icon-start01"></i> </span><span>开始</span></button></div><div><code><pre>\n      &lt;button class="ab-btn ab-btn-circle ab-btn-primary" &gt;\n        &lt;span class="ab-btn-iconDefine"&gt;\n          &lt;i class="iconfont icon-start01"&gt;&lt;/i&gt;\n        &lt;/span&gt;\n        &lt;span&gt;开始&lt;/span&gt;\n      &lt;/button&gt;\n    </pre></code></div><h3>Button demos4</h3><hr><div><button class="btn btn-delt"><span class=ab-btn-iconDefine><i class="iconfont icon-trash01"></i> </span><span>删除1</span></button> <button class="ab-btn ab-btn-circle ab-btn-danger"><span class=ab-btn-iconDefine><i class="iconfont icon-trash01"></i> </span><span>删除2</span></button></div><div><code><pre>\n      &lt;button class="btn btn-delt" &gt;\n        &lt;span class="ab-btn-iconDefine"&gt;\n          &lt;i class="iconfont icon-trash01"&gt;&lt;/i&gt;\n        &lt;/span&gt;\n        &lt;span&gt;删除1&lt;/span&gt;\n      &lt;/button&gt;\n    </pre><pre>\n      &lt;button class="ab-btn ab-btn-danger" &gt;\n        &lt;span class="ab-btn-iconDefine"&gt;\n          &lt;i class="iconfont icon-trash01"&gt;&lt;/i&gt;\n        &lt;/span&gt;\n        &lt;span&gt;删除2&lt;/span&gt;\n      &lt;/button&gt;\n    </pre></code></div><h3>Button demos5</h3><hr><div class=btn-group><button class="ab-btn ab-btn-danger ab-btn-lg">登陆1</button> <button class="ab-btn ab-btn-danger ab-btn-md active">登陆2</button> <button class="ab-btn ab-btn-danger ab-btn-sm disabled">登陆3</button></div><div><code><pre>\n       &lt;div class="btn-group" &gt;\n         &lt;button class="ab-btn ab-btn-danger ab-btn-lg"&gt;\n             登陆1\n         &lt;/button&gt;\n         &lt;button class="ab-btn ab-btn-danger ab-btn-md active"&gt;\n             登陆2\n         &lt;/button&gt;\n         &lt;button class="ab-btn ab-btn-danger ab-btn-sm disabled"&gt;\n             登陆3\n         &lt;/button&gt;\n       &lt;/div&gt;\n     </pre></code></div><h3>Button demos6</h3><hr><div><button class="ab-btn ab-btn-disabled">灰色</button> <button class="ab-btn ab-btn-disabled active">灰色1</button> <button class="ab-btn ab-btn-disabled disabled">灰色2</button></div><div><code><pre>\n        &lt;div class="" &gt;\n          &lt;button class="ab-btn ab-btn-disabled"&gt;\n              灰色\n          &lt;/button&gt;\n          &lt;button class="ab-btn ab-btn-disabled active"&gt;\n              灰色1\n          &lt;/button&gt;\n          &lt;button class="ab-btn ab-btn-disabled  disabled"&gt;\n              灰色2\n          &lt;/button&gt;\n        &lt;/div&gt;\n      </pre></code></div><h3>Button demos7</h3><hr><div class=btn-group><button class="btn btn-logingreen">登陆</button> <button class="btn btn-logingreen active">登陆</button> <button class="btn btn-logingreen disabled">登陆</button></div><div><code><pre>\n         &lt;div class="btn-group" &gt;\n           &lt;button class="btn btn-logingreen"&gt;\n               登陆\n           &lt;/button&gt;\n           &lt;button class="btn btn-logingreen active"&gt;\n               登陆\n           &lt;/button&gt;\n           &lt;button class="btn btn-logingreen disabled"&gt;\n               登陆\n           &lt;/button&gt;\n         &lt;/div&gt;\n       </pre></code></div><h3>椭圆形Button demos8</h3><hr><div><button type=button class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm">编辑编辑编辑</button> <button type=button class="ab-btn ab-btn-default ab-btn-oval ab-btn-md">编辑编辑编辑2</button> <button type=button class="ab-btn ab-btn-default ab-btn-oval ab-btn-lg">编辑编辑编辑3</button></div><div><code><pre>\n       &lt;div class="" &gt;\n         &lt;button class="ab-btn ab-btn-default ab-btn-oval ab-btn-sm"&gt;\n             编辑编辑编辑\n         &lt;/button&gt;\n         &lt;button class="ab-btn ab-btn-default ab-btn-oval ab-btn-md"&gt;\n             编辑编辑编辑2\n         &lt;/button&gt;\n         &lt;button class="ab-btn ab-btn-default ab-btn-oval ab-btn-lg"&gt;\n             编辑编辑编辑3\n         &lt;/button&gt;\n       &lt;/div&gt;\n     </pre></code></div><h3>正方形的Button demos9</h3><hr><div><button class="ab-btn ab-btn-success ab-btn-square-lg"><span class="iconfont icon-add01"></span>&nbsp;<span>新建</span></button> <button class="ab-btn ab-btn-success ab-btn-square"><span class="iconfont icon-add01"></span>&nbsp;<span>新建</span></button> <button class="ab-btn ab-btn-success ab-btn-square-sm"><span class="iconfont icon-add01"></span>&nbsp;<span>新建</span></button></div><div><code><pre>\n      &lt;button class="ab-btn ab-btn-success ab-btn-square-lg" &gt;\n        &lt;span class="iconfont icon-add01"&gt;&lt;/span&gt;&nbsp;\n        &lt;span&gt;新建&lt;/span&gt;\n      &lt;/button&gt;\n    </pre><pre>\n      &lt;button class="ab-btn ab-btn-success ab-btn-square" &gt;\n        &lt;span class="iconfont icon-add01"&gt;&lt;/span&gt;&nbsp;\n        &lt;span&gt;新建&lt;/span&gt;\n      &lt;/button&gt;\n    </pre><pre>\n      &lt;button class="ab-btn ab-btn-success ab-btn-square-sm" &gt;\n        &lt;span class="iconfont icon-add01"&gt;&lt;/span&gt;&nbsp;\n        &lt;span&gt;新建&lt;/span&gt;\n      &lt;/button&gt;\n    </pre></code></div><h3>Button demos10</h3><hr><div class=btn-group><button class="btn btn-press">全部</button> <button class="btn btn-press">未运行</button> <button class="btn btn-press">运行中</button> <button class="btn btn-press">已发布</button> <button class="btn btn-press">已结束</button></div><div><code><pre>\n      &lt;div class="btn-group" &gt;\n          &lt;button class="btn btn-press "&gt;全部&lt;/button&gt;\n          &lt;button class="btn btn-press "&gt;未运行&lt;/button&gt;\n          &lt;button class="btn btn-press "&gt;运行中&lt;/button&gt;\n          &lt;button class="btn btn-press "&gt;已发布&lt;/button&gt;\n          &lt;button class="btn btn-press "&gt;已结束&lt;/button&gt;\n      &lt;/div&gt;\n    </pre></code></div><h3>Button demos11 大小两个尺寸</h3><hr><div class=ab-btn-group><button class="btn ab-btn-press-lg">数据</button> <button class="btn ab-btn-press-lg">设置</button> <button class="btn ab-btn-press-lg">调试</button></div><br><div class=ab-btn-group><button class="btn ab-btn-press-sm">数据</button> <button class="btn ab-btn-press-sm">设置</button> <button class="btn ab-btn-press-sm">调试</button></div><div><code><pre>\n        &lt;div class="ab-btn-group"&gt;\n           &lt;button class="btn ab-btn-press-lg" &gt;数据&lt;/button&gt;\n           &lt;button class="btn ab-btn-press-lg" &gt;设置&lt;/button&gt;\n           &lt;button class="btn ab-btn-press-lg" &gt;调试&lt;/button&gt;\n        &lt;/div&gt;\n        &lt;br&gt;\n        &lt;div class="ab-btn-group"&gt;\n          &lt;button class="btn ab-btn-press-sm" &gt;数据&lt;/button&gt;\n          &lt;button class="btn ab-btn-press-sm" &gt;设置&lt;/button&gt;\n          &lt;button class="btn ab-btn-press-sm" &gt;调试&lt;/button&gt;\n        &lt;/div&gt;\n      </pre></code></div><h3>Button demos12 字体图标+文字</h3><hr><button class="btn ab-icontext-btn"><i class="iconfont icon-14pxeye"></i> 进入编辑器</button><div><code><pre>\n      &lt;button class="btn ab-icontext-btn"&gt;\n        &lt;i class="iconfont icon-question201"&gt;&lt;/i&gt;\n        进入编辑器\n      &lt;/button&gt;\n    </pre></code></div>'),a.put("app/styles/demos/charts.html",'<h2>chart demos</h2><hr><div class=page-wrap><div class=row><div class=col-lg-6><div class="panel panel-lined mb30"><div class=panel-heading><i>Line Chart11</i></div><div class=panel-body><ng-echarts class=col-lg-12 style=height:400px ec-config=lineConfig ec-option=lineOption></ng-echarts></div></div></div><div class=col-lg-6><div class="panel panel-lined mb30"><div class=panel-heading><i>Area Chart</i></div><div class=panel-body><chartist type=Line data=areadata class=ct-major-sixth tip=true opts=areaopts></chartist></div></div></div></div><!-- #end row --><div class=row><div class=col-lg-6><div class="panel panel-lined mb30"><div class=panel-heading><i>Bipolar Bar Chart</i></div><div class=panel-body><chartist type=Bar data=bipolardata class=ct-major-sixth tip=true opts=areaopts></chartist></div></div></div><div class=col-lg-6><div class="panel panel-lined mb30"><div class=panel-heading><i>Bar Chart</i></div><div class=panel-body><chartist type=Bar data=bardata class=ct-major-sixth tip=true opts=areaopts></chartist></div></div></div></div><!-- #end row --><div class=row><div class=col-lg-6><div class="panel panel-lined mb30"><div class=panel-heading><i>Stacked Bar Chart1</i></div><div class=panel-body><ng-echarts class=col-md-6 style=height:400px ec-config=barConfig ec-option=barOption></ng-echarts><!-- <chartist type="Bar" data="stackbardata" class="ct-major-sixth" tip="true" opts="stackbaropts" ondraw="stackdraw(data)"></chartist> --></div></div></div><div class=col-lg-6><div class="panel panel-lined mb30"><div class=panel-heading><i>Pie Chart</i></div><div class=panel-body><ng-echarts class=col-md-6 style=height:400px ec-config=barConfig ec-option=pieOption></ng-echarts><!-- <chartist type="Pie" data="piechartdata" class="ct-octave" tip="true"></chartist>\n          <ul class="chartist-pie-label list-unstyled list-inline small text-center m-mt-20">\n            <li><i class="fa-circle fa"></i>One</li>\n            <li><i class="fa-circle fa"></i>Two</li>\n            <li><i class="fa-circle fa"></i>Three</li>\n            <li><i class="fa-circle fa"></i>Four</li>\n          </ul> --></div></div></div></div><!-- #end row --><div class=row><div class=col-lg-6><div class="panel panel-lined mb30"><div class=panel-heading><i>Donut Pie</i></div><div class=panel-body><chartist type=Pie data=donutdata class=ct-octave tip=true opts=donutopts ondraw=donutdraw(data)></chartist></div></div></div><div class=col-lg-6><div class="panel panel-lined mb30"><div class=panel-heading><i>Using Draw Event</i></div><div class=panel-body><chartist type=Bar data=bipolardata class=ct-octave tip=true ondraw=peekdraw(data)></chartist></div></div></div></div><!-- #end row --></div>'),a.put("app/styles/demos/dropdown.html",'<h2>dropdown demos</h2><hr><!-- dropdown --><div class=btn-group uib-dropdown keyboard-nav><button id=simple-btn-keyboard-nav-msg type=button class="btn ab-btn-primary" uib-dropdown-toggle><span class="glyphicon glyphicon-user"></span></button><ul class=dropdown-menu role=menu aria-labelledby=simple-btn-keyboard-nav-msg><li role=menuitem ui-sref=userinfo><a href=#></a></li><li role=menuitem ui-sref=appmanage><a href=#>APP切换</a></li><li role=menuitem><a href=#>Something else here</a></li><li class=divider></li><li role=menuitem><a href=#>Separated link</a></li></ul></div>'),a.put("app/styles/demos/dropdown2.html",'<h2>dropdown demos</h2><hr><div><code><pre>\n\n      &lt;div class="btn-group" uib-dropdown uib-keyboard-nav&gt;\n          &lt;button id="simple-btn-keyboard-nav" type="button" class="btn btn-down btn-down-lg" uib-dropdown-toggle &gt;\n              {{selectLayer.name}}\n          &lt;/button&gt;\n          &lt;ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role="menu" aria-labelledby="simple-btn-keyboard-nav"&gt;\n              &lt;li class="dropdown-item" role="menuitem" ng-repeat="m in allLayers track by $index" ng-click="changeLayer(m)"&gt;\n                {{m.name}}\n                &lt;p class="dropdown-item-br"&gt;{{m.id}}&lt;/p&gt;\n              &lt;/li&gt;\n          &lt;/ul&gt;\n      &lt;/div&gt;\n\n    </pre></code></div><div class=btn-group uib-dropdown uib-keyboard-nav><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-sm" uib-dropdown-toggle>最小</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-sm" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem>第一</li><li class=dropdown-item role=menuitem>第二</li><li class=dropdown-item role=menuitem>第三</li><li class=divider></li><li class=dropdown-item role=menuitem>第四</li></ul></div><div class=btn-group uib-dropdown uib-keyboard-nav><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-md" uib-dropdown-toggle>中间</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem>第一</li><li class=dropdown-item role=menuitem>第二</li><li class=dropdown-item role=menuitem>第三</li><li class=dropdown-item role=menuitem>第四</li></ul></div><div class=btn-group uib-dropdown uib-keyboard-nav><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-lg" uib-dropdown-toggle>最大wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem>第一wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww</li><li class=dropdown-item role=menuitem>第二wwwwwwwwwww-wwwwwwwwwwwwwwwwwwwwwwww</li><li class=dropdown-item role=menuitem>第三</li><li class=dropdown-item role=menuitem>第四</li><li class=dropdown-item role=menuitem>第一</li><li class=dropdown-item role=menuitem>第二</li><li class=dropdown-item role=menuitem>第三</li><li class=dropdown-item role=menuitem>第四</li><li class=dropdown-item role=menuitem>第一</li><li class=dropdown-item role=menuitem>第二</li><li class=dropdown-item role=menuitem>第三</li><li class=dropdown-item role=menuitem>第四</li></ul></div><div class=btn-group uib-dropdown uib-keyboard-nav><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-lg" uib-dropdown-toggle>两行</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem>1上一行<p class=dropdown-item-br>下一行wwwwwwwww-wwwwwwwwwwwwwwwwwwwwwwww</p></li><li class=dropdown-item role=menuitem>2上一行<p class=dropdown-item-br>下一行wwwwwwwww-wwwwwwwwwwwwwwwwwwwwwwww</p></li><li class=dropdown-item role=menuitem>3上一行<p class=dropdown-item-br>下一行wwwwwwwww-wwwwwwwwwwwwwwwwwwwwwwww</p></li><li class=dropdown-item role=menuitem>4上一行<p class=dropdown-item-br>下一行wwwwwwwww-wwwwwwwwwwwwwwwwwwwwwwww</p></li></ul></div><div class=btn-group uib-dropdown uib-keyboard-nav><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-md btn-down-navbar" uib-dropdown-toggle><i class="icon iconfont icon-code01 icon-color"></i> 应用列表</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem ui-sref=app.appmanage><i class="iconfont icon-more01 icon-color"></i> 进入应用列表 <i class="iconfont icon-right01" style="float: right"></i></li><li class=divider></li><li class=dropdown-item role=menuitem><i class="icon iconfont icon-14pxandroid icon-color"></i>应用一</li><li class=dropdown-item role=menuitem><i class="icon iconfont icon-14pxh5 icon-color"></i>应用二</li><li class=dropdown-item role=menuitem><i class="icon iconfont icon-14pxapple icon-color"></i>应用三</li><li class=dropdown-item role=menuitem><i class="icon iconfont icon-code01 icon-color"></i>应用四</li></ul></div><div class=btn-group uib-dropdown uib-keyboard-nav><button id=simple-btn-keyboard-nav type=button class="btn btn-down-noborder" uib-dropdown-toggle>无边框</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-noborder" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem>第一</li><li class=dropdown-item role=menuitem>第二</li><li class=dropdown-item role=menuitem>第三</li><li class=dropdown-item role=menuitem>第四</li></ul></div>'),a.put("app/styles/demos/grid.html",'<h2>栅格</h2><div><code><pre>\n      &lt;div class="ab-grid"&gt;\n        &lt;div class="ab-col ab-col-2"&gt;两列&lt;/div&gt;\n        &lt;div class="ab-col ab-col-3"&gt;三列&lt;/div&gt;\n      &lt;/div&gt;\n    </pre></code></div><div class=ab-grid><div class="ab-col ab-col-1">1</div><div class="ab-col ab-col-1">2</div><div class="ab-col ab-col-1">3</div><div class="ab-col ab-col-1">4</div><div class="ab-col ab-col-1">5</div><div class="ab-col ab-col-1">6</div><div class="ab-col ab-col-1">7</div><div class="ab-col ab-col-1">8</div><div class="ab-col ab-col-1">9</div><div class="ab-col ab-col-1">10</div><div class="ab-col ab-col-1">11</div><div class="ab-col ab-col-1">12</div><div class="ab-col ab-col-1">13</div><div class="ab-col ab-col-1">14</div><div class="ab-col ab-col-1">15</div><div class="ab-col ab-col-1">16</div></div><div class=ab-grid><div class="ab-col ab-col-2">2</div><div class="ab-col ab-col-3">3</div></div><div class=ab-grid><div class="ab-col ab-col-3">3</div></div><div class=ab-grid><div class="ab-col ab-col-4">4</div></div><div class=ab-grid><div class="ab-col ab-col-5">5</div></div><div class=ab-grid><div class="ab-col ab-col-6">6</div></div><div class=ab-grid><div class="ab-col ab-col-7">7</div></div><div class=ab-grid><div class="ab-col ab-col-8">8</div></div><div class=ab-grid><div class="ab-col ab-col-9">9</div></div><div class=ab-grid><div class="ab-col ab-col-10">10</div></div><div class=ab-grid><div class="ab-col ab-col-11">11</div></div><div class=ab-grid><div class="ab-col ab-col-12">12</div></div><div class=ab-grid><div class="ab-col ab-col-13">13</div></div><div class=ab-grid><div class="ab-col ab-col-14">14</div></div><div class=ab-grid><div class="ab-col ab-col-15">15</div></div><div class=ab-grid><div class="ab-col ab-col-16">16</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-1">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-2">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-3">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-4">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-5">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-6">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-7">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-8">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-9">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-10">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-11">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-12">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-13">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-14">1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-15">1</div></div><div class=ab-grid><div class="ab-col ab-col-1">1</div><div class="ab-col ab-col-1">2</div><div class="ab-col ab-col-1">3</div><div class="ab-col ab-col-1">4</div><div class="ab-col ab-col-1">5</div><div class="ab-col ab-col-1">6</div><div class="ab-col ab-col-1">7</div><div class="ab-col ab-col-1">8</div><div class="ab-col ab-col-1">9</div><div class="ab-col ab-col-1">10</div><div class="ab-col ab-col-1">11</div><div class="ab-col ab-col-1">12</div><div class="ab-col ab-col-1">13</div><div class="ab-col ab-col-1">14</div><div class="ab-col ab-col-1">15</div><div class="ab-col ab-col-1">16</div></div><div class=ab-grid><div class="ab-col ab-col-8"><div class=ab-grid><div class="ab-col ab-col-3" style=background-color:yellow>3</div><div class="ab-col ab-col-5" style=background-color:green>5</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-7" style=background-color:yellow>1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-7" style=background-color:yellow>1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-7" style=background-color:yellow>1</div></div><div class=ab-grid><div class="ab-col ab-col-1 ab-col-offset-7" style=background-color:yellow>1</div></div></div><div class="ab-col ab-col-4" style=background-color:blue>4</div><div class="ab-col ab-col-4" style=background-color:red>4</div></div><div class=ab-grid-container><div class=ab-grid-fix-right style=height:200px;background-color:red></div><div class=ab-grid-left style=background-color:yellow><div class="ab-col ab-col-1" style=background-color:green>1</div><div class="ab-col ab-col-1" style=background-color:blue>2</div><div class="ab-col ab-col-1" style=background-color:green>3</div><div class="ab-col ab-col-1" style=background-color:blue>4</div><div class="ab-col ab-col-1" style=background-color:green>5</div><div class="ab-col ab-col-1" style=background-color:blue>6</div><div class="ab-col ab-col-1" style=background-color:green>7</div><div class="ab-col ab-col-1" style=background-color:blue>8</div><div class="ab-col ab-col-1" style=background-color:green>9</div><div class="ab-col ab-col-1" style=background-color:blue>10</div><div class="ab-col ab-col-1" style=background-color:green>11</div><div class="ab-col ab-col-1" style=background-color:blue>12</div><div class="ab-col ab-col-1" style=background-color:green>13</div></div></div><div class=ab-grid-container><div class=ab-grid-fix-left style=height:200px;background-color:red></div><div class=ab-grid-right style=background-color:yellow><div class="ab-col ab-col-1" style=background-color:green>1</div><div class="ab-col ab-col-1" style=background-color:blue>2</div><div class="ab-col ab-col-1" style=background-color:green>3</div><div class="ab-col ab-col-1" style=background-color:blue>4</div><div class="ab-col ab-col-1" style=background-color:green>5</div><div class="ab-col ab-col-1" style=background-color:blue>6</div><div class="ab-col ab-col-1" style=background-color:green>7</div><div class="ab-col ab-col-1" style=background-color:blue>8</div><div class="ab-col ab-col-1" style=background-color:green>9</div><div class="ab-col ab-col-1" style=background-color:blue>10</div><div class="ab-col ab-col-1" style=background-color:green>11</div><div class="ab-col ab-col-1" style=background-color:blue>12</div><div class="ab-col ab-col-1" style=background-color:green>13</div><div class="ab-col ab-col-1" style=background-color:blue>14</div></div></div><div class=ab-grid-container><div class=ab-grid-fix-right style=height:200px;background-color:red></div><div class=ab-grid-left><div class="ab-col ab-col-4" style=height:50px;background-color:yellow></div><div class="ab-col ab-col-9" style=height:50px;background-color:blue>2</div></div><div class=ab-grid-left><div class="ab-col ab-col-4" style=height:50px;background-color:green></div></div><div class=ab-grid-left><div class="ab-col ab-col-1 ab-col-offset-12" style=height:50px;background-color:yellow></div></div></div><div class=ab-grid><div class="ab-col ab-col-3" style=background-color:yellow>3</div><div class="ab-col ab-col-2" style=background-color:green>2</div><div class="ab-col ab-col-4" style=background-color:yellow>4</div><div class="ab-col ab-col-7" style=background-color:green>7</div></div>'),a.put("app/styles/demos/icons.html",'<h2>icons demo</h2><hr><ul class="icon_lists clear"><li><i class="icon iconfont icon-gear101"></i><div class=name>gear1-01</div><div class=fontclass>.icon-gear101</div></li><li><i class="icon iconfont icon-star01"></i><div class=name>Star-01</div><div class=fontclass>.icon-star01</div></li><li><i class="icon iconfont icon-stop01"></i><div class=name>Stop-01</div><div class=fontclass>.icon-stop01</div></li><li><i class="icon iconfont icon-add01"></i><div class=name>Add-01</div><div class=fontclass>.icon-add01</div></li><li><i class="icon iconfont icon-left01"></i><div class=name>left-01</div><div class=fontclass>.icon-left01</div></li><li><i class="icon iconfont icon-right01"></i><div class=name>right-01</div><div class=fontclass>.icon-right01</div></li><li><i class="icon iconfont icon-frame01"></i><div class=name>frame-01</div><div class=fontclass>.icon-frame01</div></li><li><i class="icon iconfont icon-checkmark01"></i><div class=name>Checkmark-01</div><div class=fontclass>.icon-checkmark01</div></li><li><i class="icon iconfont icon-point01"></i><div class=name>point-01</div><div class=fontclass>.icon-point01</div></li><li><i class="icon iconfont icon-trash01"></i><div class=name>Trash-01</div><div class=fontclass>.icon-trash01</div></li><li><i class="icon iconfont icon-down01"></i><div class=name>Down-01</div><div class=fontclass>.icon-down01</div></li><li><i class="icon iconfont icon-up01"></i><div class=name>Up-01</div><div class=fontclass>.icon-up01</div></li><li><i class="icon iconfont icon-checkmark02"></i><div class=name>Checkmark-02</div><div class=fontclass>.icon-checkmark02</div></li><li><i class="icon iconfont icon-clouse01"></i><div class=name>Clouse-01</div><div class=fontclass>.icon-clouse01</div></li><li><i class="icon iconfont icon-warning01"></i><div class=name>warning-01</div><div class=fontclass>.icon-warning01</div></li><li><i class="icon iconfont icon-question01"></i><div class=name>Question-01</div><div class=fontclass>.icon-question01</div></li><li><i class="icon iconfont icon-side101"></i><div class=name>side1-01</div><div class=fontclass>.icon-side101</div></li><li><i class="icon iconfont icon-start01"></i><div class=name>Start-01</div><div class=fontclass>.icon-start01</div></li><li><i class="icon iconfont icon-stop02"></i><div class=name>Stop-02</div><div class=fontclass>.icon-stop02</div></li><li><i class="icon iconfont icon-edit01"></i><div class=name>Edit-01</div><div class=fontclass>.icon-edit01</div></li><li><i class="icon iconfont icon-bigright01"></i><div class=name>BigRight-01</div><div class=fontclass>.icon-bigright01</div></li><li><i class="icon iconfont icon-bigwarn01"></i><div class=name>BigWarn-01</div><div class=fontclass>.icon-bigwarn01</div></li><li><i class="icon iconfont icon-bigwrong01"></i><div class=name>BigWrong-01</div><div class=fontclass>.icon-bigwrong01</div></li><li><i class="icon iconfont icon-gear02"></i><div class=name>gear-02</div><div class=fontclass>.icon-gear02</div></li><li><i class="icon iconfont icon-h5tool101"></i><div class=name>H5tool1-01</div><div class=fontclass>.icon-h5tool101</div></li><li><i class="icon iconfont icon-h5tool201"></i><div class=name>H5tool2-01</div><div class=fontclass>.icon-h5tool201</div></li><li><i class="icon iconfont icon-h5tool301"></i><div class=name>H5tool3-01</div><div class=fontclass>.icon-h5tool301</div></li><li><i class="icon iconfont icon-h5tool401"></i><div class=name>H5tool4-01</div><div class=fontclass>.icon-h5tool401</div></li><li><i class="icon iconfont icon-h5tool501"></i><div class=name>H5tool5-01</div><div class=fontclass>.icon-h5tool501</div></li><li><i class="icon iconfont icon-h5tool601"></i><div class=name>H5tool6-01</div><div class=fontclass>.icon-h5tool601</div></li><li><i class="icon iconfont icon-h5tool701"></i><div class=name>H5tool7-01</div><div class=fontclass>.icon-h5tool701</div></li><li><i class="icon iconfont icon-h5tool801"></i><div class=name>H5tool8-01</div><div class=fontclass>.icon-h5tool801</div></li><li><i class="icon iconfont icon-mobile01"></i><div class=name>Mobile-01</div><div class=fontclass>.icon-mobile01</div></li><li><i class="icon iconfont icon-pad01"></i><div class=name>Pad-01</div><div class=fontclass>.icon-pad01</div></li><li><i class="icon iconfont icon-pc01"></i><div class=name>PC-01</div><div class=fontclass>.icon-pc01</div></li><li><i class="icon iconfont icon-add02"></i><div class=name>Add-02</div><div class=fontclass>.icon-add02</div></li><li><i class="icon iconfont icon-sound"></i><div class=name>Sound</div><div class=fontclass>.icon-sound</div></li><li><i class="icon iconfont icon-user"></i><div class=name>User</div><div class=fontclass>.icon-user</div></li><li><i class="icon iconfont icon-speaker01"></i><div class=name>Speaker-01</div><div class=fontclass>.icon-speaker01</div></li><li><i class="icon iconfont icon-logo01"></i><div class=name>logo-01</div><div class=fontclass>.icon-logo01</div></li><li><i class="icon iconfont icon-serch01"></i><div class=name>Serch-01</div><div class=fontclass>.icon-serch01</div></li><li><i class="icon iconfont icon-volume01"></i><div class=name>volume-01</div><div class=fontclass>.icon-volume01</div></li><li><i class="icon iconfont icon-link01"></i><div class=name>link-01</div><div class=fontclass>.icon-link01</div></li><li><i class="icon iconfont icon-redo01"></i><div class=name>redo-01</div><div class=fontclass>.icon-redo01</div></li><li><i class="icon iconfont icon-undo01"></i><div class=name>undo</div><div class=fontclass>.icon-undo01</div></li><li><i class="icon iconfont icon-web"></i><div class=name>web</div><div class=fontclass>.icon-web</div></li><li><i class="icon iconfont icon-code01"></i><div class=name>code-01</div><div class=fontclass>.icon-code01</div></li><li><i class="icon iconfont icon-calendar01"></i><div class=name>calendar-01</div><div class=fontclass>.icon-calendar01</div></li><li><i class="icon iconfont icon-crown"></i><div class=name>crown</div><div class=fontclass>.icon-crown</div></li><li><i class="icon iconfont icon-diamond01"></i><div class=name>diamond-01</div><div class=fontclass>.icon-diamond01</div></li><li><i class="icon iconfont icon-list01"></i><div class=name>list-01</div><div class=fontclass>.icon-list01</div></li><li><i class="icon iconfont icon-more01"></i><div class=name>more-01</div><div class=fontclass>.icon-more01</div></li><li><i class="icon iconfont icon-pback"></i><div class=name>p_back</div><div class=fontclass>.icon-pback</div></li><li><i class="icon iconfont icon-version01"></i><div class=name>version-01</div><div class=fontclass>.icon-version01</div></li><li><i class="icon iconfont icon-code0201"></i><div class=name>code-02-01</div><div class=fontclass>.icon-code0201</div></li><li><i class="icon iconfont icon-eye01"></i><div class=name>eye-01</div><div class=fontclass>.icon-eye01</div></li><li><i class="icon iconfont icon-reset01"></i><div class=name>Reset-01</div><div class=fontclass>.icon-reset01</div></li><li><i class="icon iconfont icon-semicircle01"></i><div class=name>semicircle-01</div><div class=fontclass>.icon-semicircle01</div></li><li><i class="icon iconfont icon-question201"></i><div class=name>question2-01</div><div class=fontclass>.icon-question201</div></li><li><i class="icon iconfont icon-jianxiao01"></i><div class=name>减小-01</div><div class=fontclass>.icon-jianxiao01</div></li><li><i class="icon iconfont icon-zengjia01"></i><div class=name>增加-01</div><div class=fontclass>.icon-zengjia01</div></li><li><i class="icon iconfont icon-pencil01"></i><div class=name>Pencil-01</div><div class=fontclass>.icon-pencil01</div></li><li><i class="icon iconfont icon-iconfonttalk"></i><div class=name>iconfont-talk</div><div class=fontclass>.icon-iconfonttalk</div></li><li><i class="icon iconfont icon-data01"></i><div class=name>data-01</div><div class=fontclass>.icon-data01</div></li><li><i class="icon iconfont icon-iconfontmail"></i><div class=name>iconfont-mail</div><div class=fontclass>.icon-iconfontmail</div></li><li><i class="icon iconfont icon-iconfonttel"></i><div class=name>iconfont-tel</div><div class=fontclass>.icon-iconfonttel</div></li><li><i class="icon iconfont icon-more02"></i><div class=name>more-02</div><div class=fontclass>.icon-more02</div></li><li><i class="icon iconfont icon-medal01"></i><div class=name>Medal-01</div><div class=fontclass>.icon-medal01</div></li><li><i class="icon iconfont icon-compass01"></i><div class=name>Compass-01</div><div class=fontclass>.icon-compass01</div></li><li><i class="icon iconfont icon-multidata01"></i><div class=name>Multi-data-01</div><div class=fontclass>.icon-multidata01</div></li><li><i class="icon iconfont icon-play01"></i><div class=name>Play-01</div><div class=fontclass>.icon-play01</div></li><li><i class="icon iconfont icon-logo02"></i><div class=name>logo-02</div><div class=fontclass>.icon-logo02</div></li><li><i class="icon iconfont icon-free01"></i><div class=name>Free-01</div><div class=fontclass>.icon-free01</div></li><li><i class="icon iconfont icon-address01"></i><div class=name>Address-01</div><div class=fontclass>.icon-address01</div></li><li><i class="icon iconfont icon-hand01"></i><div class=name>Hand-01</div><div class=fontclass>.icon-hand01</div></li><li><i class="icon iconfont icon-logo03"></i><div class=name>logo-03</div><div class=fontclass>.icon-logo03</div></li><li><i class="icon iconfont icon-side701"></i><div class=name>side7-01</div><div class=fontclass>.icon-side701</div></li><li><i class="icon iconfont icon-code0301"></i><div class=name>code-03-01</div><div class=fontclass>.icon-code0301</div></li><li><i class="icon iconfont icon-play"></i><div class=name>Play</div><div class=fontclass>.icon-play</div></li><li><i class="icon iconfont icon-copy201"></i><div class=name>copy2-01</div><div class=fontclass>.icon-copy201</div></li><li><i class="icon iconfont icon-url201"></i><div class=name>url2-01</div><div class=fontclass>.icon-url201</div></li><li><i class="icon iconfont icon-link0201"></i><div class=name>link-02-01</div><div class=fontclass>.icon-link0201</div></li><li><i class="icon iconfont icon-unlink01"></i><div class=name>unlink-01</div><div class=fontclass>.icon-unlink01</div></li><li><i class="icon iconfont icon-copy301"></i><div class=name>copy3-01</div><div class=fontclass>.icon-copy301</div></li><li><i class="icon iconfont icon-trash02"></i><div class=name>Trash-02</div><div class=fontclass>.icon-trash02</div></li><li><i class="icon iconfont icon-sidecontrol"></i><div class=name>Side_Control</div><div class=fontclass>.icon-sidecontrol</div></li><li><i class="icon iconfont icon-sidedetail"></i><div class=name>Side_Detail</div><div class=fontclass>.icon-sidedetail</div></li><li><i class="icon iconfont icon-sidegear"></i><div class=name>Side_Gear</div><div class=fontclass>.icon-sidegear</div></li><li><i class="icon iconfont icon-sideoverview"></i><div class=name>Side_Overview</div><div class=fontclass>.icon-sideoverview</div></li><li><i class="icon iconfont icon-siderocket"></i><div class=name>Side_Rocket</div><div class=fontclass>.icon-siderocket</div></li><li><i class="icon iconfont icon-sideversion"></i><div class=name>Side_Version</div><div class=fontclass>.icon-sideversion</div></li><li><i class="icon iconfont icon-add"></i><div class=name>Add</div><div class=fontclass>.icon-add</div></li><li><i class="icon iconfont icon-add2"></i><div class=name>Add2</div><div class=fontclass>.icon-add2</div></li><li><i class="icon iconfont icon-14pxdel"></i><div class=name>14px_del</div><div class=fontclass>.icon-14pxdel</div></li><li><i class="icon iconfont icon-14pxright"></i><div class=name>14px_right</div><div class=fontclass>.icon-14pxright</div></li><li><i class="icon iconfont icon-14pxwrong"></i><div class=name>14px_wrong</div><div class=fontclass>.icon-14pxwrong</div></li><li><i class="icon iconfont icon-14pxandroid"></i><div class=name>14px_Android</div><div class=fontclass>.icon-14pxandroid</div></li><li><i class="icon iconfont icon-14pxcode"></i><div class=name>14px_Code</div><div class=fontclass>.icon-14pxcode</div></li><li><i class="icon iconfont icon-14pxh5"></i><div class=name>14px_H5</div><div class=fontclass>.icon-14pxh5</div></li><li><i class="icon iconfont icon-14pxedit"></i><div class=name>14px_edit</div><div class=fontclass>.icon-14pxedit</div></li><li><i class="icon iconfont icon-14pxadd"></i><div class=name>14px_add</div><div class=fontclass>.icon-14pxadd</div></li><li><i class="icon iconfont icon-14pxsearch"></i><div class=name>14px_Search</div><div class=fontclass>.icon-14pxsearch</div></li><li><i class="icon iconfont icon-14pxd"></i><div class=name>14px_D</div><div class=fontclass>.icon-14pxd</div></li><li><i class="icon iconfont icon-14pxl"></i><div class=name>14px_L</div><div class=fontclass>.icon-14pxl</div></li><li><i class="icon iconfont icon-14pxr"></i><div class=name>14px_R</div><div class=fontclass>.icon-14pxr</div></li><li><i class="icon iconfont icon-14pxu"></i><div class=name>14px_U</div><div class=fontclass>.icon-14pxu</div></li><li><i class="icon iconfont icon-14pxend"></i><div class=name>14px_End</div><div class=fontclass>.icon-14pxend</div></li><li><i class="icon iconfont icon-14pxstart"></i><div class=name>14px_Start</div><div class=fontclass>.icon-14pxstart</div></li><li><i class="icon iconfont icon-14pxmore"></i><div class=name>14px_more</div><div class=fontclass>.icon-14pxmore</div></li><li><i class="icon iconfont icon-sideret"></i><div class=name>Side_Ret</div><div class=fontclass>.icon-sideret</div></li><li><i class="icon iconfont icon-bell"></i><div class=name>Bell</div><div class=fontclass>.icon-bell</div></li><li><i class="icon iconfont icon-user1"></i><div class=name>User</div><div class=fontclass>.icon-user1</div></li><li><i class="icon iconfont icon-mark"></i><div class=name>mark</div><div class=fontclass>.icon-mark</div></li><li><i class="icon iconfont icon-bigplay"></i><div class=name>BigPlay</div><div class=fontclass>.icon-bigplay</div></li><li><i class="icon iconfont icon-clock"></i><div class=name>Clock</div><div class=fontclass>.icon-clock</div></li><li><i class="icon iconfont icon-hide"></i><div class=name>Hide</div><div class=fontclass>.icon-hide</div></li><li><i class="icon iconfont icon-question"></i><div class=name>Question</div><div class=fontclass>.icon-question</div></li><li><i class="icon iconfont icon-14pxframe"></i><div class=name>14px_Frame</div><div class=fontclass>.icon-14pxframe</div></li><li><i class="icon iconfont icon-14pxframeche"></i><div class=name>14px_Frameche</div><div class=fontclass>.icon-14pxframeche</div></li><li><i class="icon iconfont icon-48pxcompass"></i><div class=name>48px_Compass</div><div class=fontclass>.icon-48pxcompass</div></li><li><i class="icon iconfont icon-48pxwarning01"></i><div class=name>48px_Warning-01</div><div class=fontclass>.icon-48pxwarning01</div></li><li><i class="icon iconfont icon-48pxgroup"></i><div class=name>48px_Group</div><div class=fontclass>.icon-48pxgroup</div></li><li><i class="icon iconfont icon-48pxright"></i><div class=name>48px_Right</div><div class=fontclass>.icon-48pxright</div></li><li><i class="icon iconfont icon-48pxwrong"></i><div class=name>48px_Wrong</div><div class=fontclass>.icon-48pxwrong</div></li><li><i class="icon iconfont icon-48pxplane"></i><div class=name>48px_Plane</div><div class=fontclass>.icon-48pxplane</div></li><li><i class="icon iconfont icon-48pxquestion"></i><div class=name>48px_Question</div><div class=fontclass>.icon-48pxquestion</div></li><li><i class="icon iconfont icon-48pxclone"></i><div class=name>48px_Clone</div><div class=fontclass>.icon-48pxclone</div></li><li><i class="icon iconfont icon-14pxhelp"></i><div class=name>14px_Help</div><div class=fontclass>.icon-14pxhelp</div></li><li><i class="icon iconfont icon-copy"></i><div class=name>Copy</div><div class=fontclass>.icon-copy</div></li><li><i class="icon iconfont icon-delete"></i><div class=name>Delete</div><div class=fontclass>.icon-delete</div></li><li><i class="icon iconfont icon-back"></i><div class=name>back</div><div class=fontclass>.icon-back</div></li><li><i class="icon iconfont icon-14pxeye"></i><div class=name>14px_eye</div><div class=fontclass>.icon-14pxeye</div></li><li><i class="icon iconfont icon-14pxdownload"></i><div class=name>14px_Download</div><div class=fontclass>.icon-14pxdownload</div></li><li><i class="icon iconfont icon-sidedownloade"></i><div class=name>Side_Downloade</div><div class=fontclass>.icon-sidedownloade</div></li><li><i class="icon iconfont icon-14pxrefresh"></i><div class=name>14px_Refresh</div><div class=fontclass>.icon-14pxrefresh</div></li><li><i class="icon iconfont icon-curve"></i><div class=name>curve</div><div class=fontclass>.icon-curve</div></li><li><i class="icon iconfont icon-14pxapple"></i><div class=name>14px_Apple</div><div class=fontclass>.icon-14pxapple</div></li><li><i class="icon iconfont icon-14pxe"></i><div class=name>14px_E</div><div class=fontclass>.icon-14pxe</div></li><li><i class="icon iconfont icon-14pxwarning"></i><div class=name>14px_warning</div><div class=fontclass>.icon-14pxwarning</div></li><li><i class="icon iconfont icon-Arrow_up"></i><div class=name>Arrow_up</div><div class=fontclass>.icon-Arrow_up</div></li><li><i class="icon iconfont icon-Curve"></i><div class=name>Curve</div><div class=fontclass>.icon-Curve</div></li><li><i class="icon iconfont icon-Ret"></i><div class=name>Ret</div><div class=fontclass>.icon-Ret</div></li><li><i class="icon iconfont icon-Multi"></i><div class=name>Multi</div><div class=fontclass>.icon-Multi</div></li><li><i class="icon iconfont icon-Up"></i><div class=name>Up</div><div class=fontclass>.icon-Up</div></li><li><i class="icon iconfont icon-H5"></i><div class=name>H5</div><div class=fontclass>.icon-H5</div></li><li><i class="icon iconfont icon-diamond"></i><div class=name>diamond</div><div class=fontclass>.icon-diamond</div></li><li><i class="icon iconfont icon-APP"></i><div class=name>APP</div><div class=fontclass>.icon-APP</div></li><li><i class="icon iconfont icon-mark2"></i><div class=name>mark2</div><div class=fontclass>.icon-mark2</div></li><li><i class="icon iconfont icon-px_All"></i><div class=name>30px_All</div><div class=fontclass>.icon-px_All</div></li><li><i class="icon iconfont icon-px_Start"></i><div class=name>30px_Start</div><div class=fontclass>.icon-px_Start</div></li><li><i class="icon iconfont icon-px_Stop"></i><div class=name>30px_Stop</div><div class=fontclass>.icon-px_Stop</div></li><li><i class="icon iconfont icon-px_Stopwatch"></i><div class=name>30px_Stopwatch</div><div class=fontclass>.icon-px_Stopwatch</div></li><li><i class="icon iconfont icon-px_bulb"></i><div class=name>30px_bulb</div><div class=fontclass>.icon-px_bulb</div></li><li><i class="icon iconfont icon-abMan"></i><div class=name>abMan</div><div class=fontclass>.icon-abMan</div></li></ul>'),
a.put("app/styles/demos/input.html",'<h2>input demos</h2><hr><form name=form novalidate autocomplete=off><p>string test</p><div><input name=name class=ab-input placeholder=mini ng-model=formTest.name required minlength=3 maxlength=15><ab-input-icon form=form input-name=name></ab-input-icon><ab-input-desc form=form input-name=name>用户名</ab-input-desc><ab-input-error-box form=form input-name=name><ab-error type=required custom=true>用户名称敢不填写</ab-error><ab-error type=minlength len=3></ab-error><ab-error type=maxlength len=15></ab-error></ab-input-error-box></div><p>number test</p><div><input type=number name=age class=ab-input placeholder=mini ng-model=formTest.age required min=0 max=120><ab-input-icon form=form input-name=age></ab-input-icon><ab-input-desc form=form input-name=age>年龄</ab-input-desc><ab-input-error-box form=form input-name=age><ab-error type=required></ab-error><ab-error type=min len=0></ab-error><ab-error type=max len=120></ab-error></ab-input-error-box></div><p>url test</p><div><input type=url name=url class=ab-input placeholder=mini ng-model=formTest.url required><ab-input-icon form=form input-name=url></ab-input-icon><ab-input-desc form=form input-name=url>请输入测试地址链接</ab-input-desc><ab-input-error-box form=form input-name=url><ab-error type=required></ab-error><ab-error type=url></ab-error></ab-input-error-box></div><p>pattern test</p><div><input name=desc class="ab-input ab-input-block" placeholder=mini ng-model=formTest.desc required ng-pattern=/^[\\u4e00-\\u9fa5A-Za-z][\\u4e00-\\u9fa5a-zA-Z0-9_]*$/ ><ab-input-icon form=form input-name=desc></ab-input-icon><ab-input-desc form=form input-name=desc>描述</ab-input-desc><ab-input-error-box form=form input-name=desc><ab-error type=required></ab-error><ab-error type=pattern></ab-error></ab-input-error-box></div><div><input name=sss class=ab-input placeholder=mini ng-model=formTest.sss></div><input type=submit></form>'),a.put("app/styles/demos/menus.html",'<h2>menus demos</h2><hr><!-- select menu --><div class=btn-group uib-dropdown is-open=status.isopen><button id=single-button type=button class="btn btn-selectdown" uib-dropdown-toggle ng-disabled=disabled>&or;</button><div class=ab-fl style=margin-left:5px><span class=ab-block>注册按钮化</span> <span class=ab-fontdisable>https:www.lpotest.com</span></div><ul class=dropdown-menu-select role=menu aria-labelledby=single-button><li role=menuitem class=active><p>注册按钮化</p><span>https:www.appadhoc.com</span></li><li role=menuitem><p>注册按钮化</p><span>https:www.appadhoc.com</span></li></ul></div><h3>demo charge bar</h3><div><!-- <charge source="useInfoData"></charge> --></div><div><!-- <charge source="useInfoData2"></charge> --></div>'),a.put("app/styles/demos/nav.html",'<h2>nav demos</h2><hr><!-- deriv --><div ng-show=lock><select ng-select=select()><button on-click=close()></button></select></div><!--  nav-tab --><div style=background-color:#eee;margin-top:30px;padding:50px><tabset><tab><tab-heading><i class="fa fa-beer"></i> 运行中 (1)</tab-heading>adsfasfd</tab><tab><tab-heading><i class="fa fa-beer"></i> 最近结束 (2)</tab-heading>dsafasdf</tab><tab><tab-heading><i class="fa fa-beer"></i> Messages (2)</tab-heading>safds</tab></tabset></div>'),a.put("app/styles/demos/pagination.html","<h2>pagination demos</h2><hr><h4>demo1</h4><!-- pagination --><nav><ul class=pagination><li class=active><a href=# aria-label=Previous><span aria-hidden=true>&lt;</span></a></li><li><a href=#>1</a></li><li class=active><a href=#>2</a></li><li><a href=#>3</a></li><li><a href=#>4</a></li><li><a href=#>5</a></li><li class=disabled><a href=# aria-label=Next><span aria-hidden=true>&gt;</span></a></li></ul></nav><h4>demo2</h4><pagination total-items=totalItems ng-model=currentPage ng-change=pageChanged() previous-text=&lt; next-text=&gt;></pagination>"),a.put("app/styles/demos/panels.html","<h2>panels demos</h2><br><h3>flagpanel</h3><!-- <flagpanels select-flag='select'></panels> --><flag-panle select-flag=select curgroup=curGroup></flag-panle><!-- <stat-panle select-stat=''></stat-panle> --> <button ng-click=opens()>open</button> <button ng-click=closes()>close</button><div ng-bind=fei></div><div><code><p>HTML的展示</p><pre>\n        &lt;panels select-flag='select' curgroup='curGroup'&gt;&lt;/panels &gt;\n        &lt;button ng-click=\"opens()\"&gt;&lt;/button&gt;\n        &lt;button ng-click=\"closes()\"&gt;&lt;/button&gt;\n        &lt;div ng-bind='fei'&gt;&lt;/div&gt;\n    </pre></code><p>在control里获取数据方法和打开的方法,</p><code><pre>\n            $scope.opens =function(){\n              App.openPenls();//必须有App服务，因为组件外打开的服务在App.\n            }\n              $scope.closes=function(){\n                  App.closePenls();//关闭的接口\n              }\n            $scope.select=function(d){\n              console.log(d,'select');\n            };\n        </pre></code></div><h3>statpanle</h3><!-- <flagpanels select-flag='select'></panels> --><stat-panle select-stat=select curgroup=curGroup></stat-panle><!-- <stat-panle select-stat=''></stat-panle> --> <button ng-click=openstat()>open</button> <button ng-click=closePenlStat()>closestat</button><div ng-bind=fei></div><div><code><p>HTML的展示</p><pre>\n        &lt;panels select-flag='select' curgroup='curGroup'&gt;&lt;/panels &gt;\n        &lt;button ng-click=\"openstat()\"&gt;&lt;/button&gt;\n        &lt;div ng-bind='fei'&gt;&lt;/div&gt;\n    </pre></code><p>在control里获取数据方法和打开的方法,</p><code><pre>\n            $scope.openstat =function(){\n              App.openPenlStat();//必须有App服务，因为组件外打开的服务在App.\n            }\n              $scope.closePenlStat=function(){\n                  App.closePenlStat();//关闭的接口\n              }\n            $scope.select=function(d){\n              console.log(d,'select');\n            };\n        </pre></code></div><h3>statpanle</h3><!-- <flagpanels select-flag='select'></panels> --><stat-panle select-flag=select></stat-panle><!-- <stat-panle select-stat=''></stat-panle> --> <button ng-click=openstat()>open</button><div ng-bind=fei></div><div><code><p>HTML的展示</p><pre>\n        &lt;panels select-flag='select'&gt;&lt;/panels &gt;\n        &lt;button ng-click=\"openstat()\"&gt;&lt;/button&gt;\n        &lt;div ng-bind='fei'&gt;&lt;/div&gt;\n    </pre></code><p>在control里获取数据方法和打开的方法,</p><code><pre>\n            $scope.openstat =function(){\n              App.openPenlStat();//必须有App服务，因为组件外打开的服务在App.\n            }\n            $scope.select=function(d){\n              console.log(d,'select');\n            };\n        </pre></code></div>"),a.put("app/styles/demos/select.html",'<h2>select demos</h2><div><code><pre>\n      &lt;div class="<span style="color: red">ab-select-wrapper</span>"&gt;\n        &lt;select class="<span style="color: red">ab-select</span>"&gt;\n          &lt;option value="hide"&gt;-- Month --&lt;/option&gt;\n          &lt;option value="january"&gt;January&lt;/option&gt;\n          &lt;option value="february"&gt;February&lt;/option&gt;\n          &lt;option value="march"&gt;March&lt;/option&gt;\n          &lt;option value="april"&gt;April&lt;/option&gt;\n          &lt;option value="may"&gt;May&lt;/option&gt;\n          &lt;option value="june"&gt;June&lt;/option&gt;\n        &lt;/select&gt;\n      &lt;/div&gt;\n    </pre></code></div><div class=ab-select-wrapper><select class=ab-select><option value=hide>-- Month --</option><option value=january>January</option><option value=february>February</option><option value=march>March</option><option value=april>April</option><option value=may>May</option><option value=june>June</option></select></div><div class=ab-select-wrapper><select class=ab-select><option value=hide>我是option，就算我很长，也不会覆盖到字体图标</option><option value=january>January</option><option value=february>February</option><option value=march>March</option><option value=april>April</option><option value=may>May</option><option value=june>June</option></select></div>'),a.put("app/styles/demos/tables-edit.html",'<h1>table edit</h1><br><table class=ab-table-edit><thead><tr><td style=width:56%>名称</td><td style=width:40%>状态</td><td width=100px></td></tr></thead><tbody><tr ng-repeat="user in users" ng-click=rowform.$show() ng-class="{\'ab-table-edit-focus\': rowform.$visible}"><td><!-- editable username (text with validation) --> <span editable-text=user.name e-name=name e-placeholder=请填写用户名 e-form=rowform onbeforesave="checkName($data, user.id)">{{ user.name }}</span></td><td><span editable-select=user.status e-name=status e-form=rowform e-ng-options="s.value as s.text for s in statuses">{{ showStatus(user) }}</span></td><td style="white-space: nowrap"><form editable-form name=rowform ng-show=rowform.$visible class="form-buttons form-inline" shown="inserted == user"><button type=submit ng-disabled=rowform.$waiting class=icon-success><i class="iconfont icon-14pxright"></i></button> <button type=button ng-disabled=rowform.$waiting ng-click=cleanForm($event,rowform) class=icon-error><i class="iconfont icon-14pxwrong"></i></button></form><div class=buttons ng-show=!rowform.$visible><button ng-click=removeUser($event,$index) class=icon-del uib-tooltip=删除指标><i class="iconfont icon-14pxdel"></i></button></div></td></tr></tbody></table><button class="btn btn-default" ng-click=addUser()>Add row</button>'),a.put("app/styles/demos/tables.html",'<h2>table demos</h2><hr><!-- table no border块 --><div class="ab-panel ng-scope"><div class=ab-panel-header>整体数据</div><div class=ab-panel-body table-scroll><table class=ab-table><thead><tr><th><p class=ab-table-header>版本dududududdududu嘟嘟嘟嘟嘟嘟啥啥啥水水水水水水水水</p></th><th uib-tooltip-template="\'summary-d.html\'"><p class=ab-table-header>UV</p><p class=ab-table-child-header>系统预置，进入试验版本的访客数</p></th><th><p class=ab-table-header>PV</p><p class=ab-table-child-header>系统预置，试验页面的展示次数</p></th><th><p class=ab-table-header>Click</p><p class=ab-table-child-header>用户点击</p></th></tr></thead><tbody><tr><td class=ab-table-child-header><span class="ab-pr10 ab-cir5 ab-bacdarksalmon"></span> <span>原始版本</span></td><td><div class=ab-table-number>1877</div></td><td><p class=ab-table-number>0.2</p></td><td><p class=ab-table-number>0.2</p></td></tr><tr><td><span class="ab-pr10 ab-cir5 ab-bacdarksalmon"></span> <span>原始版本</span></td><td><div class=ab-table-number>1877</div></td><td><p class=ab-table-number>0.2</p><div class="ab-table-change ab-table-green">+ 0.57%<div class=ab-table-interval>[ <span class=ab-font-red>-2%</span> <span class=ab-table-green>+2%</span> ]</div></div></td><td><p class=ab-table-number>0.2</p><div class="ab-table-change ab-table-green">+ 0.57%<div class="ab-table-interval ab-font-gray">[ <span class=ab-font-red>-2%</span> <span class=ab-table-green>+2%</span> ]</div></div></td></tr></tbody></table></div></div><script type=text/ng-template id=summary-d.html><div class="tooltip-content">\n    <ul>\n      <li>\n        <p>UV</p>\n        <p>系统预置，进入试验的访客数，累计排重</p>\n      </li>\n    </ul>\n  </div></script>'),a.put("app/styles/styles.html","<div class=container><!-- ab-edit-table --><div ng-include src=\"'app/styles/demos/tables-edit.html'\"></div><!-- input --><div ng-include src=\"'app/styles/demos/input.html'\"></div><!-- nav --><div ng-include src=\"'app/styles/demos/nav.html'\"></div><!-- abtoast --><div ng-include src=\"'app/styles/demos/abtoast.html'\"></div><!-- abtab --><div ng-include src=\"'app/styles/demos/abtab.html'\"></div><!-- panels  --><div ng-include src=\"'app/styles/demos/panels.html'\"></div><!-- buttons --><div ng-include src=\"'app/styles/demos/button.html'\"></div><!-- icons --><div ng-include src=\"'app/styles/demos/icons.html'\"></div><!--  charts --><div ng-include src=\"'app/styles/demos/charts.html'\"></div><!-- pagination --><div ng-include src=\"'app/styles/demos/pagination.html'\"></div><!-- menu  --><div ng-include src=\"'app/styles/demos/menus.html'\"></div><!-- select --><div ng-include src=\"'app/styles/demos/select.html'\"></div><!-- shizi --><div class=ab-def-add><div></div><div></div></div><!-- dropdown2 --><div ng-include src=\"'app/styles/demos/dropdown2.html'\"></div><!-- abpanel --><div ng-include src=\"'app/styles/demos/abpanel.html'\"></div><!-- ab-table  --><div ng-include src=\"'app/styles/demos/tables.html'\"></div><!-- grid  --><div ng-include src=\"'app/styles/demos/grid.html'\"></div><!-- abmodal  --><div ng-include src=\"'app/styles/demos/abmodal.html'\"></div></div>"),a.put("app/summary/summary.html",'<!--<div class="clearfix mb20">\n  <div uib-dropdown class="btn-group">\n    <button uib-dropdown-toggle class="btn btn-default" type="button" id="segmenu">\n      细分：{{current_segment}}\n      <span class="caret"></span>\n    </button>\n    <ul uib-dropdown-menu role="menu" aria-labelledby="segmenu">\n      <li role="menuitem"><a class="action" tabindex="-1" ng-click="changeSegment()">所有用户</a></li>\n      <li class="divider"></li>\n      <li role="menuitem" ng-repeat="seg in segments"><a class="action" tabindex="-1" ng-click="changeSegment(seg)">{{seg.keyname}} ({{seg.value}})</a></li>\n    </ul>\n  </div>\n</div>--><div class=ab-panel id=summary><div class=ab-panel-header><span>数据概览</span><a tabindex=0 tooltip-trigger=focus class="btn ab-question" uib-tooltip-template="\'summary-a.html\'" tooltip-placement=right> <i class="iconfont icon-question201 ab-question201"></i></a><div class=ab-panel-right-box><button class="btn ab-icontext-btn" ng-show="importDataRole && group.status !=Constant.EXP_STATUS_DEF" ng-click=importData() style="margin-top: -7px"><i class="iconfont icon-px_Export"></i> 导出数据</button> <button class="btn ab-icontext-btn" ng-click=goCurVersion() style="margin-top: -7px"><i class="iconfont icon-px_Gear"></i> 运行控制</button></div><!-- <div class="ab-panel-right-box" style="margin-right:38%;margin-top: -10px;"> --><div class=ab-panel-center-box><div class=ab-btn-group><button class="btn ab-btn-press-sm" ng-model=statUnit uib-btn-radio=0>均值</button> <button class="btn ab-btn-press-sm" ng-model=statUnit uib-btn-radio=1>总值</button> <button class="btn ab-btn-press-sm" ng-model=statUnit uib-btn-radio=2>转化人数</button> <button class="btn ab-btn-press-sm" ng-model=statUnit uib-btn-radio=3>转化率</button></div></div></div><div class=ab-panel-padding-body><div class="text-center ab-testpostbody clearfix"><div class=ab-inblock smartizen-charts num=barChartData.length width=300 ng-repeat="item in barChartData track by $index"><ng-echarts style=width:100%;height:300px;float:left ec-config=barConfig ec-option=item></ng-echarts></div></div></div><div class=ab-panel-padding-body table-scroll style=overflow-x:auto><table class=ab-table><thead><tr><th><p class=ab-table-header>版本</p></th><th uib-tooltip-template="\'summary-d.html\'"><p class=ab-table-header>UV</p><p class=ab-table-child-header>系统预置，进入试验版本的访客数</p></th><th ng-show="curAppType == Constant.APP_TYPE_H5" uib-tooltip-template="\'summary-e.html\'"><p class=ab-table-header>PV</p><p class=ab-table-child-header>系统预置，试验页面的展示次数</p></th><th ng-repeat="s in vaildeStats | toArray | filter : showFilter | orderBy: \'-orderFormulaKey\'" uib-tooltip-template="\'summary-c.html\'" ng-click=goStateDeatil(s) ng-class="{\'ab-cursor\':!s.formula}" ng-hide="indexCovarianceData.hasOwnProperty(s.name)&& statUnit != Constant.STATUS_MEAN"><p class=ab-table-header ng-bind=" s.hasOwnProperty(\'statName\') ? s.statName : s.name"></p><p class=ab-table-child-header ng-show=s.formula>[复合]{{s.description}}</p><p class="ab-table-child-header summary-table-title" ng-show=!s.formula>[<span>{{meanType}}</span>]{{s.description}}</p></th></tr></thead><tbody><tr ng-repeat="r in vaildeExpAndControl|orderBy:\'created_at\'"><td><point></point>&nbsp; <span class=ab-table-child-header ng-if=r.isControl uib-tooltip-html="\'原始版本<br/>{{r.description}}\'">原始版本 &nbsp;({{r.traffic}}%)</span> <span class=ab-table-child-header ng-if=!r.isControl uib-tooltip-html="\'{{r.name}}<br/>{{r.description}}\'">{{ r.name }} &nbsp; ({{r.traffic}}%)</span></td><td><div>{{indexClients[r.id].client_sum||0}}</div></td><td ng-show="curAppType == Constant.APP_TYPE_H5"><div>{{ (r[\'PV\']*1).toMyPrecision(3) || 0 }}</div></td><td ng-repeat="s in vaildeStats | toArray | orderBy: \'-orderFormulaKey\'" ng-hide="indexCovarianceData.hasOwnProperty(s.name) && statUnit != Constant.STATUS_MEAN"><!-- <p ng-show="s.name== Constant.SYSTEM_STATS_PV">{{itemStatResult.toMyPrecision(3)|| 0 }}</p> --><p ng-show="s.name== Constant.SYSTEM_STATS_PV">{{(r[\'storeExpConfidence\'][s.name]*1).toMyPrecision(3)|| 0 }}<!-- s.formula为复合区分 --></p><div ng-show=s.formula><p ng-show="s.name!== Constant.SYSTEM_STATS_PV &&statUnit == Constant.STATUS_MEAN && indexCovarianceData.hasOwnProperty(s.name) ">{{ r[\'storeExpConfidence\'][s.name].mean||0}}</p><p ng-show="s.name!== Constant.SYSTEM_STATS_PV && statUnit ==Constant.STATUS_TOTAL ||statUnit == Constant.STATUS_MEAN && !indexCovarianceData.hasOwnProperty(s.name) ">{{ r[\'storeExpConfidence\'][s.name].sum ||0}}</p><p ng-show="s.name!== Constant.SYSTEM_STATS_PV && statUnit ==Constant.STATUS_CONVERT || statUnit == Constant.STATUS_CONVERTRATE && !indexCovarianceData.hasOwnProperty(s.name)">{{ r[\'storeExpConfidence\'][s.name].uv ||0}}</p></div><div ng-show=!s.formula><p ng-show="statUnit == Constant.STATUS_MEAN">{{(r[\'storeExpConfidence\'][s.name].mean*1).toMyPrecision(3) ||0}}</p><p ng-show="statUnit == Constant.STATUS_TOTAL">{{(r[\'storeExpConfidence\'][s.name].sum*1).toMyPrecision(3) || 0}}</p><p ng-show="statUnit == Constant.STATUS_CONVERT">{{(r[\'storeExpConfidence\'][s.name].uv*1).toMyPrecision(3) || 0}}</p><p ng-show="statUnit == Constant.STATUS_CONVERTRATE">{{(r[\'storeExpConfidence\'][s.name].uv_mean*100).toMyPrecision(3)}}%</p></div><div ng-show="s.name != Constant.SYSTEM_STATS_UV"><ui-variant-percent percent="r[\'storeExpConfidence\'][s.name].variant" uib-tooltip=较原始版本变化度 ng-hide=r.isControl notip=true></ui-variant-percent><span ng-show="s.formula == \'\'|| testStatsFormualCovariance(s.formula)"><ui-ci-range range="r[\'storeExpConfidence\'][s.name].cirang" ng-hide=r.isControl uib-tooltip=95%置信区间 notip=true></ui-ci-range></span></div></td></tr></tbody></table></div></div><div class=ab-panel id=flow><div class=ab-panel-header>流量走势图<a tabindex=0 tooltip-trigger=focus class="btn ab-question" tooltip-placement=right uib-tooltip-template="\'summary-b.html\'"> <i class="iconfont icon-question201 ab-question201"></i> </a><!-- <div class="ab-btn-group ab-panel-padright-box">\n      <button id="btnPeriodHour" class="btn ab-btn-press-sm ng-pristine ng-untouched ng-valid" ng-model="chartPeriodStatus" uib-btn-radio="0" uib-tooltip="周期：小时">按时</button>\n      <button id="btnPeriodDay" class="btn ab-btn-press-sm ng-pristine ng-untouched ng-valid active" ng-model="chartPeriodStatus" uib-btn-radio="1" uib-tooltip="周期：天">按日</button>\n    </div> --><div class=ab-panel-right-box><div class=ab-btn-group style="margin-top: -24px"><button id=btnPeriodHour class="btn ab-btn-press-sm ng-pristine ng-untouched ng-valid" ng-model=chartPeriodStatus uib-btn-radio=0 uib-tooltip=周期：小时>按时</button> <button id=btnPeriodDay class="btn ab-btn-press-sm ng-pristine ng-untouched ng-valid active" ng-model=chartPeriodStatus uib-btn-radio=1 uib-tooltip=周期：天>按日</button></div><p style="width:205px;position: relative;display: inline-block;margin: -8px 0 0 10px"><input date-range-picker class="pull-right btn-time ab-input-date-down date-picker" type=button options=datePickerConfig ng-model=datePicker.date id=summaryFlow><label class="ab-input-date-down-icon iconfont icon-down01" for=summaryFlow></label></p></div></div><div class=ab-panel-padding-body><div class=ab-grid><ng-echarts class="ab-col ab-col-16" style="width:100%;height:300px;margin-bottom: 12px" ec-config=barConfig ec-option=lineOption></ng-echarts></div><div class=page-charts><ul class="chartist-pie-label list-unstyled list-inline m-mt-20" ng-class="{\'text-center\': vaildeExpAndControl.length<=10,\'text-left\': vaildeExpAndControl.length>10}"><li ng-repeat="l in vaildeExpAndControl |orderBy:\'created_at\' "><point></point>{{l.isControl ? \'原始版本\' : l.name}}</li></ul></div></div></div><script type=text/ng-template id=summary-a.html><div class="tooltip-content">\n    <p>试验运行至今的累计数据</p>\n    <ul>\n      <li>\n        <strong>UV</strong> 进入试验的访客数，累计排重\n      </li>\n      <li><strong>指标总值</strong>:累计上报指标数</li>\n      <li><strong>指标均值</strong>:指标总值/试验UV</li>\n      <li><strong>转化人数</strong>:累计指标触发人数</li>\n      <li><strong>转化率</strong>:转化人数/UV</li>\n      <li><strong>复合指标</strong>:按照指标总值或转化总值计算</li>\n    </ul>\n  </div></script><script type=text/ng-template id=summary-b.html><div class="tooltip-content">\n    所选日期内进入到各个版本的访客数。\n  </div></script><script type=text/ng-template id=summary-c.html><div class="tooltip-content">\n    <p>{{s.hasOwnProperty(\'statName\')?s.statName:s.name}}</p>\n    <p ng-show="s.formula">[复合]{{s.description}}</p>\n    <p ng-show="s.formula">公式：{{s.formula}}</p>\n    <p ng-show="!s.formula">[<span>{{meanType}}</span>]{{s.description}}</p>\n  </div></script><script type=text/ng-template id=summary-d.html><div class="tooltip-content">\n    <ul>\n      <li>\n        <p>UV</p>\n        <p>系统预置，进入试验的访客数，累计排重</p>\n      </li>\n    </ul>\n  </div></script><script type=text/ng-template id=summary-e.html><div class="tooltip-content">\n    <ul>\n      <li>\n        <p>PV</p>\n        <p>系统预置，试验页面的展示次数</p>\n      </li>\n    </ul>\n  </div></script><div ui-view></div>'),a.put("app/testdata/testdata.html",'<div class=ab-panel id=testdata><div class=ab-panel-header>运行控制<a class="btn ab-question" uib-tooltip-template="\'testdata-tip-a.html\'" tooltip-placement=right tooltip-trigger=focus tabindex=0> <i class="iconfont icon-question201 ab-question201"></i></a></div><div class="testdata-user-audience clearfix" uib-tooltip="受众表达式: {{ curConditionStr }}">定向用户群<a class="btn ab-question" uib-tooltip-template="\'testdata-totptip-advanced.html\'" tooltip-placement=right tooltip-trigger=focus tabindex=0> <i class="iconfont icon-question201 ab-question201"></i> </a>&nbsp;{{ curAudience.name || Constant.ADCANCED_ALL }}&nbsp;&nbsp;{{ curAudience.description }}<div class=pull-right><span class=text-muted>试验开始后不可更改</span> <button class="btn ab-icontext-btn" id=btnoptiontest ng-show="group.status == Constant.EXP_STATUS_DEF" ng-click=optionAlert()><i class="iconfont icon-px_Gear"></i> 设置</button></div></div><div class=ab-panel-padding-body><div class=ab-grid><div ng-class="{\'ab-col\': curControl.status != Constant.EXP_STATUS_STOP && curControl.status != Constant.EXP_STATUS_PUBLISH ,\'ab-col-5\':curControl.status != Constant.EXP_STATUS_STOP && curControl.status != Constant.EXP_STATUS_PUBLISH ,\'testdata-testname-run\':curControl.status != Constant.EXP_STATUS_STOP && curControl.status != Constant.EXP_STATUS_PUBLISH ,\'testdata-testname-stop\':curControl.status == Constant.EXP_STATUS_STOP && curControl.status == Constant.EXP_STATUS_PUBLISH }"><p>试验名称: {{group.name}}</p><p class=ab-form-row>试验描述: <input style=width:70% class=ab-input ng-model=group.description ng-enter=updateDescription() ng-blur=updateDescription()></p><p class=ab-form-row>创建时间: <span ng-bind="group.control.created_at*1000 | date : \'yyyy-MM-dd\'"></span></p><button id=btnStartCampaign class="testdata-btn testdata-run-btn" ng-click=startCampaign() ng-show="group.status === Constant.EXP_STATUS_DEF" ng-disabled="group.experiments.length==0"><i class="iconfont icon-bigplay"></i> 开始试验</button> <button class="testdata-btn testdata-stop-btn" ng-click=stopCampaign() ng-show="group.status == Constant.EXP_STATUS_RUN"><i class="iconfont icon-px_Stop"></i> 结束试验</button> <button class="testdata-btn testdata-stop-btn" ng-show="group.status == Constant.EXP_STATUS_STOP">试验已停止</button> <button class="testdata-btn testdata-run-btn" ng-show="group.status == Constant.EXP_STATUS_PUBLISH">试验已发布，版本：<span ng-repeat="exp in curExps" ng-bind=exp.name ng-show="exp.status == Constant.EXP_STATUS_PUBLISH"></span></button></div><div class="ab-col ab-col-3" ng-show="curControl.status != Constant.EXP_STATUS_STOP && curControl.status != Constant.EXP_STATUS_PUBLISH"><ng-echarts style=height:180px;display:block ec-config=pieConfig ec-option=pieOption></ng-echarts></div><div class="ab-col ab-col-8" ng-show="curControl.status != Constant.EXP_STATUS_STOP && curControl.status != Constant.EXP_STATUS_PUBLISH"><div class=testdata-totaltraffic><sliderplus show=true tposition="\'bottom\'" max=vaildLayerTraffic min=0 save=saveAll step=curExps.length modal=totalTraffic val=totalTraffic change=avgTraffic remain=elseTraffic></sliderplus></div><div><ul class="testdata-itemtraffic testdata-itemexp"><li ng-repeat="exp in curExps"><point></point>&nbsp<span ng-bind=exp.name class=testdata-expname ng-show=!exp.isControl></span><span ng-show=exp.isControl class=testdata-expname>原始版本</span> <input ng-model=exp.traffic style="width:45px;min-width:45px;padding:0px 15px 0px 5px;text-align:center" class=ab-input ng-change=itemChange(exp)> <span class=testdata-percent>%</span><!-- <button class="ab-btn ab-btn-success" ng-if="!exp.isControl"  ng-click="launch(exp)" ng-show="exp.typ === Constant.EXP_TYPE_CODE && exp.status == Constant.EXP_STATUS_RUN">\n                 <span ng-show="exp.status != Constant.EXP_STATUS_DELETE">发布</span>\n               </button> --><p ng-show=exp.maxTrafficFig class=testdata-errorcol ng-bind=exp.tipError></p></li></ul><div><button ng-click=saveAll() class="ab-btn ab-btn-success ab-btn-sm">保存</button> <button ng-click=resetAll() class="ab-btn ab-btn-default ab-btn-sm" ng-show=editStatus>重置</button></div></div></div></div></div></div><script type=text/ng-template id=testdata-tip-a.html><div class="uib-tooltip-content">\n    <p>该分层下所有试验共用100%的线上流量。</p>\n    <p>可直接设置整个试验的总流量，也可为每个版本单独分配流量。</p>\n    <p>发布：将线上全流量切换为该版本并结束试验。</p>\n    <p>详情参考<a href="http://doc.lpotest.com/expFlow/flowDistribution.html" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script><script type=text/ng-template id=testdata-c.html><div class="tooltip-content">\n    <ul>\n      <li>\n        <p>UV</p>\n        <p>系统预置，进入试验的访客数，累计排重</p>\n      </li>\n    </ul>\n  </div></script><script type=text/ng-template id=testdata-d.html><div class="tooltip-content">\n    <ul>\n      <li>\n        <p>PV</p>\n        <p>系统预置，试验页面的展示次数</p>\n      </li>\n    </ul>\n  </div></script><script type=text/ng-template id=testdata-e.html><div class="tooltip-content">\n    <p>{{s.name}}</p>\n    <p ng-show="s.formula">[复合]{{s.description}}</p>\n    <p ng-show="s.formula">公式：{{s.formula}}</p>\n    <p ng-show="!s.formula">[<span>[人均]</span>]{{s.description}}</p>\n  </div></script><script type=text/ng-template id=testdata-totptip-advanced.html><div class="tooltip-content">\n    <p>请在试验开始前设置，开始后不可更改。</p>\n    <p>当您希望在一部分用户中运行试验时，可设置受众群体，只有符合受众群体条件的用户会进入<br>试验。例如操作系统、应用版本等，并且支持多种条件的与或非组合。<br>\n    100%的流量为全部流量中所有符合分组条件的用户。</p>\n    <p>详情参考<a href="http://doc.lpotest.com/expFlow/orientationTest.html" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script><div ui-view></div>'),a.put("app/url/url.html","<stepbar></stepbar><div class=app-container><div class=container-h5><div class=container ui-view state-loader></div></div></div>"),a.put("app/urllists/urllists.html",'<div class="ab-panel url-lists" id=urllists><div class=ab-panel-header>2. 试验版本<a class="btn ab-question" uib-tooltip-template="\'h5urls-b.html\'" tooltip-placement=right tabindex=0 tooltip-trigger=focus> <i class="iconfont icon-question201 ab-question201"></i></a></div><div class=ab-panel-padding-body><div class=ab-grid><div class="ab-col ab-col-9 ab-col-offset-3"><div><form editable-form name=exp.form class=ab-form-row onaftersave=saveExp($data,exp) ng-repeat="exp in curExps | orderBy:\'created_at\'"><div ng-class="{\'url-list-control\': exp.isControl}" style=position:relative><div class=url-list-warning ng-show=exp.isControl><i class="iconfont icon-14pxwarning"></i> 此链接将作为试验URL发布，试验上线后，用户访问此链接即可分流到不同试验版本。</div><div class=ab-grid><div class="ab-col ab-col-7 ab-form-row"><span ng-if=exp.isControl ng-bind=exp.name></span> <span ng-if=!exp.isControl editable-text=exp.name e-class="ab-input ab-input-block url-input" e-name=name e-placeholder=版本名称 onbeforesave=checkName($data,exp)>{{ exp.name }}</span></div><div class="ab-col ab-col-7"><span ng-if=exp.isControl ng-bind=exp.description></span> <span ng-if=!exp.isControl editable-text=exp.description e-class="ab-input ab-input-block url-input" e-name=description e-placeholder=版本说明(选填)>{{ exp.description || \'\'}}</span></div></div><div class="ab-grid ab-form-row" ng-init="!exp.annotation.base_url ? exp.form.$show(): \'\'"><div class="ab-col ab-col-16 ab-form-row"><div class="ab-col ab-col-14 ab-form-row"><span editable-text=exp.annotation.base_url e-class="ab-input ab-input-block url-input" e-name=base_url e-placeholder=http:// onbeforesave=checkURL($data)>{{ exp.annotation.base_url || \'\'}}</span></div><div ng-repeat="url in urls" class="ab-grid clearfix" ng-if=exp.isControl><div class="ab-col ab-col-3"><div class=ab-select-wrapper ng-show="mode == REGEXP_MODE"><select class=ab-select ng-init=initURLObj(url) ng-model=url.mode><option value=equal selected>完全匹配</option><option value=regex>模糊匹配</option></select></div><a tabindex=0 class="btn ab-question" tooltip-placement=right uib-tooltip-template="\'h5urls-b.html\'" tooltip-trigger=focus style="padding-top: 5px;padding-left:12px;position:absolute"><i class="iconfont icon-question201 ab-question201"></i></a></div><div class="ab-col ab-col-11"><input name="{{ \'gurl\' + $index }}" ng-model=url.regexp class="ab-input ab-input-block" ng-if="url.mode == \'regex\'" placeholder=请填写包含通配符的规则链接 required><ab-input-icon form=exp.form input-name="{{\'grul\'+ $index}}"></ab-input-icon><ab-input-error-box form=exp.form input-name="{{\'gurl\' + $index}}"><ab-error type=required custom=true>规则链接必填</ab-error></ab-input-error-box></div></div></div><div class="ab-col ab-col-2 url-setting-group" ng-show=!exp.isControl><a class="btn url-group" ng-click=exp.form.$show() uib-tooltip=编辑版本 ng-show=!exp.form.$visible><i class="iconfont icon-14pxedit"></i></a><br><a class="btn url-group-close" ng-click=delVersion(exp) uib-tooltip=删除版本 ng-show=!exp.form.$visible><i class="iconfont icon-14pxdel"></i></a></div></div><div ng-show=exp.form.$visible class="ab-grid text-center"><div class="ab-col ab-col-5 ab-col-offset-4 ab-form-row"><button type=submit class="ab-btn ab-btn-primary" ng-disabled=exp.form.$waiting>保存</button> <button type=button class="ab-btn ab-btn-default" ng-disabled=exp.form.$waiting ng-click=cancel(exp) ng-show=!exp.isControl>取消</button></div></div></div></form></div><div class=ab-form-row><button type=button class=ab-btn-icon ng-click=addVersion() ng-show="addVersionFig() "><i class="iconfont icon-add02"></i> 添加版本</button></div><div class=ab-form-row><div class=url-version-sdk style=position:relative;width:98%><p>请在所有试验页面的&lt;head/&gt;部分加入javascript代码，否则无法读取和编辑页面。</p><textarea style=overflow-y:hidden class=textarea-code readonly rows=6 id=copy-url-sdk>\n<!-- lpotst sdk -->\n<script src=https://sdk.appadhoc.com/ab.plus.js></script>\n<script>\nadhoc(\'init\', {\n  appKey: \'{{app.app_key}}\'\n})\n</script>\n<!-- lpotest sdk end -->\n                     </textarea><i class="iconfont icon-copy url-version-copy" uib-tooltip=点击复制 ng-click=copy()></i><p class=url-version-copytip>{{copyTextTip}}</p></div></div><div class="ab-form-row ab-col ab-col-offset-7"><button type=submit class="ab-btn ab-btn-success ab-btn-md" ng-click=nextStep(form)>下一步&nbsp;&nbsp;<i class="iconfont icon-14pxd"></i></button></div></div></div></div></div><div ui-view></div><script type=text/ng-template id=h5urls-a.html><div class="tooltip-content">\n    <ul>\n      <li>\n        <p>PV</p>\n        <p>系统预置，试验页面的展示次数</p>\n      </li>\n    </ul>\n  </div></script><script type=text/ng-template id=h5urls-b.html><div class="uib-tooltip-content">\n    <p>每个试验版本对应一个独立页面链接，在此填写试验的链接。</p>\n    <p>原始版本链接将作为汇总试验链接发布，用户访问原始版本链接时，可以按照设定的比例跳转到试验页面。如果直接访问试验版本链接，则无法进入试验。</p>\n    <p>详情参考<a href="http://doc.lpotest.comH5exp/URLsplite.html#ver" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script>'),
a.put("app/urlversion/urlversion.html",'<div class="ab-panel url-version" id=urlversion><div class=ab-panel-header>试验版本<a class="btn ab-question" uib-tooltip-template="\'urlversion-b.html\'" tooltip-placement=right tabindex=0 tooltip-trigger=focus> <i class="iconfont icon-question201 ab-question201"></i></a></div><div class=ab-panel-padding-body><div class=ab-grid><div class="ab-col ab-col-16"><form editable-form name=exp.form class=ab-form-row onaftersave=saveExp($data,exp) ng-repeat="exp in curExps | orderBy:\'created_at\'"><div ng-class="{\'url-list-control\': exp.isControl}" style=position:relative><div class=url-list-warning ng-show=exp.isControl><i class="iconfont icon-14pxwarning"></i> 此链接将作为试验URL发布，试验上线后，用户访问此链接即可分流到不同试验版本。</div><div class=ab-grid><div class="ab-col ab-col-7 ab-form-row"><span ng-if=exp.isControl ng-bind=exp.name></span> <span ng-if=!exp.isControl editable-text=exp.name e-class="ab-input ab-input-block url-input" e-name=name e-placeholder=版本名称 onbeforesave=checkName($data,exp)>{{ exp.name }}</span></div><div class="ab-col ab-col-7"><span ng-if=exp.isControl ng-bind=exp.description></span> <span ng-if=!exp.isControl editable-text=exp.description e-class="ab-input ab-input-block url-input" e-name=description e-placeholder=版本说明(选填)>{{ exp.description || \'\'}}</span></div></div><div class=ab-grid ng-init="!exp.annotation.base_url ? exp.form.$show(): \'\'"><div class="ab-col ab-col-14 ab-form-row"><span editable-text=exp.annotation.base_url e-class="ab-input ab-input-block url-input" e-name=base_url e-placeholder=http:// onbeforesave=checkURL($data)>{{ exp.annotation.base_url || \'\'}}</span> <span ng-if="mode == \'regex\' && exp.isControl">(模糊匹配规则): {{ urls[0].regexp }}</span></div><div class="ab-col ab-col-2 url-setting-group" ng-show=!exp.isControl><a class="btn url-group" ng-click=exp.form.$show() uib-tooltip=编辑版本 ng-show=!exp.form.$visible><i class="iconfont icon-14pxedit"></i></a><br><a class="btn url-group-close" ng-click=delVersion(exp) uib-tooltip=删除版本 ng-show=!exp.form.$visible><i class="iconfont icon-14pxdel"></i></a></div></div><div ng-show=exp.form.$visible class="ab-grid text-center"><div class="ab-col ab-col-5 ab-col-offset-4 ab-form-row"><button type=submit class="ab-btn ab-btn-primary" ng-disabled=exp.form.$waiting>保存</button> <button type=button class="ab-btn ab-btn-default" ng-disabled=exp.form.$waiting ng-click=cancel(exp) ng-show=!exp.isControl>取消</button></div></div></div></form></div><div class="ab-col ab-col-16"><div class=ab-form-row><button type=button class=ab-btn-icon ng-click=addVersion()><i class="iconfont icon-add02"></i> 添加版本</button></div></div></div></div><!-- panel-body end --></div><script type=text/ng-template id=urlversion-a.html><div class="uib-tooltip-content">\n    <p>试验版本通过试验变量控制。</p>\n    <p>在此管理每个试验版本中对应的变量值。</p>\n    <p>试验运行中也可以更改，线上同步生效。</p>\n    <p>请确保变量名称已经在代码中正确集成。</p>\n  </div></script><script type=text/ng-template id=urlversion-b.html><div class="uib-tooltip-content">\n    <p>每个试验版本对应一个独立页面链接，在此填写试验的链接</p>\n    <p>原始版本链接将作为汇总试验链接发布，用户访问原始版本链接时，可以按照设定的比例跳转到试验页面。如果直接访问试验版本链接，则无法进入试验。</p>\n    <p>详情参考<a href="http://doc.lpotest.com/expFlow/ver.html" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script><div ui-view></div>'),a.put("app/version/version.html",'<div class=ab-panel id=version><div class=ab-panel-header>试验版本<a class="btn ab-question" uib-tooltip-template="\'version-a.html\'" tooltip-placement=right tabindex=0 tooltip-trigger=focus><i class="iconfont icon-question201 ab-question201"></i></a></div><div class=ab-panel-padding-body><div class="ab-exp-list clearfix"><div class="ab-expitem ab-expitem-header"><div class=ab-expitem-head><span class=ab-expitem-name>变量名称</span></div><div class=ab-expitem-body><div class=ab-expitem-box ng-repeat="flag in curFlags"><span uib-tooltip={{flag.description}} class="ab-breakword ab-w180" uib-tooltip={{flag.name}}>{{flag.name}}</span> <span class=ab-expitem-desc>{{flag.typ}}</span> <a class=ab-btn-icon-delflag ng-if="Constant.EXP_STATUS_DEF === $parent.curControl.status" ng-click=delFlag(flag) uib-tooltip=删除变量><i class="iconfont icon-clouse01"></i></a></div><div class=ab-expitem-box ng-show="curFlags.length === 0">未添加试验变量</div></div></div><div class=ab-expitem ng-class="{\'ab-expitem-control\': exp.isControl}" ng-repeat="exp in curExps | orderBy: \'created_at\'"><div class=ab-expitem-head><span editable-text=exp.name e-name=name e-class=ab-input class="ab-expitem-name ab-expitem-text" e-placeholder=版本名称 e-form=expform onbeforesave=checkExpName($data)>{{exp.isControl ? \'原始版本\' :exp.name}}</span><br><span editable-text=exp.description e-name=description e-class=ab-input class=ab-expitem-text e-placeholder=版本描述 e-form=expform>{{exp.description}}</span><div class=ab-expitem-groups ng-if=!exp.isControl ng-show=!expform.$visible><button class=ab-btn-icon-edit ng-click="focusTr(expform, exp)" uib-tooltip=编辑版本><i class="iconfont icon-14pxedit"></i></button> <button class=ab-btn-icon-del ng-show="exp.status === Constant.EXP_STATUS_DEF" ng-click="removeExp($event, exp)" uib-tooltip=删除版本><i class="iconfont icon-14pxdel"></i></button></div></div><div class=ab-expitem-body><div class=ab-expitem-box ng-repeat="flag in curFlags"><span ng-if="flag.typ === \'String\'" editable-text=exp.flags[flag.name] e-name=flag.name e-class=ab-input e-placeholder=值 onbeforesave=checkFlags($data,flag.typ) e-form=expform edit-disabled={{exp.isControl}} class="ab-breakword ab-w180" uib-tooltip={{exp.flags[flag.name]}}>{{ exp.flags[flag.name]}} </span><span ng-if="flag.typ === \'Number\' || flag.typ === \'Integer\'" editable-number=exp.flags[flag.name] e-name=flag.name e-class=ab-input e-placeholder=值 onbeforesave=checkFlags($data,flag.typ) e-form=expform edit-disabled={{exp.isControl}}>{{ exp.flags[flag.name]}} </span><span ng-if="flag.typ === \'Boolean\'" editable-select=exp.flags[flag.name] e-name=flag.name e-form=expform e-ng-options="s.val as s.key for s in types">{{ exp.flags[flag.name] }}</span></div><div class=ab-expitem-box ng-show="curFlags.length === 0">未添加试验变量</div></div><div class="ab-expitem-footer clearfix" ng-show="expform.$visible && !exp.isControl"><form editable-form name=expform onbeforesave=saveExp($data,exp) class="form-buttons form-inline" shown="inserted == exp"><button type=submit class="ab-btn ab-btn-success pull-right" ng-disabled=rowform.$waiting>确定</button> <button type=button class="ab-btn ab-btn-default pull-right" style=margin-right:12px ng-disabled=rowform.$waiting ng-click="cleanForm($event, expform, exp)">取消</button></form></div></div></div><flag-panle select-flag=select curgroup=curFlags></flag-panle><div class="ab-form-row clearfix" ng-if="curControl.status == Constant.EXP_STATUS_DEF" style=margin-top:24px><button class=ab-btn-icon ng-click=addExps()><i class="iconfont icon-add02"></i> 添加版本</button> <button class=ab-btn-icon ng-click=addFlags() ng-if="curControl.status == Constant.EXP_STATUS_DEF"><i class="iconfont icon-add02"></i> 添加变量</button></div></div></div><script type=text/ng-template id=version-a.html><div class="uib-tooltip-content">\n    <p>试验版本通过试验变量控制。</p>\n    <p>在此管理每个试验版本中对应的变量值。</p>\n    <p>试验运行中也可以更改，线上同步生效。</p>\n    <p>请确保变量名称已经在代码中正确集成。</p>\n    <p>详情参考<a href="http://doc.lpotest.comexpFlow/ver.html" target="_blank" class="ab-link">使用文档</a></p>\n  </div></script><div ui-view></div>'),a.put("components/abError/abError.html",'<p class="ab-input-desc ab-input-error" ng-show=form[inputName].$error[type]><ng-transclude ng-show=isShowDef></ng-transclude><span ng-show="!isShowDef && required">请填写内容</span> <span ng-show="!isShowDef && minlength">不得少于{{len}}字</span> <span ng-show="!isShowDef && maxlength">不得超过{{len}}字</span> <span ng-show="!isShowDef && max">数值不得大于{{len}}</span> <span ng-show="!isShowDef && min">数值不得小于{{len}}</span> <span ng-show="!isShowDef && pattern">格式不正确，请重新输入</span> <span ng-show="!isShowDef && url">请填写正确的页面链接</span></p>'),a.put("components/abExpItem/abExpItem.html",'<div class=ab-exp-item ng-click=openGroup(g)><div class=ab-exp-item-name ng-bind-html="g.name | highlight: searchKey"></div><i class="iconfont icon-right01 ab-exp-item-right01"></i> <i class="iconfont icon-eye01 icon-green ab-exp-item-eye" ng-if="g.typ == Constant.EXP_TYPE_BUILD" uib-tooltip-html="\'可视化\'"></i> <i class="iconfont icon-multidata01 icon-green ab-exp-item-eye" ng-if="g.typ == Constant.EXP_TYPE_URL" uib-tooltip-html="\'多链接\'"></i><div class=ab-exp-item-url>{{g.annotation.base_url}}</div><div class=ab-exp-item-right><div class=ab-exp-item-status><span class=ab-exp-item-status-run ng-show="g.status==  Constant.EXP_STATUS_RUN">运行中</span> <span class=ab-exp-item-status-def ng-show="g.status == Constant.EXP_STATUS_DEF">未开始</span> <span class=ab-exp-item-status-stop ng-show="g.status == Constant.EXP_STATUS_STOP">已结束</span> <span class=ab-exp-item-status-publish ng-show="g.status== Constant.EXP_STATUS_PUBLISH">已发布</span></div><div class=ab-exp-item-days ng-if={start:g.control.start_date,end:g.control.end_date,status:g.status}|dayOldToNew><div ng-show="g.status == Constant.EXP_STATUS_RUN || g.status == Constant.EXP_STATUS_PUBLISH || g.status == Constant.EXP_STATUS_STOP">已运行<span class="ng-binding ab-exp-item-daysNum" ng-bind={start:g.control.start_date,end:g.control.end_date,status:g.status}|dayOldToNew></span>天</div></div><div class=ab-exp-item-ctrate-date>创建于<span ng-bind="g.control.created_at*1000|date:\'yyyy-MM-dd\'" class=ng-binding></span></div><div class=ab-exp-item-double-tab ng-click=stopBubble($event)><a ng-click=clone(g) uib-tooltip-html="\'克隆试验\'"><i class="iconfont icon-copy301 ab-exp-item-copy"></i></a> <a ng-show="g.status!=1" ng-click=deltExp(g)><i class="iconfont icon-trash02 ab-exp-item-trash"></i></a></div></div><div class=ab-exp-item-tab><!-- 这个地方可能要改,hack方法解决显示分层 --> <span ng-show=g.layer_id>{{indexAllLayer[g.layer_id]? indexAllLayer[g.layer_id].name:\'不互斥\'}} </span><span ng-show=!g.layer_id>默认层 </span><span class=ab-exp-item-cutline>|</span> <span ng-show="g.status == Constant.EXP_STATUS_RUN || g.status == Constant.EXP_STATUS_DEF || g.traffic">流量{{g.traffic}}%</span> <span class=ab-exp-item-cutline ng-show="g.status == Constant.EXP_STATUS_RUN || g.status == Constant.EXP_STATUS_DEF">|</span> <span>{{g.experiments.length}}试验版本</span> <span class=ab-exp-item-cutline>|</span> <span ng-if="(g.control.stats | filter: statsFilter).length>0">{{ (g.control.stats | filter: statsFilter).length}}个优化指标</span> <span ng-if="(g.control.stats | filter: statsFilter).length<=0">未设置优化指标</span></div></div>'),a.put("components/abInputDesc/abInputDesc.html",'<p class=ab-input-desc ng-hide="form.$submitted && form[inputName].$invalid || form[inputName].$invalid && form[inputName].$dirty || form[inputName].$invalid && form[inputName].$touched" ng-transclude></p>'),a.put("components/abInputErrorBox/abInputErrorBox.html",'<div ng-show="form.$submitted || form[inputName].$touched || form[inputName].$dirty" ng-transclude style=position:absolute></div>'),a.put("components/abInputIcon/abInputIcon.html","<i class=iconfont ng-class=\"{'icon-bigright01 ab-input-icon-success':form.$submitted && form[inputName].$valid || form[inputName].$valid , 'icon-bigwrong01 ab-input-icon-wrong':form.$submitted && form[inputName].$invalid || form[inputName].$invalid && form[inputName].$dirty || form[inputName].$invalid && form[inputName].$touched}\"></i>"),a.put("components/abNav/abNav.html",'<div class="navbar navbar-default ab-navbar navbar-fixed-top"><div class="navbar-container clearfix"><div class=navbar-header><a href=javascript:; class="navbar-brand ablogo"></a></div><div class="navbar-collapse collapse"><ab-nav-noapp ng-if=navStatus></ab-nav-noapp><ab-nav-hasapp ng-if=!navStatus></ab-nav-hasapp><ul class="nav navbar-nav navbar-right"><li><charge source="userInfoData "></charge></li><li ng-show=!navStatus><div class=btn-group uib-dropdown uib-keyboard-nav is-open=status.isopen style=margin-top:7px><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-md btn-down-navbar" uib-dropdown-toggle ng-disabled=disabled><i class="icon iconfont icon-14pxandroid icon-color" ng-if="curApp.typ == Constant.APP_TYPE_ANDIOD"></i> <i class="icon iconfont icon-14pxh5 icon-color" ng-if="curApp.typ == Constant.APP_TYPE_H5"></i> <i class="icon iconfont icon-14pxapple icon-color" ng-if="curApp.typ == Constant.APP_TYPE_IOS"></i> <i class="icon iconfont icon-code01 icon-color" ng-if="curApp.typ == Constant.APP_TYPE_DEF"></i> <i class="icon iconfont icon-px_LPO icon-color" ng-if="curApp.typ == Constant.APP_TYPE_LPO"></i> {{curApp.name}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem ui-sref=app.appmanage><i class="iconfont icon-more01 icon-color" style=vertical-align:middle;color:#d2d2d2></i> <span style=vertical-align:middle>进入应用列表</span> <i class="iconfont icon-right01" style=vertical-align:middle;margin-left:4px;color:#d2d2d2></i></li><li class=divider></li><li class=dropdown-item role=menuitem ng-repeat="item in myapps track by $index"><a href=# ng-click=openApp(item) style=padding:0><i class="icon iconfont icon-14pxandroid isme" ng-if="item.typ == Constant.APP_TYPE_ANDIOD"></i> <i class="icon iconfont icon-14pxh5 isme" ng-if="item.typ == Constant.APP_TYPE_H5"></i> <i class="icon iconfont icon-14pxapple isme" ng-if="item.typ == Constant.APP_TYPE_IOS"></i> <i class="icon iconfont icon-code01 isme" ng-if="item.typ == Constant.APP_TYPE_DEF"></i> <i class="icon iconfont icon-px_LPO isme" ng-if="item.typ == Constant.APP_TYPE_LPO"></i> {{item.name}}</a></li><li class=dropdown-item role=menuitem ng-repeat="item in colapps track by $index"><a href=# ng-click=openApp(item) style=padding:0><i class="icon iconfont icon-14pxandroid notme" ng-if="item.typ == Constant.APP_TYPE_ANDIOD"></i> <i class="icon iconfont icon-14pxh5 notme" ng-if="item.typ == Constant.APP_TYPE_H5"></i> <i class="icon iconfont icon-14pxapple notme" ng-if="item.typ == Constant.APP_TYPE_IOS"></i> <i class="icon iconfont icon-code01 notme" ng-if="item.typ == Constant.APP_TYPE_DEF"></i> <i class="icon iconfont icon-px_LPO notme" ng-if="item.typ == Constant.APP_TYPE_LPO"></i> {{item.name}}</a></li></ul></div></li><li><div class=btn-group uib-dropdown uib-keyboard-nav><a id=simple-btn-keyboard-nav class=navbar-btn-nav-user uib-dropdown-toggle><i class="iconfont icon-bell"></i><i class="iconfont icon-point011 icon-point01" ng-if="message.length>0"></i></a><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role=menu aria-labelledby=simple-btn-keyboard-nav ng-if="message.length>0"><li class=dropdown-item role=menuitem style="line-height: 16px"><span>{{message.length}}</span>条新消息<i class="iconfont icon-trash01 icon-color abnav-icon-brash" ng-click=deleteAllNotRead(message)></i></li><li class=divider></li><li class=dropdown-item role=menuitem ng-repeat="mes in message" ng-click=seeContent(mes)>{{mes.subject}}<p class=dropdown-item-br>{{mes.time | date:\'yyyy-MM-dd\'}}</p></li></ul><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role=menu aria-labelledby=simple-btn-keyboard-nav ng-if="message.length==0"><li class=dropdown-item role=menuitem>暂无未读通知</li></ul></div><div class=btn-group uib-dropdown uib-keyboard-nav><a id=simple-btn-keyboard-nav class=navbar-btn-nav-user uib-dropdown-toggle style=margin-top:1px><i class="iconfont icon-user1"></i></a><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role=menu aria-labelledby=simple-btn-keyboard-nav><li class=dropdown-item role=menuitem ng-bind=currentUser.email ng-click=goChangePass()></li><li class=dropdown-item role=menuitem ui-sref=app.appmanage>APP切换</li><li class=dropdown-item role=menuitem ui-sref=app.management ng-show="curUser.role == \'Owner\'&& managementRole">成员管理</li><li class=dropdown-item role=menuitem ng-click=exit()>退出登录</li></ul></div></li></ul></div></div></div>'),a.put("components/abNavHasapp/abNavHasapp.html",'<ul class="nav navbar-nav ab-navbar-list navbar-nav-border ab-header-navbar"><li ng-repeat="item in menu" ui-sref-active=active ng-hide=item.isdev><a ui-sref={{item.state}}>{{item.title}}</a></li><!--<li>--><!--<a href="http://doc.lpotest.com/index.html" target="_blank">使用文档</a>--><!--</li>--><!--\n     -<li>\n     -    <a href="http://www.appadhoc.com/blog/category/instance/" target="_blank">案例</a>\n     -</li>\n     --></ul>'),a.put("components/abNavNoapp/abNavNoapp.html",'<ul class="nav navbar-nav ab-navbar-list navbar-nav-border"><li ui-sref-active=active><a ui-sref=app.appmanage ng-class="{\'ab-libs\': item.isClass }">首页</a></li><li ng-repeat="item in menu" ui-sref-active=active><a href={{item.href}} target=_blank ng-bind=item.title ng-class="{\'ab-libs\': item.isClass }"></a></li></ul>'),a.put("components/abTab/abTab.html",'<div class="abtab abtab-center-box"><a class=abtab-left ng-show="navs.length>4" ng-click=clickLeft()><i class="icon iconfont icon-14pxl"></i></a><div class="abtab-list-box js-abtab-list-box"><ul class="abtab-list js-abtab-list" ng-class="{\'abtab-nobottomline\':noBottomLine}"><li ng-repeat="nav in navs" ng-class={on:nav.selected} ng-click=click(nav,$index) ng-show=" $index<4 || abTabShow"><i class="iconfont ab-fl abtab-icon {{nav.icon}}" ng-if=nav.icon></i><a class=ab-fl href=javascript:; ng-class="{\'abtab-width\':nav.width}" ng-bind-html=nav.title></a> <span class="ab-fl abtab-line" ng-show="{{ !$last && nav.line}}">|</span> <span class=abtab-angle><em></em></span></li></ul></div><a class=abtab-right ng-show="navs.length>4" ng-mousedown=mousedownRight() ng-mouseup=mouseupRight()><i class="icon iconfont icon-14pxr"></i></a><div ng-show=!nopane ng-transclude></div></div>'),a.put("components/abTabNav/abTabNav.html",""),a.put("components/abTabPane/abTabPane.html","<div class=abtab-pane ng-show=navs[paneIndex].selected ng-transclude></div>"),a.put("components/abToast/abToast.html",'<div><div class="abtoast-box {{type}}"><i class="icon iconfont icon-speaker01 abtoast-icon" ng-if=icon></i><div class=abtoast-content ng-transclude></div></div><a href=javascript:; ng-click=click()><i class="iconfont icon-clouse01 abtoast-close"></i></a></div>'),a.put("components/actionbar/actionbar.html",'<div class=actionbar><a class=actionbar-back ui-sref=app.main><i class="iconfont icon-back"></i></a><p class=actionbar-name>试验名称: {{group.name}}</p><div class=actionbar-con><p class="ab-item-status-def actionbar-text" ng-show="group.status == Constant.EXP_STATUS_DEF">未运行</p><p class="ab-item-status-run actionbar-text" ng-show="group.status == Constant.EXP_STATUS_RUN">运行中，已运行<span ng-bind={start:group.control.start_date,end:group.control.end_date,status:group.status}|dayOldToNew></span>天</p><p class="ab-item-status-stop actionbar-text" ng-show="group.status == Constant.EXP_STATUS_STOP && endDaily >= 0">已结束，总共运行<span ng-bind={start:group.control.start_date,end:group.control.end_date,status:group.status}|dayOldToNew></span>天</p><p class="ab-item-status-publish actionbar-text" ng-show="group.status == Constant.EXP_STATUS_PUBLISH">已发布</p></div><!-- tab bar box --><div class=actionbar-tabbar><div class=ab-btn-group><button class="ab-btn ab-btn-radius" ng-click=goCurData() ng-class="{\'ab-btn-radius-active\': (\'app.data.summary.detail\' | isState) || (\'app.data.summary.detail.retentionplus\' | isState)}" ui-sref-active=ab-btn-radius-active ng-show="group.status != Constant.EXP_STATUS_DEF">数据</button> <button class="ab-btn ab-btn-radius" ng-click=goCurVersion() ng-class="{\'ab-btn-radius-active\':(\'app.data.testdata.version.stats\' | isState) || (\'app.data.testdata.h5version.autostats\' | isState) || (\'app.data.testdata.urlversion.urlstats\' | isState) }">设置</button> <button class="ab-btn ab-btn-radius" ui-sref=app.data.devtest ui-sref-active=ab-btn-radius-active ng-show=isdev>调试</button></div></div></div>'),a.put("components/charge/charge.html",'<div class=charge><div class="charge-header charge-header-bgcolor-gray"><div class=charge-header-progress><div class=charge-header-progressbar style=width:{{dayRate.rate}} ng-class="{\'charge-header-progressbar-normal-background\':dayRate.type,\'charge-header-progressbar-red-background\':!dayRate.type}"><span style="visibility: hidden">进度条</span></div></div></div><div class=charge-con><div class=charge-con-img><i class="iconfont charge-con-imgicon-size charge-con-imgicon-color" ng-class="{\'icon-diamond01\':!isFree,\'icon-free01\':isFree}"></i></div><div class=charge-con-textarea><h4 class=charge-con-text-padding>{{userType}}</h4><ul ng-show=isFree class=charge-con-textarea-con><li ng-show=!free_expiryFig><p>免费剩余<span>{{dayRate.durDay}}</span> 天</p></li><li ng-show=!free_expiryFig><p>本月API已用: <span ng-class="{\'charge-text-color-red\':apiFlagTip }">{{apiCount}}</span></p></li><li ng-show=freeFindPayFig>账户处于免费试用期。您已续费，免费期结束后，将转为付费账户。</li><li ng-show=!freeFindPayFig><ul><li ng-show=free_expiryFig><span ng-class="{\'charge-text-color-red\':freeDayFlag }">您的账户已超出使用限制，平台已停止统计。为恢复账户数据，请尽快与客户经理联系付费。</span></li><li ng-show=!free_expiryFig><span ng-class="{\'charge-text-color-red\':freeDayFlag }">您的账户处于免费试用期，若逾期未付费，平台将停止统计账户内的试验数据。</span></li></ul></li><li class=charge-free-link><a class=charge-text-color-blue ui-sref=app.changePass>查看计费详情</a>。</li></ul><ul ng-show=!isFree class=charge-con-text-ul><li class=charge-con-text-padding ng-show=isArrearage><p ng-show=!expiryFig>本月API已用: <span ng-class="{\'charge-text-color-red\':apiFlagTip }">{{apiCount}}</span></p><p ng-show=!expiryFig>本月API上限: <span ng-class="{\'charge-text-color-red\':apiFlagTip }">{{apiLimitTip}}</span></p></li><li class=charge-con-text-customer ng-show=expiryFig><span class=charge-text-color-red>您的账户已超出使用限制，平台已停止统计。为恢复账户数据，请尽快与客户经理联系续费。</span></li><li class=charge-con-text-customer ng-show=!expiryFig><div ng-show=isArrearage><span ng-bind=textTip ng-class="{\'charge-text-color-red\':apiFlagTip }"></span></div></li><li ng-show=!expiryFig class=charge-con-text-paytime>付费期限至 : <span ng-class="{\'charge-text-color-red\': dayRate.durDay<30?true : false }" ng-bind=apiEndDate></span></li><li ng-show=curUser.owner_email>计费账号：{{curUser.owner_email}}</li><li ng-show=!expiryFig><span ng-bind=timeTip ng-class="{\'charge-text-color-red\':timeFlagTip }"></span></li><li><a class=charge-text-color-blue ui-sref=app.changePass>查看计费详情</a></li></ul></div></div></div>'),a.put("components/checkPwdModel/checkPwdModel.html",'<div class="ab-modal ab-modal-success"><form name=form novalidate autocomplete=off><div class=mobile-content><p ng-bind-html=content></p><div ng-hide=isTestinMode><input type=password name=pwd ng-model=pwd class="ab-input ab-input-block" placeholder=用户密码 required><ab-input-desc form=form input-name=pwd>请输入密码</ab-input-desc><ab-input-error-box form=form input-name=pwd><ab-error type=required custom=true>密码必须填写</ab-error><ab-error type=checkpwd custom=true>密码输入有误</ab-error></ab-input-error-box></div></div><button type=submit class="ab-btn ab-btn-default" ng-click=ok(form)>确定</button> <button type=button class="ab-btn ab-btn-default" ng-click=cancel()>取消</button></form></div>'),a.put("components/editmemberModel/editmember.html",'<div class="ab-modal ab-modal-success"><form name=nForm novalidate autocomplete=off><div class="mobile-content invitate-content"><h2>编辑成员</h2><div><p>账号</p><div class=invitate-comment style="padding: 0 10px;text-align: left"><span ng-bind=userInfo.email></span></div></div><div><p>备注</p><div class=invitate-comment><input name=comment class="ab-input ab-input-block" ng-model=formTest.owner_comment placeholder=选填></div></div><div><span style="margin-left: -10px">等级</span><ul class=btn-group uib-dropdown uib-keyboard-nav style="width: 350px;margin-left: 10px"><button id=simple-btn-keyboard-member type=button class="btn btn-down btn-down-lg" uib-dropdown-toggle>{{curRole.name}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role=menu aria-labelledby=simple-btn-keyboard-member><li class=dropdown-item role=menuitem ng-repeat="m in roles" ng-click=changeRole(m)><span ng-bind=m.name></span></li></ul></ul></div><div class=invitate-apps-head style=text-align:left><span class=invitate-apps style="margin-left: 8px">参与应用</span><div class=invitate-apps-content style="width: 360px"><div class=invitate-apps-tabs ng-repeat="m in apps"><input class=invitate-sel id={{m.id}} type=checkbox name=selectedApp[] value={{m.name}} ng-checked="appsStores.indexOf(m.id) > -1" ng-click=selectedApp(m.id)><label class=invitate-label for={{m.id}}>{{m.name}}</label></div></div></div></div><div class=ab-modal-btns><button type=button class="ab-btn ab-btn-default" ng-click=cancel() style="width: 150px;height: 40px;font-size: 16px">&nbsp;&nbsp;取消&nbsp;&nbsp;</button> <button type=button class="ab-btn ab-btn-success" ng-disabled="!nForm.$valid  " ng-click=newok() style="width: 190px;height: 40px;margin-left: 20px;font-size: 16px">&nbsp;&nbsp;确定&nbsp;&nbsp;</button></div></form></div>'),a.put("components/expBuildEdit/expBuildEdit.html",'<div class=ab-build-item><h3 class=name editable-text=exp.name e-name=name e-class=ab-input e-placeholder=试验名称 onbeforesave=checkExpName($data) e-form=expform>{{ exp.isControl ? \'原始版本\': exp.name }}</h3><p class=desc editable-text=exp.description e-name=description e-class=ab-input e-form=expform>{{exp.description }}</p><div class=imgBox><img class=img ng-src="{{exp.preImg || \'assets/images/img-loading.bc6fc55b.png\'}}" onerror="this.src=\'assets/images/img-loading.bc6fc55b.png\';" alt=iphone></div><p class=info ng-show=exp.isContral>对照版本，不可编辑</p><p class=status ng-hide=exp.isContral><span ng-show="exp.status==0" class=exp-status-def>未运行</span> <span ng-show="exp.status==1">运行中</span></p><p class=time>创建于 <span ng-bind="exp.created_at*1000 | date:\'yyyy-MM-dd\'"></span></p><a class=me ng-click=show(exp) ng-class="{\'me-block\': exp.isControl}" ng-show=isH5>预览</a> {{ Constant }} <a class="me me-edit" ng-click=edit(expform) ng-class="{\'me-edit-block\': isAndroid }" ng-hide=exp.isControl>编辑</a><form editable-form name=expform onbeforesave=ok($data) ng-show=expform.$visible><button type=submit class="me me-ok">确定</button> <button type=button class="me me-clean" ng-click="cleanForm($event, expform, exp)">取消</button></form></div>'),a.put("components/firstModel/firstModal.html",'<div class="ab-modal ab-modal-success"><p class=ab-modal-title>恭喜,试验创建成功</p><p class=ab-modal-text>点击“完成” 回到试验主页面,接下来您可以进行如下操作。</p><ul class=modal-guide-box><li><p>1. 调整流量,确认试验配置</p><img src=assets/images/step1.929fee9c.png alt=info></li><li><p>2. 运行试验获取报告</p><img src=assets/images/step2.8d62229c.png alt=info></li></ul><div class=ab-modal-btns><button type=button class="btn btn-success btn-modal-guide" ng-click=ok()>完成</button></div></div>'),a.put("components/flagpanel/flagpanel.html",'<ul ng-if=locked><li><ab-tab active=1 tab-click=abTabClickModel><ab-tab-nav width=true title=新建变量></ab-tab-nav><ab-tab-nav width=true title=选择已有变量></ab-tab-nav><ab-tab-pane style="margin-top: -9px"><div class=paneltip-line></div><div class=paneltip-waring>请在代码中需要控制展示的地方集成变量{{vm.createName}}。参考 <a ng-show="curApp.typ === Constant.APP_TYPE_H5 || curApp.typ === Constant.APP_TYPE_DEF" class=ab-link href=http://doc.lpotest.comsdk/htmlSDK.html#flag target=_blank>集成说明</a> <a ng-show="curApp.typ === Constant.APP_TYPE_ANDIOD" class=ab-link href=http://doc.lpotest.comsdk/androidSDK.html#flag target=_blank>集成说明</a> <a ng-show="curApp.typ === Constant.APP_TYPE_IOS" href=http://doc.lpotest.comsdk/iosSDK.html#flag target=_blank>集成说明</a> 。</div><div class=paneltip-cona><div><input ng-model=vm.createName ng-change=changeName(vm.createName) placeholder=请填写变量 class=ab-input id=input-step><icon class="iconfont icon-h5tool701 ab-errorcolor" ng-show=errNameStat></icon><icon class="iconfont icon-bigright01 paneltip-icon" ng-show=!errNameStat ng-class={paneltipright:sucNameStat,paneltipgray:!sucNameStat}></icon><p style="text-align: left" ng-class="{\'ab-errorcolor\':tipStat,\'paneltipgray\':!tipStat}" ng-bind=erroTipName></p></div><div><input ng-model=vm.createDescrition placeholder=变量说明 ng-change=changeDes(vm.createDescrition) class=ab-input style=width:250px><icon class="iconfont icon-bigright01 paneltip-icon" ng-class={paneltipright:sucFlagStat,paneltipgray:!sucFlagStat}></icon></div><div class=btn-group uib-dropdown uib-keyboard-nav style="margin-top: -12px"><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-md" ng-click=clickType() uib-dropdown-toggle ng-disabled=disabledDimension>{{createType}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-nav style="margin-top: -75px"><li class=dropdown-item role=menuitem ng-repeat="d in types" ng-click=selType(d)><span ng-bind=d></span></li></ul></div><div id=input-step-val><div ng-show=!booleanFlag><input ng-model=vm.default_value placeholder={{flagRe}} ng-change=changeVal(vm.default_value) class=ab-input style=width:197px><icon class="iconfont icon-bigright01 paneltip-icon" ng-show=!erroTipValue ng-class={paneltipright:sucValueStat,paneltipgray:!sucValueStat}></icon><icon class="iconfont icon-h5tool701 ab-errorcolor" ng-show=tipFlag></icon><p style="text-align: left" class=paneltipFlag ng-class="{\'ab-errorcolor\':tipFlag,\'paneltipgray\':!tipFlag}" ng-bind=erroTipValue></p></div><div class=btn-group uib-dropdown uib-keyboard-nav ng-show=booleanFlag style="margin-top: -12px"><button id=simple-btn-keyboard-nav type=button class="btn btn-down btn-down-md" ng-click=clickType() uib-dropdown-toggle ng-disabled=disabledDimension>{{createBoolean}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-md" role=menu aria-labelledby=simple-btn-keyboard-nav style="margin-top: -44px"><li class=dropdown-item role=menuitem ng-repeat="d in Booleans" ng-click=selectBoolean(d)><span ng-bind=d></span></li></ul></div></div><button ng-click="create({name:vm.createName,description:vm.createDescrition,typ:createType,default_value:vm.default_value })" class="ab-btn ab-btn-success ab-btn-square paneltip-whight" style=border-style:none><i class="iconfont icon-add02 paneltip-smicon"></i></button></div></ab-tab-pane><ab-tab-pane style="margin-top: -9px"><div class=paneltip-line></div><div class=paneltip-waring>请在代码中需要控制展示的地方集成变量{{vm.createName}}。参考 <a ng-show="curApp.typ === Constant.APP_TYPE_H5 || curApp.typ === Constant.APP_TYPE_DEF" class=ab-link href=http://doc.lpotest.comsdk/htmlSDK.html#flag target=_blank>集成说明</a> <a ng-show="curApp.typ === Constant.APP_TYPE_ANDIOD" class=ab-link href=http://doc.lpotest.comsdk/androidSDK.html#flag target=_blank>集成说明</a> <a ng-show="curApp.typ === Constant.APP_TYPE_IOS" href=http://doc.lpotest.comsdk/iosSDK.html#flag target=_blank>集成说明</a> 。</div><div><ul class=panelconb><li ng-show="statsData.length ==0" style=text-align:center;margin-top:38px>没有变量,请创建变量。</li><li ng-show="statsData.length !=0" ng-class="{\'paneltip-creat-active\': r.select,\'paneltip-creat\':!r.newCreat}" ng-repeat="r in statsData track by $index"><div ng-click=selects(r) tabindex=-1><ul><li ng-bind=r.name uib-tooltip={{r.description}}></li><li class=paneltipcol ng-bind=r.typ></li></ul><button class="ab-btn ab-btn-success ab-btn-square paneltip-whight" style=border-style:none><i class="iconfont icon-add02 paneltip-smicon"></i></button></div></li></ul></div></ab-tab-pane></ab-tab></li><li class=paneltip-bottom><div class=paneltip-bottom-line><span class="paneltip-click iconfont icon-up01"></span> <span class="iconfont icon-semicircle01 paneltip-roundicon" ng-click=lock() style=font-size:30px></span></div></li></ul>'),a.put("components/importDataModel/importDataModel.html",'<div class="ab-modal ab-modal-success"><p class=ab-modal-title>导出数据</p><p class=ab-modal-text>选择时间段后，点击按钮下载表格</p><input date-range-picker class="btn-time form-control date-picker" type=button options=datePickerConfig ng-model=datePicker.date><div class=ab-modal-btns><a ng-href={{url}} class="ab-btn ab-btn-success ab-btn-md" ng-show=isDownload>&nbsp;&nbsp;下载&nbsp;&nbsp;</a></div></div>'),a.put("components/invitate/invitate.html",'<div class="ab-modal ab-modal-success"><form name=nForm novalidate autocomplete=off><div class=invitate-content><h2 style=padding-bottom:40px>邀请成员</h2><div style="height: 40px"><p class=invitate-name-t>账号</p><div class=invitate-name ng-class="{\'invitate-name-error\':errorTipStat}" style="text-align: left"><input name=name class="ab-input ab-input-block" placeholder=请填写邮箱账户 ng-model=formTest.userEmail required ng-pattern=/^([a-zA-Z0-9_\\.\\-])+\\@(([a-zA-Z0-9\\-])+\\.)+([a-zA-Z0-9]{2,4})+$/ ><ab-input-icon form=nForm input-name=name ng-hide=errorTip></ab-input-icon><br><ab-input-desc form=nForm input-name=name ng-hide=errorTip>请及时通知该成员查收邮件</ab-input-desc><span ng-show=errorTip><i class="iconfont icon-bigwrong01 ab-input-icon-wrong invitate-iconwrong"></i> </span><span style="position: relative;right: 125px" class=errorTip>{{errorTip}}</span><ab-input-error-box form=nForm input-name=name><ab-error type=required custom=true>用户名不能为空</ab-error><ab-error type=pattern custom=true>邮箱账号输入错误，请重新输入</ab-error></ab-input-error-box></div></div><div><p style="margin-left: -46px">备注</p><div class=invitate-comment><input name=comment class="ab-input ab-input-block" ng-model=formTest.owner_comment placeholder=选填></div></div><div><span class=invitate-grade>等级</span><ul class=btn-group uib-dropdown uib-keyboard-nav style="width: 350px;margin-left: 10px"><button id=simple-btn-keyboard-member type=button class="btn btn-down btn-down-lg" uib-dropdown-toggle>{{curRole.name}}</button><ul class="uib-dropdown-menu dropdown-menu dropdown-menu-lg" role=menu aria-labelledby=simple-btn-keyboard-member><li class=dropdown-item role=menuitem ng-repeat="m in roles" ng-click=changeRole(m)><span ng-bind=m.name></span><p class=ab-fontgray ng-bind=m.description></p></li></ul></ul></div><div style=text-align:left><span class=invitate-apps style="margin-left: -14px">参与应用</span><div style="width: 360px"><div class=invitate-apps-tabs ng-repeat="m in apps"><input class=invitate-sel id={{m.id}} type=checkbox name=selectedApp[] value={{m.name}} ng-checked="appsStores.indexOf(m.id) > -1" ng-click=selectedApp(m.id)><label class=invitate-label for={{m.id}}>{{m.name}}</label></div></div></div></div><div class=ab-modal-btns><button type=button class="ab-btn ab-btn-default" ng-click=cancel() style="width: 150px;height: 40px;font-size: 16px">&nbsp;&nbsp;取消&nbsp;&nbsp;</button> <button type=button class="ab-btn ab-btn-success" ng-disabled="!nForm.$valid " ng-click=newok() style="width: 190px;height: 40px;margin-left: 20px;font-size: 16px">&nbsp;&nbsp;确定&nbsp;&nbsp;</button></div></form></div>'),
a.put("components/loading/loading.html","<div class=ab-loading><img src=assets/images/loading.fba6538d.gif alt=loading...></div>"),a.put("components/onavbar/onavbar.html",'<div class="navbar navbar-default navbar-fixed-top"><div class=navbar-container><div class=navbar-header><a href=https://appadhoc.com target=_blank class="navbar-brand ablogo"></a></div><div uib-collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav navbar-right m-w-465"><li><a href=# target=_blank>首页</a></li><!--<li ng-show="isShow"><a href="http://doc.lpotest.comindex.html" target="_blank">使用文档</a></li>--><!--\n           -<li><a href="http://www.appadhoc.com/blog" target="_blank">博客</a></li>\n           --><li><span class=onav-line>|</span></li><li><a ui-sref=login class=onav-login>登录</a></li><!--\n           -<li><a class="onav-application" target="_blank" href="http://appadhoc.com/#apply">申请试用 <i class="icon iconfont icon-pencil01"></i></a></li>\n           --></ul></div></div></div>'),a.put("components/sliderplus/sliderplus.html",'<div class=slider-plus><div ng-show=showT><span class=slider-plus-point></span> <span class=testdata-expname>整体流量</span> <input name=name max=maxTraffic class="slider-plus-input ab-input" ng-change=changeModal(modal) ng-model=modal style=width:45px;min-width:45px><span class=slider-plus-perctent>%</span> <span ng-bind=tipError></span></div><slider class=slider-traffic ng-model=modal min=min step=step max=max value=val slidertooltipposition={{tposition}} on-slide-change=change on-start-slide=start() on-stop-slide=stop()></slider><span ng-show=showT name=button style="display: inline-block">可用流量:{{max}}%</span></div>'),a.put("components/slidingMenu/slidingMenu.html",'<div class=nav-wrap><ul class=sliding-menu ng-show="curStateName === \'app.data.summary.detail.retentionplus\' || curStateName === \'app.data.summary.detail\'"><li><a ng-click="goAnchor(\'summary\')"><i class="iconfont icon-sideoverview"></i><p>概览</p></a></li><li><a ng-click="goAnchor(\'flow\')"><i class="iconfont icon-sidecontrol"></i><p>流量</p></a></li><li><a ng-click="goAnchor(\'detail\')"><i class="iconfont icon-sidedetail"></i><p>指标</p></a></li><li ng-show="curStateName === \'app.data.summary.detail.retentionplus\'"><a ng-click="goAnchor(\'retentionplus\')"><i class="iconfont icon-sideret"></i><p>留存</p></a></li></ul><ul class="sliding-menu sliding-menu-down" ng-show=importDataRole><li><a ng-click=importData()><i class="iconfont icon-sidedownloade"></i></a></li></ul><ul class=sliding-menu ng-show="curStateName === \'app.data.testdata.version.stats\' || curStateName === \'app.data.testdata.h5version.autostats\' || curStateName === \'app.data.testdata.urlversion.urlstats\'"><li><a ng-click="goAnchor(\'testdata\')"><i class="iconfont icon-sidegear"></i><p>运行</p></a></li><li><a ng-click=goVersionAnchor()><i class="iconfont icon-sideversion"></i><p>版本</p></a></li><li><a ng-click="goAnchor(\'stats\')"><i class="iconfont icon-siderocket"></i><br><p>指标</p></a></li><li><a ng-click=openTestLogs()><i class="iconfont icon-Side_Log"></i><br><p>日志</p></a></li><testlog appid=curApp.id groupid=curGroup.id close=closeTestLogs ng-if=logsPanelSwitch></testlog></ul><ul class=sliding-menu ng-show="curStateName === \'app.data.devtest\'"><li><a ng-click="goAnchor(\'devtest\')"><i class="iconfont icon-sidegear"></i><p>集成</p></a></li></ul></div>'),a.put("components/statpanel/statpanel.html",'<ul ng-if=locked><li><ab-tab active=0><ab-tab-nav width=true title=新建指标></ab-tab-nav><ab-tab-nav width=true title=选择指标></ab-tab-nav><ab-tab-pane><div class=paneltip-line></div><div class=paneltip-waring ng-show=!comstatFig style=text-align:left>请在代码中需要上报处集成优化指标。参考 <a ng-show="curApp.typ === Constant.APP_TYPE_H5 || curApp.typ === Constant.APP_TYPE_DEF" class=ab-link href=http://doc.lpotest.com/sdk/htmlSDK.html#stat target=_blank>集成说明</a> <a ng-show="curApp.typ === Constant.APP_TYPE_ANDIOD" class=ab-link href=http://doc.lpotest.com/sdk/androidSDK.html#stat target=_blank>集成说明</a> <a ng-show="curApp.typ === Constant.APP_TYPE_IOS" href=http://doc.lpotest.com/sdk/iosSDK.html#stat target=_blank>集成说明</a> 。</div><!--<div class="paneltip-waring" style="background-color: antiquewhite;" ng-show="!comstatFig&& curApp.typ === Constant.APP_TYPE_ANDIOD || !comstatFig&& curApp.typ === Constant.APP_TYPE_IOS">--><!--<button style="padding:0px" type="button" class="ab-btn-icon statpanel-appsystem" ng-click="adding(Constant.SYSTEM_STATS_VISIT,Constant.SYSTEM_STATS_VISIT_DESCRIPTION)"><i class="iconfont icon-add02"></i>访问次数</button>--><!--<button style="padding:0px" type="button" class="ab-btn-icon statpanel-appsystem" ng-click="adding(Constant.SYSTEM_STATS_DURATION,Constant.SYSTEM_STATS_DURATION_DESCRIPTION)"><i class="iconfont icon-add02"></i><span>访问时长</span></button>--><!--<button style="padding:0px" type="button" class="ab-btn-icon statpanel-appsystem" ng-click="adding(Constant.SYSTEM_STATS_CRASH,Constant.SYSTEM_STATS_CRASH_DESCRIPTION)"><i class="iconfont icon-add02"></i>崩溃次数</button>--><!--<i class="iconfont icon-question201 ab-question201" uib-tooltip-template="\'statpanel-tooltip-a.html\'"></i>--><!--</div>--><form name=nform novalidate autocomplete=off class=paneltip-cona><div ng-class="{\'paneltip-comstat-formula-name\':comstatFig,\'paneltip-comstat-formula-name-active\':!comstatFig}"><input name=statName class="ab-input ab-input-block" ng-model=vm.name placeholder=指标名称 required ng-change="nameChange(nform, vm.name)" ng-pattern=/^[a-zA-Z][\\w\\d_]*$/ ><ab-input-icon form=nform input-name=statName></ab-input-icon><ab-input-desc form=nform input-name=statName>字母,数字或下划线,字母开头</ab-input-desc><ab-input-error-box form=nform input-name=statName><ab-error type=pattern custom=true>字母,数字或下划线,字母开头</ab-error><ab-error type=required custom=true>指标名称不能为空</ab-error><ab-error type=exist custom=true>指标名称已存在</ab-error></ab-input-error-box></div><div ng-class="{\'paneltip-comstat-formula\':comstatFig,\'paneltip-comstat-formula-active\':!comstatFig}"><input name=statDesc class="ab-input ab-input-block" ng-model=vm.desc placeholder=指标说明></div><div ng-if=comstatFig style=width:35%><input name=statFormula class="ab-input ab-input-block" ng-model=vm.formula placeholder=请输入计算公式 required ng-blur=checkStatFormula(nform,vm.formula)><ab-input-icon form=nform input-name=statFormula></ab-input-icon><ab-input-error-box form=nform input-name=statFormula><ab-error type=required>复合指标公式不能为空</ab-error><ab-error type=checkFormula custom=true>公式错误</ab-error></ab-input-error-box></div><button ng-click=create(nform,vm) type=submit ng-disabled=!nform.$valid class="ab-btn ab-btn-success ab-btn-square paneltip-whight" style=border-style:none><i class="iconfont icon-add02 paneltip-smicon"></i></button></form></ab-tab-pane><ab-tab-pane><div class=paneltip-line></div><div><ul><li ng-show="statsData.length ==0 " style=text-align:center;margin-top:38px>没有指标,请新建指标</li><li ng-show="statsData.length != 0" ng-class="{\'paneltip-creat\':!r.newCreat,\'paneltip-creat-active\': r.select}" ng-repeat="r in statsData track by $index"><div ng-show=comstatFig tabindex=-1 ng-click=selects(r) uib-tooltip-html=" \' {{r.name}}<br>公式:{{r.formula}} \' "><ul><li ng-bind=r.name></li><li class=paneltipcol ng-bind=r.description></li></ul><button class="ab-btn ab-btn-success ab-btn-square paneltip-whight" style=border-style:none><i class="iconfont icon-add02 paneltip-smicon"></i></button></div><div ng-show=!comstatFig tabindex=-1 ng-click=selects(r) uib-tooltip-html=" \' {{r.name}}<br>{{r.description}}\' "><ul><li ng-bind=r.name></li><li class=paneltipcol ng-bind=r.description></li></ul><button class="ab-btn ab-btn-success ab-btn-square paneltip-whight" style=border-style:none><i class="iconfont icon-add02 paneltip-smicon"></i></button></div></li></ul></div></ab-tab-pane></ab-tab></li><li class=paneltip-bottom><div class=paneltip-bottom-line><span class="paneltip-click iconfont icon-up01"></span> <span class="iconfont icon-semicircle01 paneltip-roundicon" ng-click=close() style=font-size:30px></span></div></li></ul><script type=text/ng-template id=statpanel-tooltip-a.html><div class="uib-tooltip-content">\n    <p>访问次数：访客从进入应用到离开应用记为1次访问，离开后超过30分钟再次访问记为下次。</p>\n    <p>访问时长(s)：从进入应用到离开应用的时间是一次访问的时长。</p>\n    <p>崩溃次数：应用崩溃和未捕获异常数据的次数。</p>\n  </div></script>'),a.put("components/testlog/testlog.html",'<div class="testlog-open animate-if"><div class=testlog-flotation ng-click=closeTestLog()></div><div class="nav-wrap testlog-open-content"><p><b>流量调整记录</b></p><ul><li><div class=ab-oh><span class="ab-fl testlog-gray ab-cursor" uib-tooltip={{indexUsersEmail[changesLogData[0].user_id].email}} ng-bind="indexUsersEmail[changesLogData[0].user_id].email || \'Admin\'"></span> <span class="ab-fr testlog-gray" ng-bind=changeTime(changesLogData[0].created_at)></span></div><div><p>创建了试验</p></div></li></ul><ul ng-repeat="l in exportslogs" ng-show=l.isShow><!--<li ng-show="l.flagsReduceShow">--><!--<div class="ab-oh">--><!--<span  class="ab-fl testlog-gray ab-cursor" uib-tooltip={{indexUsersEmail[l.user_id].email}} ng-bind="indexUsersEmail[l.user_id].email || \'Admin\'"> username</span>--><!--<span class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div  class="testlog-stat-content">--><!--<div > <p>移除变量: </p><span ng-repeat="key in l.flagsReduceArray">{{key}}</span></div>--><!--</div>--><!--</li>--><!--<li ng-show="l.flagsAddShow">--><!--<div class="ab-oh">--><!--<span  class="ab-fl testlog-gray ab-cursor" uib-tooltip={{indexUsersEmail[l.user_id].email}} ng-bind="indexUsersEmail[l.user_id].email || \'Admin\'"> username</span>--><!--<span class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div  class="testlog-stat-content">--><!--<div > <p>添加变量: </p><span ng-repeat="key in l.flagsAddArray"> <span> {{key}}</span></div>--><!--</div>--><!--</li>--><!--<li ng-show="l.statsReduceShow">--><!--<div  class="ab-oh">--><!--<span  class="ab-fl testlog-gray ab-cursor" uib-tooltip={{indexUsersEmail[l.user_id].email}} ng-bind="indexUsersEmail[l.user_id].email || \'Admin\' "> username</span>--><!--<span class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div  class="testlog-stat-content">--><!--<div> <p>移除指标: </p><span ng-repeat="key in l.statsReduceArray" ng-show="!noShowKey.hasOwnProperty(key)">{{showKeyWant.hasOwnProperty(key)?showKeyWant[key]:key}}--><!--<span ng-show="!$last"> ,</span> </span></div>--><!--</div>--><!--</li>--><!--<li ng-show="l.statsAddShow">--><!--<div  class="ab-oh">--><!--<span  class="ab-fl testlog-gray ab-cursor" uib-tooltip={{indexUsersEmail[l.user_id].email}} ng-bind="indexUsersEmail[l.user_id].email || \'Admin\' "> username</span>--><!--<span class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div  class="testlog-stat-content">--><!--<div > <p>添加指标: </p><span ng-repeat="key in l.statsAddArray" ng-show="!noShowKey.hasOwnProperty(key)">{{showKeyWant.hasOwnProperty(key)?showKeyWant[key]:key}}--><!--<span ng-show="!$last">,</span></span></div>--><!--</div>--><!--</li>--><li ng-show=l.experiment_changes.trafficShow><div class=ab-oh><span class="ab-fl testlog-gray ab-cursor" uib-tooltip={{indexUsersEmail[l.user_id].email}} ng-bind="indexUsersEmail[l.user_id].email || \'Admin\' "></span> <span class="ab-fr testlog-gray" ng-bind=changeTime(l.created_at)></span></div><div><p>调整试验流量为:</p><div ng-show="value.hasOwnProperty(\'after\')" ng-repeat="(key,value) in l.experiment_changes"><span>{{indexCurExps[key].name}}</span> : <span>{{value.after.traffic}}%</span></div></div></li><!--<li ng-show="l.isRun">--><!--<div class="ab-oh">--><!--<span  class="ab-fl testlog-gray" ng-bind="indexUsersEmail[l.user_id].email || \'Admin\' "></span>--><!--<span  class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div>--><!--<span  class="iconfont icon-point01 ab-link"><i></i></span><span>开始试验</span>--><!--</div>--><!--</li>--><!--<li ng-show="l.isStop">--><!--<div  class="ab-oh">--><!--<span class="ab-fl testlog-gray" ng-bind="indexUsersEmail[l.user_id].email || \'Admin\' "> </span>--><!--<span class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div >--><!--<span  class="iconfont icon-point01 ab-fontred"><i></i></span><span>停止试验</span>--><!--</div>--><!--</li>--><!--<li ng-show="l.showDeleteExp">--><!--<div  class="ab-oh">--><!--<span class="ab-fl testlog-gray" ng-bind="indexUsersEmail[l.user_id].email || \'Admin\' "></span>--><!--<span class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div >--><!--<span  class="iconfont icon-point01 ab-fontred"><i></i></span><span>删除试验:{{ l.showDeleteName }}</span>--><!--</div>--><!--</li>--><!--<li ng-show="isPublish">--><!--<div  class="ab-oh">--><!--<span class="ab-fl testlog-gray" ng-bind="indexUsersEmail[l.user_id].email || \'Admin\'"></span>--><!--<span  class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div >--><!--<span  class="iconfont icon-point01 ab-fontgreen"><i></i></span><span>发布试验</span>--><!--</div>--><!--</li>--><!--<li ng-show="l.isAddExp">--><!--<div  class="ab-oh">--><!--<span  class="ab-fl testlog-gray" ng-bind="indexUsersEmail[l.user_id].email || \'Admin\' "> </span>--><!--<span  class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div>--><!--<p ng-show="val" ng-repeat="(key,val) in l.experiment_changes">添加版本:{{val.after.name}}</p>--><!--<p></p>--><!--</div>--><!--</li>--><!--<li  ng-repeat=" (id,val) in l.experiment_changes|isChangeUrl " ng-show=" val.hasOwnProperty(\'changeUrl\')">--><!--<div>--><!--<div class="ab-oh" >--><!--<span  class="ab-fl testlog-gray" ng-bind="indexUsersEmail[l.user_id].email || \'Admin\' "></span>--><!--<span  class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div >--><!--<p> 修改{{indexCurExps[id].name}}页面链接由{{val.changeUrl.changeUrlBefore}}改为--><!--{{val.changeUrl.changeUrlAfter}}--><!--</p>--><!--</div>--><!--</div>--><!--</li>--><!--<li   ng-if="l.isChangeName">--><!--<div  class="ab-oh">--><!--<span class="ab-fl testlog-gray ab-cursor" uib-tooltip={{indexUsersEmail[l.user_id].email}} ng-bind="indexUsersEmail[l.user_id].email || \'Admin\' "></span>--><!--<span class="ab-fr testlog-gray" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div class="testlog-stat-content">--><!--<p ng-repeat=" (id,val) in l.experiment_changes" ng-show="val">--><!--将【{{val[\'before\'].name}}】版本名称修改为：【{{val[\'after\'].name}}】--><!--</p>--><!--</div>--><!--</li>--><!--<!-- <li ng-show="isChangeGroupDescription(l)">--><!--<div  class="ab-oh">--><!--<span class="ab-fl ab-cursor" uib-tooltip={{indexUsersEmail[l.user_id].email}} ng-bind="indexUsersEmail[l.user_id].email"></span>--><!--<span class="ab-fr" ng-bind="changeTime(l.created_at)"></span>--><!--</div>--><!--<div class="testlog-stat-content">--><!--<p  ng-show="l.group_change.after.description">--><!--修改了试验的描述,由{{l.group_change.before.description}}改成{{l.group_change.after.description}}--><!--</p>--><!--</div>--><!--</li> --></ul></div></div>')}]);